<?php

/**
 * @file
 * Module for building and managing site's blocks.
 */


module_load_include('inc', 'gv_blocks', 'inc/constants');


/**
 * Implements hook_block_info().
 */
function gv_blocks_block_info() {
  $blocks['main_menu_om_news'] = array(
    'info' => t('OM News'), 
    'cache' => DRUPAL_CACHE_GLOBAL, // DRUPAL_CACHE_GLOBAL
  );
  $blocks['main_menu_om_bus_voip'] = array(
    'info' => t('OM Business VoIP'),
    'cache' => DRUPAL_CACHE_GLOBAL,
  );  
  $blocks['main_menu_om_res_voip'] = array(
    'info' => t('OM Residential VoIP'),
    'cache' => DRUPAL_CACHE_GLOBAL,
  );

  $blocks['main_menu_om_voip_reviews'] = array(
    'info' => t('OM VoIP Reviews'),
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  $blocks['main_menu_om_articles'] = array(
    'info' => t('OM Articles'),
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  $blocks['main_menu_om_voiplibrary'] = array(
    'info' => t('OM VoIP Library'),
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  $blocks['main_menu_om_blog'] = array(
    'info' => t('OM Blog'),
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  $blocks['main_menu_om_aboutus'] = array(
    'info' => t('OM About Us'),
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  $blocks['footer_menu'] = array(
    'info' => t('Footer menu'),
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  $blocks['header_links'] = array(
    'info' => t('Header links'),
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  
  $blocks['request_quote'] = array(
    'info' => t('Request a quote block'),
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  $blocks['request_quote_v2'] = array(
    'info' => t('Request a quote block v2'),
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  $blocks['request_quote_v3'] = array(
    'info' => t('Request a quote block v3'),
    'cache' => DRUPAL_CACHE_GLOBAL,
  );  
  $blocks['request_quote_v4'] = array(
    'info' => t('Request a quote block v4'),
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  $blocks['request_quote_v5'] = array(
    'info' => t('Request a quote block v5 (for a highlite region)'),
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  $blocks['request_quote_v6'] = array(
    'info' => t('Request a quote block v6 (sidebar 2 steps)'),
    'cache' => DRUPAL_CACHE_GLOBAL,
  ); 
  
  $blocks['get_access_banner'] = array(
    'info' => t('Get access... Banner'),
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  
  $blocks['get_prefaceHome'] = array(
    'info' => t('Main section of the Front page preface'),
    'cache' => DRUPAL_CACHE_GLOBAL,
  );  
  
  $blocks['r_provider_p_bottom'] = array(
    'info' => t('Bottom section of Residential providers page preface'),
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  $blocks['b_provider_p_bottom'] = array(
    'info' => t('Bottom section of Business providers page preface'),
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  $blocks['sip_provider_p_bottom'] = array(
    'info' => t('Bottom section of SIP providers page preface'),
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  $blocks['ifa_provider_p_bottom'] = array(
    'info' => t('Bottom section of IFA providers page preface'),
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  
  
  $blocks['best_voip_p_bottom'] = array(
    'info' => t('Bottom section of best-voip-service-providers page preface'),
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  $blocks['bu_voip_features_p_bottom'] = array(
    'info' => t('Bottom section of business-voip-features page preface'),
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  $blocks['canada_voip_p_bottom'] = array(
    'info' => t('Bottom section of canada-voip page preface'),
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  
  $blocks['news_tags'] = array(
    'info' => t('Shows a tag cloud for news tags'),
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  $blocks['blog_tags'] = array(
    'info' => t('Shows a tag cloud for blog tags'),
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  $blocks['articles_tags'] = array(
    'info' => t('Shows a tag cloud for Voip library tags'),
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  $blocks['t_pick_providers_ar'] = array(
    'info' => t('Top pick providers for the all providers reviews page'),
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  $blocks['google_all_reviews_snippet'] = array(
    'info' => t('Google all  reviews aggregator snippet with the descriptive caption'),
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  // Topics block for different content types.
  $content_types = array('blog_post' => 'blog', 'news_post' => 'news', 'article' => 'articles');
  foreach ($content_types as $content_type => $label) {
    
    $blocks[$content_type . '_topics'] = array(
      'info' => t(drupal_ucfirst($label) . ' topics'),
      'cache' => DRUPAL_CACHE_GLOBAL,
    );
  }
  
  
  $blocks['ad_free_ipad_mini'] = array(
    'info' => t('Ad for a free ipad-mini'),
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  $blocks['weekly_video'] = array(
    'info' => t('GV Weekly video'),
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  
  $blocks['current_page_provider_articles'] = array(
    'info' => t('Current page provider articles'),
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  $blocks['blog_page_latest_news'] = array(
    'info' => t('Blog page latest news'),
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  $blocks['preface_bottom_latest_articles'] = array(
    'info' => t('Preface bottom latest articles'),
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  return $blocks;
}


/**
 * Implements hook_block_view().
 */
function gv_blocks_block_view($delta = '') {
  $block = array();
  switch ($delta) {      
    case 'main_menu_om_news':
      $block['subject'] = t('OM News');
      $block['content'] = gv_blocks_get_omMenuBlock_byTitle('News', 'gv_blocks_get_omMenuBlock_News');
      break;
    case 'main_menu_om_bus_voip':
      $block['subject'] = t('OM Business VoIP');
      $block['content'] = gv_blocks_get_omMenuBlock_byTitle('Business VoIP', 'gv_blocks_get_omMenuBlock_Providers');
      break;
  case 'main_menu_om_res_voip':
      $block['subject'] = t('OM Residential VoIP');
      $block['content'] = gv_blocks_get_omMenuBlock_byTitle('Residential VoIP', 'gv_blocks_get_omMenuBlock_Providers');
      break;    
    
  case 'main_menu_om_voip_reviews':
      $block['subject'] = t('OM VoIP Reviews');
      $block['content'] = gv_blocks_get_omMenuBlock_byTitle('VoIP Reviews', 'gv_blocks_get_omMenuBlock_Providers');
      break;    
    
    
    
    case 'main_menu_om_blog':
      $block['subject'] = t('OM Blog');
      $block['content'] = gv_blocks_get_omMenuBlock_byTitle('Blog', 'gv_blocks_get_omMenuBlock_Blog');
      break;
    case 'main_menu_om_aboutus':
      $block['subject'] = t('OM About Us');
      $block['content'] = gv_blocks_get_omMenuBlock_byTitle('About Us', 'gv_blocks_get_omMenuBlock_AboutUs');
      break;
    
    case 'main_menu_om_articles':
      $block['subject'] = t('OM Articles');
      $block['content'] = gv_blocks_get_omMenuBlock_byTitle('Articles', 'gv_blocks_get_omMenuBlock_articles');
      break;
    
    case 'main_menu_om_voiplibrary':
      $block['subject'] = t('OM VoIP Library');
      $block['content'] = gv_blocks_get_omMenuBlock_byTitle('VoIP Library', 'gv_blocks_get_omMenuBlock_voiplibrary');
      break;
    
    
    case 'footer_menu':
      $block['subject'] = t('Footer menu');
      $block['content'] = gv_blocks_get_footerMenu();
      break; 
    case 'header_links':
      $block['subject'] = t('Header links');
      $block['content'] = gv_blocks_get_headerLinks();
      break; 
    
    case 'request_quote':
      $block['subject'] = t('Request a quote block');
      $block['content'] = gv_blocks_get_requestQuote_block_v1();
      break; 
    case 'request_quote_v2':
      $block['subject'] = t('Request a quote block v2');
      $block['content'] = gv_blocks_get_requestQuote_block_v2();
      break; 
    case 'request_quote_v3':
      $block['subject'] = t('Request a quote block v3');
      $block['content'] = gv_blocks_get_requestQuote_block_v3();
      break;
    case 'request_quote_v4':
      $block['subject'] = t('Request a quote block v4');
      $block['content'] = gv_blocks_get_requestQuote_block_v4();
      break;
    case 'request_quote_v5':
      $block['subject'] = t('Request a quote block v5 (for a Highlite region)');
      $block['content'] = gv_blocks_get_requestQuote_block_v5();
      break;
    case 'request_quote_v6':
      $block['subject'] = t('Request a quote block v6 (for a side bar 2 steps)');
      $block['content'] = gv_blocks_get_requestQuote_block_v6();
      break;
    
    case 'get_access_banner':
      $block['subject'] = t('GET ACCESS TO THE LARGEST <br>VOIP FOOTPRINT <br>IN THE NATION');
      $block['content'] = gv_blocks_get_accessToFootprintBanner();
      break;         
     
    
    case 'get_prefaceHome':
      $block['subject'] = t('Main section of the Front page preface');
      $block['content'] = gv_misc_getPrefaceMainSection('front'); // Arg - preface's key
      break;
    case 'b_provider_p_bottom':
      $block['subject'] = t('Bottom section of Business providers page preface');
      $block['content'] = gv_misc_getPrefaceBottomSection('page-compare-business-voip-providers');
      break;
    case 'r_provider_p_bottom':
      $block['subject'] = t('Bottom section of Residential providers page preface');
      $block['content'] = gv_misc_getPrefaceBottomSection('page-compare-residential-voip-providers');
      break;
    case 'sip_provider_p_bottom':
      $block['subject'] = t('Bottom section of SIP providers page preface');
      $block['content'] = gv_misc_getPrefaceBottomSection('page-compare-sip-voip-providers');
      break;
    case 'ifa_provider_p_bottom':
      $block['subject'] = t('Bottom section of IFA providers page preface');
      $block['content'] = gv_misc_getPrefaceBottomSection('page-compare-ifa-voip-providers');
      break;
    
    
    
    case 'best_voip_p_bottom':
      $block['subject'] = t('Bottom section of best-voip-service-providers page preface');
      $block['content'] = gv_misc_getPrefaceBottomSection('best-voip-service-providers');
      break;
    case 'bu_voip_features_p_bottom':
      $block['subject'] = t('Bottom section of business-voip-features page preface');
      $block['content'] = gv_misc_getPrefaceBottomSection('business-voip-features');
      break;
    
    case 'canada_voip_p_bottom':
      $block['subject'] = t('Bottom section of canada-voip page preface');
      $block['content'] = gv_misc_getPrefaceBottomSection('canada-voip');
      break;
  
    
    
    case 'news_tags':
      $block['subject'] = t('Shows a tag cloud for news tags');
      $block['content'] = gv_pages_buildTopicsPage('news');
      break;
    case 'blog_tags':
      $block['subject'] = t('Shows a tag cloud for blog tags');
      $block['content'] = gv_pages_buildTopicsPage('blog');
      break;
    case 'articles_tags':
      $block['subject'] = t('Shows a tag cloud for Voip library tags');
      $block['content'] = gv_pages_buildTopicsPage('articles');
      break;
    
    case 't_pick_providers_ar':
      $block['subject'] = t('Top pick providers for the all providers reviews page');
      $block['content'] = gv_pages_getTopPickProvidersBlocksForAllReviewsPage();
      break;
  
    case 'google_all_reviews_snippet':
      $block['subject'] = t('Google all  reviews aggregator snippet with the descriptive caption');
      $block['content'] = gv_blocks_getGoogleAllReviewsSnippet();
      break;
  
    
    default:
      // Get blocks for topics for a specific content type.
      if (strpos($delta, '_topics')) {
        $content_types = array('blog_post' => 'blog', 'news_post' => 'news', 'article' => 'articles');
        $content_type = str_replace('_topics', '', $delta);
        if(!isset($content_types[$content_type])) {
          continue;
        }
        $block['subject'] = t(drupal_ucfirst($content_types[$content_type]) . ' topics');
        $block['content'] = gv_blocks_get_topicsBlock($content_type);
      }
      break;
      
      
    case 'ad_free_ipad_mini':
      $block['subject'] = t('Ad for a free ipad-mini');
      $block['content'] = gv_blocks_getAdBlock('free_ipad_mini');
      break;
    
    case 'weekly_video':
      $block['subject'] = t('GV Weekly video');
      $block['content'] = gv_blocks_weeklyVideoBlock();
      break;
    
    case 'current_page_provider_articles':
      $block_data = gv_blocks_currentPageProviderArticles();
      $block['subject'] = $block_data['title']; //t('Current page provider articles');
      $block['content'] = $block_data['content']; //gv_blocks_currentPageProviderArticles();
      break;
    
    case 'blog_page_latest_news':
      $block['subject'] = t('Blog page latest news');
      $block['content'] = gv_blocks_blogPageLatestNews();
      break;
    
    case 'preface_bottom_latest_articles':
      $block['subject'] = t('Preface bottom latest articles');
      $block['content'] = gv_blocks_prefaceBottomLatestArticles();
      break;
    
  }

  return $block;
}


/**
 * Implements hook_block_configure().
 */
function gv_blocks_block_configure($delta = '') {
  
  $form = array();
  
  if ($delta == 'weekly_video') {
    
    $form['youtube_video_id'] = array(
      '#type' => 'textfield', 
      '#title' => t('YouTube video id'),
      '#default_value' => variable_get('gv_weekly_video_block', NULL), 
    );
    
  }
  
  return $form;
}


/**
 * Implements hook_block_save().
 */
function gv_blocks_block_save($delta = '', $edit = array()) {

  if ($delta == 'weekly_video') {
    variable_set('gv_weekly_video_block', $edit['youtube_video_id']);
  }
  
}


/**
 * Returns a preface Bottom Latest Articles block.
 */
function gv_blocks_prefaceBottomLatestArticles() {

  $content = NULL;
  
  $map_path_to_type = array(
    '/compare-business-voip-providers' => 'Business VoIP',
    '/compare-residential-voip-providers' => 'Residential VoIP',
    '/business-voip-features' => 'Business VoIP Features',
    '/sip-trunking-providers' => 'SIP Trunking Providers',
    '/canada-voip' => 'Canada VoIP',
    '/internet-fax-service-providers' => 'Internet Fax',
  );
  
  $pin_article_to = array(
    'Business VoIP' => 1,
    'Residential VoIP' => 2, 
    'Business VoIP Features' => 3,
    'SIP Trunking Providers' => 4,
    'Canada VoIP' => 5,
    'Internet Fax' => 6,
  );
  
  if (!$page_index = @$pin_article_to[@$map_path_to_type[@$_SERVER['REDIRECT_URL']]]) {
    return NULL;
  }
  dpm('page_index = ' . $page_index);
  
//  $query = db_select('node', 'n')  
//        ->fields('n', array('nid', 'created'));
//  $query->leftJoin('field_data_field_pin_article_to', 'a', 'a.field_pin_article_to_value = ' . $page_index);
//  $query->fields('a', array('entity_id'));
//  $query->condition('n.nid', 'a.entity_id');
//  $query->orderBy('n.created', 'DESC')
//        ->range(0, 9);
  //$provider_articles_teasers = $query->execute()->fetchAllAssoc('n.nid');
  
  $query = db_select('field_data_field_pin_article_to', 'a')
        ->fields('a', array('entity_id'));
  $query->leftJoin('node', 'n', 'n.nid = a.entity_id')
        ->fields('n', array('nid', 'created'));
  $query->condition('a.field_pin_article_to_value', $page_index);
  $query->orderBy('n.created', 'DESC')
        ->range(0, 9);
  
  $results = $query->execute()->fetchAll();

  dpm($results);
  return 'xxx';
  
  if (!empty($results)) {
    dpm($results);
    $count = count($results) - 1;
    foreach ($results as $key => $result) {
      $extra_data = unserialize($result->field_extra_data_value);
      //dpm($extra_data);
      $content .= '<div class="views-row' . ($key == $count ? ' last' : '') . '">

                  <div class="views-field views-field-created date-icon">
                    <span class="field-content">
                        <span>
                          <span>' . date('d\<\/\s\p\a\n\>\<\d\i\v\>M\<\/\d\i\v\>', $result->created) . '
                        </span>
                    </span>
                  </div>

                  <div class="views-field views-field-title">
                    <span class="field-content">' .
                      l($extra_data['title'], 'node/' . $result->nid) .
                    '</span>
                  </div>

                  <div class="views-field teaser">
                    <span class="field-content">' .
                      $extra_data['teaser_block'] .
                    '</span>
                  </div>

                  <div class="bottom-clear"></div>

                </div>';

            ;
    }

    $content = '<div class="view-content block-teasers">' . $content . '</div>';
  }

  return $content;
}


/**
 * Returns a Blog page latest news block.
 */
function gv_blocks_blogPageLatestNews() {
  
  $content = NULL;
  

    $query = db_select('node', 'n')  
          ->fields('n', array('nid', 'created'));
    $query->leftJoin('field_data_field_extra_data', 'e', 'e.entity_id = n.nid');
    $query->fields('e', array('field_extra_data_value'));
    $query->condition('n.type', 'news_post');
    $query->orderBy('n.created', 'DESC')
          ->range(0, 9);
    //$provider_articles_teasers = $query->execute()->fetchAllAssoc('n.nid');
    $results = $query->execute()->fetchAll();
    
    if (!empty($results)) {
      //dpm($results);
      $count = count($results) - 1;
      foreach ($results as $key => $result) {
        $extra_data = unserialize($result->field_extra_data_value);
        //dpm($extra_data);
        $content .= '<div class="views-row' . ($key == $count ? ' last' : '') . '">
          
                    <div class="views-field views-field-created date-icon">
                      <span class="field-content">
                          <span>
                            <span>' . date('d\<\/\s\p\a\n\>\<\d\i\v\>M\<\/\d\i\v\>', $result->created) . '
                          </span>
                      </span>
                    </div>

                    <div class="views-field views-field-title">
                      <span class="field-content">' .
                        l($extra_data['title'], 'node/' . $result->nid) .
                      '</span>
                    </div>
                    
                    <div class="views-field teaser">
                      <span class="field-content">' .
                        $extra_data['teaser_block'] .
                      '</span>
                    </div>

                    <div class="bottom-clear"></div>
                    
                 </div>';
              
              ;
      }
      
      $content = '<div class="view-content block-teasers">' . $content . '</div>';
    }

  return $content;
}


/**
 * Returns a Current page provider articles block.
 */
function gv_blocks_currentPageProviderArticles() {
  
  $content = NULL;
  $title = NULL;
  
  $args = arg();
  if ($args[0] == 'node') {
    $query = db_select('field_data_field_providers_mentioned', 'p')  
          ->fields('p', array('entity_id'));
    $query->leftJoin('node', 'n', 'n.nid = p.entity_id');
    $query->leftJoin('field_revision_field_p_name"', 'pn', 'pn.entity_id = p.field_providers_mentioned_target_id');
    
    $query->leftJoin('field_data_field_extra_data', 'e', 'e.entity_id = p.entity_id');
    $query->fields('n', array('created'));
    $query->fields('pn', array('field_p_name_value'));
    $query->fields('e', array('field_extra_data_value'));
    $query->condition('p.field_providers_mentioned_target_id', $args[1]);
    $query->orderBy('n.created', 'DESC')
          ->range(0, 9);//->limit(10);
    //$provider_articles_teasers = $query->execute()->fetchAllAssoc('p.entity_id');
    $results = $query->execute()->fetchAll();

    if (!empty($results)) {
      //dpm($results);
      $count = count($results) - 1;
      $title = $results[0]->field_p_name_value . ' articles';
      foreach ($results as $key => $result) {
        $extra_data = unserialize($result->field_extra_data_value);
        //dpm($extra_data);
        $content .= '<div class="views-row' . ($key == $count ? ' last' : '') . '">
          
                    <div class="views-field views-field-created date-icon">
                      <span class="field-content">
                          <span>
                            <span>' . date('d\<\/\s\p\a\n\>\<\d\i\v\>M\<\/\d\i\v\>', $result->created) . '
                          </span>
                      </span>
                    </div>

                    <div class="views-field views-field-title">
                      <span class="field-content">' .
                        l($extra_data['title'], 'node/' . $result->entity_id) .
                      '</span>
                    </div>
                    
                    <div class="views-field teaser">
                      <span class="field-content">' .
                        $extra_data['teaser_block'] .
                      '</span>
                    </div>

                    <div class="bottom-clear"></div>
                    
                 </div>';
              
              ;
              
      }
      
      $content = '<div class="view-content block-teasers">' . $content . '</div>';
    }
  }
  return array('title' => $title, 'content' => $content);
}


/**
 * Returns a weekly Video block.
 */
function gv_blocks_weeklyVideoBlock() {
  
  $youtube_video_id = variable_get('gv_weekly_video_block', NULL);
  $out = '<iframe width="238" height="160" src="http://www.youtube.com/embed/' . $youtube_video_id . '?rel=0&wmode=opaque" frameborder="0" allowfullscreen></iframe>';
  
  //$out = '<object width="238" height="160"><param name="movie" value="http://www.youtube.com/v/' . $youtube_video_id . '?version=3&amp;hl=en_US&amp;rel=0"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><embed src="http://www.youtube.com/v/' . $youtube_video_id . '?version=3&amp;hl=en_US&amp;rel=0" type="application/x-shockwave-flash" width="238" height="160" allowscriptaccess="always" allowfullscreen="true"></embed></object>';
  
  return $out;
}


/**
 * Returns an ad block by its name.
 */
function gv_blocks_getAdBlock($ad_name) {
  switch ($ad_name) {
    case 'free_ipad_mini':
      
      $path_to_custom_js = 'sites/all/libraries/jquery.plugins/countdown/';
      drupal_add_js($path_to_custom_js . 'kkcountdown.min.js');
      $path_to_custom_js = drupal_get_path('module', 'gv_misc') . '/js/';
      drupal_add_js($path_to_custom_js . 'gv_countdown.js');
  
      return '<a href="/blog/2012/11/19/getvoipcom-holiday-sweepstakes-win-a-free-ipad-mini"><img src="/sites/default/files/a/free-ipad-mini-banner.jpg" /></a>
              <span time="' . strtotime('2012-12-18, 23:59:59') . '" class="kkcount-down" id="ipad_mini"></span>';
  }
}


/**
 * Returns a snippet providing a data for all reviews aggregator data for Google search.
 */
function gv_blocks_getGoogleAllReviewsSnippet() {
  
  $allReviewsAmount = variable_get('gv_allReviewsAmount');
  $out = '<div class="content page preface" xmlns:v="http://rdf.data-vocabulary.org/#" typeof="v:Review-aggregate">
          <div id="all-reviews-snippet">Total of <span id="count" property="v:count">' . $allReviewsAmount . '</span> Reviews for all <span id="itemreviewed" property="v:itemreviewed">VoIP Providers</span><span class="rating-descr" style="display: none;">, with top rating of <span id="rating" property="v:rating">5</span></span>
          </div>';
  return $out;
}


/**
 * Returns a two themed blocks with Top pick providers for the All Reviews page
 */
function gv_pages_getTopPickProvidersBlocksForAllReviewsPage() {
  $out = '';// '<div class="providers areviews">';
  
  /*
  $block_data = array('module' => 'views', 'delta' => 'providers-block_pick_bu_areviews', 'shadow' => TRUE);
  $out .= gv_blocks_getBlockThemed($block_data);
  $block_data = array('module' => 'views', 'delta' => 'providers-block_pick_re_areviews', 'shadow' => TRUE);
  $out .= gv_blocks_getBlockThemed($block_data);
  */
  
  // Get block for Top pick business providers.
  $block_data = array('module' => 'views', 'delta' => 'providers-block', 'shadow' => FALSE, 'subject' => 'Top Business VoIP Providers Reviews');
  $out .= gv_blocks_getBlockThemed($block_data);
 
  // Get block for Top pick residential providers.
  $block_data = array('module' => 'views', 'delta' => 'providers-block_1', 'shadow' => FALSE, 'subject' => 'Top Residential VoIP Providers Reviews'); 
  $out .= gv_blocks_getBlockThemed($block_data);
  
  
  //$out .= '<div class="bottom-clear"></div>';
  return $out;
}


/**
 * Returns a two themed blocks with Top pick providers for the Articles (news, blog, etc) directory page 
 */
function gv_pages_getTopProvidersBlocksForArticlesDirectory() {
  
  $out = '<div class="providers dir">';
  $block_data = array('module' => 'views', 'delta' => 'providers-block_pick_bu', 'shadow' => TRUE);
  $out .= gv_blocks_getBlockThemed($block_data);
  $block_data = array('module' => 'views', 'delta' => 'providers-block_pick_re', 'shadow' => TRUE);
  $out .= gv_blocks_getBlockThemed($block_data);
  $out .= '<div class="bottom-clear"></div>';
  $out .= '</div>';
  return $out;
}


/**
 * Returns a themed topics block for a specific content type.
 * 
 * Allows to use same topics for News, Articles, Blog posts, etc.
 */
function gv_blocks_get_topicsBlock($content_type) {
  
  global $language;
  $topics = NULL;
  $topics = cache_get($content_type . '_topics_block' . $language->language);
  if (!$topics || empty($topics->data) || $topics->expire < time()) {
    // Key = url_argument, used in building the url, 
    // for example,
    // topics/news for topics list for news 
    // OR blog/provider for show all blog posts tagged with 'provider' topic.
    $content_types = array('blog_post' => 'blog', 'news_post' => 'news', 'article' => 'articles');
    $url_argument = $content_types[$content_type];
    $topics = gv_misc_getTopics($content_type, $url_argument, 2);
    if(!$topics) {
      return NULL;
    }
    $topics = theme('gv_misc_submenuSimple', array('submenu' => array('below' => $topics), 'class' => 'topics'));
    $topics .= '<div class="more-link">' . l(t('More'), $url_argument . '/tags') . '</div>';
    // Expire = current time + 4 hours.
    cache_set($content_type . '_topics_block' . $language->language, $topics, 'cache', time() + 14400);
  }
  else {
    $topics = $topics->data;
  }
  return $topics; 
}


/**
 * Returns a themed News topics block. 
 * 
 * Allows to use same topics for News, Articles, Blog posts, etc.
 */
/*
function gv_blocks_get_newsTopics() {
  global $language;
  $topics = cache_get('news_topics_block' . $language->language);
  if (!$topics || empty($topics->data) || $topics->expire < time()) {
    $topics = gv_misc_getTopics('news_post', 'news', 2);
    $topics = theme('gv_misc_submenuSimple', array('submenu' => array('below' => $topics), 'class' => 'topics'));
    $topics .= '<div class="more-link">' . l(t('More'), 'news-topics'). '</div>';
    // Expire = current time + 4 hours.
    cache_set('news_topics_block' . $language->language, $topics, 'cache', time() + 14400);
  }
  else {
    $topics = $topics->data;
  }
  return $topics; 
}
*/


/**
 * Returns a themed Header links block.
 */
function gv_blocks_get_headerLinks() {
  
  $cid = 'gv_cached_headerLinks';
  $cache = cache_get($cid, 'cache');

  if ($cache && !empty($cache->data) && $cache->expire > time()) {
    $out = $cache->data;
  }
  else {
    $menu = menu_build_tree('menu-header-links');
    $out = theme('gv_misc_headerLinks', array('submenu' => array('below' => $menu)));
    
    cache_set($cid, $out, 'cache', strtotime('+31 day'));
  } 
  
//  $menu = menu_build_tree('menu-header-links');
//  $out = theme('gv_misc_headerLinks', array('submenu' => array('below' => $menu)));
  return $out;
}


/**
 * Returns a themed Footer menu.
 */
function gv_blocks_get_footerMenu() {
  
  $cid = 'gv_footer_menu';
  $cache = cache_get($cid, 'cache');

  if ($cache && !empty($cache->data) && $cache->expire > time()) {
    $out = $cache->data;
  }
  else {
    $menu = menu_build_tree('menu-footer-menu');
    $out = theme('gv_misc_submenuSimple', array('submenu' => array('below' => $menu), 'class' => 'menu', 'delimiter' => '<li> | </li>')); // . '<div class="c">В© 2012 GetVoIP.com | All Rights Reserved</div>';
    
    cache_set($cid, $out, 'cache', strtotime('+31 day'));
  } 
  
  //$menu = menu_build_tree('menu-footer-menu');
  //$out = theme('gv_misc_submenuSimple', array('submenu' => array('below' => $menu), 'class' => 'menu', 'delimiter' => '<li> | </li>')); // . '<div class="c">В© 2012 GetVoIP.com | All Rights Reserved</div>';
  
  return $out;
}


/**
 * Dispatcher for getting themed block for MegaMenu by a block title.
 */
function gv_blocks_get_omMenuBlock_byTitle($title, $function) {

  // global $language;
  // $types = cache_get('types_' . $language->language);
  // Expire = current time + 2 hours.
  // cache_set('types_' . $language->language, $types, 'cache', time() + 7200);
  
  // Get main menu wireframe menu.
  $submenu = gv_blocks_getSubmenuByTitle('main-menu', $title);
  //return '<div class="om-btitle">' . $title . '</div>' . $function($submenu);
  return $function($submenu);
}


/**
 * Returns a themed News block content for MegaMenu.
 */
function gv_blocks_get_omMenuBlock_News($submenu) {
  $block_data = array('module' => 'gv_blocks', 'delta' => 'news_post_topics', 'subject_visible' => FALSE);
  $out = gv_blocks_getBlockThemed($block_data);
  return $out;  
  //return theme('gv_misc_submenuSimple', array('submenu' => $submenu, 'class' => 'block'));
}


/**
 * Returns a themed Library block content for MegaMenu.
 */
function gv_blocks_get_omMenuBlock_articles($submenu) {
  return theme('gv_misc_submenuSimple', array('submenu' => $submenu, 'class' => 'block'));
}


/**
 * Returns a themed VoIP Providers block content for MegaMenu.
 */
function gv_blocks_get_omMenuBlock_Providers($submenu) {
  return theme('gv_misc_submenuSimple', array('submenu' => $submenu, 'class' => 'block'));
}


/**
 * Returns a themed VoIP Blog block content for MegaMenu.
 */
function gv_blocks_get_omMenuBlock_Blog($submenu) {
  $block_data = array('module' => 'gv_blocks', 'delta' => 'blog_post_topics', 'subject_visible' => FALSE);
  $out = gv_blocks_getBlockThemed($block_data);
  return $out;  
  //return theme('gv_misc_submenuSimple', array('submenu' => $submenu, 'class' => 'block'));
}


/**
 * Returns a themed VoIP Blog block content for MegaMenu.
 */
function gv_blocks_get_omMenuBlock_AboutUs($submenu) {
  return theme('gv_misc_submenuSimple', array('submenu' => $submenu, 'class' => 'block'));
}


/**
 * Returns a themed All About VoIP block content for MegaMenu.
 */
function gv_blocks_get_omMenuBlock_voiplibrary($submenu) {
  $block_data = array('module' => 'gv_blocks', 'delta' => 'article_topics', 'subject_visible' => FALSE);
  $out = gv_blocks_getBlockThemed($block_data);
  return $out;   
  //return theme('gv_misc_submenuSimple', array('submenu' => $submenu, 'class' => 'block'));
}


/**
 * Returns a themed Editor block content for MegaMenu.
 */
function gv_blocks_get_omMenuBlock_Editor($submenu) {
  return theme('gv_misc_submenuSimple', array('submenu' => $submenu, 'class' => 'block'));
}


/**
 * Returns a themed custiom User block content (which contains several blocks and contents) for MegaMenu.
 */
function gv_blocks_get_omMenuBlock_User($submenu) {
  
  $out = NULL;
  // Build block for User login/logout.
  global $user;
  if($user->uid) {
    $out .= '<div class="title">' . t('You are logged in as ') . '<b>' . $user->name . '</b></div>';
    
    $block_data = array('module' => 'system', 'delta' => 'user-menu', 'subject_visible' => FALSE);
    $out .= gv_blocks_getBlockThemed($block_data);
  }
  else {
    $block_data = array('module' => 'user', 'delta' => 'login');
    $out .= gv_blocks_getBlockThemed($block_data);
  }
  return $out; 
}


/**
 * Returns a submenu from a menu.
 */
function gv_blocks_getSubmenuByTitle($menu_name, $submenu_title) {
  $menu = menu_build_tree($menu_name);
  if(!$menu) {
    return NULL;
  }
  foreach ($menu as $submenu) {
    if ($submenu['link']['link_title'] == $submenu_title) {
      return $submenu;
    }
  }
  return NULL;
}


/**
 * Wrap a block content in proper block's divs.
 */
function gv_blocks_wrapInBlockThemed($block_data, $block)
{
  if(!isset($block['content']) || !$block['content']) {
      return null;
  }
  if (is_array($block['content'])) {
    $block['content'] = render($block);
  }
  if(isset($block_data['subjectTag']) && $block_data['subjectTag']) {
    $subjectTag = $block_data['subjectTag'];
  }
  else {
    $subjectTag = 'h2';
  }
  if(isset($block_data['replaceUnderlinesWithDashesInID']) && $block_data['replaceUnderlinesWithDashesInID']) {
    $block_data['module'] = str_replace('_', '-', $block_data['module']);
    $block_data['delta'] = str_replace('_', '-', $block_data['delta']);
  }
  if (isset($block_data['shadow']) && $block_data['shadow']) {
    return 
      '<section id="block-' . $block_data['module'] . '-' . $block_data['delta'] . '" class="block gv block-' . $block_data['module'] . (isset($block_data['class']) ? ' ' . $block_data['class'] : '') . '">' 
        . '<div class="inside">'
            . ( ($block['subject'] && (!isset($block_data['subject_visible']) || $block_data['subject_visible']) )
                ? 
                '<div class="block-icon pngfix"></div><' . $subjectTag . ' class="block-title">' . $block['subject'] . '</' . $subjectTag . '>'
                :
                '') 
            . '<div class="content">' . $block['content'] . '</div>
          </div> <!-- /.inside -->
          <div class="shadow"></div>
      </section>';
  }
  else {
    return 
      '<section id="block-' . $block_data['module'] . '-' . $block_data['delta'] . '" class="block gv block-' . $block_data['module'] . (isset($block_data['class']) ? ' ' . $block_data['class'] : '') . '">' 
         . ( ($block['subject'] && (!isset($block_data['subject_visible']) || $block_data['subject_visible']) )
            ? 
            '<div class="block-icon pngfix"></div><' . $subjectTag . ' class="block-title">' . $block['subject'] . '</' . $subjectTag . '>'
            :
            '') 
         . '<div class="content">' . $block['content'] . '</div>
      </section>';
  }
}


/**
 * Returns a content of a block wrapped in proper divs.
 */
function gv_blocks_getBlockThemed_noCache($block_data){
  
  // No caching version.
  
  $block = module_invoke($block_data['module'], 'block_view', $block_data['delta']);
  if ($block) {
    if (isset($block_data['subject'])) {
      $block['subject'] = $block_data['subject'];
    }
    elseif (@$block_data['no_subject']) {
      $block['subject'] = '';
    }
    return gv_blocks_wrapInBlockThemed($block_data, $block);
  }
  return NULL;
  
}


/**
 * Returns a content of a block wrapped in proper divs.
 */
function gv_blocks_getBlockThemed($block_data, $cache_on = FALSE, $cache_expire_str = FALSE, $suffix = NULL)
{

  
  
  // No caching version.
  
  if (!$cache_on) {
    return gv_blocks_getBlockThemed_noCache($block_data);
  }

  
  
  // Caching system version.
  
  $cid = 'gv-block-cache---' . $block_data['module'] . '-' . $block_data['delta'] . $suffix;
  $cache = cache_get($cid, 'cache');

  if ($cache && !empty($cache->data) && $cache->expire > time()) {
    $out = $cache->data;
  }
  else {

    if ($out = gv_blocks_getBlockThemed_noCache($block_data)) {
      if ($cache_expire_str) {
        cache_set($cid, $out, 'cache', strtotime($cache_expire_str));
      }
      else {
        cache_set($cid, $out, 'cache');
      }
      
    }

  } // End of else of if ($cache && !empty($cache->data) && $cache->expire > time()) {

  return $out;

  
  
  
  
  // No caching version.
  
//  $block = module_invoke($block_data['module'], 'block_view', $block_data['delta']);
//  if ($block) {
//    if (isset($block_data['subject'])) {
//      $block['subject'] = $block_data['subject'];
//    }
//    elseif (@$block_data['no_subject']) {
//      $block['subject'] = '';
//    }
//    return gv_blocks_wrapInBlockThemed($block_data, $block);
//  }
//  return NULL;
}


/**
 * Returns a content of a block Get access to the VoIP footprint... Banner.
 */
function gv_blocks_get_accessToFootprintBanner() {
  return '<div class="link">' . l(t('Learn more'), '<front>') . '</div>';
}


/**
 * Block Request a quote with a multistep form v1.
 */
function gv_blocks_get_requestQuote_block_v1() {
  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  

  //drupal_add_library('system', 'effects.bounce');
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  drupal_add_js($path_to_custom_js . 'gv_requestquote.js');
  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  //drupal_add_js($path_to_custom_js . 'bbq.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;

  $out = '
   <div id="requestQuoteFormWrapper">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        <form class="multipartForm bbq" method="post" action="/request" style="height: 272px; overflow: hidden;">

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="phones_amt_section"> 
                            <img src="/sites/all/themes/gv_orange/css/images/r-quote-woman.jpg" alt="Get Free VoIP Quotes" />
                            <div class="question">' . t('How many phones do you have?') . '</div>
                            
                            <input type="radio" name="phones_amt" value="1 - 2" /><div class="label_after">1 - 2</div>
                            <input type="radio" name="phones_amt" value="3 - 5" /><div class="label_after">3 - 5</div>
                            <input type="radio" name="phones_amt" value="6 - 10" /><div class="label_after">6 - 10</div>
                            <input type="radio" name="phones_amt" value="11 - 20" /><div class="label_after">11 - 20</div>
                            <input type="radio" name="phones_amt" value="21 - 50" /><div class="label_after">21 - 50</div>
                            <input type="radio" name="phones_amt" value="50+" /><div class="last_radio label_after">50+</div>
                            
                            <div class="step-notice">' . t('Step <span class="f">!first</span>of<span class="s">!second</span>', array('!first' => 1, '!second' => 5)) . '</div>
                    </div>
                    
                    <div class="step" id="q_for">
                        
                            <div class="question">' . t('You are looking for a quote for...') . '</div>
                            
                            <input type="radio" name="q_for" value="Home" /><div class="label_after">' . t('Home') .'</div>
                            <input type="radio" name="q_for" value="Home-based Business" /><div class="label_after">' . t('Home-based Business') . '</div>
                            <input type="radio" name="q_for" value="Business" /><div class="last_radio label_after">' . t('Business') . '</div>
                         
                            <div class="step-notice">' . t('Step <span class="f">!first</span>of<span class="s">!second</span>', array('!first' => 2, '!second' => 5)) . '</div>
                    </div>
                    

                    <div class="step" id="buying_time">
                        
                            <div class="question">' . t('What is your buying time frame?') . '</div>
                            
                            <input type="radio" name="buying_time" value="ASAP" /><div class="label_after">' . t('ASAP') . '</div>
                            <input type="radio" name="buying_time" value="Less Than 1 Month" /><div class="label_after">' . t('Less Than 1 Month') . '</div>
                            <input type="radio" name="buying_time" value="1 - 3 Months" /><div class="label_after">' . t('1 - 3 Months') . '</div>
                            <input type="radio" name="buying_time" value="3 - 6 Months" /><div class="label_after">' . t('3 - 6 Months') . '</div>
                            <input type="radio" name="buying_time" value="More Than 6 Months" /><div class="last_radio label_after">' . t('More Than 6 Months') . '</div>
                         
                            <div class="step-notice">' . t('Step <span class="f">!first</span>of<span class="s">!second</span>', array('!first' => 3, '!second' => 5)) . '</div>
                    </div>
                    

                    <div class="step" id="connection">
                        
                            <div class="question">' . t('What is your data connection?') . '</div>
                            
                            <input type="radio" name="connection" value="DSL" /><div class="label_after">' . t('DSL') . '</div>
                            <input type="radio" name="connection" value="Cable" /><div class="label_after">' . t('Cable') . '</div>
                            <input type="radio" name="connection" value="T1" /><div class="label_after">' . t('T1') . '</div>
                            <input type="radio" name="connection" value="Fiber" /><div class="label_after">' . t('Fiber') . '</div>
                            <input type="radio" name="connection" value="Other" /><div class="label_after">' . t('Other') . '</div>
                            <input type="radio" name="connection" value="Need New Connection" /><div class="last_radio label_after">' . t('Need New Connection') . '</div>
                              
                            <div class="step-notice">' . t('Step <span class="f">!first</span>of<span class="s">!second</span>', array('!first' => 4, '!second' => 5)) . '</div>
                    </div>
                    
                    
                    <div class="step" id="personal_info">
                        
                            <div class="question">' . t('Fill out the form below:') . '</div>
                            
                            <div class="label_before required">' . t('First Name') . '<span class="form-required">*</span></div>
                                <input class="after required name" name="firstname" id="firstname" />
                            <div class="label_before required">' . t('Last Name') . '<span class="form-required">*</span></div>
                                <input class="after required" name="lastname" id="lastname" />
                                
                            <div class="label_before required">' . t('Company') . '</div>
                                <input class="after" name="company" id="company" />
                                
                            <div class="label_before required">' . t('Email') . '<span class="form-required">*</span></div>
                                <input class="after email required" name="email" id="email" />
                                
                            <div class="label_before required">' . t('Phone') . '</div>
                                <input class="after required phone" name="phone_1" id="phone_1" value="" />
                                <input class="after required phone" name="phone_2" id="phone_2" value="" />
                                <input class="after required phone" name="phone_3" id="phone_3" value="" />
                                
                            <div class="label_before">' . t('Notes') . '</div>
                                <input class="after" name="notes" id="notes" />
                         
                           <div class="step-notice">' . t('Step <span class="f">!first</span>of<span class="s">!second</span>', array('!first' => 5, '!second' => 5)) . '</div>
                             
                    </div>
                    
                </div>
            
                <div id="Navigation"> 							
                        <input class="navigation_button" id="back" value="Back" type="reset" />
                        <input class="navigation_button" id="next" value="Next" type="submit" />
                </div>
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="block" />
                <input type="hidden" name="version" value="1" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}


/**
 * Block Request a quote with a multistep form v2.
 */
function gv_blocks_get_requestQuote_block_v2() {
  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  

  drupal_add_js('sites/all/libraries/jquery.plugins/jquery.hint-with-password.js');
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  drupal_add_js($path_to_custom_js . 'gv_requestquote_v2.js');
  
  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  
  
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;

  $out = '
   <div id="up">
      <h3>Compare Top VoIP Services Tailored to Your Needs</h3>
      <div class="explain p1"><div class="number">1</div><span class="text">Tell us about your VoIP needs below</span></div>
      <div class="explain p2"><div class="number">2</div><span class="text">Your request will be reviewed by our expert team of VoIP researchers</span></div>
      <div class="explain p3"><div class="number">3</div><span class="text">We will connect you with three providers that best suit your needs</span></div>
   </div>
   <div id="up-image"></div>
   <div class="bottom-clear"></div>   
   <div id="requestQuoteFormWrapper">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        <form class="multipartForm bbq" method="post" action="/request" style="height: 140px; overflow: hidden;">

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="questions_section">

                            <div class="wrapper top first">
                              <div class="question">' . t('Phones amount needed') . ':</div>
                              <select name="phones_amt" id="phones_amt" class="input required">
                                <option value="1 - 4">1 - 4</option>
                                <option value="5 - 10">5 - 10</option>
                                <option selected="selected" value="11 - 20">11 - 20</option>
                                <option value="21 - 50">21 - 50</option>
                                <option value="More than 50">More than 50</option>
                              </select>
                            </div>
           
                            <div class="wrapper top">
                              <div class="question">' . t('VoIP Service desired') . ':</div>
                              <select name="q_type" id="q_type" class="input required">
                                <option value="Both phones and service">' . t('Both phones and service') .'</option>
                                <option value="Phone system only">' . t('Phone system only') .'</option>
                                <option value="Service provider only">' . t('Service provider only') .'</option>
                              </select>
                            </div>
                            
                            <div class="wrapper top last">
                              <div class="question">' . t('Buying time frame') . ':</div>
                              <select name="buying_time" id="buying_time" class="input required">
                                <!--<option value="">- Select a value -</option>-->
                                <option value="ASAP">' . t('ASAP') .'</option>
                                <option value="1-3 Months">' . t('1-3 Months') .'</option>
                                <option value="3-6 Months">' . t('3-6 Months') .'</option>
                              </select>
                            </div>
                            
                            <div class="bottom-clear"></div>


                            <div class="wrapper first">
                              <div class="label_before required">' . t('First Name') . ':<span class="form-required">*</span></div>
                                <input class="after required firstname" name="firstname" id="firstname" />
                            </div>
                            
                            <div class="wrapper">
                              <div class="label_before required">' . t('Last Name') . ':<span class="form-required">*</span></div>
                                <input class="after required lastname" name="lastname" id="lastname" />
                            </div>
                            
                            <div class="wrapper last">
                              <div class="label_before required">' . t('Email') . ':<span class="form-required">*</span></div>
                                <input class="after email required" name="email" id="email" />
                            </div>
                         
                            <div class="wrapper phone first">
                              <div class="label_before required">' . t('Phone') . '<span class="form-required">*</span></div>
                              <div id="phone">
                                <input class="after required phone" name="phone_1" id="phone_1" value="" />
                                <input class="after required phone" name="phone_2" id="phone_2" value="" />
                                <input class="after required phone" name="phone_3" id="phone_3" value="" />
                               </div>
                            </div>
                            
                            <div class="wrapper company">
                              <div class="label_before">' . t('Company') . ':</div>
                                <input class="after" name="company" id="company" />
                            </div>

                            <div class="wrapper website last">
                              <div class="label_before">' . t('Website') . ':</div>
                                <input class="after" name="website" id="website" />
                            </div>
                            
                            <!--<div id="on_error"></div>-->

                            <!--<div class="step-notice">' . t('Step <span class="f">!first</span>of<span class="s">!second</span>', array('!first' => 1, '!second' => 2)) . '</div> -->
                                
                            <div class="protected"></div>
                    </div>

                    
                
                </div>
                
                
            
                <div id="Navigation"> 							
                        <input class="navigation_button" id="back" value="Back" type="reset" />
                        <input class="navigation_button" id="next" value="Submit & Get Quotes" type="submit" />
                </div>
                
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="block" />
                <input type="hidden" name="version" value="2" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}


/**
 * Block Request a quote with a multistep form v3.
 */
function gv_blocks_get_requestQuote_block_v3() {
  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  

  drupal_add_js('sites/all/libraries/jquery.plugins/jquery.hint-with-password.js');
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  drupal_add_js($path_to_custom_js . 'gv_requestquote_v2.js');
  
  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  
  
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;

  $out = '
  <h3>No-Risk Free VoIP Quote</h3>
  <h4>Don\'t trust your phone system with just anyone!</h4>
  <div id="requestQuoteFormWrapper">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        <form class="multipartForm bbq" method="post" action="/request" style="overflow: hidden;">

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="questions_section">

                            <div class="explain p1"><div class="number">1</div><div class="text">Tell us about your VoIP needs</div></div>
                            
                            <div class="wrapper top first">
                              <div class="question">' . t('Lines needed') . ':</div>
                              <select name="phones_amt" id="phones_amt" class="input required">
                                <option value="1 - 2">1 - 2</option>
                                <option value="3 - 5">3 - 5</option>
                                <option selected="selected" value="6 - 10">6 - 10</option>
                                <option value="11 - 20">11 - 20</option>
                                <option value="21 - 50">21 - 50</option>
                                <option value="50+">50+</option>
                              </select>
                            </div>
           
                            <div class="wrapper top">
                              <div class="question">' . t('Service Type') . ':</div>
                              <select name="q_type" id="q_type" class="input required">
                                <option selected="selected" value="Business">' . t('Business') .'</option>
                                <option value="Home">' . t('Home') .'</option>
                                <option value="Home-Based Business">' . t('Home-Based Business') .'</option>
                              </select>
                            </div>
                            
                            <div class="bottom-clear"></div>

                            <div class="explain p2"><div class="number">2</div><div class="text">Your request will be reviewed by our team of VoIP Experts</div></div>
                            <div class="explain p3"><div class="number">3</div><div class="text">РЎonnect with leading providers that best match your needs</div></div>
      
                            <div class="wrapper middle first">
                              <div class="label_before required">' . t('First Name') . ':<span class="form-required">*</span></div>
                                <input class="after required firstname" name="firstname" id="firstname" />
                            </div>
                            
                            <div class="wrapper middle">
                              <div class="label_before required">' . t('Last Name') . ':<span class="form-required">*</span></div>
                                <input class="after required lastname" name="lastname" id="lastname" />
                            </div>
                            
                            <div class="wrapper middle company">
                              <div class="label_before">' . t('Company') . ':</div>
                                <input class="after" name="company" id="company" />
                            </div>


                            <div class="wrapper middle last">
                              <div class="label_before required">' . t('Email') . ':<span class="form-required">*</span></div>
                                <input class="after email required" name="email" id="email" />
                            </div>
                         
                            <div class="wrapper middle phone">
                              <div class="label_before required">' . t('Phone') . '<span class="form-required">*</span></div>
                              <div id="phone">
                                <input class="after required phone" name="phone_1" id="phone_1" value="" />
                                <input class="after required phone" name="phone_2" id="phone_2" value="" />
                                <input class="after required phone" name="phone_3" id="phone_3" value="" />
                               </div>
                            </div>
                            
                            <!--<div id="on_error"></div>-->

                            <div class="protected"></div>
                    </div>

                    
                
                </div>
                
                
            
                <div id="Navigation"> 							
                        <input class="navigation_button" id="next" value="Submit" type="submit" />
                </div>
                
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="block" />
                <input type="hidden" name="version" value="3" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}


/**
 * Block Request a quote with a multistep form v4.
 */
function gv_blocks_get_requestQuote_block_v4() {
  
//  global $user;
//  if ($user->uid) {
//    return NULL;
//  }
  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  

  drupal_add_js('sites/all/libraries/jquery.plugins/jquery.hint-with-password.js');
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  drupal_add_js($path_to_custom_js . 'gv_requestquote_v4.js');
  
  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  
  
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;

  $out = '
  <h3>No-Risk Free VoIP Quote</h3>
  <h4>Don\'t trust your phone system with just anyone!</h4>
  <div id="requestQuoteFormWrapper">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        <form class="multipartForm bbq" method="post" action="/request" style="overflow: hidden;">

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="questions_section">

                            <div class="wrapper top first">
                              <div class="question">' . t('Lines needed') . ':</div>
                              <select name="phones_amt" id="phones_amt" class="input required">
                                <option value="1 - 4">1 - 4</option>
                                <option selected="selected" value="5 - 10">5 - 10</option>
                                <option value="11 - 20">11 - 20</option>
                                <option value="21 - 50">21 - 50</option>
                                <option value="More than 50">More than 50</option>
                              </select>
                            </div>
                            
           
                            <div class="wrapper top">
                              <div class="question">' . t('Service Type') . ':</div>
                              <select name="q_type" id="q_type" class="input required">
                                <option selected="selected" value="Business">' . t('Business') .'</option>
                                <option value="Home">' . t('Home') .'</option>
                                <option value="Home-Based Business">' . t('Home-Based Business') .'</option>
                              </select>
                            </div>
                            
                            <div class="bottom-clear"></div>

                            <div class="middle-wrapper">
                            
                              <div class="wrapper middle first">
                                  <input class="after required firstname" name="firstname" id="firstname" title="First Name *" />
                              </div>

                              <div class="wrapper middle">
                                  <input class="after required lastname" name="lastname" id="lastname" title="Last Name *" />
                              </div>

                              <div class="wrapper middle last">
                                  <input class="after email required" name="email" id="email" title="Email Address *" />
                              </div>

                              <div class="wrapper middle phone">
                                  <input class="after required phone" name="phone" id="phone" value="" title="Phone Number *" />
                              </div>

                              <div class="wrapper middle company">
                                  <input class="after" name="company" id="company" title="Company" />
                              </div>
                            
                              <div class="bottom-clear"></div>
                              
                            </div>
                            
                            <!--<div id="on_error"></div>-->

                            <div class="protected"></div>
                    </div>

                    
                
                </div>
                
                
            
                <div id="Navigation"> 							
                        <input class="navigation_button" id="next" value="Submit" type="submit" />
                </div>
                
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="block" />
                <input type="hidden" name="version" value="4" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}


/**
 * Block Request a quote with a multistep form v5.
 */
function gv_blocks_get_requestQuote_block_v5() {
  
//  global $user;
//  if ($user->uid != 1) {
//    return NULL;
//  }
  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  

  drupal_add_js('sites/all/libraries/jquery.plugins/jquery.hint-with-password.js');
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  drupal_add_js($path_to_custom_js . 'gv_requestquote_v5.js');
  
  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  
  // height: 140px; 
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;

  $out = '
   <div id="up">
      <div class="cap1">Save Big - Switch to a Business VoIP Phone System</div>
      <div class="cap2">Compare Low Rates From Leading VoIP Providers</div>
   </div>
   <div class="bottom-clear"></div>   
   <div id="requestQuoteFormWrapper">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        <form class="multipartForm bbq" method="post" action="/request" style="overflow: hidden;">

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="questions_section">
                            
                            <div class="left">
                               <img src="/sites/all/themes/gv_orange/css/images/q-phone-black.jpg" />
                            </div>
                            

                            <div class="middle-wrapper">

                                <div class="wrapper top first">
                                  <div class="question">' . /*t('How many phone lines do you need?')*/t('Lines needed') . ':</div>
                                  <select name="phones_amt" id="phones_amt" class="input required">
                                    <option value="1 - 4">1 - 4</option>
                                    <option selected="selected" value="5 - 10">5 - 10</option>
                                    <option value="11 - 20">11 - 20</option>
                                    <option value="21 - 50">21 - 50</option>
                                    <option value="More than 50">More than 50</option>
                                  </select>
                                </div>

                                <div class="wrapper top">
                                  <div class="question">' . /*t('What is your current phone needs?')*/t('Service Type') . ':</div>
                                  <select name="q_type" id="q_type" class="input required">
                                    <option selected="selected" value="Business">' . t('Business') .'</option>
                                    <option value="Home">' . t('Home') .'</option>
                                    <option value="Home-Based Business">' . t('Home-Based Business') .'</option>
                                  </select>
                                </div>


                                <div class="wrapper top last">
                                  <div class="question">' . /*t('What is your buying time frame?')*/ t('Buying time frame') . ':</div>
                                  <select name="buying_time" id="buying_time" class="input required">
                                    <!--<option value="">- Select a value -</option>-->
                                    <option value="ASAP">' . t('ASAP') .'</option>
                                    <option value="1-3 Months">' . t('1-3 Months') .'</option>
                                    <option value="3-6 Months">' . t('3-6 Months') .'</option>
                                  </select>
                                </div>
                            
                            </div>
                           


                            <div class="right">
                              <img src="/sites/all/themes/gv_orange/css/images/qrequest-book.jpg" /> 
                              <div class="str2">With quote request</div>
                            </div>
                            

                            <div class="bottom-clear"></div>
                            
                              
                            <!--<div id="on_error"></div>-->

                            <!--<div class="step-notice">' . t('Step <span class="f">!first</span>of<span class="s">!second</span>', array('!first' => 1, '!second' => 2)) . '</div> -->
                                
                            <div class="bottom-info">Personalized Quotes Tailored to your needs</div>
                            <div class="progress"><img src="/sites/all/themes/gv_orange/css/images/progress-bar-50.jpg" /></div>
                    </div>



                    


                    <div class="step" id="personal_data">
                    
                            <div class="left">
                               <img src="/sites/all/themes/gv_orange/css/images/qrequest-girl.jpg" />
                            </div>

                            <div class="middle-wrapper">
                            
                                <div class="wrapper middle first">
                                    <input class="after required firstname" name="firstname" id="firstname" title="First Name *" />
                                </div>

                                <div class="wrapper middle">
                                    <input class="after required lastname" name="lastname" id="lastname" title="Last Name *" />
                                </div>

                                <div class="wrapper middle last">
                                    <input class="after email required" name="email" id="email" title="Email Address *" />
                                </div>

                                <div class="wrapper middle phone">
                                    <input class="after required phone" name="phone" id="phone" value="" title="Phone Number *" />
                                </div>

                                <div class="wrapper middle company">
                                    <input class="after" name="company" id="company" title="Company" />
                                </div>

                                <div class="bottom-clear"></div>
                              
                            </div>
                            
                            
                            <div class="right">
                               <img src="/sites/all/themes/gv_orange/css/images/qrequest-book.jpg" />
                               <div class="str2">With quote request</div>
                            </div>
                            <!--<div class="right">
                               <img src="/sites/all/themes/gv_orange/css/images/qrequest-guide.jpg" />
                               <div class="str1">Free VoIP Guide</div>
                               <div class="str2">With quote request</div>
                            </div>-->
                            
                            <!--<div id="on_error"></div>-->

                            <div class="protected"></div>
                            <div class="progress"><img src="/sites/all/themes/gv_orange/css/images/progress-bar-75.jpg" /></div>
                    </div>





                
                </div>
                
                
            
                <div id="Navigation"> 							
                        <input class="navigation_button" id="back" value="Back" type="reset" />
                        <input class="navigation_button" id="next" value="Submit & Get Quotes" type="submit" />
                </div>
                
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="block" />
                <input type="hidden" name="version" value="5" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}


/**
 * Block Request a quote with a multistep form v6.
 */
function gv_blocks_get_requestQuote_block_v6() {
  
//  global $user;
//  if ($user->uid != 1) {
//    return NULL;
//  }
  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  

  drupal_add_js('sites/all/libraries/jquery.plugins/jquery.hint-with-password.js');
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  drupal_add_js($path_to_custom_js . 'gv_requestquote_v5.js');
  
  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  
  // height: 140px; 
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;

  $out = '
   <div id="up">
      <div class="caption">Compare Leading Providers</div>
      <div class="text">Low Price Assurance</div>
      <div class="text">Personal Service Reps</div>
      <div class="text">Unlimited Calling & Faxing</div>
      <div class="img"></div>
   </div>
   <div class="bottom-clear"></div>   
   <div id="requestQuoteFormWrapper">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        <form class="multipartForm bbq" method="post" action="/request" style="overflow: hidden;">

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="questions_section">
                           
                                <div class="wrapper top first">
                                  <div class="question">' . t('Lines needed') . ':</div>
                                  <select name="phones_amt" id="phones_amt" class="input required">
                                    <option value="1 - 4">1 - 4</option>
                                    <option selected="selected" value="5 - 10">5 - 10</option>
                                    <option value="11 - 20">11 - 20</option>
                                    <option value="21 - 50">21 - 50</option>
                                    <option value="More than 50">More than 50</option>
                                  </select>
                                </div>

                                <div class="wrapper top">
                                  <div class="question">' . t('Service Type') . ':</div>
                                  <select name="q_type" id="q_type" class="input required">
                                    <option selected="selected" value="Business">' . t('Business') .'</option>
                                    <option value="Home">' . t('Home') .'</option>
                                    <option value="Home-Based Business">' . t('Home-Based Business') .'</option>
                                  </select>
                                </div>


                                <div class="wrapper top last">
                                  <div class="question">' . t('Buying time frame') . ':</div>
                                  <select name="buying_time" id="buying_time" class="input required">
                                    <!--<option value="">- Select a value -</option>-->
                                    <option value="ASAP">' . t('ASAP') .'</option>
                                    <option value="1-3 Months">' . t('1-3 Months') .'</option>
                                    <option value="3-6 Months">' . t('3-6 Months') .'</option>
                                  </select>
                                </div>
                          

                            <div class="bottom-clear"></div>
                            
                            <div class="guide">Free VoIP Guide With Request</div>
                            

                            <div class="bottom-clear"></div>
                            
                              
                            <!--<div id="on_error"></div>-->

                            <div class="step-notice">' . t('Step <span class="f">!first</span>of<span class="s">!second</span>', array('!first' => 1, '!second' => 2)) . '</div>
                                

                    </div>



                    


                    <div class="step" id="personal_data">
                    
           
                            
                                <div class="wrapper middle first">
                                    <input class="after required firstname" name="firstname" id="firstname" title="First Name *" />
                                </div>

                                <div class="wrapper middle">
                                    <input class="after required lastname" name="lastname" id="lastname" title="Last Name *" />
                                </div>

                                <div class="wrapper middle last">
                                    <input class="after email required" name="email" id="email" title="Email Address *" />
                                </div>

                                <div class="wrapper middle phone">
                                    <input class="after required phone" name="phone" id="phone" value="" title="Phone Number *" />
                                </div>

                                <div class="wrapper middle company">
                                    <input class="after" name="company" id="company" title="Company" />
                                </div>

                            <div class="bottom-clear"></div>
                            
                            <div class="guide">Free VoIP Guide With Request</div>
           
                            
                            <!--<div id="on_error"></div>-->

                            <div class="protected"></div>

                    </div>





                
                </div>
                
                
            
                <div id="Navigation"> 							
                        <input class="navigation_button" id="back" value="Back" type="reset" />
                        <input class="navigation_button" id="next" value="Get Quotes" type="submit" />
                </div>
                
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="block" />
                <input type="hidden" name="version" value="6" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}


/**
 * Block Request a quote with a multistep form FOR PAGE v1 - /request-voip-phone-system-quote.
 */
function gv_blocks_get_requestQuoteForPage() {

  drupal_add_library('system', 'ui.widget');

  //drupal_add_library('system', 'effects.bounce');
  
  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  //drupal_add_js($path_to_custom_js . 'bbq.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  
  
  drupal_add_js('sites/all/libraries/jquery.plugins/ui/jquery.ui.selectmenu.js');
  drupal_add_css('sites/all/libraries/jquery.plugins/ui/themes/base/jquery.ui.selectmenu.css');
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  drupal_add_js($path_to_custom_js . 'gv_requestquote_page.js');
  
  
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;
  
  $out = '
   <div id="requestQuoteFormWrapper">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        <form class="multipartForm bbq" method="post" action="/request" style="height: 300px; overflow: hidden;">

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="phones_amt_section">
                        
                            <div class="question">' . t('How many phones do you need?') . '<span class="form-required">*</span></div>
                              <select name="phones_amt" id="phones_amt" class="input required">
                                <!--<option value="">- Select a value -</option>-->
                                <option value="1 - 4">1 - 4</option>
                                <option value="5 - 10">5 - 10</option>
                                <option selected="selected" value="11 - 20">11 - 20</option>
                                <option value="21 - 50">21 - 50</option>
                                <option value="More than 50">More than 50</option>
                              </select>
                            
                            
                            <div class="question">' . t('What is your current phone needs?') . '<span class="form-required">*</span></div>
                              <select name="q_for" id="q_for" class="input required">
                                <!--<option value="">- Select a value -</option>-->
                                <option value="Replace current phone system">' . t('Replace current phone system') .'</option>
                                <option value="Need a phone system for a new office">' . t('Need a phone system for a new office') .'</option>
                                <option value="Expand on our current phone system">' . t('Expand on our current phone system') .'</option>
                              </select>

                            <div class="question">' . t('What type of quote do you need?') . '<span class="form-required">*</span></div>
                              <select name="q_type" id="q_type" class="input required">
                                <!--<option value="">- Select a value -</option>-->
                                <option value="Both phones and service">' . t('Both phones and service') .'</option>
                                <option value="Phone system only">' . t('Phone system only') .'</option>
                                <option value="Service provider only">' . t('Service provider only') .'</option>
                              </select>
                            
                            <div class="question">' . t('What is your buying time frame?') . '<span class="form-required">*</span></div>
                              <select name="buying_time" id="buying_time" class="input required">
                                <!--<option value="">- Select a value -</option>-->
                                <option value="ASAP">' . t('ASAP') .'</option>
                                <option value="1-3 Months">' . t('1-3 Months') .'</option>
                                <option value="3-6 Months">' . t('3-6 Months') .'</option>
                              </select>
                            
                            <!--<div id="on_error"></div>-->
                            
                            <!--<div class="step-notice">' . t('Step <span class="f">!first</span>of<span class="s">!second</span>', array('!first' => 1, '!second' => 2)) . '</div> -->
                    </div>
                    
                    <div class="step" id="personal_info">
                        
                            <div class="question">' . t('Fill out the form below:') . '</div>
                            
                            <div class="wrapper">
                              <div class="label_before required">' . t('First Name') . '<span class="form-required">*</span></div>
                                <input class="after required name" name="firstname" id="firstname" />
                            </div>
                            
                            <div class="wrapper">
                              <div class="label_before required">' . t('Last Name') . '<span class="form-required">*</span></div>
                                <input class="after required" name="lastname" id="lastname" />
                            </div>
                            
                            <div class="wrapper">
                              <div class="label_before required">' . t('Company') . '</div>
                                <input class="after" name="company" id="company" />
                            </div>

                            <div class="wrapper">
                              <div class="label_before required">' . t('Email') . '<span class="form-required">*</span></div>
                                <input class="after email required" name="email" id="email" />
                            </div>
                            
                            <div class="wrapper">
                              <div class="label_before">' . t('Website') . '</div>
                                <input class="after" name="website" id="website" />
                            </div>
                            
                            <div class="wrapper">
                              <div class="label_before required">' . t('Phone') . '<span class="form-required">*</span></div>
                              <div id="phone">
                                <input class="after required phone" name="phone_1" id="phone_1" value="" />
                                <input class="after required phone" name="phone_2" id="phone_2" value="" />
                                <input class="after required phone" name="phone_3" id="phone_3" value="" />
                               </div>
                            </div>
                         
                           <!--<div class="step-notice">' . t('Step <span class="f">!first</span>of<span class="s">!second</span>', array('!first' => 2, '!second' => 2)) . '</div>-->
                           <div class="protected"></div>
                    </div>
                    
                </div>
            
                <div id="Navigation"> 							
                        <input class="navigation_button" id="back" value="Back" type="reset" />
                        <input class="navigation_button" id="next" value="No Risk Quote" type="submit" />
                </div>
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="page" />
                <input type="hidden" name="version" value="1" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}


/**
 * Block Request a quote with a multistep form FOR PAGE v2 - /voip-provider-quotes.
 */
function gv_blocks_get_requestQuoteForPage_v2() {

  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  //drupal_add_js($path_to_custom_js . 'bbq.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  drupal_add_js('sites/all/libraries/jquery.plugins/jquery.hint-with-password.js');
  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  drupal_add_js($path_to_custom_js . 'gv_requestquote_page_v2.js');
  
  
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;
  
  $out = '
   <div id="requestQuoteFormWrapper">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        <form class="multipartForm bbq" method="post" action="/request">

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="questions_section">

                            <div class="question">' . t('How many phones do you need?') . '<span class="form-required">*</span></div>
                            <div class="subset first">
                              <input type="radio" name="phones_amt" value="1 - 4" /><div class="label_after">1 - 4</div>
                              <input type="radio" name="phones_amt" value="11 - 20" /><div class="last_radio label_after">11 - 20</div>
                            </div>
                            <div class="subset second">
                              <input checked type="radio" name="phones_amt" value="5 - 10" /><div class="label_after">5 - 10</div>
                              <input type="radio" name="phones_amt" value="more than 20" /><div class="last_radio label_after">more than 20</div>
                            </div>
                            
                            <div class="bottom-clear"></div>


                            <div class="question">' . t('What type of quote do you need?') . '<span class="form-required">*</span></div>
                            <div class="subset first">
                              <input type="radio" name="q_type" value="Phone system only" /><div class="label_after">' . t('Phone system only') . '</div>
                              <input checked type="radio" name="q_type" value="Both phones and service" /><div class="label_after">' . t('Both phones and service') . '</div>
                            </div>
                            <div class="subset second">
                              <input type="radio" name="q_type" value="Service provider only" /><div class="last_radio label_after">' . t('Service provider only') . '</div>
                            </div>

                            <div class="question">' . t('What is your buying time frame?') . '<span class="form-required">*</span></div>
                            <div class="subset first">
                              <input checked type="radio" name="buying_time" value="ASAP" /><div class="label_after">' . t('ASAP') . '</div>
                              <input type="radio" name="buying_time" value="3 - 6 Months" /><div class="last_radio label_after">' . t('3 - 6 Months') . '</div>
                            </div>  
                            <div class="subset second">
                              <input type="radio" name="buying_time" value="1 - 3 Months" /><div class="label_after">' . t('1 - 3 Months') . '</div>
                            </div>
                            
                            <div class="bottom-clear"></div>
                            
                            <div class="subset-name"> 
                              <div class="wrapper subset first">
                                <div class="label_before required">' . t('Name') . '<span class="form-required">*</span></div>
                                  <input class="after required name" name="firstname" id="firstname" title="First" />
                              </div>

                              <div class="wrapper subset second">
                                  <input class="after required" name="lastname" id="lastname" title="Last" />
                              </div>
                            </div>
                            
                            <div class="bottom-clear"></div>
                            
                            <div class="wrapper">
                              <div class="label_before required">' . t('Email') . '<span class="form-required">*</span></div>
                                <input class="after email required" name="email" id="email" title="Enter a valid email" />
                            </div>
                         
                            <div class="wrapper">
                              <div class="label_before required">' . t('Phone') . '<span class="form-required">*</span></div>
                              <div id="phone">
                                <input class="after required phone" name="phone_1" id="phone_1" value="" />
                                <input class="after required phone" name="phone_2" id="phone_2" value="" />
                                <input class="after required phone" name="phone_3" id="phone_3" value="" />
                               </div>
                            </div>
                            
                            <div class="wrapper">
                              <div class="label_before">' . t('Company') . '</div>
                                <input class="after" name="company" id="company" title="Optional" />
                            </div>

   
                     

                            <!--<div id="on_error"></div>-->

                            <!--<div class="step-notice">' . t('Step <span class="f">!first</span>of<span class="s">!second</span>', array('!first' => 1, '!second' => 2)) . '</div> -->
                    </div>

                    <div class="protected"></div>
                
                </div>
                
                
            
                <div id="Navigation"> 							
                        <input class="navigation_button" id="back" value="Back" type="reset" />
                        <input class="navigation_button" id="next" value="Submit & Get Quotes" type="submit" />
                </div>
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="page" />
                <input type="hidden" name="version" value="2" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}



/**
 * Block Request a quote with a multistep form FOR PAGE v3 - /voip-provider-quotes.
 */
function gv_blocks_get_requestQuoteForPage_v3() {

  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  //drupal_add_js($path_to_custom_js . 'bbq.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  drupal_add_js('sites/all/libraries/jquery.plugins/jquery.hint-with-password.js');

  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  drupal_add_js($path_to_custom_js . 'gv_requestquote_page_v2.js');
  
  drupal_add_js($path_to_custom_js . 'gv_brandsCarousel.js');
  drupal_add_js('sites/all/libraries/jquery.plugins/jcarousel/jquery.jcarousel.min.js');
  drupal_add_css('sites/all/libraries/jquery.plugins/jcarousel/skins/tango/skin.css');
  
  
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;
  
  $out = '
   <div id="requestQuoteFormWrapper">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        <form class="multipartForm bbq" method="post" action="/request">

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="questions_section">

                            <div class="question">' . t('Amount of phones needed') . ':</div>
                              <select name="phones_amt" id="phones_amt" class="input required">
                                <option value="1 - 4">1 - 4</option>
                                <option selected="selected" value="5 - 10">5 - 10</option>
                                <option value="11 - 20">11 - 20</option>
                                <option value="21 - 50">21 - 50</option>
                                <option value="More than 50">More than 50</option>
                              </select>
           
                            <div class="question">' . t('VoIP Service desired') . ':</div>
                              <select name="q_type" id="q_type" class="input required">
                                <option value="Both phones and service">' . t('Both phones and service') .'</option>
                                <option value="Phone system only">' . t('Phone system only') .'</option>
                                <option value="Service provider only">' . t('Service provider only') .'</option>
                              </select>
                            
                            <div class="question">' . t('Buying time frame') . ':</div>
                              <select name="buying_time" id="buying_time" class="input required">
                                <!--<option value="">- Select a value -</option>-->
                                <option value="ASAP">' . t('ASAP') .'</option>
                                <option value="1-3 Months">' . t('1-3 Months') .'</option>
                                <option value="3-6 Months">' . t('3-6 Months') .'</option>
                              </select>
                              
                            
                            <div class="bottom-clear"></div>


                            <div class="wrapper">
                              <div class="label_before required">' . t('First Name') . ':<span class="form-required">*</span></div>
                                <input class="after required firstname" name="firstname" id="firstname" />
                            </div>
                            
                            <div class="wrapper">
                              <div class="label_before required">' . t('Last Name') . ':<span class="form-required">*</span></div>
                                <input class="after required lastname" name="lastname" id="lastname" />
                            </div>
                            
                            <div class="wrapper">
                              <div class="label_before required">' . t('Email') . ':<span class="form-required">*</span></div>
                                <input class="after email required" name="email" id="email" />
                            </div>
                         
                            <div class="wrapper phone">
                              <div class="label_before required">' . t('Phone') . '<span class="form-required">*</span></div>
                              <div id="phone">
                                <input class="after required phone" name="phone_1" id="phone_1" value="" />
                                <input class="after required phone" name="phone_2" id="phone_2" value="" />
                                <input class="after required phone" name="phone_3" id="phone_3" value="" />
                              </div>
                            </div>
                            
                            <!--
                            <div class="wrapper phone">
                              <div class="label_before required">' . t('Phone') . ':<span class="form-required">*</span></div>
                                <input class="after required phone" name="phone" id="phone" value="" />
                            </div>
                            -->
                            
                            <div class="wrapper company">
                              <div class="label_before">' . t('Company') . ':</div>
                                <input class="after" name="company" id="company" />
                            </div>

                            <div class="wrapper website">
                              <div class="label_before">' . t('Website') . ':</div>
                                <input class="after" name="website" id="website" />
                            </div>
                            
                            <!--<div id="on_error"></div>-->

                            <!--<div class="step-notice">' . t('Step <span class="f">!first</span>of<span class="s">!second</span>', array('!first' => 1, '!second' => 2)) . '</div> -->
                                
                            <div class="protected"></div>
                    </div>

                    
                
                </div>
                
                
            
                <div id="Navigation"> 							
                        <!--<input class="navigation_button" id="back" value="Back" type="reset" />-->
                        <input class="navigation_button" id="next" value="Submit & Get Quotes" type="submit" />
                </div>
                
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="page" />
                <input type="hidden" name="version" value="3" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}


/**
 * Block Request a quote with a multistep form FOR PAGE v32 - /voip-provider-quotes.
 * A bit changed v3.
 */
function gv_blocks_get_requestQuoteForPage_v32() {

  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  //drupal_add_js($path_to_custom_js . 'bbq.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  drupal_add_js('sites/all/libraries/jquery.plugins/jquery.hint-with-password.js');

  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  drupal_add_js($path_to_custom_js . 'gv_requestquote_page_v3.js');
  
  drupal_add_js($path_to_custom_js . 'gv_brandsCarousel.js');
  drupal_add_js('sites/all/libraries/jquery.plugins/jcarousel/jquery.jcarousel.min.js');
  drupal_add_css('sites/all/libraries/jquery.plugins/jcarousel/skins/tango/skin.css');
  
  
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;
  
  $out = '
   <div id="requestQuoteFormWrapper">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        <form class="multipartForm bbq" method="post" action="/request">

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="questions_section">

                            <div class="question">' . t('Amount of phones needed') . ':</div>
                              <select name="phones_amt" id="phones_amt" class="input required">
                                <option value="1 - 4">1 - 4</option>
                                <option selected="selected" value="5 - 10">5 - 10</option>
                                <option value="11 - 20">11 - 20</option>
                                <option value="21 - 50">21 - 50</option>
                                <option value="More than 50">More than 50</option>
                              </select>
           
                            <div class="question">' . t('VoIP Service desired') . ':</div>
                              <select name="q_type" id="q_type" class="input required">
                                <option value="Both phones and service">' . t('Both phones and service') .'</option>
                                <option value="Phone system only">' . t('Phone system only') .'</option>
                                <option value="Service provider only">' . t('Service provider only') .'</option>
                              </select>
                            
                            <div class="question">' . t('Buying time frame') . ':</div>
                              <select name="buying_time" id="buying_time" class="input required">
                                <!--<option value="">- Select a value -</option>-->
                                <option value="ASAP">' . t('ASAP') .'</option>
                                <option value="1-3 Months">' . t('1-3 Months') .'</option>
                                <option value="3-6 Months">' . t('3-6 Months') .'</option>
                              </select>
                              
                            
                            <div class="bottom-clear"></div>
                            
                            <div class="guide">Free VoIP Guide With Request</div>

                            <div class="wrapper input-border">
                              <input class="after required firstname" name="firstname" id="firstname" title="First Name *" />
                            </div>
                            
                            <div class="wrapper input-border">
                              <input class="after required lastname" name="lastname" id="lastname" title="Last Name *" />
                            </div>
                            
                            <div class="wrapper input-border">
                              <input class="after email required" name="email" id="email" title="Email Address *" />
                            </div>
                            
                            <!--
                            <div class="wrapper phone">
                              <div class="label_before required">' . t('Phone') . '<span class="form-required">*</span></div>
                              <div class="input-border"><div id="phone">
                                <input class="after required phone" name="phone_1" id="phone_1" value="" />
                                <input class="after required phone" name="phone_2" id="phone_2" value="" />
                                <input class="after required phone" name="phone_3" id="phone_3" value="" />
                               </div></div>
                            </div>
                            -->
                            
                            <div class="wrapper phone input-border">
                                <input class="after required phone" name="phone" id="phone" value="" title="Phone Number *" />
                            </div>
                            
                            
                            <div class="wrapper company input-border">
                                <input class="after required" name="company" id="company" title="Company *" />
                            </div>

                            <div class="wrapper website input-border">
                                <input class="after" name="website" id="website" title="Website" />
                            </div>
                            
                            <!--<div id="on_error"></div>-->

                            <!--<div class="step-notice">' . t('Step <span class="f">!first</span>of<span class="s">!second</span>', array('!first' => 1, '!second' => 2)) . '</div> -->
                            
                            <div class="ps"><span>4,000+ Form Submissions -</span> Helping businesses save an average of $180 per month on their phone bill</div>
                            
                            <div class="verisign"></div><div class="protected"></div>
                    </div>

                    
                
                </div>
                
                
            
                <div id="Navigation"> 							
                        <input class="navigation_button" id="next" value="Submit & Get Quotes" type="submit" />
                </div>
                
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="page" />
                <input type="hidden" name="version" value="3" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}