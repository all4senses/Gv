<?php
// $Id: gv_blocks.module

/**
 * Implements hook_block_info().
 */
function gv_blocks_block_info() {
  
  $blocks['main_menu_om_news'] = array(
    'info' => t('Main menu om News'), 
    'cache' => DRUPAL_NO_CACHE,
  );

  $blocks['main_menu_om_providers'] = array(
    'info' => t('Main menu om Providers'),
    'cache' => DRUPAL_CACHE_GLOBAL, //DRUPAL_NO_CACHE,
  );
  
  return $blocks;
}


/**
 * Implements hook_block_view().
 */
function gv_blocks_block_view($delta = '') {
  
  $block = array();

  switch ($delta) {      
        
    case 'main_menu_om_news':
      $block['subject'] = t('Main menu om News');
      $block['content'] = gv_blocks_get_omMenuBlock_News();
      break;

  }
  return $block;
}


/**
 * Returns themed News block content for MegaMenu.
 */
function gv_blocks_get_omMenuBlock_News() {
  // Get main menu wireframe menu
  $submenu = gv_blocks_getSubmenuByTitle('main-menu', 'News');
  if (!$submenu) {
    return NULL;
  }
  dpm($submenu);
  return theme('gv_blocks_submenu', $submenu); //'News menu block xxx';
}

/**
 * Returns submenu from menu
 */
function gv_blocks_getSubmenuByTitle($menu_name, $submenu_title) {
  $menu = menu_build_tree($menu_name);
  foreach ($menu as $submenu) {
    if ($submenu['link']['link_title'] == $submenu_title) {
      return $submenu;
    }
  }
  return NULL;
}

/**
 * Implements hook_theme().
 */
function gv_blocks_theme($existing, $type, $theme, $path) {
  return array(
     'gv_blocks_submenu' => array(
          'variables' => array('submenu' => null),
          //'template' => 'gv_blocks_home',
        ),
  );
}


function theme_gv_blocks_submenu($data) {
  return 'xxxxxxxxx xxxxx';
}