<?php

/**
 * @file
 * Module for building and managing site's blocks.
 */


module_load_include('inc', 'gv_misc', 'inc/constants');


/**
 * Implements hook_block_info().
 */
function gv_blocks_block_info() {
  $blocks['main_menu_om_news'] = array(
    'info' => 'OM News', 
    'cache' => DRUPAL_CACHE_GLOBAL, // DRUPAL_CACHE_GLOBAL
  );
  $blocks['mmenu_om_bu'] = array(
    'info' => 'OM Business VoIP',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );  
  $blocks['main_menu_om_res_voip'] = array(
    'info' => 'OM Residential VoIP',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );

  $blocks['main_menu_om_voip_reviews'] = array(
    'info' => 'OM VoIP Reviews',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  $blocks['mmenu_om_rev'] = array(
    'info' => 'OM VoIP Reviews 2',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  $blocks['main_menu_om_articles'] = array(
    'info' => 'OM Articles',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  $blocks['main_menu_om_voiplibrary'] = array(
    'info' => 'OM VoIP Library',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  $blocks['main_menu_om_blog'] = array(
    'info' => 'OM Blog',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  $blocks['main_menu_om_aboutus'] = array(
    'info' => 'OM About Us',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  $blocks['footer_menu'] = array(
    'info' => 'Footer menu',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  $blocks['footer_menu_pl'] = array(
    'info' => 'Footer menu plain',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  $blocks['footer_menu_pl_v2'] = array(
    'info' => 'Footer menu plain v2 (without Our Team)',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  $blocks['header_links'] = array(
    'info' => 'Header links',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  
  $blocks['request_quote'] = array(
    'info' => 'Request a quote block',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  $blocks['request_quote_v2'] = array(
    'info' => 'Request a quote block v2',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  $blocks['request_quote_v3'] = array(
    'info' => 'Request a quote block v3',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );  
  $blocks['request_quote_v4'] = array(
    'info' => 'Request a quote block v4',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  $blocks['request_quote_v5'] = array(
    'info' => 'Request a quote block v5 (for a highlite region)',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  $blocks['request_quote_v6'] = array(
    'info' => 'Request a quote block v6 (sidebar 2 steps)',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  $blocks['request_quote_v7'] = array(
    'info' => 'Request a quote block v7 (sidebar 1 step)',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  $blocks['request_quote_v8'] = array(
    'info' => 'Request a quote block v8 (home, main column, 1 step)',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  
  $blocks['get_access_banner'] = array(
    'info' => 'Get access... Banner',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  
  $blocks['get_prefaceHome'] = array(
    'info' => 'Main section of the Front page preface',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );  
  
  
  
  $blocks['r_provider_p_bottom'] = array(
    'info' => 'Bottom section of Residential providers page preface',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  
  
  $blocks['b_provider_p_bottom'] = array(
    'info' => 'Bottom section of Business providers page preface',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  $blocks['b_provider_p_bottom2'] = array(
    'info' => 'Bottom section of Business providers page preface v2 with rotated randomly first 4 providers',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  $blocks['sip_provider_p_bottom'] = array(
    'info' => 'Bottom section of SIP providers page preface',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  $blocks['ifa_provider_p_bottom'] = array(
    'info' => 'Bottom section of IFA providers page preface',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  $blocks['pbx_provider_p_bottom'] = array(
    'info' => 'Bottom section of PBX providers page preface',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  $blocks['cc_provider_p_bottom'] = array(
    'info' => 'Bottom section of CC providers page preface',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  $blocks['wc_provider_p_bottom'] = array(
    'info' => 'Bottom section of WC providers page preface',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  $blocks['crm_provider_p_bottom'] = array(
    'info' => 'Bottom section of CRM providers page preface',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  $blocks['cb_p_bottom'] = array(
    'info' => 'Bottom section of CB providers page preface',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  
  $blocks['best_voip_p_bottom'] = array(
    'info' => 'Bottom section of best-voip-service-providers page preface',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  $blocks['bu_voip_features_p_bottom'] = array(
    'info' => 'Bottom section of business-voip-features page preface',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  $blocks['canada_voip_p_bottom'] = array(
    'info' => 'Bottom section of canada-voip page preface',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  $blocks['reviews_all_p_bottom'] = array(
    'info' => 'Bottom section of all reviews page preface',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  $blocks['rsl_p_bottom'] = array(
    'info' => 'Bottom section of resellers providers page preface',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  $blocks['news_tags'] = array(
    'info' => 'Shows a tag cloud for news tags',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  $blocks['blog_tags'] = array(
    'info' => 'Shows a tag cloud for blog tags',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  $blocks['articles_tags'] = array(
    'info' => 'Shows a tag cloud for Voip library tags',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  $blocks['articles_tags_block'] = array(
    'info' => 'Shows a tag cloud BLOCK for Voip library page',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  
  $blocks['t_pick_providers_ar'] = array(
    'info' => 'Top pick providers for the all providers reviews page',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  $blocks['google_all_reviews_snippet'] = array(
    'info' => 'Google all  reviews aggregator snippet with the descriptive caption',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  // Topics block for different content types.
  $content_types = array('blog_post' => 'blog', 'news_post' => 'news', 'article' => 'articles');
  foreach ($content_types as $content_type => $label) {
    
    $blocks[$content_type . '_topics'] = array(
      'info' => t(drupal_ucfirst($label) . ' topics'),
      'cache' => DRUPAL_CACHE_GLOBAL,
    );
  }
  
  
  $blocks['ad_free_ipad_mini'] = array(
    'info' => 'Ad for a free ipad-mini',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  $blocks['ad_speedtest_page'] = array(
    'info' => 'Ad for a speedtest page',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
    
    
  $blocks['weekly_video'] = array(
    'info' => 'GV Weekly video',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  
  $blocks['current_page_provider_articles'] = array(
    'info' => 'Current page provider articles',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  $blocks['blog_page_latest_news'] = array(
    'info' => 'Blog page latest news',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  $blocks['preface_bottom_w_latest_articles'] = array(
    'info' => 'Preface bottom with latest articles',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  
  $blocks['latest_reviews_by_path'] = array(
    'info' => 'gv_blocks_getLatestReviews_byPathAndPrefaceAsServiceType()',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  
  $blocks['newsletters_subscribe'] = array(
    'info' => 'Newsletters subscribe',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
      
  $blocks['bu_voip_ads'] = array(
    'info' => 'Business VoIP Ads',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  $blocks['library_list'] = array(
    'info' => 'Library list',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  $blocks['library_sections'] = array(
    'info' => 'Library sections',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );
  
  $blocks['lib_teasers_custom'] = array(
    'info' => 'Library teasers custom pagination',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );


  $blocks['provider_table_in_var'] = array(
    'info' => 'Provider table saved in Drupal variables',
    'cache' => DRUPAL_CACHE_GLOBAL,
  );

  $blocks['compare_providers'] = array(
    'info' => 'Compare providers',
    'cache' => DRUPAL_NO_CACHE,
  );
  
  $blocks['compare_providers_top_bu'] = array(
    'info' => 'Compare Top Bu providers',
    'cache' => DRUPAL_NO_CACHE,
  );
  
  $blocks['compare_providers_top_re'] = array(
    'info' => 'Compare Top Re providers',
    'cache' => DRUPAL_NO_CACHE,
  );
  
  $blocks['compare_providers_top_pbx'] = array(
    'info' => 'Compare Top PBX providers',
    'cache' => DRUPAL_NO_CACHE,
  );
  
  $blocks['reviews_counter'] = array(
    'info' => 'Reviews counter',
    'cache' => DRUPAL_NO_CACHE,
  );
  
  $blocks['home_in_highlighted'] = array(
    'info' => 'Home in highlighted',
    'cache' => DRUPAL_NO_CACHE,
  );
  
  $blocks['home_in_hlighted_2'] = array(
    'info' => 'Home in highlighted 2',
    'cache' => DRUPAL_NO_CACHE,
  );
  
  $blocks['home_in_hlighted_3'] = array(
    'info' => 'Home in highlighted 3',
    'cache' => DRUPAL_NO_CACHE,
  );
  
  $blocks['home_in_hlighted_4'] = array(
    'info' => 'Home in highlighted 4',
    'cache' => DRUPAL_NO_CACHE,
  );
  
  
  $blocks['writer-admin-links'] = array(
    'info' => 'Writer admin links',
    'cache' => DRUPAL_NO_CACHE,
  );
  
  $blocks['as_featured_in'] = array(
    'info' => 'As featured in BOTTOM block',
    'cache' => DRUPAL_NO_CACHE,
  );
  $blocks['as_featured_in_side'] = array(
    'info' => 'As featured in SIDE block',
    'cache' => DRUPAL_NO_CACHE,
  );
  $blocks['as_featured_in_home'] = array(
    'info' => 'As featured in Home',
    'cache' => DRUPAL_NO_CACHE,
  );
  
  $blocks['sidebar_share_block'] = array(
    'info' => 'Share this Post Static',
    'cache' => DRUPAL_NO_CACHE,
  );
  
  $blocks['side_social_links'] = array(
    'info' => 'Follow Us Sideblock',
    'cache' => DRUPAL_NO_CACHE,
  );
  
  $blocks['sidebar_related_articles'] = array(
    'info' => 'Related articles for a current post',
    'cache' => DRUPAL_NO_CACHE,
  );
  
  $blocks['secondary_p_section'] = array(
    'info' => 'Secondary providers section',
    'cache' => DRUPAL_NO_CACHE,
  );
  
  $blocks['sitelock-badge'] = array(
    'info' => 'Sitelock badge',
    'cache' => DRUPAL_NO_CACHE,
  );
  
  $blocks['footer-about'] = array(
    'info' => 'Footer about GV',
    'cache' => DRUPAL_NO_CACHE,
  );
  
  $blocks['g_remarket_code'] = array(
    'info' => 'Google Remarketing Code',
    'cache' => DRUPAL_NO_CACHE,
  );
  
  $blocks['home_service_types'] = array(
    'info' => 'Home service types',
    'cache' => DRUPAL_NO_CACHE,
  );
  
  $blocks['latest_posts_rotated'] = array(
    'info' => 'Latest Posts rotated',
    'cache' => DRUPAL_NO_CACHE,
  );
  
  $blocks['home_bottom_rotated'] = array(
    'info' => 'Home bottom sections rotated',
    'cache' => DRUPAL_NO_CACHE,
  );
  
  
  $blocks['blog_top_rotated'] = array(
    'info' => 'Blog Top rotated',
    'cache' => DRUPAL_NO_CACHE,
  );
  
  $blocks['latest_reviews_service'] = array(
    'info' => 'latest_reviews on service pages (from views home reviews)',
    'cache' => DRUPAL_NO_CACHE,
  );
  
  $blocks['top5prov_fromviews'] = array(
    'info' => 'Top 5 providers (from views providers-block_top_bu_small) for main blog page',
    'cache' => DRUPAL_NO_CACHE,
  );
  
  $blocks['top5prov_by_type'] = array(
    'info' => 'Top 5 providers by type/path',
    'cache' => DRUPAL_NO_CACHE,
  );
  
  $blocks['ourteam_header_footer'] = array(
    'info' => 'Our Team header and footer',
    'cache' => DRUPAL_NO_CACHE,
  );
  
  $blocks['shopperapproved_badge'] = array(
    'info' => 'Shopperapproved badge',
    'cache' => DRUPAL_NO_CACHE,
  );
  
  $blocks['buchart_alteredview'] = array(
    'info' => 'Altered bu chart from view - now with rotated first 4 providers',
    'cache' => DRUPAL_NO_CACHE,
  );
  
  $blocks['exitintent_v2'] = array(
    'info' => 'Exit intent v2 with quote 3 step',
    'cache' => DRUPAL_NO_CACHE,
  );
  
  $blocks['find_solution_anchor'] = array(
    'info' => 'find-solution anchor for the home page',
    'cache' => DRUPAL_NO_CACHE,
  );
  
  $blocks['conf_search'] = array(
    'info' => 'Search block for main conf page',
    'cache' => DRUPAL_NO_CACHE,
  );
  
  $blocks['sip_chart_alteredview'] = array(
    'info' => 'Altered SIP chart from view - with rotated first providers',
    'cache' => DRUPAL_NO_CACHE,
  );

  $blocks['getQuotePopup_onLists'] = array(
    'info' => 'Get quote popup on providers lists',
    'cache' => DRUPAL_NO_CACHE,
  );
  
  
  return $blocks;
}


/**
 * Implements hook_block_view().
 */
function gv_blocks_block_view($delta = '') {
  $block = array();
  switch ($delta) {      
    case 'main_menu_om_news':
      $block['subject'] = 'OM News';
      $block['content'] = gv_blocks_get_omMenuBlock_byTitle('News', 'gv_blocks_get_omMenuBlock_News');
      break;
    case 'mmenu_om_bu':
      $block['subject'] = 'OM Business VoIP';
      $block['content'] = gv_blocks_get_omMenuBlock_byTitle('Business VoIP', 'gv_blocks_get_omMenuBlock_Providers');
      break;
    case 'main_menu_om_res_voip':
        $block['subject'] = 'OM Residential VoIP';
        $block['content'] = gv_blocks_get_omMenuBlock_byTitle('Residential VoIP', 'gv_blocks_get_omMenuBlock_Providers');
        break;    

    case 'main_menu_om_voip_reviews':
        $block['subject'] = 'OM VoIP Reviews';
        $block['content'] = gv_blocks_get_omMenuBlock_byTitle('VoIP Reviews', 'gv_blocks_get_omMenuBlock_Providers');
        break;    
    case 'mmenu_om_rev':
      $block['subject'] = 'OM VoIP Reviews 2';
      $block['content'] = gv_blocks_get_omMenuBlock_byTitle('Reviews', 'gv_blocks_get_omMenuBlock_Providers');
      break;    
    
    
    
    case 'main_menu_om_blog':
      $block['subject'] = 'OM Blog';
      $block['content'] = gv_blocks_get_omMenuBlock_byTitle('Blog', 'gv_blocks_get_omMenuBlock_Blog');
      break;
    case 'main_menu_om_aboutus':
      $block['subject'] = 'OM About Us';
      $block['content'] = gv_blocks_get_omMenuBlock_byTitle('About Us', 'gv_blocks_get_omMenuBlock_AboutUs');
      break;
    
    case 'main_menu_om_articles':
      $block['subject'] = 'OM Articles';
      $block['content'] = gv_blocks_get_omMenuBlock_byTitle('Insights', 'gv_blocks_get_omMenuBlock_articles');
      break;
    
    case 'main_menu_om_voiplibrary':
      $block['subject'] = 'OM VoIP Library';
      $block['content'] = gv_blocks_get_omMenuBlock_byTitle('Library', 'gv_blocks_get_omMenuBlock_voiplibrary');
      break;
    
    
    case 'footer_menu':
      $block['subject'] = 'Footer menu';
      $block['content'] = gv_blocks_get_footerMenu();
      break; 
    
    case 'footer_menu_pl':
      $block['subject'] = 'Footer menu plain';
      $block['content'] = gv_blocks_get_footerMenuPlain();
      break;
    case 'footer_menu_pl_v2':
      $block['subject'] = 'Footer menu plain v2 (without Our Team)';
      $block['content'] = gv_blocks_get_footerMenuPlain(2);
      break;
    
    case 'header_links':
      $block['subject'] = 'Header links';
      $block['content'] = gv_blocks_get_headerLinks();
      break; 
    
    case 'request_quote':
      $block['subject'] = 'Request a quote block';
      $block['content'] = gv_blocks_get_requestQuote_block_v1();
      break; 
    case 'request_quote_v2':
      $block['subject'] = 'Request a quote block v2';
      $block['content'] = gv_blocks_get_requestQuote_block_v2();
      break; 
    case 'request_quote_v3':
      $block['subject'] = 'Request a quote block v3';
      $block['content'] = gv_blocks_get_requestQuote_block_v3();
      break;
    case 'request_quote_v4':
      $block['subject'] = 'Request a quote block v4';
      $block['content'] = gv_blocks_get_requestQuote_block_v4();
      break;
    case 'request_quote_v5':
      $block['subject'] = 'Request a quote block v5 (for a Highlite region)';
      $block['content'] = gv_blocks_get_requestQuote_block_v5();
      break;
    case 'request_quote_v6':
      $block['subject'] = 'Request a quote block v6 (for a side bar 2 steps)';
      $block['content'] = gv_blocks_get_requestQuote_block_v6();
      break;
    case 'request_quote_v7':
      $block['subject'] = 'Request a quote block v7 (for a side bar 1 step)';
      $block['content'] = gv_blocks_get_requestQuote_block_v7();
      break;
    case 'request_quote_v8':
      $block['subject'] = '';
      $block['content'] = gv_blocks_get_requestQuote_block_v8();
      break;
    
    
    case 'get_access_banner':
      $block['subject'] = 'GET ACCESS TO THE LARGEST <br>VOIP FOOTPRINT <br>IN THE NATION';
      $block['content'] = gv_blocks_get_accessToFootprintBanner();
      break;         
     
    
    case 'get_prefaceHome':
      $block['subject'] = 'Main section of the Front page preface';
      $block['content'] = gv_misc_getPrefaceMainSection('front'); // Arg - preface's key
      break;
    
    case 'b_provider_p_bottom':
      $block['subject'] = 'Bottom section of Business providers page preface';
      $block['content'] = gv_misc_getPrefaceBottomSection('page-compare-business-voip-providers');
      break;
    case 'b_provider_p_bottom2':
      $block['subject'] = 'Bottom section of Business providers page preface v2 with rotated randomly first 4 providers';
      $block['content'] = gv_misc_getPrefaceBottomSection('page-compare-business-voip-providers-v2');
      break;
    
    
    case 'r_provider_p_bottom':
      $block['subject'] = 'Bottom section of Residential providers page preface';
      $block['content'] = gv_misc_getPrefaceBottomSection('page-compare-residential-voip-providers');
      break;
    case 'sip_provider_p_bottom':
      $block['subject'] = 'Bottom section of SIP providers page preface';
      $block['content'] = gv_misc_getPrefaceBottomSection('page-compare-sip-voip-providers');
      break;
    case 'ifa_provider_p_bottom':
      $block['subject'] = 'Bottom section of IFA providers page preface';
      $block['content'] = gv_misc_getPrefaceBottomSection('page-compare-ifa-voip-providers');
      break;
    case 'pbx_provider_p_bottom':
      $block['subject'] = 'Bottom section of PBX providers page preface';
      $block['content'] = gv_misc_getPrefaceBottomSection('page-compare-pbx-voip-providers');
      break;
    case 'cc_provider_p_bottom':
      $block['subject'] = 'Bottom section of CC providers page preface';
      $block['content'] = gv_misc_getPrefaceBottomSection('page-compare-cc-voip-providers');
      break;
    case 'wc_provider_p_bottom':
      $block['subject'] = 'Bottom section of WC providers page preface';
      $block['content'] = gv_misc_getPrefaceBottomSection('web-conferencing-voip-providers');
      break;
    case 'crm_provider_p_bottom':
      $block['subject'] = 'Bottom section of CRM providers page preface';
      $block['content'] = gv_misc_getPrefaceBottomSection('crm-voip-providers');
      break;
    
    
    
    case 'best_voip_p_bottom':
      $block['subject'] = t('Bottom section of best-voip-service-providers page preface');
      $block['content'] = gv_misc_getPrefaceBottomSection('best-voip-service-providers');
      break;
    case 'bu_voip_features_p_bottom':
      $block['subject'] = 'Bottom section of business-voip-features page preface';
      $block['content'] = gv_misc_getPrefaceBottomSection('business-voip-features');
      break;
    
    case 'canada_voip_p_bottom':
      $block['subject'] = 'Bottom section of canada-voip page preface';
      $block['content'] = gv_misc_getPrefaceBottomSection('canada-voip');
      break;
  
    case 'reviews_all_p_bottom':
      $block['subject'] = 'Bottom section of all reviews page preface';
      $block['content'] = gv_misc_getPrefaceBottomSection('view-reviews-page_all_reviews');
      break;
  
    case 'rsl_p_bottom':
      $block['subject'] = 'Bottom section of resellers providers page preface';
      $block['content'] = gv_misc_getPrefaceBottomSection('page-reseller-providers');
      break;
    
    case 'cb_p_bottom':
      $block['subject'] = 'Bottom section of CB providers page preface';
      $block['content'] = gv_misc_getPrefaceBottomSection('cloud-backup');
      break;
    

    case 'news_tags':
      $block['subject'] = 'Shows a tag cloud for news tags';
      $block['content'] = gv_pages_buildTopicsPage('news');
      break;
    case 'blog_tags':
      $block['subject'] = 'Shows a tag cloud for blog tags';
      $block['content'] = gv_pages_buildTopicsPage('blog');
      break;
    case 'articles_tags':
      $block['subject'] = 'Shows a tag cloud for Voip library tags';
      $block['content'] = gv_pages_buildTopicsPage('articles');
      break;
    
    case 'articles_tags_block':
      $block['subject'] = 'Refine also by tag';
      $block['content'] = gv_block_buildTopicsBlock('articles');
      break;
    
    
    
    
    case 't_pick_providers_ar':
      $block['subject'] = '';
      $block['content'] = gv_blocks_getTopPickProvidersBlocksForAllReviewsPage();
      break;
  
    case 'google_all_reviews_snippet':
      $block['subject'] = 'Google all  reviews aggregator snippet with the descriptive caption';
      $block['content'] = gv_blocks_getGoogleAllReviewsSnippet();
      break;
  
    
    default:
      // Get blocks for topics for a specific content type.
      if (strpos($delta, '_topics')) {
        $content_types = array('blog_post' => 'blog', 'news_post' => 'news', 'article' => 'articles');
        $content_type = str_replace('_topics', '', $delta);
        if(!isset($content_types[$content_type])) {
          continue;
        }
        $block['subject'] = t(drupal_ucfirst($content_types[$content_type]) . ' topics');
        $block['content'] = gv_blocks_get_topicsBlock($content_type);
      }
      break;
      
      
    case 'ad_free_ipad_mini':
      $block['subject'] = 'Ad for a free ipad-mini';
      $block['content'] = gv_blocks_getAdBlock('free_ipad_mini');
      break;
    
    case 'ad_speedtest_page':
      $block['subject'] = 'Speedtest';
      $block['content'] = gv_blocks_getAdBlock('speedtest_page');
      break;
    
    case 'weekly_video':
      $block['subject'] = 'GV Weekly video';
      $block['content'] = gv_blocks_weeklyVideoBlock();
      break;
    
    case 'current_page_provider_articles':
      $block_data = gv_blocks_currentPageProviderArticles();
      $block['subject'] = $block_data['title']; //t('Current page provider articles');
      $block['content'] = $block_data['content']; //gv_blocks_currentPageProviderArticles();
      break;
    
    case 'blog_page_latest_news':
      $block['subject'] = 'Blog page latest news';
      $block['content'] = gv_blocks_blogPageLatestNews();
      break;
    
    case 'preface_bottom_w_latest_articles':
      $block['subject'] = '';
      $block['content'] = gv_blocks_prefaceBottomWithLatestArticles();
      break;
    
    case 'latest_reviews_by_path':
      $block['subject'] = gv_blocks_getBlockFromViews_title();
      $block['content'] = gv_blocks_getLatestReviews_byPathAndPrefaceAsServiceType();
      break;
    
    
    case 'newsletters_subscribe':
      $block['subject'] = 'Newsletter Sign Up';
      $block['content'] = drupal_get_form('gv_misc_newsletterSubscribe_form');
      break;
    
    case 'bu_voip_ads':
      $block['subject'] = 'Business VoIP Ads';
      $block['content'] = gv_blocks_voipAds('bu');
      break;
    
    
    case 'library_list':
      $block['subject'] = '';
      $block['content'] = gv_blocks_libraryList();
      break;
    
    case 'library_sections':
      $block['subject'] = '';
      $block['content'] = gv_blocks_librarySections();
      break;
    
    case 'lib_teasers_custom':
      $block['subject'] = 'Latest Insights...';
      $block['content'] = gv_blocks_libraryArticlesTeasers_customPagesAmountPager();
      break;
    
    case 'provider_table_in_var':
      $block['subject'] = '';
      $block['content'] = gv_blocks_getProvidersTableFromViews_withCaching();
      break;
    
    
    case 'compare_providers':
      $block['subject'] = '';
      $block['content'] = gv_blocks_compareProviders();
      break;
    
    case 'compare_providers_top_bu':
      $block['subject'] = '';
      $block['content'] = gv_blocks_compareTopProviders('business');
      break;
    
    case 'compare_providers_top_re':
      $block['subject'] = '';
      $block['content'] = gv_blocks_compareTopProviders('residential');
      break;
    
    case 'compare_providers_top_pbx':
      $block['subject'] = '';
      $block['content'] = gv_blocks_compareTopProviders('pbx');
      break;
    
  
    case 'reviews_counter':
      $block['subject'] = '';
      $block['content'] = gv_blocks_reviewsCounter();
      break;
    
    case 'home_in_highlighted':
      $block['subject'] = '';
      $block['content'] = gv_blocks_prefaceHomeMainInHighlightedRegion('v1');
      break;
    
    case 'home_in_hlighted_2':
      $block['subject'] = '';
      $block['content'] = gv_blocks_prefaceHomeMainInHighlightedRegion('v2');
      break;
    
    case 'home_in_hlighted_3':
      $block['subject'] = '';
      $block['content'] = gv_blocks_prefaceHomeMainInHighlightedRegion('v3');
      break;
    
    case 'home_in_hlighted_4':
      $block['subject'] = '';
      $block['content'] = gv_blocks_prefaceHomeMainInHighlightedRegion('v4');
      break;
    
    case 'writer-admin-links':
      $block['subject'] = '';
      $block['content'] = gv_blocks_getWriterAdminLinks();
      break;
    
    case 'as_featured_in':
      $block['subject'] = '';
      $block['content'] = gv_blocks_getAsFeaturedInBlock('bottom');
      break;
    
    case 'as_featured_in_side':
      $block['subject'] = 'As Featured In';
      $block['content'] = gv_blocks_getAsFeaturedInBlock('side');
      break;
    
    case 'as_featured_in_home':
      $block['subject'] = 'As Featured In Home';
      $block['content'] = gv_blocks_getAsFeaturedInBlock('home');
      break;
    
    case 'sidebar_share_block':
      $block['subject'] = 'Share this Post:';
      $block['content'] = gv_blocks_getSidebarShareStaticBlock();
      break;
    
    case 'side_social_links':
      $block['subject'] = 'Follow Us:';
      $block['content'] = gv_blocks_getSidebarFollowLinksBlock();
      break;
    
    
    
    case 'sidebar_related_articles':
      $block['subject'] = 'Related posts';
      $block['content'] = gv_blocks_getSidebarRelatedArticlesBlock();
      break;
    
    case 'secondary_p_section':
      $block['subject'] = gv_blocks_getSecondaryProvidersSectionBlock('title'); //'Secondary providers section';
      $block['content'] = gv_blocks_getSecondaryProvidersSectionBlock();
      break;
    
    case 'sitelock-badge':
      $block['subject'] = '';
      $block['content'] = gv_blocks_getSitelockBadge();
      break;
    
    case 'footer-about':
      $block['subject'] = '';
      $block['content'] = gv_blocks_getFooterAbout();
      break;
    
    case 'g_remarket_code':
      $block['subject'] = '';
      $block['content'] = gv_blocks_getGoogleRemarketingCode();
      break;
    
    
    case 'home_service_types':
      $block['subject'] = '';
      $block['content'] = gv_blocks_getHomeServiceTypes();
      break;
    
    
    case 'latest_posts_rotated':
      $block['subject'] = '';
      $block['content'] = gv_blocks_getLatestPostsRotated();
      break;
    
    
    case 'home_bottom_rotated':
      $block['subject'] = gv_blocks_getHomeBottomSectionsRotated('title');
      $block['content'] = gv_blocks_getHomeBottomSectionsRotated('body');
      break;
    
    
    case 'blog_top_rotated':
      $block['subject'] = '';
      $block['content'] = gv_blocks_getBlogTopRotated();
      break;
    
    case 'latest_reviews_service':
      $block['subject'] = gv_blocks_getBlockFromViews_title('reviews-block_home_latest_reviews');
      $block['content'] = gv_blocks_getBlockFromViews('reviews-block_home_latest_reviews');
      break;
    
    case 'top5prov_fromviews':
      $block['subject'] = '';
      $block['content'] = ($_GET['q'] == 'blog' && isset($_GET['page'])) ? NULL : gv_blocks_render_block('views', 'providers-block_top_bu_small');
      break;
    
    case 'top5prov_by_type':
      $block['subject'] = ''; // 'Top 5 VoIP Providers';
      $block['content'] = gv_blocks_getTop5Providers_byTypeAndPath();
      break;
   
    case 'ourteam_header_footer':
      $block['subject'] = ''; 
      $block['content'] = gv_blocks_getBlockFromVariable('gv_ourteam_header_data');
      break;
   
    case 'shopperapproved_badge':
      $block['subject'] = ''; 
      $block['content'] = gv_blocks_getBlockFromVariable('gv_shopperapproved_badge_data');
      break;
    
    case 'buchart_alteredview':
      $block['subject'] = ''; 
      //$block['content'] = gv_blocks_chartFromView_altered_rotatedFirst4providers(array('view' => 'providers', 'display' => 'block_top_bu_ppc'));
      $block['content'] = gv_blocks_chartFromView_altered_rotatedProviders(array('view' => 'providers', 'display' => 'block_top_bu_ppc'));
      break;
 
    
    case 'exitintent_v2':
      $block['subject'] = ''; 
      $block['content'] = gv_blocks_get_exitIntent_v2();
      break;
    
    case 'find_solution_anchor':
      $block['subject'] = ''; 
      $block['content'] = '<div id="find-solution"></div>';
      break;

    
    case 'conf_search':
      $block['subject'] = ''; 
      $block['content'] = gv_blocks_get_confMainSearch();
      break;
    
    case 'sip_chart_alteredview':
      $block['subject'] = '';
      $block['content'] = gv_blocks_chartFromView_altered_rotatedProviders(array('view' => 'providers', 'display' => 'bl_p_sip_rotated'));
      break;
    
    case 'getQuotePopup_onLists':
      $block['subject'] = '';
      $block['content'] = gv_blocks_getQuotePopup_onLists();
      break;
    
    
      
  }

  return $block;
}


/**
 * Implements hook_block_configure().
 */
function gv_blocks_block_configure($delta = '') {
  
  $form = array();
  
  switch ($delta) {
    
    case 'ourteam_header_footer':
      
      
      $data = unserialize(variable_get('gv_ourteam_data', NULL));
      
      $form['banner_title'] = array(
        '#type' => 'textfield', 
        '#title' => 'Banner title',
        '#default_value' => $data['banner_title'],
      );
      $form['banner_subtitle'] = array(
        '#type' => 'textfield', 
        '#title' => 'Banner subtitle',
        '#default_value' => $data['banner_subtitle'],
      );
      $form['banner_text'] = array(
        '#type' => 'text_format', 
        '#title' => 'Banner text',
        '#format' => 'full_html',
        '#default_value' => $data['banner_text']['value'],
      );
      
      $form['main_title'] = array(
        '#type' => 'textfield', 
        '#title' => 'Main title',
        '#default_value' => $data['main_title'],
      );
      $form['main_text'] = array(
        '#type' => 'text_format', 
        '#title' => 'Main text',
        '#format' => 'full_html',
        '#default_value' => $data['main_text']['value'],
      );
      
      $form['footer_title'] = array(
        '#type' => 'textfield', 
        '#title' => 'Footer title',
        '#default_value' => $data['footer_title'],
      );
      $form['footer_text'] = array(
        '#type' => 'text_format', 
        '#title' => 'Footer text',
        '#format' => 'full_html',
        '#default_value' => $data['footer_text']['value'],
      );
      

      break;
    
    
    
    case 'secondary_p_section':
      
      $data = unserialize(variable_get('gv_secondary_p_section_data', NULL));
     
      $form['chart_title'] = array(
        '#type' => 'textfield', 
        '#title' => 'Chart Title',
        '#default_value' => @$data['chart_title'][$_GET['destination']],
      );
      
      break;
    
    
    
    
    case 'request_quote_v7':
      
      $data = unserialize(variable_get('gv_request_quote_v7', NULL));
      
      $form['headline'] = array(
        '#type' => 'text_format', 
        '#title' => 'Headline',
        '#format' => 'full_html',
        '#default_value' => $data['headline']['value'],
      );
      
      break;
    
    
    
    case 'request_quote_v8':
      
      $data = unserialize(variable_get('gv_request_quote_v8', NULL));
      
      $form['headline'] = array(
        '#type' => 'text_format', 
        '#title' => 'Headline',
        '#format' => 'full_html',
        '#default_value' => $data['headline']['value'],
      );
      
      break;
    
    
    
    case 'home_in_hlighted_2':
    
      $data = unserialize(variable_get('gv_home_in_hlighted_2', NULL));
      
      /*
      $form['banner_title'] = array(
        '#type' => 'textfield', 
        '#title' => 'Title',
        '#default_value' => $data['title'],
      );
      $form['body'] = array(
        '#type' => 'text_format', 
        '#title' => 'Main body text',
        '#format' => 'full_html',
        '#default_value' => $data['body']['value'],
      );
       */
      $form['flying_text_1'] = array(
        '#type' => 'text_format', 
        '#title' => 'Flying text 1',
        '#format' => 'full_html',
        '#default_value' => $data['flying_text_1']['value'],
      );
      $form['flying_text_2'] = array(
        '#type' => 'text_format', 
        '#title' => 'Flying text 2',
        '#format' => 'full_html',
        '#default_value' => $data['flying_text_2']['value'],
      );
      
      $form['flying_text_3'] = array(
        '#type' => 'text_format', 
        '#title' => 'Flying text 3 BIG',
        '#format' => 'full_html',
        '#default_value' => $data['flying_text_3']['value'],
      );

      break;
  
    
    case 'home_in_hlighted_3':
    
      $data = unserialize(variable_get('gv_home_in_hlighted_3', NULL));
      
      //dpm($data);

      $form['banner_title'] = array(
        '#type' => 'text_format', 
        '#title' => 'Title',
        '#format' => 'full_html',
        '#default_value' => $data['title']['value'],
      );
      $form['testimonial'] = array(
        '#type' => 'text_format', 
        '#title' => 'Testimonial',
        '#format' => 'full_html',
        '#default_value' => $data['testimonial']['value'],
      );

      $form['features'] = array(
        '#type' => 'text_format', 
        '#title' => 'Features',
        '#format' => 'full_html',
        '#default_value' => $data['features']['value'],
      );
      
      break;
    
    
    case 'home_in_hlighted_4':
    
      $data = unserialize(variable_get('gv_home_in_hlighted_4', NULL));
      
      //dpm($data);

      $form['banner_title'] = array(
        '#type' => 'text_format', 
        '#title' => 'Title',
        '#format' => 'full_html',
        '#default_value' => $data['title']['value'],
      );
      $form['testimonial'] = array(
        '#type' => 'text_format', 
        '#title' => 'Testimonial',
        '#format' => 'full_html',
        '#default_value' => $data['testimonial']['value'],
      );

      $form['features'] = array(
        '#type' => 'text_format', 
        '#title' => 'Features',
        '#format' => 'full_html',
        '#default_value' => $data['features']['value'],
      );
      
      break;
    
    
    
    case 'weekly_video':
    
      $form['youtube_video_id'] = array(
        '#type' => 'textfield', 
        '#title' => t('YouTube video id'),
        '#default_value' => variable_get('gv_weekly_video_block', NULL), 
      );

      break;
  
  
  
    case 'as_featured_in':
      
      if(!$data = unserialize(variable_get('gv_as_featured_in_bottom', NULL))) {
        $data = unserialize(variable_get('gv_as_featured_in', NULL));
      }
          
      $form['body'] = array(
        '#type' => 'text_format', 
        '#title' => 'Images',
        '#format' => 'full_html',
        '#default_value' => $data['body']['value'],
      );
      
      break;
      
    
      
      
     case 'as_featured_in_home':
      
      $data = unserialize(variable_get('gv_as_featured_in_home', NULL));
          
      $form['html_images'] = array(
        '#type' => 'text_format', 
        '#title' => 'Images',
        '#format' => 'full_html',
        '#default_value' => $data['html_images']['value'],
      );
      
      break;
    
    
      
    case 'as_featured_in_side':
      
      $data = unserialize(variable_get('gv_as_featured_in_side', NULL));
          
      $form['html_images'] = array(
        '#type' => 'text_format', 
        '#title' => 'Images',
        '#format' => 'full_html',
        '#default_value' => $data['html_images']['value'],
      );
      
      
      
      
      // Upload images using 'managed_file' form api element. 
      /*
      $form['image_example_image_fid'] = array(
        '#title' => 'Images',
        '#type' => 'managed_file',
        '#description' => 'The uploaded image will be displayed on this page using the image style choosen below.',
        //'#default_value' => variable_get('image_example_image_fid', ''),
        '#upload_location' => 'public://a/',
      );
      */
      
      // Upload images using plupload multiple load.
      /*
      $form['pl_images'] = array(
        '#type' => 'plupload',
        '#title' => 'Upload files',
        '#description' => 'This multi-upload widget uses Plupload library.',
        '#upload_validators' => array(
          'file_validate_extensions' => array('jpg jpeg gif png tiff'),
          //'my_custom_file_validator' => array('some validation criteria'),
        ),
//        '#plupload_settings' => array(
//          'runtimes' => 'html5',
//          'chunk_size' => '1mb',
//        ),
      );
      */
      
      break;
    
  }
  
  return $form;
}


/**
 * Implements hook_block_save().
 */
function gv_blocks_block_save($delta = '', $edit = array()) {

  switch ($delta) {
    
     case 'ourteam_header_footer':
      
      $data = array('banner_title' => $edit['banner_title'], 'banner_subtitle' => $edit['banner_subtitle'], 'features' => $edit['features']);
      variable_set('gv_ourteam_data', serialize($data));
      
       
       
    case 'secondary_p_section':
      $data = unserialize(variable_get('gv_secondary_p_section_data', NULL));
      $data['chart_title'][$_GET['destination']] = $edit['chart_title'];
      variable_set('gv_secondary_p_section_data', serialize($data));
      break;
    
    
    case 'request_quote_v7':
      $data = array('headline' => $edit['headline']);
      variable_set('gv_request_quote_v7', serialize($data));
      break;
    
    case 'request_quote_v8':
      $data = array('headline' => $edit['headline']);
      variable_set('gv_request_quote_v8', serialize($data));
      break;
    
    case 'home_in_hlighted_2':
      $data = array(/*'title' => $edit['banner_title'], 'body' => $edit['body'], */'flying_text_1' => $edit['flying_text_1'], 'flying_text_2' => $edit['flying_text_2'], 'flying_text_3' => $edit['flying_text_3']);
      variable_set('gv_home_in_hlighted_2', serialize($data));
      break;
      
    
    case 'home_in_hlighted_3':
      $data = array('title' => $edit['banner_title'], 'testimonial' => $edit['testimonial'], 'features' => $edit['features']);
      variable_set('gv_home_in_hlighted_3', serialize($data));
      break;
    
    case 'home_in_hlighted_4':
      $data = array('title' => $edit['banner_title'], 'testimonial' => $edit['testimonial'], 'features' => $edit['features']);
      variable_set('gv_home_in_hlighted_4', serialize($data));
      break;
    
    case 'weekly_video':
      variable_set('gv_weekly_video_block', $edit['youtube_video_id']);
      break;
    
    case 'as_featured_in':
      $data = array('body' => $edit['body']);
      variable_set('gv_as_featured_in_bottom', serialize($data));
      break;
    
    case 'as_featured_in_home':
    case 'as_featured_in_side':
      //dpm($edit);
      
      if ($delta == 'as_featured_in_side') {
        $data_variable = 'gv_as_featured_in_side';
        $style_name = 'as_featured_in_sideblock';
        
      }
      elseif ($delta == 'as_featured_in_home') {
        $data_variable = 'gv_as_featured_in_home';
        $style_name = 'as_featured_in_sideblock';
        
      }
      
      // Save files using plupload multiple load.
      /*
      $saved_files = array(); //Array to capture file objects
      $scheme = variable_get('file_default_scheme', 'public') . '://';
      $directoryname = 'pl_uploads'; // Directory where images are collected
      $imagebankpath = $scheme . $directoryname;
      file_prepare_directory($imagebankpath, FILE_CREATE_DIRECTORY); // Create the folder if it doesn't exist
      // We can't use file_save_upload() because of
      // http://www.jacobsingh.name/content/tight-coupling-no-not
      // file_uri_to_object();
      foreach ($edit['pl_images'] as $uploaded_file) {
        if ($uploaded_file['status'] == 'done') {
          $source = $uploaded_file['tmppath'];
          $destination = file_stream_wrapper_uri_normalize($imagebankpath .'/'. $uploaded_file['name']);
          // Rename it to its original name, and put it in its final home.
          // Note - not using file_move here because if we call file_get_mime
          // (in file_uri_to_object) while it has a .tmp extension, it horks.
          $destination = file_unmanaged_move($source, $destination, FILE_EXISTS_RENAME);
          $file = plupload_file_uri_to_object($destination);
          file_save($file);
          
          $block = block_load('custom_block', $delta);
          file_usage_add($file, 'gv_blocks', 'as_featured_in_side', $block->bid);
      
          $saved_files[] = $file;
        }
        else {
          drupal_set_message("Upload of {$uploaded_file['name']} failed", 'warning');
        }
      }
      dpm($saved_files);
      */
      
      
      if (preg_match_all('/<img[^>]+>/i', $edit['html_images']['value'], $matches)) {
        $found_image = TRUE;
        //dpm($matches);
        foreach ($matches[0] as $key_0 => $i) {
          preg_match_all('/(alt|title|src)="([^"]*)"/i',$i, $matches2);
          //dpm($matches2);
          foreach ($matches2[1] as $index => $key) {
            $main_image[$key] = $matches2[2][$index];
          }
          
          $main_image['src'] = urldecode($main_image['src']); //str_replace('%20', ' ', $main_image['src']);
          $stream_path = gv_misc_getStreamUriFromRelativePath($main_image['src']);
          //$main_image['uri'] = $stream_path;
          
          $main_image_html = theme('image_style', array( 'path' => $stream_path, 'style_name' => $style_name));
          //$main_image_html = '<div>' . $main_image_html;
          
          
          // Recreate cached styled thumbs.
          $image_styled_url = str_replace('http://getvoip.com/', '', image_style_url($style_name, $stream_path));
          
          // Alternative way, try to get files it via curl and write it locally.
          // Actually don't make sense, because the below way is working perfecrly.
          //$source_fpath = DRUPAL_ROOT . '/' . $image_styled_url;
          //gv_misc_curl_file_from_remote_site_likeBrowser('http://getvoip.com/' . $image_styled_url, $source_fpath));
            
          // Working way.
          // Assure that the imagecache file is created already, or recreate it.
          gv_misc_createCachedImageIfNotExists($image_styled_url, $style_name, TRUE);
          
          
          
          //$images[] = $main_image_html;
          $images[] = gv_pages_convertBeautifulUrls('from_originals_to_beautiful', $main_image_html);
        }
      }
      
      //dpm($images);
      $data = array('html_images' => $edit['html_images'], 'images' => $images);
      variable_set($data_variable, serialize($data));
      
      // Reset (clear) old styled images so that new images will be created on the next access to those images.
      $style_to_flush = $style_name;
      // Cut from function image_style_flush($style) {
      // Delete the style directory in each registered wrapper.
//      $wrappers = file_get_stream_wrappers(STREAM_WRAPPERS_WRITE_VISIBLE);
//      foreach ($wrappers as $wrapper => $wrapper_data) {
//        file_unmanaged_delete_recursive($wrapper . '://styles/' . $style_to_flush);
//      }
      
      // TO-DO IMPORTANT! Need to regenerate file!
      // Assure that the imagecache file is created already, or recreate it.
      //gv_misc_createCachedImageIfNotExists($input_providers_data[$providers_logos_sprite_name][$provider->nid]['themed_image_src']);
      
      break;
  }
  
}



/**
 * Blocks from Views blocks by delta Get Title.
 */
function gv_blocks_getBlockFromViews_title($delta = NULL) {
  
  $out = NULL;
  
  switch ($delta) {
    case 'reviews-block_home_latest_reviews':
    default: 
      
      switch (@$_SERVER['REQUEST_URI']) {
        case '/business':
          $out = 'Latest Business VoIP Reviews...';
          break;
        
        case '/sip-trunking':
          $out = 'Latest SIP Trunking Reviews...';
          break;
        
        case '/fax':
          $out = 'Latest Online Faxing Reviews...';
          break;
        
        default:
          $out = 'Latest Consumer Reviews...';
          break;
      }
   
      break;
  }
  
  return $out;
}


/**
 * Blocks from Views blocks by delta.
 */
function gv_blocks_getBlockFromViews($delta) {
  
  $out = NULL;
  
  switch ($delta) {
    case 'reviews-block_home_latest_reviews':
      
      $block_data = array('module' => 'views', 'delta' => 'reviews-block_home_latest_reviews', 'shadow' => FALSE); 
      //$block_data['subject'] = '';
      $block_data['no_subject'] = TRUE;
      /*
      switch (@$_SERVER['REQUEST_URI']) {
        case '/business':
          $block_data['subject'] = 'Latest Business VoIP Reviews...';
          break;
        
        case '/sip-trunking':
          $block_data['subject'] = 'Latest SIP Trunking Reviews...';
          break;
        
        default:
          $block_data['subject'] = 'Latest Consumer Reviews...';
          break;
      }
      */
      
      $out .= gv_blocks_getBlockThemed($block_data);
   
      break;
  }
  
  return $out;
}


/**
 * Block with Rotated latest posts.
 */
function gv_blocks_getLatestPostsRotated() {
  

  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.tabs');

  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  drupal_add_js($path_to_custom_js . 'gv_postsRotator.js');

  $path_to_current_theme = drupal_get_path('theme', $GLOBALS['theme']) . '/css/';
  drupal_add_css($path_to_current_theme . 'gv_bannerRotator.css');

  
  $query = db_select('node', 'n');
  $query->fields('n', array('nid'));
  $query->condition('n.type', array('blog_post', 'phone'), 'IN');
  $query->condition('n.status', 1);
  $query->leftJoin('field_data_field_invisible', 'i', 'i.entity_id = n.nid');
  $query->condition('i.field_invisible_value', 1, '!='); 
  $query->orderBy('n.created', 'DESC');
  // 4 pages
  //$query->range(0, 8);
  // 3 pages
  //$query->range(0, 6);
  
  $query->range(0, 9);
  
  
  $reviews = $query->execute()->fetchCol();
  
  //dpm($reviews);
  
  $ui_tabs_nav = '';
  $fragments = '';
  
  // 4 pages
  //for($i = 0; $i < 7; $i += 2) {
  // 3 pages
  //for($i = 0; $i < 5; $i += 2) {
  
  for($i = 0; $i < 8; $i += 3) {  
      //$nodes = node_load_multiple(array($reviews[$i], $reviews[$i+1]));
      $nodes = node_load_multiple(array($reviews[$i], $reviews[$i+1], $reviews[$i+2]));
      $node_views = node_view_multiple($nodes, 'home_teaser_rotated');
      $count = $class = NULL;
      foreach ($node_views['nodes'] as $key => $value) {

        if (!$count) {
          $class = 'first';
        }
        elseif ($count == 2){
          $class = 'last';
        }
        else {
          $class = 'middle';
        }

        $node_views['nodes'][$key]['#prefix'] = '<div class="section ' . $class . '">';
        $node_views['nodes'][$key]['#suffix'] = '</div>';
        
        if ($count == 2){
          break;
        }
        
        $count++;
      }
      //dpm($node_views);
      //$node_views = node_view_multiple($nodes, 'home_teaser_rotated');
      
      //$ui_tabs_nav .= '<li class="ui-tabs-nav-item ui-tabs-selected" id="nav-fragment-' . $i . '"><a href="#fragment-' . $i . '">' . $i . '</a></li>';
      $ui_tabs_nav .= '<li class="ui-tabs-nav-item ui-tabs-selected" id="nav-fragment3-' . $i . '"><a href="#fragment3-' . $i . '"></a></li>';
      $fragments .= '<div id="fragment3-' . $i . '" class="ui-tabs-panel' . (!$i ? '' : ' hidden') . '"><div class="info">' . drupal_render($node_views) . '</div></div>';
  }
  //$key += 1; 
  //$blog_tab = '<li class="ui-tabs-nav-item ui-tabs-selected" id="nav-fragment-' . $key . '"><a href="#fragment-' . $key . '">Blog</a></li>';
  //$blog_fragment = '<div id="fragment-' . $key . '" class="ui-tabs-panel"><div class="info">' . vr_misc_getHomeBlogPostsForBannerRotator() . '</div></div>';
  //return '<div id="p-rotator"><ul class="ui-tabs-nav">' . $ui_tabs_nav . $blog_tab . '</ul>' . $fragments . $blog_fragment . '</div>';  
  return '<div id="p-rotator-wrapper"><div id="prev3" class="button">Prev</div><div id="p-rotator">' . $fragments . '<ul class="ui-tabs-nav">' . $ui_tabs_nav . '</ul></div><div id="next3" class="button">Next</div></div>'
          . l('View All', 'blog', array('attributes' => array('class' => array('view-all'))))
        ;  
}


/**
 * Block with Rotated home bottom sections.
 */
function gv_blocks_getHomeBottomSectionsRotated($target = 'body') {
  

  
  $seo_welcome_node = gv_misc_getPrefaceByKey('front');
  $seo_welcome_node->title_no_link = TRUE;
  $seo_welcome_node_view = node_view($seo_welcome_node, 'full');

  //dpm($seo_welcome_node_view);
  //dpm($seo_welcome_node);

  
  if ($target == 'title') {
    return $seo_welcome_node->title;
  }
  
  $keys = element_children($seo_welcome_node_view['field_preface_bottom']);
  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.tabs');

  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  drupal_add_js($path_to_custom_js . 'gv_homeBottomSectionsRotator.js');

  $path_to_current_theme = drupal_get_path('theme', $GLOBALS['theme']) . '/css/';
  drupal_add_css($path_to_current_theme . 'gv_bannerRotator.css');

  
  $ui_tabs_nav = '';
  $fragments = '';
 
  foreach ($keys as $i) {
      $ui_tabs_nav .= '<li class="ui-tabs-nav-item ui-tabs-selected" id="nav-fragment-' . $i . '"><a href="#fragment-' . $i . '"></a></li>';
      $fragments .= '<div id="fragment-' . $i . '" class="ui-tabs-panel' . (!$i ? '' : ' hidden') . '"><div class="info">' . str_replace(array('ul>', '<li>', '</li>'), array('div>', '<p class="rteindent1">', '</p>'), render($seo_welcome_node_view['field_preface_bottom'][$i])) . '</div></div>';
  }
  //$key += 1; 
  //$blog_tab = '<li class="ui-tabs-nav-item ui-tabs-selected" id="nav-fragment-' . $key . '"><a href="#fragment-' . $key . '">Blog</a></li>';
  //$blog_fragment = '<div id="fragment-' . $key . '" class="ui-tabs-panel"><div class="info">' . vr_misc_getHomeBlogPostsForBannerRotator() . '</div></div>';
  //return '<div id="p-rotator"><ul class="ui-tabs-nav">' . $ui_tabs_nav . $blog_tab . '</ul>' . $fragments . $blog_fragment . '</div>';  
  return '<div id="hb-rotator-wrapper"><div id="prev2" class="button">Prev</div><div id="hb-rotator">' . $fragments . '<ul class="ui-tabs-nav">' . $ui_tabs_nav . '</ul></div><div id="next2" class="button">Next</div></div>';  
}


/**
 * Block with Rotated latest posts.
 */
function gv_blocks_getBlogTopRotated() {
  
//dpm($_GET);

if (isset($_GET['page'])) {
  return NULL;
}
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.tabs');

  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  drupal_add_js($path_to_custom_js . 'gv_postsRotator.js');

  $path_to_current_theme = drupal_get_path('theme', $GLOBALS['theme']) . '/css/';
  drupal_add_css($path_to_current_theme . 'gv_bannerRotator.css');

  
  $query = db_select('node', 'n');
  
  $query->condition('n.type', 'blog_post');
  $query->condition('n.status', 1);
  $query->leftJoin('field_data_field_extra_data', 'd', 'd.entity_id = n.nid');
  $query->leftJoin('field_data_field_invisible', 'i', 'i.entity_id = n.nid');
  $query->condition('i.field_invisible_value', 1, '!='); 
  $query->leftJoin('field_data_field_main_image', 'p', 'p.entity_id = n.nid');
  $query->isNotNull('p.field_main_image_value');
  $query->condition('p.field_main_image_value', 'N;', '!=');
  $query->fields('p', array('field_main_image_value'));
  $query->fields('n', array('nid', 'title'));
  $query->fields('d', array('field_extra_data_value'));
  $query->orderBy('n.created', 'DESC');
  
  $query->range(0, 9);
  
  $posts = $query->execute()->fetchAllAssoc('nid');
  
//  foreach ($posts as $nid => $post) {
//    $posts[$nid]->field_extra_data_value = unserialize($post->field_extra_data_value);
//    $posts[$nid]->main_image_url = $posts[$nid]->field_extra_data_value['main_image']['src_beautify'];
//  }
//  
  //dpm($posts);
  
  $ui_tabs_nav = '';
  $fragments = '';
  
  $i = 0;
  foreach ($posts as $nid => $post) {
      $extra_data = unserialize($post->field_extra_data_value);
      $main_image_url = $extra_data['main_image']['src_beautify'];
      
      $ui_tabs_nav .= '<li class="ui-tabs-nav-item ui-tabs-selected" id="nav-fragment-' . $i . '"><a href="#fragment-' . $i . '"></a></li>';
      $clean_title = str_replace('"', '`', $post->title);
      $fragments .= '<div id="fragment-' . $i . '" class="ui-tabs-panel' . (!$i ? '' : ' hidden') . '"><div class="info"><img src="' . $main_image_url . '" alt="' . $clean_title . '" /><div class="title">' . l($post->title, 'node/' .  $post->nid) . '</div></div></div>';
      $i++;
  }

  
  /*
  for($i = 0; $i < 8; $i += 3) {  
      $nodes = node_load_multiple(array($reviews[$i], $reviews[$i+1], $reviews[$i+2]));
      $node_views = node_view_multiple($nodes, 'home_teaser_rotated');
      $count = $class = NULL;
      foreach ($node_views['nodes'] as $key => $value) {

        if (!$count) {
          $class = 'first';
        }
        elseif ($count == 2){
          $class = 'last';
        }
        else {
          $class = 'middle';
        }

        $node_views['nodes'][$key]['#prefix'] = '<div class="section ' . $class . '">';
        $node_views['nodes'][$key]['#suffix'] = '</div>';
        
        if ($count == 2){
          break;
        }
        
        $count++;
      }
      $ui_tabs_nav .= '<li class="ui-tabs-nav-item ui-tabs-selected" id="nav-fragment-' . $i . '"><a href="#fragment-' . $i . '"></a></li>';
      $fragments .= '<div id="fragment-' . $i . '" class="ui-tabs-panel' . (!$i ? '' : ' hidden') . '"><div class="info">' . drupal_render($node_views) . '</div></div>';
  }
*/  
  $out = '<div id="p-rotator-wrapper"><div id="prev-wrapper" class="button"></div><div id="prev" >Prev</div><div id="p-rotator">' . $fragments . '<ul class="ui-tabs-nav">' . $ui_tabs_nav . '</ul></div><div id="next-wrapper" class="button"></div><div id="next">Next</div></div>'
          //. l('View All', 'blog', array('attributes' => array('class' => array('view-all'))))
        ;
  
  //$out .= gv_blocks_render_block('views', '785f423dc4ad7c3130530376c18daf4b');
  
  return $out;
}


/**
 * Home Service Types block.
 */
function gv_blocks_getHomeServiceTypes() {
  
  $out = NULL;
  
  //$service_types_home = serialize(array(/*'smbv' => 'Small Business', */ 're' => 'Residential', 'bu' => 'Business', 'mo' => 'Mobile', 'ifa' => 'Internet Fax', 'pbx' => 'Hosted PBX', 'sip' => 'SIP Trunking', 'cc' => 'Call Center', 're_ca' => 'Residential Canada', 'bu_ca' => 'Business Canada', 'rsl' => 'Reseller'));
  $service_types_home = array('bu' => array('title' => 'Business VoIP', 'key' => 'page-compare-business-voip-providers', 'erating_field' => ''), 'pbx' => array('title' => 'Hosted PBX', 'key' => 'page-compare-pbx-voip-providers', 'erating_field' => 'pbx'), 'sip' => array('title' => 'SIP Trunking', 'key' => 'page-compare-sip-voip-providers', 'erating_field' => 'sip'), 'wc' => array('title' => 'Web Conferencing', 'key' => 'web-conferencing-voip-providers', 'erating_field' => 'wc'), 're' => array('title' => 'Residential VoIP', 'key' => 'page-compare-residential-voip-providers', 'erating_field' => 'residential'), 'ifa' => array('title' => 'Online Fax', 'key' => 'page-compare-ifa-voip-providers', 'erating_field' => 'ifa') );
  
  
  foreach ($service_types_home as $service_type => $data) {
    
    $out .= '<div class="section" id="' . $service_type . '">';

      $query = db_select('field_data_field_preface_key', 'k');
      $query->condition('k.field_preface_key_value', $data['key']); //'page-compare-business-voip-providers'
      //$query->leftJoin('field_data_body', 'b', "b.entity_id = k.entity_id");
      $query->leftJoin('field_data_field_extra_data', 'd', "d.entity_id = k.entity_id");
      //$query->fields('b', array('entity_id', 'body_summary'));
      //$query->fields('d', array('entity_id', 'field_p_erating_value' . ($data['erating_field'] ? '_' . $data['erating_field'] : '') ));
      $query->fields('d', array('entity_id', 'field_extra_data_value'));
      $result = $query->execute()->fetchObject(); 

      //dpm($result);
      $extra_data = unserialize($result->field_extra_data_value);
      
      $out .= '<div class="title"><span></span><div>' . $data['title'] . '</div></div><div class="summary">' . $extra_data['body_summary'] . l('Learn More', 'node/' . $result->entity_id, array('attributes' => array('class' => array('more'))  )) . '</div>'
              . '<div class="divider"></div>'
              . '<div class="subtitle">Top ' . $data['title'] . ' Providers</div>'
              ;
      
      $table = 'field_data_field_p_erating' . ($data['erating_field'] ? '_' . $data['erating_field'] : '');
      $field = 'field_p_erating' . ($data['erating_field'] ? '_' . $data['erating_field'] : '') . '_value';
      $field_prefixed = 'r.' . $field;
      $query = db_select($table, 'r');
      $query->isNotNull($field_prefixed);
      //$query->condition($field_prefixed, '', '!=');
      
      $query->join('node', 'n', "n.nid = r.entity_id AND n.type='provider'");
      //$query->leftJoin('field_data_field_p_data', 'd', "d.entity_id = r.entity_id");
      $query->leftJoin('field_data_field_p_name', 'p', "p.entity_id = r.entity_id");
      $query->fields('r', array('entity_id', $field ));
      //$query->fields('d', array('field_p_data_value'));
      $query->fields('p', array('field_p_name_value'));
      $query->orderBy($field_prefixed, 'ASC');
      
      $query->range(0, 3);
      $results = $query->execute()->fetchAll(); 

      //dpm($results);
      
      foreach ($results as $key => $data) {
        $out .= '<a href="' . url('node/' . $data->entity_id) . '" class="p"><span>' . ($key + 1) .'</span>' . $data->field_p_name_value . '</a>';
      }
        
      
     $out .= '<div class="view-all">' . l('View All', 'node/' . $result->entity_id) . '</div>'; 
    
    /*
    $query = db_select('node', 'n');
    $query->join('field_data_field_p_name', 'pn', "pn.entity_id = n.nid");
    $query->fields('n', array('nid', 'title'))  
          ->fields('pn', array('field_p_name_value')) 
          ->condition('n.type', 'provider')
          ->condition('n.status', 1); 
    
      // Get only featured providers.
      $query->leftJoin('field_data_field_p_erating', 'er_bu', "er_bu.entity_id = n.nid");
      $query->leftJoin('field_data_field_p_erating_residential', 'er_re', "er_re.entity_id = n.nid");
      $query->leftJoin('field_data_field_p_erating_sip', 'er_sip', "er_sip.entity_id = n.nid");
      $query->leftJoin('field_data_field_p_erating_pbx', 'er_pbx', "er_pbx.entity_id = n.nid");
      $query->leftJoin('field_data_field_p_erating_ifa', 'er_ifa', "er_ifa.entity_id = n.nid");
      
      $or = db_or()->isNotNull('field_p_erating_value')
                   ->isNotNull('field_p_erating_residential_value')
                   ->isNotNull('field_p_erating_sip_value')
                   ->isNotNull('field_p_erating_pbx_value')
                   ->isNotNull('field_p_erating_ifa_value')
              ;
      $query->condition($or);
      */
    
      
      $out .= '</div>';
    

  } // End of foreach ($service_types_home as $service_type => $data) {
  
  return $out;
}


/**
 * Google Remarketing Code.
 */
function gv_blocks_getGoogleRemarketingCode() {
  
  return '
<!-- Google Code for Remarketing Tag -->
<!--------------------------------------------------
Remarketing tags may not be associated with personally identifiable information or placed on pages related to sensitive categories. See more information and instructions on how to setup the tag on: http://google.com/ads/remarketingsetup
--------------------------------------------------->
<script type="text/javascript">
/* <![CDATA[ */
var google_conversion_id = 944838791;
var google_custom_params = window.google_tag_params;
var google_remarketing_only = true;
/* ]]> */
</script>
<script type="text/javascript" src="//www.googleadservices.com/pagead/conversion.js">
</script>
<noscript>
<div style="display:inline;">
<img height="1" width="1" style="border-style:none;" alt="" src="//googleads.g.doubleclick.net/pagead/viewthroughconversion/944838791/?value=0&amp;guid=ON&amp;script=0"/>
</div>
</noscript>
';
  
}


/**
 * About the author block.
 */
function gv_blocks_getAboutTheAuthor($uid) {
  $user = user_load($uid);
  
  //dpm($user);
  
  if (empty($user->field_u_bio_on_article['und'][0]['value'])) {
    return NULL;
  }
  
  return '<div id="about_author">
              <div id="left">'
              . theme('image_style', array( 'path' =>  @$user->field_u_author_img['und'][0]['uri'], 'style_name' => 'author_avatar_article_circle', 'alt' => '', 'title' => '', 'attributes' => array('rel' => 'v:photo')))
              
            . '</div>
              <div id="right">' .
                //'<div class="title">About <span style="white-space: nowrap;">the author:</span>' . /*$user->realname .*/ '</div><div class="bio">' . @$user->field_u_quick_bio['und'][0]['value'] . '.. ' . l('Read More', 'user/' . $uid) . '</div>'
                '<div class="title">' . $user->realname . '</div>'
                . (!empty($user->field_u_position['und'][0]['value']) ? '<div class="subtitle">' . $user->field_u_position['und'][0]['value'] . '</div>' : '')
                . '<div class="bio">' . @$user->field_u_quick_bio['und'][0]['value'] . '.. ' . l('Read More', 'user/' . $uid) . '</div>'
                
                . '<div class="social">' .
                      (!empty($user->field_u_gplus_profile['und'][0]['value']) ? '<a id="gplus" target="_blank" rel="author" href="' . (strpos($user->field_u_gplus_profile['und'][0]['value'], '://') ? '' : 'http://') . $user->field_u_gplus_profile['und'][0]['value'] . '"></a>' : '') .
                      (!empty($user->field_u_ln_profile['und'][0]['value']) ? '<a id="ln" target="_blank" href="' . (strpos($user->field_u_ln_profile['und'][0]['value'], '://') ? '' : 'http://') . $user->field_u_ln_profile['und'][0]['value'] . '"></a>' : '') .
                      (!empty($user->field_u_tw_profile['und'][0]['value']) ? '<a id="tw" target="_blank" href="' . (strpos($user->field_u_tw_profile['und'][0]['value'], '://') ? '' : 'http://') . $user->field_u_tw_profile['und'][0]['value'] . '"></a>' : '') .
                      (!empty($user->field_u_fb_profile['und'][0]['value']) ? '<a id="fb" target="_blank" href="' . (strpos($user->field_u_fb_profile['und'][0]['value'], '://') ? '' : 'http://') . $user->field_u_fb_profile['und'][0]['value'] . '"></a>' : '') .
                 '</div>    
              </div>' .
          '</div>';
}









/**
 * Block with Footer About.
 */
function gv_blocks_getFooterAbout() {
  return '<div class="c">GetVoIP.com is an independent provider comparison and shoppers guide, offering unbiased consumer reviews. We monetize from advertisers and affiliates. This does not influence the rankings and reviews on our website. 
            <div>© 2015 GetVoIP.com | All Rights Reserved</div>
         </div>';
}


/**
 * Block with Sitelock Badge.
 */
function gv_blocks_getSitelockBadge() {
  // static
  return '<a href="#" onclick="window.open(' . "'https://www.sitelock.com/verify.php?site=getvoip.com','SiteLock','width=600,height=600,left=160,top=170'" . ');" ><img alt="website security" title="SiteLock"  src="//shield.sitelock.com/shield/getvoip.com"/></a>';
}


/**
 * Block with the main part of the home preface to place to Highlighted region.
 */
function gv_blocks_prefaceHomeMainInHighlightedRegion($key = 'v1') {
  
  $out = '';
  
  switch ($key) {
    case 'v1':
    case 'v2':
      $home_preface_node = gv_misc_getPrefaceByKey('front');
      $home_preface_node->title_no_link = TRUE;
      $home_preface_node_view = node_view($home_preface_node, 'full');

      $out = render($home_preface_node_view);
      break;
  }
  
  switch ($key) {
    case 'v2':
      $data = unserialize(variable_get('gv_home_in_hlighted_2', NULL));
      //$out = '<h1 class="preface">' . $data['title'] . '</h1>' . $data['body']['value'] . '<div id="flying_text_1">' . $data['flying_text_1']['value'] . '</div>';
      ////$out .= '<div id="flying_text_1">' . $data['flying_text_1']['value'] . '</div><div id="flying_text_2">' . $data['flying_text_2']['value'] . '</div>';
      $out .= '<div id="flying_text_3">' . $data['flying_text_3']['value'] . '</div>';
      break;
    
    case 'v3':
      $data = unserialize(variable_get('gv_home_in_hlighted_3', NULL));
      //dpm(strip_tags($data['title']['value']));
      
      //global $user;
      
      //if ($user->uid == 1) 
        {
        $out .= '
          <h1>Best VoIP Service Providers</h1>
          <h2 id="banner_title">' . strip_tags($data['title']['value'], '<br><br/><br />') . '</h2>
          <div id="features">' . $data['features']['value'] . '</div>
          <div id="testimonial">' . $data['testimonial']['value'] . '</div>
        ';
      }
//      else {
//        $out .= '
//          <h1>Best VoIP Service Providers</h1>
//          <h2 id="banner_title">' .$data['title']['value'] . '</h2>
//          <div id="features">' . $data['features']['value'] . '</div>
//          <div id="testimonial">' . $data['testimonial']['value'] . '</div>
//        ';
//      }
      break;
    
    
    case 'v4':
      $data = unserialize(variable_get('gv_home_in_hlighted_4', NULL));
      
      
//       Add front metatags from Metatags module settings (filled by the root user).  
//       
//       
        //gv_misc_addMetatag('description', 'Share your VoIP phone experience with others. Use this quick form to submit your review and share your feedback');
      
        $metatags = metatag_metatags_view('global:frontpage', array());
        gv_misc_addMetatag('title', $metatags['title']['#attached']['metatag_set_preprocess_variable'][0][2]);
        gv_misc_addMetatag('description', $metatags['description']['#attached']['drupal_add_html_head'][0][0]['#value']);
        //dpm($metatags);
        
        // Metatags.
//      gv_misc_addMetatag('title', 'Submit VoIP Phone Review');
//      gv_misc_addMetatag('description', 'Share your VoIP phone experience with others. Use this quick form to submit your review and share your feedback');
//      gv_misc_addMetatag('keywords', 'submit phone reviews, phone reviews from users');
      
        $out .= '
          <h1>Best VoIP Service Providers</h1>
          <h2 id="banner_title">' . strip_tags($data['title']['value'], '<br><br/><br />') . '</h2>
          <div id="features">' . $data['features']['value'] . '</div>
          <div id="testimonial">' . $data['testimonial']['value'] . '</div>
          ' 
          //. l('Find a VoIP service', 'business', array('attributes' => array('class' => array('link')))) 
          //. '<a href="#" class="link"><span>Find a VoIP service</span><div></div></a>
          //. '<a href="#block-gv-blocks-home-service-types" class="link scroll-to-link"></a>'
          . '<a href="#find-solution" class="link scroll-to-link"></a>'
        ;

      break;
  }
  
  return $out;
}




/**
 * Secondary Providers section for a current page.
 */
function gv_blocks_getSecondaryProvidersSectionBlock($op = NULL) {
  
  //dpm($_GET);
  //dpm($_SERVER);
  
  if ($op == 'title') {
    $data = unserialize(variable_get('gv_secondary_p_section_data', NULL));
    return @$data['chart_title'][$_GET['q']];
  }
  
  $map_url_to_viewsDisplay_name = array(
    '/business' => 'block_top_bu_cmp_wide',
    '/sip-trunking' => 'block_p_sip_page',
    '/fax' => 'block_p_ifa_page',
    '/hosted-pbx' => 'block_p_pbx_page_cmp',
    '/residential' => 'block_p_re_page',
  );
  
  
  if (!isset($map_url_to_viewsDisplay_name[$_SERVER['REQUEST_URI']])) {
    return NULL;
  }
  
  global $user;
  if (!$user->uid && $_SERVER['REQUEST_URI'] != '/business' && $_SERVER['REQUEST_URI'] != '/sip-trunking' && $_SERVER['REQUEST_URI'] != '/hosted-pbx' && $_SERVER['REQUEST_URI'] != '/residential') {
    return NULL;
  }
  
  $chart_themed = NULL;
  $view_name = 'providers'; 
  $display_name = $map_url_to_viewsDisplay_name[$_SERVER['REQUEST_URI']];
  $view = views_get_view($view_name);
  
  //dpm($view);
  
  // Remove almost all existing fields. We will add some new fields instead for the second chart.
  //$types = views_object_types();
  //dpm($types);
  $fields = $view->get_items('field', $display_name);
  //dpm($fields);
  
  // Delete all header fields, in this case some js scripts (for example, gv_compareProviders.js)
  $header = $view->get_items('header', $display_name);
  //dpm($header);
  foreach ($header as $header_field_name => $data) {
    $view->set_item($display_name, 'header', $header_field_name, NULL); // Delete field.
  }
  
  $labels_of_fields_to_leave = array(/*'Title', */ /*'Company'*/ /*, 'More Details'*/);
  foreach ($fields as $field_name => $data) {
    if ($field_name != 'title' && !in_array($data['label'], $labels_of_fields_to_leave)) {
      $view->set_item($display_name, "field", $field_name, NULL); // Delete field.
    }
  }
  
  //$viewsFilterOptions_nodeNid = array('id' => 'field_ref_phone_target_id', 'value' => array('value' => $node->nid));
  //$view->add_item($display_name, 'filter', 'field_data_field_ref_phone', 'field_ref_phone_target_id', $viewsFilterOptions_nodeNid);
  
  $php_field_options = array(
    'id' => 'php_title', 
    'label' => 'Company',
    'element_class' => 'company',
    'element_label_class' => 'company',
    'use_php_setup' => 0, 
    'use_php_click_sortable' => '3',
    'php_click_sortable' => '',
    'php_value' =>  '$value = gv_misc_getProviderQuickData(\'name_chart_direct_link\', array(\'data\' => $data));
return $value;',
    'php_output' => '<?php 
echo $value;
?>',
  );
  //$view->add_item($display_name, 'field', 'field_data_field_ref_phone', 'field_ref_phone_target_id', $viewsFilterOptions_nodeNid);
  $view->add_item($display_name, 'field', 'views', 'php', $php_field_options);
  
  
  $php_field_options = array(
    'id' => 'php_country', 
    'label' => 'Country Available',
    'element_class' => 'country',
    'element_label_class' => 'country',
    'use_php_setup' => 0, 
    'use_php_click_sortable' => '0',
    'php_click_sortable' => '',
    'php_value' =>   '$value = gv_misc_getProviderQuickData(\'i_availability\', array(\'data\' => $data));
return $value;',
    'php_output' => '<?php 
echo $value;
?>',
  );
  //$view->add_item($display_name, 'field', 'field_data_field_ref_phone', 'field_ref_phone_target_id', $viewsFilterOptions_nodeNid);
  $view->add_item($display_name, 'field', 'views', 'php', $php_field_options);
  
  
  $php_field_options = array(
    'id' => 'php_details', 
    'label' => 'Details',
    'use_php_setup' => 0, 
    'use_php_click_sortable' => '0',
    'php_click_sortable' => '',
    // details2 - shorter details.
    'php_value' => '$value = gv_misc_getProviderQuickData(\'details2\', array(\'data\' => $data));
return $value;',
    'php_output' => '<?php 
echo $value;
?>',
  );
  //$view->add_item($display_name, 'field', 'field_data_field_ref_phone', 'field_ref_phone_target_id', $viewsFilterOptions_nodeNid);
  $view->add_item($display_name, 'field', 'views', 'php', $php_field_options);
  
  
  
  /*
  
  $handler->display->display_options['fields']['php_1']['id'] = 'php_1';
$handler->display->display_options['fields']['php_1']['table'] = 'views';
$handler->display->display_options['fields']['php_1']['field'] = 'php';
$handler->display->display_options['fields']['php_1']['label'] = 'Video';
$handler->display->display_options['fields']['php_1']['use_php_setup'] = 0;
$handler->display->display_options['fields']['php_1']['php_value'] = '$value = gv_misc_getProviderQuickData(\'vr-y\', array(\'data\' => $data, \'service_type\' =>\'re\'));

return $value;';
$handler->display->display_options['fields']['php_1']['php_output'] = '<?php 
echo $value;
?>';
$handler->display->display_options['fields']['php_1']['use_php_click_sortable'] = '3';
$handler->display->display_options['fields']['php_1']['php_click_sortable'] = '';

  
  
  */
  
  
  $filters = $view->get_items('filter', $display_name);

  foreach ($filters as $name => $data) {
    // Remove filters by NOT NULL erating listing position (we will collect even providers with not set listing position value for the Secondary chart).
    if (strpos($name, '_p_erating')) {
      $view->set_item($display_name, "filter", $name, NULL); // Delete filter.
    }
    // Find a php filter for excluding marked to Secondary chart.
    elseif (@$data['ui_name'] == 'sps') {

      // Invert providers selection condition to select ones with Secondary chart checkbox marked out.
      $filters[$name]['php_filter'] = str_replace(" gv_misc_getProviderQuickData('sps',", " !gv_misc_getProviderQuickData('sps',", $filters[$name]['php_filter']);
    
      //$view->set_item($display_name, "filter", $sps_filter, NULL); // Delete filter.
      $view->set_item($display_name, "filter", $name, $filters[$name]);

      // Run view's query.
      $view->execute();
      
      // Take out umlisted providers in the separate array.
      $unlisted = array();
      foreach ($view->result as $index => $data) {
        foreach ($data as $field_name => $field_value) {
          if (strpos($field_name, 'field_p_erating') && (!$field_value || $field_value == 'NA')) {
            $unlisted[] = $view->result[$index];
            unset($view->result[$index]);
          }
        }
      }
      // Sort unlisted array alphabetically by a provider name.
      uasort($unlisted, 'gv_misc_sortArrayByObjectsNodeTitle');
      
      // Put sorted unlisted providers back to the main array. 
      $view->result += $unlisted;
      
      $chart_themed = $view->preview($display_name);
      //dpm($view->result);
      break;
    }
  }
  
  return $chart_themed;
}


/**
 * Block with images for the home page footer.
 */
function gv_blocks_getAsFeaturedInBlock($key = 'bottom') {
  
  if ($key == 'bottom') {
    if (!$data = unserialize(variable_get('gv_as_featured_in_bottom', NULL))) {
      $data = unserialize(variable_get('gv_as_featured_in', NULL));
    }
  }
  else {
    $data = unserialize(variable_get('gv_as_featured_in_' . $key, NULL));
  }

  switch ($key) {
    case 'bottom':
      $out = '<div class="title">As featured In</div><div class="body">' . $data['body']['value'] . '</body>'; // . '<div class="more">' . l('See all of the recent buzz about us >>>', '') . '</div>';
      break;
    
    case 'home':
      $out = '<img src="/sites/all/themes/gv_blue/css/images/as-featured-in-home.jpg" alt="As Featured in..." />';
      break;
      
    case 'side':
      
      //dpm($data);
      /*
      $out = '';//$data['html_images']['value'];
      foreach ($data['images'] as $image) {
        $out .= $image;
      }
      */
      $out = '<img class="side" src="/sites/all/themes/gv_blue/css/images/as-featured-in-home.jpg" />';
      break;
      
    
  }
  
  return $out;
}


/**
 * Block with sidebar related posts for a current post.
 */
function gv_blocks_getSidebarRelatedArticlesBlock($nid = NULL, $node = NULL, $block_title = NULL) {
  
  if (!$node) {
    
    if (!$nid) {
      $nid = str_replace('node/', '', $_GET['q']);
    }
    
    $query = db_select('node', 'n')
      ->fields('n', array('nid', 'type'));
    $query->join('field_data_field_extra_data', 'ed', 'ed.entity_id = n.nid');
    //$query->fields('ed', array('field_extra_data_value'));
    $query->addField('ed', 'field_extra_data_value', 'field_extra_data');
    
    $query->condition('n.nid', $nid);

    $node = $query->execute()->fetchObject();
  }
  
  gv_misc_addRelatedArticlesToNode($node);
  
  
  if (empty($node->related_articles)) {
    return NULL;
  }
    
  //dpm($node);

  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.tabs');
  //drupal_add_library('system', 'effects.bounce');


  $path_to_custom_js = drupal_get_path('module', 'gv_misc') . '/js/';
  drupal_add_js($path_to_custom_js . 'gv_relatedArticlesRotator.js');

  $path_to_current_theme = drupal_get_path('theme', $GLOBALS['theme']) . '/css/';
  drupal_add_css($path_to_current_theme . 'gv_relatedArticlesRotator.css');

  $ui_tabs_nav = '';
  $fragments = '';

  $count = NULL;
  foreach ($node->related_articles as $related_nid => $related_article) {
    ++$count;
    $ui_tabs_nav .= '<li class="ui-tabs-nav-item ui-tabs-selected" id="nav-fragment-' . $related_nid . '"><a href="#fragment-' . $related_nid . '" title="' . $related_article->title . '"></a></li>';

    $fragments .= '<div id="fragment-' . $related_nid . '" class="ui-tabs-panel' . (!$fragments ? ' first': '') . '">';

    if (!empty($related_article->src_themed_related_sideblock)) {
      $fragments .='<a class="thumb" href="' . url('node/' . $related_nid) . '">'
          //. ($related_article->src_themed_related_sideblock ? '<img src="' . $related_article->src_themed_related_sideblock . '" alt="' . $related_article->title . '" title="' . $related_article->title . '" />' : '')
          . ($related_article->src_themed_related_sideblock_beautify ? '<img src="' . $related_article->src_themed_related_sideblock_beautify . '" alt="' . $related_article->title . '" title="' . $related_article->title . '" />' : '')
      . '</a>';
    }
    $fragments .= l($related_article->title, 'node/' . $related_nid, array('attributes' => array('class' => array('title')))) .

      '<div class="submitted">' . (!isset($related_article->created) ? '': date('D, F d, Y', $related_article->created)) . '</div>
      <div class="teaser">' . (!isset($related_article->teaser) ? '' : $related_article->teaser) . ' ' . l('Read more', 'node/' . $related_nid, array('attributes' => array('class' => array('more')))) . '</div>

    </div>';
  }
//    $key += 1; 
//    $blog_tab = '<li class="ui-tabs-nav-item ui-tabs-selected" id="nav-fragment-' . $key . '"><a href="#fragment-' . $key . '">Blog</a></li>';
//    $blog_fragment = '<div id="fragment-' . $key . '" class="ui-tabs-panel"><div class="info">' . vr_misc_getHomeBlogPostsForBannerRotator() . '</div></div>';
//    return '<div id="related-block"><ul class="ui-tabs-nav">' . $ui_tabs_nav . $blog_tab . '</ul>' . $fragments . $blog_fragment . '</div>';
  
  //return '<div class="related-block" id="rotator"><ul class="ui-tabs-nav">' . $ui_tabs_nav . '</ul>' . $fragments . '</div>';
  return '<div class="related-block" id="rotator">' . $fragments . '<ul class="ui-tabs-nav c' . $count . '">' . $ui_tabs_nav . '</ul></div>';
}


/**
 * Block with social links for sidebar.
 */
function gv_blocks_getSidebarFollowLinksBlock() {
  
  $out = NULL;
  /*
  $source = 'GetVoIP.com';
  $post_url = url($_GET['q'], array('absolute' => TRUE));
  $post_title = $node->title;
  $summary = !empty($node->metatags['description']['value']) ? $node->metatags['description']['value'] : drupal_substr(strip_tags(@$node->body['und'][0]['value']), 0, 200);

  $link_open = 'href="javascript:void(window.open(' . "'";
  $links = array(
      'Twitter' => array('social_url' => 'http://twitter.com/share', 'query' => array('text' => $post_title, 'via' => 'getvoipreviews')),
      'Facebook' => array('social_url' => 'http://www.facebook.com/sharer.php', 'query' => array('u' => $post_url), 'link_close' => "','ShareThis','toolbar=0,status=0,width=626,height=436'))"),
      //array('social_url' => 'http://www.facebook.com/sharer.php', 'query' => array('p[title]' => $post_title, 'p[url]' => $post_url, 'p[summary]' => $summary, 'p[images]' => $image, )),
      'GooglePlus' => array('social_url' => 'https://plus.google.com/share', 'query' => array('url' => $post_url)),
      'LinkedIn' => array('social_url' => 'http://www.linkedin.com/shareArticle', 'query' => array('title' => $post_title, 'mini' => 'true', 'url' => $post_url, 'summary' => $summary, 'source' => $source)),
  
  );
  
  foreach ($links as $class => $link) {
    $out .= l($class, $link['social_url'], array('attributes' => array('class' => array($class), 'rel' => 'nofollow'), 'query' => $link['query']));
  }
  */
  
  
  
  $cid = 'gv_cached_sideSocialLinks';
  $cache = cache_get($cid, 'cache');

  if ($cache && !empty($cache->data) && $cache->expire > time()) {
    $out = $cache->data;
  }
  else {
    $menu = menu_build_tree('menu-header-links');
    //dpm($menu);
    // Don't show rss link here.
    unset($menu['49956 Rss 931']);
    $out = theme('gv_misc_headerLinks', array('submenu' => array('below' => $menu)));
    
    cache_set($cid, $out, 'cache', strtotime('+31 day'));
  } 
  
  return '<div class="follow-static">' . $out . '</div>';
}


/**
 * Block with sidebar share links for a current post.
 */
function gv_blocks_getSidebarShareStaticBlock($node = NULL, $block_title = NULL, $class = NULL) {
  
  static $out;
  
  if (!$out) {
    
  
  
      if (!$node) {
        if (strpos($_GET['q'], 'node/') === FALSE) {
          return NULL;
        }
        $node = node_load(str_replace('node/', '', $_GET['q']));
      }
      //dpm($_GET);
      //dpm($node);

      //$out = NULL;
      $source = 'GetVoIP.com';
      $post_url = url($_GET['q'], array('absolute' => TRUE));
      $post_title = $node->title;
      $summary = !empty($node->metatags['description']['value']) ? $node->metatags['description']['value'] : drupal_substr(strip_tags(@$node->body['und'][0]['value']), 0, 200);

      $link_open = 'href="javascript:void(window.open(' . "'";
      $links = array(
          'Twitter' => array('social_url' => 'http://twitter.com/share', 'query' => array('text' => $post_title, 'via' => 'getvoipreviews')),
          'Facebook' => array('social_url' => 'http://www.facebook.com/sharer.php', 'query' => array('u' => $post_url), 'link_close' => "','ShareThis','toolbar=0,status=0,width=626,height=436'))"),
          //array('social_url' => 'http://www.facebook.com/sharer.php', 'query' => array('p[title]' => $post_title, 'p[url]' => $post_url, 'p[summary]' => $summary, 'p[images]' => $image, )),
          'GooglePlus' => array('social_url' => 'https://plus.google.com/share', 'query' => array('url' => $post_url)),
          'LinkedIn' => array('social_url' => 'http://www.linkedin.com/shareArticle', 'query' => array('title' => $post_title, 'mini' => 'true', 'url' => $post_url, 'summary' => $summary, 'source' => $source)),

        //'http://twitter.com/share?text=What%20is%20%E2%80%9CBig%20Data%E2%80%9D%20in%20Healthcare,%20and%20Who%E2%80%99s%20Already%20Doing%20It?',
        //'http://www.linkedin.com/shareArticle?mini=true&url=http://profitable-practice.softwareadvice.com/what-is-big-data-in-healthcare-0813/&title=What%20is%20%E2%80%9CBig%20Data%E2%80%9D%20in%20Healthcare,%20and%20Who%E2%80%99s%20Already%20Doing%20It?&summary=What+will+big+data+mean+for+healthcare%3F+I+talked+to+expert+Dr.+Russell+Richmond%2C+and+looked+at+5+companies+using+big+data+today.&source=The+Profitable+Practice',
        //'https://plus.google.com/share?url=http://profitable-practice.softwareadvice.com/what-is-big-data-in-healthcare-0813/',
        //'http://www.facebook.com/sharer.php?s=%20100&p[title]=What%20is%20%E2%80%9CBig%20Data%E2%80%9D%20in%20Healthcare,%20and%20Who%E2%80%99s%20Already%20Doing%20It?&p[url]=http://profitable-practice.softwareadvice.com/what-is-big-data-in-healthcare-0813/&p[images][0]=http://profitable-practice.softwareadvice.com/files/2013/08/genomedata_thumbnail.jpg&p[summary]=What+will+big+data+mean+for+healthcare%3F+I+talked+to+expert+Dr.+Russell+Richmond%2C+and+looked+at+5+companies+using+big+data+today.',
      );

      foreach ($links as $provider => $link) {
        $out .= l($provider, $link['social_url'], array('attributes' => array(/*'target' => '_blank',*/ 'class' => array($provider), 'rel' => 'nofollow'), 'query' => $link['query']));
      }

      //$out .= '<a ' . $link_open . $links['Facebook']['social_url'] . $links['Facebook']['link_close'] . '">Share</a>';
  }
  
  return '<div class="share-static' . ($class ? ' ' . $class : '') . '">' . $block_title . $out . '</div>';
}


/**
 * Block with writer admin links.
 */
function gv_blocks_getWriterAdminLinks() {
  return '<a href="/admin/content-gv?service=All">Add/Edit Content</a><a href="/cc">Clear Cache</a>';
}


/**
 * Returns a block with a cloud of all tags of s specific content type.
 */
function gv_block_buildTopicsBlock($content_type_label) {
  
  $content_types = array('blog' => 'blog_post', 'news' => 'news_post', 'articles' => 'article');
  $content_type = $content_types[$content_type_label];
  
  //$tags = gv_misc_getTopics($content_type, $content_type_label, 20);  
  $tags = gv_misc_getTopics($content_type, $content_type_label, NULL, NULL, NULL, array('name', 'asc'));
  
  //$tags = tagadelic_sort_tags(tagadelic_build_weighted_tags($tags, 12));
  
  $themed_tags = '';
  foreach ($tags as $tag) {
    $themed_tags .= l(drupal_ucfirst($tag->name) . ' (' . $tag->count . ')', $tag->link['href']);
  }
  
  return $themed_tags . '<div class="more-link">' . l('All', 'articles/tags') . '</div>';
}


/**
 * Returns block with the current reviews counter.
 */
function gv_blocks_reviewsCounter() {
  
  if (!$ReviewsAmount = variable_get('gv_allReviewsAmount')) {
    $ReviewsAmount = gv_misc_recalculateReviewsAmount();
  }
  
  $chars = str_split(variable_get('gv_allReviewsAmount'));
  //$counter = count($chars) == 3 ? '<span>0</span>' : '';
  $counter = '';
  foreach ($chars as $char) {
    $counter .= '<span>' . $char . '</span>';
  }
  return '<div class="r-counter">' . $counter . '</div><div class="title">Real user reviews</div>';
}


/**
 * Returns block with Top 5 Providers block by service type/path.
 */
function gv_blocks_getTop5Providers_byTypeAndPath($service_type = NULL) {
  
  
  if (!$service_type) {
    /*
    $map_path_to_preface_type = array(
      '/business' => 'page-compare-business-voip-providers',
      '/residential' => 'page-compare-residential-voip-providers',
      '/sip-trunking' => 'page-compare-sip-voip-providers',
      '/fax' => 'page-compare-ifa-voip-providers',
      //'/business-voip-features' => 'business-voip-features',
      '/canada' => 'canada-voip',
      '/hosted-pbx' => 'page-compare-pbx-voip-providers',
      '/web-conferencing' => 'web-conferencing-voip-providers',
    );
    */
    /*
    $map_preface_type_to_service_type = array(
      'page-compare-business-voip-providers' => 'business',
      'page-compare-residential-voip-providers' => 'residential',
      'page-compare-sip-voip-providers' => 'sip',
      'page-compare-ifa-voip-providers' => 'ifa',
      'canada-voip' => 'ca',
      'page-compare-pbx-voip-providers' => 'pbx',
       //'page-compare-smbv-voip-providers' => NULL,
    );
    */

    $map_path_to_title = array(
      '/business' => 'Business VoIP', 
      '/ppc/business-voip' => 'Business VoIP', 
      '/residential' => 'Residential VoIP',
      //'/business-voip-features' => 'Business VoIP Features',
      '/sip-trunking' => 'SIP Trunking',
      '/canada' => 'Canada VoIP',
      '/fax' => 'Internet Fax',
      '/hosted-pbx' => 'Hosted PBX',
      '/web-conferencing' => 'Web Conferencing',
       //'/small-business-voip' => 'Small Business VoIP',
      '/cloud-backup' => 'Cloud Backup',
      '/cloud-contact-center' => 'Call Center Software',
    );
    
    $map_path_to_type = array(
      //'/business' => 'business',  
      '/business' => 'bu', 
      '/ppc/business-voip' => 'bu', 
      //'/residential' => 'residential',
      '/residential' => 're',
      //'/business-voip-features' => 'Business VoIP Features',
      '/sip-trunking' => 'sip',
      '/canada' => 'ca',
      '/fax' => 'ifa',
      '/hosted-pbx' => 'pbx',
      '/web-conferencing' => 'wc',
      '/crm-software' => 'crm',
      //'/small-business-voip' => 'smbv',
      '/cloud-backup' => 'cb',
      '/cloud-contact-center' => 'cc',// 'page-compare-cc-voip-providers',
    );
    
    if(!$service_type = @$map_path_to_type[$_SERVER['REDIRECT_URL']]) {
      return NULL;
    }

  }
  
  //$current_theme = $GLOBALS['theme'];
  $cid = 'gv_blocks_getTop5Providers_data_' . $service_type;
  $cache = cache_get($cid, 'cache');
  
  if ($cache && !empty($cache->data) && $cache->expire > time()) {
    return $cache->data;
  }
  
  $services_data = array (
    //'business' => array (
    'bu' => array (
      'rating_table' => 'field_data_field_p_erating',
      'rating_field' => 'field_p_erating_value',
    ),
    //'residential' => array (
    're' => array (
      'rating_table' => 'field_data_field_p_erating_residential',
      'rating_field' => 'field_p_erating_residential_value',
    ),
    'pbx' => array (
      'rating_table' => 'field_data_field_p_erating_pbx',
      'rating_field' => 'field_p_erating_pbx_value',
    ),
    'sip' => array (
      'rating_table' => 'field_data_field_p_erating_sip',
      'rating_field' => 'field_p_erating_sip_value',
    ),
    'ifa' => array (
      'rating_table' => 'field_data_field_p_erating_ifa',
      'rating_field' => 'field_p_erating_ifa_value',
    ),
    'wc' => array (
      'rating_table' => 'field_data_field_p_erating_wc',
      'rating_field' => 'field_p_erating_wc_value',
    ),
    'crm' => array (
      'rating_table' => 'field_data_field_p_erating_crm',
      'rating_field' => 'field_p_erating_crm_value',
    ),
    'ca' => array (
      'rating_table' => 'field_data_field_p_erating_bu_ca',
      'rating_field' => 'field_p_erating_bu_ca_value',
    ),
    'cb' => array (
      'rating_table' => 'field_data_field_p_erating_cb',
      'rating_field' => 'field_p_erating_cb_value',
    ),
    'cc' => array (
      'rating_table' => 'field_data_field_p_erating_cc',
      'rating_field' => 'field_p_erating_cc_value',
    ),
  );
  
   
  
  
  $query = db_select($services_data[$service_type]['rating_table'], 'r');
  $query->addField('r', $services_data[$service_type]['rating_field'], 'erating');
  $query->condition('r.bundle', 'provider');
  
//  global $user;
//  if ($user->uid == 1) {
//    $query->leftJoin('field_data_field_p_erating_re_ca', 'r2', "r2.bundle = 'provider'");
//    $query->addField('r2', 'field_p_erating_re_ca_value', 'erating');
//    $query->leftJoin('field_data_field_p_name', 'pn', "pn.entity_id = r.entity_id OR pn.entity_id = r2.entity_id");
//  }
//  else 
    {
    $query->leftJoin('field_data_field_p_name', 'pn', "pn.entity_id = r.entity_id");
  }
  
  
  $query->fields('pn', array('field_p_name_value', 'entity_id'));
  
  
  //$query->leftJoin('field_data_field_p_data', 'pd', "pd.entity_id = r.entity_id");
  //$query->fields('pd', array('field_p_data_value', 'entity_id'));
  
  $query->orderBy($services_data[$service_type]['rating_field']);
  $query->range(0, 5);

  
  
  $providers = $query->execute()->fetchAllAssoc('entity_id');
  
  //dpm($providers);
  
  
  
  
  
  
  // Re_ca for the canada page
  /*
  if ($service_type == 'ca') {
    $query = db_select('field_data_field_p_erating_re_ca', 'r');
    $query->addField('r', 'field_p_erating_re_ca_value', 'erating');
    $query->condition('r.bundle', 'provider');

    $query->leftJoin('field_data_field_p_name', 'pn', "pn.entity_id = r.entity_id");

    $query->fields('pn', array('field_p_name_value', 'entity_id'));

    $query->orderBy('field_p_erating_re_ca_value');
    $query->range(0, 5);

    $providers2 = $query->execute()->fetchAllAssoc('entity_id');

    //dpm($providers2);
    
    foreach ($providers2 as $nid2 => $provider2) {
      if (isset($providers[$nid2])) {
        if ($providers[$nid2]->erating > $providers2[$nid2]->erating) {
          unset($providers2[$nid2]);
        }
        else {
          unset($providers[$nid2]);
        }
      }
    }
    
    $providers += $providers2;
    
    uasort($providers, 'gv_misc_sortArrayProvidersByErating');
    
    //dpm($providers);
  } // End of if ($service_type == 'ca' && $user->uid == 1) {
  */
  
  
  $all_data_quick = gv_misc_getProvidersDataQuick();
  
  $out = '<section id="block-views-providers-block-top-bu-small" class="block block-views contextual-links-region odd first">
  <h3 class="block-title">
  <span class="block-icon">Top 5 Providers</span></h3>' .
  /*        
  '<div class="contextual-links-wrapper contextual-links-processed">
    <a class="contextual-links-trigger" href="#">Configure</a>
    <ul class="contextual-links">
      <li class="views-ui-edit first">
        <a href="/admin/structure/views/view/providers/edit/block_top_bu_small?destination=blog">Edit view</a>
      </li>
      <li class="block-configure last">
        <a href="/admin/structure/block/manage/views/providers-block_top_bu_small/configure?destination=blog">Configure block</a>
      </li>
    </ul>
  </div>' .
   */       
  '<div class="content">
    <div class="view view-providers view-id-providers view-display-id-block_top_bu_small bu-providers view-dom-id-cb39c150aa1db478decae445be6b3572">
      <div class="view-content">
        <table class="views-table cols-0">
          <tbody>';
  
  $zebra = 'even';
  $count = NULL;
  
  //dpm($_SERVER['REDIRECT_URL']);
  
  foreach ($providers as $nid => $provider) {
      
      if ($count == 5) {
        break;
      }

      ////$zebra = ($zebra == 'odd') ? 'even' : 'odd';
    
      $criteria = array(
        'entity_type' => 'node',
        'entity_id' => $nid,
        'function' => 'average',
      );
      $votes = votingapi_select_results($criteria);
      $stars = NULL;
      foreach ($votes as $vote) {
        if ($vote['tag'] == 'overall' && $vote['value']) {
          $stars = theme('gv_misc_fivestar_static', array('rating' => $vote['value'], 'stars' => 5, 'tag' => 'overall', 'widget' => array('name' => 'stars', 'css' => 'stars.css')));
          ////$providers[$nid]->p_vote_overall = number_format($vote['value'] * 0.05, 1);
        }
        /*
        elseif ($vote['tag'] == 'recommend') {
          $p_vote_recommend = $vote['value'];
        }
        else {
          $p_votes[$vote['tag']] = $vote['value']; // number_format($vote['value'] * 0.05, 1);
        }
        */
      }
      
      ////$providers[$nid]->field_p_data_value = unserialize($providers[$nid]->field_p_data_value); 
      if ($_SERVER['REDIRECT_URL'] == '/ppc/business-voip') {
        $reviews_link_attributes = array('attributes' => array('class' => array('review-link'), 'target' => '_blank'));
      }
      else {
        $reviews_link_attributes = array('attributes' => array('class' => array('review-link')));
      }
      
      $out .= '
          <tr' .  /*' class="' . $zebra . (!$count++ ? ' views-row-first views-row-last' : '') . '"' . */ '>
          
            <td class="views-field views-field-field-p-erating">
              <span>' . /*$provider->erating*/ ++$count . '</span> 
            </td>
            
            <td class="views-field views-field-php-4">
            
              <div class="name">' . gv_misc_getTrackingUrl($provider->field_p_name_value, NULL, $nid, NULL, NULL, NULL, $all_data_quick[$nid], $service_type) . '</div>
                
              <div class="rating">' . $stars . 
                
//                 '<div class="fivestar fivestar-stars">
//                   <div class="fivestar-widget-static fivestar-widget-static-overall fivestar-widget-static-5 clearfix">
//                    <div class="star star-1 star-odd star-first">
//                      <span class="on">4.816325</span>
//                    </div>
//                    <div class="star star-2 star-even">
//                      <span class="on"></span>
//                      </div><div class="star star-3 star-odd"><span class="on"></span></div><div class="star star-4 star-even"><span class="on"></span></div><div class="star star-5 star-odd star-last"><span class="on" style="width: 81.6325%"></span></div></div>
//                  </div>' .
                  
               '</div> 
            </td>
            
            <td class="views-field views-field-php-5">
              <div class="p-links">'
                //. '<a href="/go/nextiva" target="_blank" rel="nofollow" class="reviews visit-site-btn"></a>'
                 . gv_misc_getTrackingUrl('', NULL, $nid, NULL, 'visit-site-btn reviews', NULL, $all_data_quick[$nid], $service_type)
                 . l('READ REVIEWS', 'node/' . $nid, $reviews_link_attributes) //. '<a class="review-link" href="/reviews/nextiva">READ REVIEWS</a>
              . '</div> 
            </td>
          </tr>
          ';

  }
  
  
  $out .= '</tbody>
          </table>
        </div>
      </div> 
    </div>
  </section>';
  
  
  cache_set($cid, $out, 'cache', strtotime('+31 day'));
          
  //dpm($providers);
      
  return $out;//$map_path_to_title[$_SERVER['REDIRECT_URL']];
}



/**
 * Returns block with comparing TOP BUSINESS or Other type providers table.
 */
function gv_blocks_compareTopProviders($service_type) {
  
  //global $user;
  $current_theme = $GLOBALS['theme'];
  //$cid = 'gv_blocks_compareTopProviders_' . $service_type . ($user->uid ? '_admin' : '_anonim') . '_' . $current_theme;
  $cid = 'gv_blocks_compareTopProviders_' . $service_type . '_' . $current_theme;
  $cache = cache_get($cid, 'cache');
  
  // Stick table header to the page top.
  drupal_add_js('misc/tableheader.js');
  
  // Try to get the data from cache.
  if ($cache && !empty($cache->data) && $cache->expire > time()) {
    // Strange, but seems that adding tis dpm info line has increased the cached page loadding tim in several times!!!
    dpm('Cached ...' . $cid);
    return $cache->data;
  }
  // Strange, but seems that adding tis dpm info line has increased the cached page loadding tim in several times!!!
  dpm('No cache Compare...' . $cid);
  
  // No cached data... rebuilding...
  switch ($service_type) {
    case 'business':
      $rating_table = 'field_data_field_p_erating';
      $rating_field = 'field_p_erating_value';
      break;
    case 'residential':
      $rating_table = 'field_data_field_p_erating_residential';
      $rating_field = 'field_p_erating_residential_value';
      break;
    case 'pbx':
      $rating_table = 'field_data_field_p_erating_pbx';
      $rating_field = 'field_p_erating_pbx_value';
      break;
  }
  
  $query = db_select($rating_table, 'r');
  $query->leftJoin('field_data_field_p_name', 'pn', "pn.entity_id = r.entity_id");

  $query->fields('pn', array('field_p_name_value'));
  $query->condition('r.bundle', 'provider');
  $query->orderBy($rating_field);

  $p_names = $query->execute()->fetchCol();
  
  $sprite_names = unserialize(SPRITE_NAMES);
  
  // Replace defaults with bigger logos.
  $sprite_names['residential'] = 'top_re_providers_chart_big';
  
  if (!empty($p_names)) {
    //return gv_blocks_compareProviders($p_names, '<none>', $sprite_names[$service_type], $service_type, $rating_table, $rating_field);
    $out = gv_blocks_compareProviders($p_names, '<none>', $sprite_names[$service_type], $service_type, $rating_table, $rating_field);
    cache_set($cid, $out, 'cache', strtotime('+31 day'));
    return $out;
  }
  
}


/**
 * Returns block with comparing providers table.
 */
function gv_blocks_compareProviders($p_names = NULL, $back_button = NULL, $sprite_name = NULL, $service_type = 'business', $rating_table = 'field_data_field_p_erating', $rating_field = 'field_p_erating_value') {
  
  global $user;
  
  if (empty($p_names)) {
  
    if (empty($_GET['p'])) {
      return '<div class="no-results">No providers have been chosen.</div>';
    }

    $p_names = explode(';', $_GET['p']);
  }
  
  // Get providers with data, by names
  $query = db_select('field_data_field_p_name', 'pn');
  $query->leftJoin('field_data_field_p_data', 'pd', "pd.entity_id = pn.entity_id");
  $query->leftJoin($rating_table, 'pr', "pr.entity_id = pn.entity_id");
  $query->fields('pr', array($rating_field));
  $query->fields('pd', array('field_p_data_value', 'entity_id'));
  $query->fields('pn', array('field_p_name_value'));
  
  $db_or = db_or();
  foreach ($p_names as $p_name) {
    $db_or->condition('pn.field_p_name_value', $p_name);
  }
  $query->condition($db_or);
  
  $query->orderBy($rating_field, 'ASC');
  $results = $query->execute()->fetchAllAssoc('entity_id');

  if (empty($results)) {
    return '<div class="no-results">No providers have been chosen.</div>';
  }
  
  $all_data_quick = gv_misc_getProvidersDataQuick();
  
  foreach ($results as $nid => $provider) {
    $providers[$nid] = array('nid' => $provider->entity_id, 'p_name' => $provider->field_p_name_value, 'p_data' => unserialize($provider->field_p_data_value));
  }
  
  $cols_num = count($providers) + 1;
  
  $v_colors = array('features' => '#a7a7a7', 'install' => '#6b6a6a', 'money' => 'black', 'rely' => '#85caff', 'service' => '#3099e9', 'sound' => '#046da7');
  $v_titles = array('sound' => SOUND, 'install' => INSTALL, 'service' => CUSTOMER, 'rely' => RELY, 'features' => FEATURES, 'money' => PRICE, 'recommend' => RECOMMEND);  
  
  $out = '<table class="specs sticky-enabled sticky-table p' . ($cols_num - 1) . '">';
  
      if ($back_button) {
        if ($back_button = '<none>') {
          $back_button = '';
        }
      }
      else {
        $back_button = l('Back', @$_SERVER['HTTP_REFERER'], array('attributes' => array('style' => 'background: url(/sites/all/themes/gv_orange/css/images/rect-btn-gray-left.png) no-repeat 0 0 transparent;
                      color: gray;
                      display: block;
                      width: 110px;
                      height: 25px;
                      margin: auto;
                      font-size: 12px;
                      padding: 5px 0 0 0; text-indent: 50px; font-weight: bold;')));
      }

      
      //if (!$user->uid) {
      if ($GLOBALS['theme'] == 'gv_blue') {
        $out .= '<thead><tr class="logos" ><th class="back" style="border: none; vertical-align: bottom; padding: 8px 0 3px; border-radius: 10px 0 0 0;">' . $back_button . '<div class="rank title"><span>Rank</span></div></th>';
      }
      else {
        $out .= '<thead><tr class="logos" ><th class="back" style="border: none; vertical-align: bottom; padding: 8px 0 3px; border-radius: 10px 0 0 0;">' . $back_button . '<div class="rank title" style="background: #2c7bbf; color: white; text-align: left; font-size: 12px; font-weight: bold; padding: 3px 0 3px 7px;">Rank</div></th>';
      }
        
        //$out .= '<thead><tr class="logos" ><th class="back" style="border: none; padding: 8px 0 3px; border-radius: 10px 0 0 0;">' . $back_button . '</th>';

        $i = $cols_num - 1;
        foreach ($providers as $nid => $provider) {
          //$out .= '<th style="border: none; vertical-align: bottom; text-align: center; padding: 8px 0 3px; ' . (--$i <= 0 ? ' border-radius: 0 10px 0 0;' : '') . '">';
          $out .= '<th class="th-all" style="border: none; vertical-align: bottom; text-align: center; padding: 8px 0 2px; ' . (--$i <= 0 ? ' border-radius: 0 10px 0 0;' : '') . '">';
          if ($sprite_name) {
            $image = gv_misc_getProviderLogoFromSprite($provider['nid'], $sprite_name, array($provider['nid'] => array('name' => $provider['p_name'])));
          }
          elseif (!empty($provider['p_data']['logo']['i_logo_uri'])) {
            $image_style_name = 'logo_provider_chart_main';
            $image = theme('gv_misc_image_style', array('style_name' => $image_style_name, 'path' => $provider['p_data']['logo']['i_logo_uri'], 'alt' =>  'Visit ' . $provider['p_name'], 'title' =>  'Visit ' . $provider['p_name'] ));
          }
          
          if (!empty($image)) {
            // gv_misc_getTrackingUrl($title_or_wrapped_object, $subpath = NULL, $nid = NULL, $target_name = NULL, $a_class = NULL, $a_attr = NULL)
            
            //$out .= gv_misc_getTrackingUrl('<div style="min-height: 45px;">' . $image . '</div>', NULL, $provider['nid'], NULL, 'logo');
            $out .= gv_misc_getTrackingUrl('<div style="min-height: 45px;">' . $image . '</div>', NULL, $provider['nid'], NULL, 'logo', NULL, $all_data_quick[$nid], gv_misc_refineServiceTypeKey($service_type));
          }
          
          //$out .= '<div class="rank" style="background: #2c7bbf; color: white; margin-top: 5px;">#' . ($cols_num - $i - 1) . '</div>';
          $out .= '<div class="rank"><span>#</span>' . ($cols_num - $i - 1) . '</div>';
          
          $out .= '</th>';
        }
      $out .= '</tr></thead>';

      
      
      
  
      $out .= '<tbody><tr class="overall"><td class="title">Ratings</td>';
      foreach ($providers as $nid => $provider) {
              
            $criteria = array(
              'entity_type' => 'node',
              'entity_id' => $provider['nid'],
              'function' => 'average',
            );
            $votes = votingapi_select_results($criteria);

            foreach ($votes as $vote) {
              if ($vote['tag'] == 'overall') {
                $p_vote_overall = number_format($vote['value'] * 0.05, 1);
              }
              elseif ($vote['tag'] == 'recommend') {
                $p_vote_recommend = $vote['value'];
              }
              else {
                $p_votes[$vote['tag']] = $vote['value']; // number_format($vote['value'] * 0.05, 1);
              }
            }
            
            $providers[$nid]['p_votes'] = $p_votes;
            $providers[$nid]['p_vote_overall'] = $p_vote_overall;
            $providers[$nid]['p_vote_recommend'] = $p_vote_recommend;
            
            $out .= '<td style="text-align: center;">' . $p_vote_overall . '/5</td>';
          
      }
      $out .= '</tr>';
      
      
      
      
      
      // Ratings graphs row.
      $out .= '<tr class="rating-graphs"><td class="titles">';
      
      // Ratings graphs title td.
      $out .= '<div class="graph-titles" style="float: left; padding-top: 1px;">';
        foreach ($p_votes as $vote_tag => $vote_value) {
          $out .= '<div style="overflow: hidden;"><div class="marker" style="background: ' . $v_colors[$vote_tag] . ';"></div><div class="title">' . $v_titles[$vote_tag] . '</div></div>';
        } 
      $out .= '</div>';
      
      $out .= '<div class="graph-grades"><div class="first">5</div><div>4</div><div>3</div><div>2</div><div class="last">1</div></div>';
      
      
      $out .= '</td>';
      
      
      $v_max_height = $GLOBALS['theme'] == 'gv_blue' ? 130 : 100;
      
      foreach ($providers as $nid => $provider) {
        
        $out .= '<td class="v-bars">';

            
            $out .= '<div class="v-graphs">';
            foreach ($provider['p_votes'] as $vote_tag => $p_vote_value) {
              $out .= '<div class="v-bar" title="' . $v_titles[$vote_tag] . ': ' . number_format($p_vote_value * 0.05, 1) . '" style="float: left; height: ' . number_format($v_max_height * ($p_vote_value/100), 0) .  'px; margin-top: ' . ($v_max_height - number_format($v_max_height * ($p_vote_value/100), 0)) . 'px; margin-left: 3px; width: 10px; background: ' . $v_colors[$vote_tag] . ';"></div>';
            }
            $out .= '</div>';


        $out .= '</td>';
      }
      $out .= '</tr>';
  
      
      
      
      
     
      $options_to_exclude = array();
      $options_sets_to_exclude = array();
      
      $additional_options_td_style = array(
        'Monthly Cost of Cheapest Service' => ' font-size: 14px; font-weight: bold;',
      );
      $provider_options_titles_aliases = unserialize(PROVIDER_OPTIONS_TITLES_ALIASES);
          
      switch ($service_type) {
        case 'business':
        case 'pbx':
          $provider_options_structure = unserialize(PROVIDER_OPTIONS_BU);
          $provider_options_index = 'provider_options_bu';
           
          if ($service_type == 'business') {
            $options_sets_to_exclude = array(
              'Integrations',
            );
            $options_to_exclude = array(
              'Amount of Lines Per Price Tier',
              'Desktop Integration Client',
              'Call Notifications',
              'Call Return',
              'Push To Talk',
              'Selective Call Acceptance',
              'Selective Call Rejection',
              'Switchboard Software for Live Receptionist',
              'Virtual Extensions',
              'Call Queuing',
              'Call Me Now',
            );
          }
          else { 
            // PBX
            $options_to_exclude = array(
              'Amount of Lines Per Price Tier',
            );
          }
          
          break;
        
        case 'residential':
          $provider_options_structure = unserialize(PROVIDER_OPTIONS_RE);
          $provider_options_index = 'provider_options_re';
          break;
      }
      //$provider_options_bu = unserialize(PROVIDER_OPTIONS_BU);
      
      foreach ($provider_options_structure as $options_set => $options_data) {

        if (in_array($options_set, $options_sets_to_exclude)) {
          continue;
        }
        
        $out .= '<tr class="reviews"><td class="title">User Reviews</td>';
          foreach ($providers as $nid => $provider) {
            $out .= '<td style="text-align: center;">' . l('Read Reviews', 'node/' . $nid) . '</td>';
          }
        $out .= '</tr>';


        $out .= '<tr class="visit"><td class="title">Details</td>';
          foreach ($providers as $nid => $provider) {
            //$out .= '<td style="text-align: center;">' . gv_misc_getTrackingUrl($provider['p_name'], NULL, $nid) . '</td>';
            //$out .= '<td style="text-align: center;">' . gv_misc_getTrackingUrl('Visit Site', NULL, $nid) . '</td>';
            $out .= '<td style="text-align: center;">' . gv_misc_getTrackingUrl('Visit Site', NULL, $nid, NULL, NULL, NULL, $all_data_quick[$nid], gv_misc_refineServiceTypeKey($service_type)) . '</td>';
          }
        $out .= '</tr>';
        
        
        $out .= '<tr class="divider"><td colspan="' . $cols_num . '"></td></tr><tr class="caption"><td colspan="' . $cols_num . '">' . str_replace(array('(', ')'), array('<span>(', ')</span>'), $options_set) . '</td></tr>';

        
        
        $odd = TRUE;
        foreach ($options_data as $option_title => $option_type) {
          if (in_array($option_title, $options_to_exclude)) {
            //dpm($option_title);
            continue;
          }
          
          
          
          if ($odd) {$odd = FALSE; $row_class = 'even';} else {$odd = TRUE; $row_class = 'odd';}
          
          
          // Refine a title to show.
          $title_alias = isset($provider_options_titles_aliases[$option_title])? $provider_options_titles_aliases[$option_title] : $option_title;
          $title_alias = str_replace('Num ', '# ', $title_alias);
          $out .= '<tr class="options ' . $row_class . '"><td class="title">' . $title_alias . '</td>';
          
          foreach ($providers as $nid => $provider) {
            
              if ($provider_options_index == 'provider_options_bu') {
                $provider_options = isset($provider['p_data'][$provider_options_index]) ? $provider['p_data'][$provider_options_index] : (isset($provider['p_data']['provider_options']) ? $provider['p_data']['provider_options'] : NULL);
              }
              else {
                $provider_options = isset($provider['p_data'][$provider_options_index]) ? $provider['p_data'][$provider_options_index] : NULL;
              }
              
              $option_value = @$provider_options[$options_set][$option_title];
              
              $is_checkbox = is_int($option_value);
              $option_value = ($is_checkbox ? ($option_value ? 'Yes' : 'No') : ($option_value ? $option_value : 'N/A'));
              

              if ($option_value == 'Yes' && !empty($provider_options[$options_set][$option_title . ' -text-'])) {
                $additional_text = ' <span>' . $provider_options[$options_set][$option_title . ' -text-'] . '</span>';
              }
              else {
                $additional_text = '';
              }
              
              if (is_array($option_value)) {
                $option_value = $option_value['value'];
              }
              
              $out .= '<td style="text-align: center;' . (!empty($additional_options_td_style[$option_title]) ? $additional_options_td_style[$option_title] : '') . '" class="option value' . ($option_value == 'Yes' ? ' yes' : ($option_value == 'No' ? ' no' : '')) . '"><div'. ($is_checkbox ? ' class="check"' : '') . '>' . $option_value . '</div><div>' . $additional_text . '</div></td>';

          }
          
          $out .= '</tr>';
     
        }
      }

      $out .= '<tr class="reviews"><td class="title">User Reviews</td>';
        foreach ($providers as $nid => $provider) {
          $out .= '<td style="text-align: center;">' . l('Read Reviews', 'node/' . $nid) . '</td>';
        }
      $out .= '</tr>';


      $out .= '<tr class="visit"><td class="title">Details</td>';
        foreach ($providers as $nid => $provider) {
          //$out .= '<td style="text-align: center;">' . gv_misc_getTrackingUrl($provider['p_name'], NULL, $nid) . '</td>';
          
          //$out .= '<td style="text-align: center;">' . gv_misc_getTrackingUrl('Visit Site', NULL, $nid) . '</td>';
          $out .= '<td style="text-align: center;">' . gv_misc_getTrackingUrl('Visit Site', NULL, $nid, NULL, NULL, NULL, $all_data_quick[$nid], gv_misc_refineServiceTypeKey($service_type)) . '</td>';
        }
      $out .= '</tr>';
        
      
  $out .= '</tbody></table>';
  
  $out = '<div class="compare-providers-top-wrapper">' . $out . '</div>';
  
  return $out;
}


/**
 * Returns block with cached providers table.
 */
function gv_blocks_getProvidersTableFromViews_withCaching() {

  if(!$providers = variable_get('gv_providers_table')) {
    $block_data = array('module' => 'views', 'delta' => 'providers-block_providers_list_table', 'shadow' => FALSE);
    $providers = gv_blocks_getBlockThemed($block_data);
    variable_set('gv_providers_table', $providers);
    //dpm('new generation');
  }
 
  return $providers;
}


/**
 * Returns block with paginated articles pages with 4 teasers on the first page and 18 pages on the rest of pages.
 */
function gv_blocks_libraryArticlesTeasers_customPagesAmountPager() {
  
  $out = '';
  
  $query = db_select('node', 'n')
        ->fields('n', array('nid'));
  $query->condition('n.type', 'article');
  $query->condition('n.status', 1);
  $query->addTag('a4s');
  $query->addTag('articles');
  $query->orderBy('n.created', 'DESC');
  //$query->orderBy('n.title', 'ASC');
  
  
  $countQuery = $query->countQuery();
  $overal_articles_num = $countQuery->execute()->fetchField();
  
  $page_next = FALSE;
  $page_prev = FALSE;
  
  if (empty($_GET['page'])) {
    // First page.
    $limit = 4;
    $start = 0;
    $page_prev = 1;
  }
  else {
    $limit = 18;
    $start = 0;
    if ($_GET['page'] ===  1) {
      $start = $start + 4;
    }
    else {
      $start = 4 + ($_GET['page'] * $limit - $limit);
    }
  }

  //dpm('start = ' . $start . ', limit = ' . $limit);

  // Correction for overflows.
  $corrected = FALSE;
  while ($start > $overal_articles_num - 1) {
    $corrected = TRUE;
    $_GET['page'] -= 1;
    $start = 4 + ($_GET['page'] * $limit - $limit);
  }
  
  
//  if ($corrected) {
//    dpm('corrected start = ' . $start . ', limit = ' . $limit . ', new cur page = ' . $_GET['page']);
//  }
  
  
  if (empty($_GET['page']) || (!empty($_GET['page']) && $_GET['page'] === 0)) {
    $page_prev = 1;
  }
  elseif (!empty($_GET['page'])) {
    $page_prev = $_GET['page'] + 1;
    $page_next = $_GET['page'] - 1;
    if ($corrected || ($start + $limit > $overal_articles_num)) {
      $page_prev = FALSE;
    }
  }
  
  if ($page_prev !== FALSE) {
    $page_prev = l('Older Posts ›', $_GET['q'], array('query' => array('page' => $page_prev)));
  }
  if ($page_next !== FALSE) {
    if (!$page_next) {
      $page_next = l('‹ Newer Posts', $_GET['q'], array('attributes' => array('class' => array('newer'))));
    }
    else {
      $page_next = l('‹ Newer Posts', $_GET['q'], array('query' => array('page' => $page_next), 'attributes' => array('class' => array('newer'))));
    }
  }
  
  $query->range($start, $limit);
  
  $nids = $query->execute()->fetchCol();
  
  $out .=  '<div class="view-articles">';
  $views_row_odd = TRUE;
  foreach ($nids as $nid) {
    $node = node_load($nid);
    if ($views_row_odd) {
      $views_row_odd = FALSE;
      $class_add = ' views-row-odd';
    }
    else {
      $views_row_odd = TRUE;
      $class_add = '';
    }
    $node_teaser = node_view($node, 'teaser');
    $out .= '<div class="views-row' . $class_add . '">' . render($node_teaser) . '</div>';
  }
  $out .= '</div>';
  if (!$GLOBALS['theme'] == 'gv_blue') {
    $out .= '<div class="pager custom">' . $page_next . ' ' . $page_prev . '</div>';
  }
  else {
    $out .= '<ul class="pager custom"><li class="pager-previous first">' . $page_next . '</li><li class="pager-next last">' . $page_prev . '</li></ul>';
  }
  
  return $out;
}


/**
 * Returns Library articles sections block.
 */
function gv_blocks_librarySections() {
 
  // Show only on the first page (not on further pagenated pages)
  if (!empty($_GET['page'])) {
    return NULL;
  }
  
  $path_to_custom_js = drupal_get_path('module', 'gv_misc') . '/js/';
  drupal_add_js($path_to_custom_js . 'gv_getSectionArticles.js');
  
  
  $sections = array(
    'Advantages of' => array('see_all_link' => 'library', 'image' => '/sites/all/themes/gv_orange/css/images/section-advantages.png'),
    'Cloud' => array('see_all_link' => 'library', 'image' => '/sites/all/themes/gv_orange/css/images/section-cloud.png'),
    'Connectivity' => array('see_all_link' => 'library', 'image' => '/sites/all/themes/gv_orange/css/images/section-connectivity.png'),
    'Equipment/Hardware' => array('see_all_link' => 'library', 'image' => '/sites/all/themes/gv_orange/css/images/section-equipment.png'),
    'How Stuff Works' => array('see_all_link' => 'library', 'image' => '/sites/all/themes/gv_orange/css/images/section-howworks.png'),
    'Mobility' => array('see_all_link' => 'library', 'image' => '/sites/all/themes/gv_orange/css/images/section-mobility.png'),
    'Terms to Know/Glossary' => array('see_all_link' => 'library', 'image' => '/sites/all/themes/gv_orange/css/images/section-terms.png'),
    'Types of Features' => array('see_all_link' => 'library', 'image' => '/sites/all/themes/gv_orange/css/images/section-features.png'),
    'SIP' => array('see_all_link' => 'library', 'image' => '/sites/all/themes/gv_orange/css/images/section-sip.png'),
    'Compare Services' => array('see_all_link' => 'library', 'image' => '/sites/all/themes/gv_orange/css/images/section-services.png'),
  );
  
  $out = '<div class="row">';
  $odd = TRUE;
  $count = 0;
  foreach ($sections as $section => $data) {
    
    //$articles = '<div class="articles">' . gv_misc_get_sectionArticles($section, 5) . '</div>';
    $articles = gv_misc_get_sectionArticles($section, 5);
    
    $count++;
    $odd = $odd ? FALSE : TRUE;
    if ($count == 4 || $count == 7 || $count == 10) {
      $out .= '</div><div class="row">';
    }
    $out .= '<div class="section ' . ($odd ? 'odd' : 'even') . (($count == 3 || $count == 6 || $count == 9) ? ' last-col' : ''). '"><table><tbody><tr><td><img src="' . @$data['image'] . '"></td></tr></tbody></table><div class="caption">' . $section . '</div>' . $articles . '<div class="more-link">' . l('', $data['see_all_link'], array('attributes' => array('class' => $section)) ) . '</div><div class="loading" style="display: none;"></div></div>';
  }
  $out .= '</div>';
  
  return $out;
}


/**
 * Returns Library articles list block.
 */
function gv_blocks_libraryList() {
 
  // Show only on the first page (not on further pagenated pages)
  if (!empty($_GET['page'])) {
    return NULL;
  }
  
  $query = db_select('node', 'n')
        ->fields('n', array('title', 'nid'));
  $query->condition('n.type', 'article');
  $query->condition('n.status', 1);
  $query->addTag('a4s');
  $query->addTag('articles');
  //$query->orderBy('n.created', 'DESC');
  $query->orderBy('n.title', 'ASC');

  $results = $query->execute()->fetchAllAssoc('nid');
  
  $out = '<div class="articles-list"><div class="col col-1">';
  $count = 0;
  $amount = count($results);
  $second = FALSE;
  foreach ($results as $nid => $article) {
    
    if (!$second && $count > ($amount - 1)/2) {
      $out .= '</div><div class="col col-2">';
      $second = TRUE;
    }
    
    $out .= '<div>' . l($article->title, 'node/' . $nid, array('attributes' => array('title' => $article->title))) . '</div>';
    $count++;
  }
  $out .= '</div></div>';
  
  return $out;
}


/**
 * Returns a preface Bottom Latest Articles block.
 */
function gv_blocks_prefaceBottomWithLatestArticles() {
  
  $latest_articles = NULL;
  $latest_reviews = NULL;
  
  $map_path_to_preface_type = array(
    '/business' => 'page-compare-business-voip-providers',
    '/residential' => 'page-compare-residential-voip-providers',
    '/sip-trunking' => 'page-compare-sip-voip-providers',
    '/fax' => 'page-compare-ifa-voip-providers',
    '/business-voip-features' => 'business-voip-features',
    '/canada' => 'canada-voip',
    '/hosted-pbx' => 'page-compare-pbx-voip-providers',
  );
  
  $map_preface_type_to_service_type = array(
    'page-compare-business-voip-providers' => 'business',
    'page-compare-residential-voip-providers' => 'residential',
    'page-compare-sip-voip-providers' => 'sip',
    'page-compare-ifa-voip-providers' => 'ifa',
    'canada-voip' => 'ca',
    'page-compare-pbx-voip-providers' => 'pbx',
    //'page-compare-smbv-voip-providers' => NULL,
  );
  
  $map_path_to_type = array(
    '/business' => 'Business VoIP',  
    '/residential' => 'Residential VoIP',
    '/business-voip-features' => 'Business VoIP Features',
    '/sip-trunking' => 'SIP Trunking Providers',
    '/canada' => 'Canada VoIP',
    '/fax' => 'Internet Fax',
   '/hosted-pbx' => 'Hosted PBX Providers',
    '/small-business-voip' => 'Small Business VoIP',
  );
 
  
  $pin_article_to = array(
    'Business VoIP' => 1,
    'Residential VoIP' => 2, 
    'Business VoIP Features' => 3,
    'SIP Trunking Providers' => 4,
    'Canada VoIP' => 5,
    'Internet Fax' => 6,
    'Hosted PBX Providers' => 7,
    //'Small Business VoIP' => 8,
  );
  
  if (!$page_index = @$pin_article_to[@$map_path_to_type[@$_SERVER['REDIRECT_URL']]]) {
    return NULL;
  }
  
  
  global $language;
  global $user;
  $logged_in = $user->uid ? '_logged' : '';
  $cache_name = 'gv_top_' . $map_preface_type_to_service_type[$map_path_to_preface_type[$_SERVER['REDIRECT_URL']]] . '_bottom_content_' . $language->language . $logged_in;
  
  $cache_content = cache_get($cache_name);
  if ($cache_content && !empty($cache_content->data) && $cache_content->expire > time()) {
    return $cache_content->data;
  }
  
  $map_path_to_articles_limit = array(
    '/business' => 2,
    '/residential' => 2,
    '/sip-trunking' => 4,
    '/fax' => NULL,
    '/business-voip-features' => 4,
    '/canada' => 2,
    '/hosted-pbx' => 2,
    '/small-business-voip' => 5,
  );
  
  
  $map_path_to_title = array(
    '/business' => 'Business VoIP',
    '/residential' => 'Residential VoIP',
    '/business-voip-features' => 'Business VoIP Features',
    '/sip-trunking' => 'SIP Trunking',
    '/canada' => 'Canada VoIP',
    '/fax' => 'Internet Fax',
    '/hosted-pbx' => 'Hosted PBX',
    '/small-business-voip' => 'Small Business VoIP',
  );
 
  $map_preface_type_to_latest_reviews = array(
    'page-compare-business-voip-providers' => 4,
    'page-compare-residential-voip-providers' => 4,
    'page-compare-sip-voip-providers' => NULL,
    'page-compare-ifa-voip-providers' => NULL,
    'business-voip-features' => NULL,
    'canada-voip' => NULL,
    'page-compare-pbx-voip-providers' => 4,
    //'page-compare-smbv-voip-providers' => NULL,
  );
  
  // Find latest posts.
  $query = db_select('field_data_field_pin_article_to', 'a')
        ->fields('a', array('entity_id'));
  $query->leftJoin('node', 'n', 'n.nid = a.entity_id');
  $query->fields('n', array('created'));
  $query->condition('a.field_pin_article_to_value', $page_index);
  $query->condition('n.status', 1);
  $query->addTag('a4s');
  $query->addTag('articles');
  $query->orderBy('n.created', 'DESC');
  if ($map_path_to_articles_limit[$_SERVER['REDIRECT_URL']]) {
    $query->range(0, $map_path_to_articles_limit[$_SERVER['REDIRECT_URL']]);
  }
  
  $results = $query->execute()->fetchAll();
  
  if (!empty($results)) {
    
    $count = count($results) - 1;
    foreach ($results as $key => $result) {
      $node = node_load($result->entity_id);
      $latest_articles .= '<div class="views-row' . ($key == $count ? ' last' : '') . '">' . render(node_view($node, 'side_block_teaser')) . '</div>';
    }
    if ($GLOBALS['theme'] == 'gv_blue') {
      //if ($user->uid) {
      $latest_articles = '<div class="view-articles block"><h3 class="block-title"><span class="block-icon">Latest Posts</span></h3><div class="view-content content">' . $latest_articles . '<div class="more-link"><a href="/articles" rel="nofollow">View All</a></div></div></div>';
    }
    else {
      $latest_articles = '<div class="view-articles"><a href="/articles" class="more-link">View All</a><h3 class="block-title">Latest Posts</h3><div class="view-content">' . $latest_articles . '</div></div>';
    }
  }
  
  
  
  
  
  // Find latest reviews
  if ($map_preface_type_to_latest_reviews[$map_path_to_preface_type[$_SERVER['REDIRECT_URL']]]) {
    
    $query = db_select('node', 'n')
            ->fields('n', array('nid', 'created'));
    $query->leftJoin('field_data_field_ref_provider', 'p', 'p.entity_id = n.nid');
    
    $query->join('field_data_field_p_types', 'pt', "pt.entity_id = p.field_ref_provider_target_id AND pt.field_p_types_value LIKE '%%" . $map_preface_type_to_service_type[$map_path_to_preface_type[$_SERVER['REDIRECT_URL']]] . "%%'");
    
    $query->condition('n.status', 1);
    $query->addTag('a4s');
    $query->addTag('reviews');
    $query->condition('n.type', 'review');
    $query->orderBy('n.created', 'DESC');
    $query->range(0, $map_preface_type_to_latest_reviews[$map_path_to_preface_type[$_SERVER['REDIRECT_URL']]]);

    $results = $query->execute()->fetchAll();
    
    if (!empty($results)) {

      $count = count($results) - 1;
      foreach ($results as $key => $result) {
        $node = node_load($result->nid);
          $latest_reviews .= '<div class="views-row' . ($key == $count ? ' last' : '') . '">' . render(node_view($node, 'teaser_onPrefaceBottomLatest')) . '</div>';
      }
      if ($GLOBALS['theme'] == 'gv_blue') {
      //if ($user->uid) {
        $latest_reviews = '<div id="compare-providers-reviews" class="block"><h3 class="block-title"><span class="block-icon">Latest Reviews</span></h3><div class="view-content content">' . $latest_reviews . '<div class="more-link"><a href="/reviews/business" rel="nofollow">View All</a></div></div></div>';
      }
      else {
        $latest_reviews = '<div id="compare-providers-reviews"><a href="/reviews/business" class="more-link">View All</a><h3 class="block-title">Latest Reviews</h3><div class="view-content">' . $latest_reviews . '</div></div>';
      }
    }

  }
  
  $right_col = ($latest_articles || $latest_reviews) ? '<div class="block-views' . ($GLOBALS['theme'] == 'gv_blue' ? ' sidebar' : '') . '">' . $latest_reviews . $latest_articles . '</div>' : NULL;

  $content = '<div id="bottom-with-latest-articles" class="preface' . (($latest_articles || $latest_reviews) ? ' with-articles' : '') . '">'
            . $right_col
            . '<div class="field-name-field-preface-bottom">' . gv_misc_getPrefaceBottomSection($map_path_to_preface_type[$_SERVER['REDIRECT_URL']]) . '</div>'
            . '<div class="bottom-clear"></div>'
          . '</div>';
 
  cache_set($cache_name, $content, 'cache', time() + 14400);
  
  return $content;
}


/**
 * Copy of Latest reviews part of the function gv_blocks_prefaceBottomWithLatestArticles() (from preface Bottom Latest Articles block.)
 */
function gv_blocks_getLatestReviews_byPathAndPrefaceAsServiceType() {
  
  $latest_articles = NULL;
  $latest_reviews = NULL;
  
  $map_path_to_preface_type = array(
    '/business' => 'page-compare-business-voip-providers',
    '/ppc/business-voip' => 'page-compare-business-voip-providers-v2',
    '/residential' => 'page-compare-residential-voip-providers',
    '/sip-trunking' => 'page-compare-sip-voip-providers',
    '/fax' => 'page-compare-ifa-voip-providers',
    '/business-voip-features' => 'business-voip-features',
    '/canada' => 'canada-voip',
    '/hosted-pbx' => 'page-compare-pbx-voip-providers',
    '/web-conferencing' => 'web-conferencing-voip-providers',
    '/crm-software' => 'crm-voip-providers',
    '/cloud-backup' => 'cloud-backup',
    '/cloud-contact-center' => 'page-compare-cc-voip-providers',
  );
  
  $map_preface_type_to_service_type = array(
    'page-compare-business-voip-providers' => 'business',
    'page-compare-business-voip-providers-v2' => 'business',
    'page-compare-residential-voip-providers' => 'residential',
    'page-compare-sip-voip-providers' => 'sip',
    'page-compare-ifa-voip-providers' => 'ifa',
    'canada-voip' => 'ca',
    'page-compare-pbx-voip-providers' => 'pbx',
    //'page-compare-smbv-voip-providers' => NULL,
    'web-conferencing-voip-providers' => 'wc',
    'crm-voip-providers' => 'crm',
    'cloud-backup' => 'cb',
    'page-compare-cc-voip-providers' => 'cc',
  );
  
  $map_path_to_type = array(
    '/business' => 'Business VoIP',
    '/ppc/business-voip' => 'Business VoIP',
    '/residential' => 'Residential VoIP',
    '/business-voip-features' => 'Business VoIP Features',
    '/sip-trunking' => 'SIP Trunking Providers',
    '/canada' => 'Canada VoIP',
    '/fax' => 'Internet Fax',
    '/hosted-pbx' => 'Hosted PBX Providers',
    '/small-business-voip' => 'Small Business VoIP',
    '/web-conferencing' => 'Video Web Conferencing Solutions',
    '/crm-software' => 'CRM Solutions',
    '/cloud-backup' => 'Cloud Backup Providers',
    '/cloud-contact-center' => 'Call Center Software',
  );
 
  $service_type_name_origin = $map_preface_type_to_service_type[$map_path_to_preface_type[$_SERVER['REDIRECT_URL']]];
  
  global $language;
  global $user;
  $logged_in = $user->uid ? '_logged' : '';
  $cache_name = 'gv_latest_reviews_for_' . $service_type_name_origin . $language->language . $logged_in;
  
  $cache_content = cache_get($cache_name);
  if ($cache_content && !empty($cache_content->data) && $cache_content->expire > time()) {
    return $cache_content->data;
  }
  
  $map_path_to_title = array(
    '/business' => 'Business VoIP',
    '/residential' => 'Residential VoIP',
    '/business-voip-features' => 'Business VoIP Features',
    '/sip-trunking' => 'SIP Trunking',
    '/canada' => 'Canada VoIP',
    '/fax' => 'Internet Fax',
    '/hosted-pbx' => 'Hosted PBX',
    '/small-business-voip' => 'Small Business VoIP',
    '/web-conferencing' => 'Video Web Conferencing Solutions',
    '/crm-software' => 'CRM Solutions',
    '/cloud-backup' => 'Cloud Backup',
    '/cloud-contact-center' => 'Call Center Software',
  );
 
  
  
  $map_preface_type_to_latest_reviews = array(
    'page-compare-business-voip-providers' => 3,
    'page-compare-business-voip-providers-v2' => 4,
    'page-compare-residential-voip-providers' => NULL, //4,
    'page-compare-sip-voip-providers' => 4,
    'page-compare-ifa-voip-providers' => 4,
    'business-voip-features' => NULL,
    'canada-voip' => 3,
    'page-compare-pbx-voip-providers' => 4,
    //'page-compare-smbv-voip-providers' => NULL,
    'web-conferencing-voip-providers' => 2,
    'crm-voip-providers' => 2,
    'cloud-backup' => 3,
    'page-compare-cc-voip-providers' => 3,
  );
  
  
  
  // Find latest reviews
  if ($map_preface_type_to_latest_reviews[$map_path_to_preface_type[$_SERVER['REDIRECT_URL']]]) {
    
    $query = db_select('node', 'n')
            ->fields('n', array('nid', 'created'));
    $query->leftJoin('field_data_field_ref_provider', 'p', 'p.entity_id = n.nid');
    
    $query->join('field_data_field_p_types', 'pt', "pt.entity_id = p.field_ref_provider_target_id AND pt.field_p_types_value LIKE '%%" . $service_type_name_origin . "%%'");
    
    $query->condition('n.status', 1);
    $query->addTag('a4s');
    $query->addTag('reviews');
    $query->condition('n.type', 'review');
    $query->orderBy('n.created', 'DESC');
    // Show only specific number of  latest reviews
    $query->range(0, $map_preface_type_to_latest_reviews[$map_path_to_preface_type[$_SERVER['REDIRECT_URL']]]);

    $results = $query->execute()->fetchAll();

    //dpm($results);
    
    if (!empty($results)) {
      $sprite_name = 'top_' . str_replace(array('business', 'residential'), array('bu', 're'), $service_type_name_origin) . '_providers';
      $count = count($results) - 1;
      foreach ($results as $key => $result) {
        $node = node_load($result->nid);
        $node->sprite_name = $sprite_name;
        $servicePage_bottomMainReviewTeaser = node_view($node, 'servicePage_bottomMainReviewTeaser');
        $latest_reviews .= '<div class="views-row' . ($key == $count ? ' last' : '') . '">' . render($servicePage_bottomMainReviewTeaser) . '</div>';
      }

      //$latest_reviews = '<div id="compare-providers-reviews" class="block"><h3 class="block-title"><span class="block-icon">Latest Reviews</span></h3><div class="view-content content">' . $latest_reviews . '<div class="more-link"><a href="/reviews/business" rel="nofollow">View All</a></div></div></div>';
      ////$latest_reviews = $latest_reviews . '<div class="more-link"><a href="/reviews" rel="nofollow">View All</a></div>';
    }

  }
  
 
  cache_set($cache_name, $latest_reviews, 'cache', time() + 14400);
  
  return $latest_reviews;
}


/**
 * Returns a Blog page latest news block.
 */
function gv_blocks_blogPageLatestNews() {
  
  $content = NULL;
  
  global $language;
  $cache_name = 'gv_blogPageLatestNews_' .$language->language;
  $cache_content = cache_get($cache_name);
  if ($cache_content && !empty($cache_content->data) && $cache_content->expire > time()) {
    return $cache_content->data;
  }
  
  $query = db_select('node', 'n')  
        ->fields('n', array('nid', 'created'));
  $query->leftJoin('field_data_field_extra_data', 'e', 'e.entity_id = n.nid');
  $query->fields('e', array('field_extra_data_value'));
  $query->condition('n.type', 'news_post');
  $query->condition('n.status', 1);
  $query->addTag('a4s');
  $query->addTag('articles');
  $query->orderBy('n.created', 'DESC')
        ->range(0, 6);

  $results = $query->execute()->fetchAll();

  if (!empty($results)) {

    $count = count($results) - 1;
    foreach ($results as $key => $result) {
      $extra_data = unserialize($result->field_extra_data_value);

      $content .= '<div class="views-row' . ($key == $count ? ' last' : '') . '">

                  <div class="views-field views-field-created date-icon">
                    <span class="field-content">
                        <span>
                          <span class="day">' . date('d\<\/\s\p\a\n\>\<\s\p\a\n\>M\<\/\s\p\a\n\>', $result->created) . '
                        </span>
                    </span>
                  </div>

                  <div class="views-field views-field-title">
                    <span class="field-content">' .
                      l($extra_data['title'], 'node/' . $result->nid) .
                    '</span>
                  </div>

                  <div class="views-field teaser">
                    <span class="field-content">' .
                      $extra_data['teaser_block'] .
                    '</span>
                  </div>

                  <div class="bottom-clear"></div>

                </div>';

            ;
    }

    $content = '<div class="view-content block-teasers">' . $content . '</div>';

    cache_set($cache_name, $content, 'cache', time() + 14400);
  }

  return $content;
}


/**
 * Returns a Current page provider articles block.
 */
function gv_blocks_currentPageProviderArticles() {
  
  $content = NULL;
  $title = NULL;
  
  $args = arg();
  if ($args[0] != 'node') {
    return array('title' => $title, 'content' => $content);
  }
    
  
  
  global $language;
  $cache_name = 'gv_providersArticles_' . $args[1] . '_' .$language->language;
  $cache_content = cache_get($cache_name);
  if ($cache_content && !empty($cache_content->data) && $cache_content->expire > time()) {
    return $cache_content->data;
  }
  
  $query = db_select('field_data_field_providers_mentioned', 'p')  
        ->fields('p', array('entity_id'));
  $query->leftJoin('node', 'n', 'n.nid = p.entity_id');
  $query->leftJoin('field_revision_field_p_name"', 'pn', 'pn.entity_id = p.field_providers_mentioned_target_id');

  $query->leftJoin('field_data_field_extra_data', 'e', 'e.entity_id = p.entity_id');
  $query->fields('n', array('created'));
  $query->fields('pn', array('field_p_name_value'));
  $query->fields('e', array('field_extra_data_value'));
  
  $query->condition('n.status', 1);
  
  $query->condition('p.field_providers_mentioned_target_id', $args[1]);
  $query->orderBy('n.created', 'DESC')
        ->range(0, 5);//->limit(10);
  //$provider_articles_teasers = $query->execute()->fetchAllAssoc('p.entity_id');
  $results = $query->execute()->fetchAll();

  if (!empty($results)) {
    //dpm($results);
    $count = count($results) - 1;
    $title = $results[0]->field_p_name_value . ' articles';
    foreach ($results as $key => $result) {
      $extra_data = unserialize($result->field_extra_data_value);
      $content .= '<div class="views-row' . ($key == $count ? ' last' : '') . '">

                  <div class="views-field views-field-created date-icon">
                    <span class="field-content">
                        <span>
                          <span class="day">' . date('d\<\/\s\p\a\n\>\<\s\p\a\n\>M\<\/\s\p\a\n\>', $result->created) . '
                        </span>
                    </span>
                  </div>

                  <div class="views-field views-field-title">
                    <span class="field-content">' .
                      l($extra_data['title'], 'node/' . $result->entity_id) .
                    '</span>
                  </div>

                  <div class="views-field teaser">
                    <span class="field-content">' .
                      $extra_data['teaser_block'] .
                    '</span>
                  </div>

                  <div class="bottom-clear"></div>

                </div>';

            ;

    }

    $content = '<div class="view-content block-teasers">' . $content . '</div>';
  }
  
  $out = array('title' => $title, 'content' => $content);
  cache_set($cache_name, $out, 'cache', time() + 14400);
  
  return $out;
}


/**
 * Returns a weekly Video block.
 */
function gv_blocks_weeklyVideoBlock() {
  
  $youtube_video_id = variable_get('gv_weekly_video_block', NULL);
  $out = '<iframe width="238" height="160" src="http://www.youtube.com/embed/' . $youtube_video_id . '?rel=0&wmode=opaque" frameborder="0" allowfullscreen></iframe>';
  
  //$out = '<object width="238" height="160"><param name="movie" value="http://www.youtube.com/v/' . $youtube_video_id . '?version=3&amp;hl=en_US&amp;rel=0"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><embed src="http://www.youtube.com/v/' . $youtube_video_id . '?version=3&amp;hl=en_US&amp;rel=0" type="application/x-shockwave-flash" width="238" height="160" allowscriptaccess="always" allowfullscreen="true"></embed></object>';
  
  return $out;
}


/**
 * Returns an ad block by its name.
 */
function gv_blocks_getBlockFromVariable($var_name) {
  switch ($var_name) {
    
    case 'gv_ourteam_header_data':
      return '<a href="/speed-test-tool"><div title="VoIP Speed Test Tool" ></div></a>';
      
      
      
    case 'gv_shopperapproved_badge_data':
      return '<a href="http://www.shopperapproved.com/reviews/getvoip.com/" onclick="var nonwin=navigator.appName!=' . " 'Microsoft Internet Explorer'?'yes':'no'; var certheight=screen.availHeight-90; window.open(this.href,'shopperapproved','location='+nonwin+',scrollbars=yes,width=620,height='+certheight+',menubar=no,toolbar=no'); return false;" . ' "><img src="https://c683207.ssl.cf2.rackcdn.com/12265-r.gif" style="border: 0" alt="" oncontextmenu="var d = new Date(); alert(' . "'Copying Prohibited by Law - This image and all included logos are copyrighted by Shopper Approved \251 '+d.getFullYear()+'.'); return false;" . '" /></a>';
  }
}


/**
 * Returns an ad block by its name.
 */
function gv_blocks_getAdBlock($ad_name) {
  switch ($ad_name) {
    
    case 'speedtest_page':
      //return '<a href="/voip-speed-test"><div title="VoIP Speed Test Tool" ></div></a>';
      return '<a href="/speed-test-tool"><div title="VoIP Speed Test Tool" ></div></a>';
      ////'<img alt="VoIP Speed Test Tool" title="VoIP Speed Test Tool" src="/sites/default/files/speedtestbanner.png" />'
    case 'free_ipad_mini':
      
      $path_to_custom_js = 'sites/all/libraries/jquery.plugins/countdown/';
      drupal_add_js($path_to_custom_js . 'kkcountdown.min.js');
      $path_to_custom_js = drupal_get_path('module', 'gv_misc') . '/js/';
      drupal_add_js($path_to_custom_js . 'gv_countdown.js');
  
      return '<a href="/blog/2012/11/19/getvoipcom-holiday-sweepstakes-win-a-free-ipad-mini"><img src="/sites/default/files/a/free-ipad-mini-banner.jpg" /></a>
              <span time="' . strtotime('2012-12-18, 23:59:59') . '" class="kkcount-down" id="ipad_mini"></span>';
  }
}


/**
 * Returns a snippet providing a data for all reviews aggregator data for Google search.
 */
function gv_blocks_getGoogleAllReviewsSnippet() {
  
  $allReviewsAmount = variable_get('gv_allReviewsAmount');
  $out = '<div class="content page preface" xmlns:v="http://rdf.data-vocabulary.org/#" typeof="v:Review-aggregate">
          <div id="all-reviews-snippet">Total of <span id="count" property="v:count">' . $allReviewsAmount . '</span> Reviews for all <span id="itemreviewed" property="v:itemreviewed">VoIP Providers</span><span class="rating-descr" style="display: none;">, with top rating of <span id="rating" property="v:rating">5</span></span>
          </div>';
  return $out;
}


/**
 * Returns a two themed blocks with Top pick providers for the All Reviews page
 */
function gv_blocks_getTopPickProvidersBlocksForAllReviewsPage() {


  global $language;
  $cache_name = 'gv_topPickProvidersBlocksForAllReviews_' . $language->language;
 
  $cache_content = cache_get($cache_name);
  if ($cache_content && !empty($cache_content->data) && $cache_content->expire > time()) {
    // Uncomment if chart(s) will have compare check boxes and should have compare functionality.
    //$module_path_pages = drupal_get_path('module', 'gv_misc');
    //drupal_add_js( $module_path_pages . '/js/gv_compareProviders.js'); 
    return $cache_content->data;
  }
  
  //dpm('no cache');
  
  // Business providers reviews.
  $block_data = array('module' => 'views', 'delta' => 'providers-block_top_bu_ar_cmp', 'shadow' => FALSE/*, 'subject' => 'Top Business VoIP Providers Reviews'*/);
  $out = gv_blocks_getBlockThemed($block_data);
    
  // Get block for Top pick residential providers.
  $block_data = array('module' => 'views', 'delta' => 'providers-block_top_re_ar', 'shadow' => FALSE/*, 'subject' => 'Top Residential VoIP Providers Reviews'*/); 
  $out .= gv_blocks_getBlockThemed($block_data);
  
  
  cache_set($cache_name, $out, 'cache', time() + 14400);
  
  return $out;
}


/**
 * Returns a two themed blocks with Top pick providers for the Articles (news, blog, etc) directory page 
 */
function gv_pages_getTopProvidersBlocksForArticlesDirectory() {
  
  $out = '<div class="providers dir">';
  $block_data = array('module' => 'views', 'delta' => 'providers-block_pick_bu', 'shadow' => TRUE);
  $out .= gv_blocks_getBlockThemed($block_data);
  $block_data = array('module' => 'views', 'delta' => 'providers-block_pick_re', 'shadow' => TRUE);
  $out .= gv_blocks_getBlockThemed($block_data);
  $out .= '<div class="bottom-clear"></div>';
  $out .= '</div>';
  return $out;
}


/**
 * Returns a themed topics block for a specific content type.
 * 
 * Allows to use same topics for News, Articles, Blog posts, etc.
 */
function gv_blocks_get_topicsBlock($content_type) {
  
  global $language;
  $topics = NULL;
  $topics = cache_get($content_type . '_topics_block' . $language->language);
  if (!$topics || empty($topics->data) || $topics->expire < time()) {
    // Key = url_argument, used in building the url, 
    // for example,
    // topics/news for topics list for news 
    // OR blog/provider for show all blog posts tagged with 'provider' topic.
    $content_types = array('blog_post' => 'blog', 'news_post' => 'news', 'article' => 'articles');
    $url_argument = $content_types[$content_type];
    $topics = gv_misc_getTopics($content_type, $url_argument, 2);
    if(!$topics) {
      return NULL;
    }
    $topics = theme('gv_misc_submenuSimple', array('submenu' => array('below' => $topics), 'class' => 'topics'));
    $topics .= '<div class="more-link">' . l(t('More'), $url_argument . '/tags') . '</div>';
    // Expire = current time + 4 hours.
    cache_set($content_type . '_topics_block' . $language->language, $topics, 'cache', time() + 14400);
  }
  else {
    $topics = $topics->data;
  }
  return $topics; 
}


/**
 * Returns a themed News topics block. 
 * 
 * Allows to use same topics for News, Articles, Blog posts, etc.
 */
/*
function gv_blocks_get_newsTopics() {
  global $language;
  $topics = cache_get('news_topics_block' . $language->language);
  if (!$topics || empty($topics->data) || $topics->expire < time()) {
    $topics = gv_misc_getTopics('news_post', 'news', 2);
    $topics = theme('gv_misc_submenuSimple', array('submenu' => array('below' => $topics), 'class' => 'topics'));
    $topics .= '<div class="more-link">' . l(t('More'), 'news-topics'). '</div>';
    // Expire = current time + 4 hours.
    cache_set('news_topics_block' . $language->language, $topics, 'cache', time() + 14400);
  }
  else {
    $topics = $topics->data;
  }
  return $topics; 
}
*/


/**
 * Returns a themed Header links block.
 */
function gv_blocks_get_headerLinks() {
  
  $cid = 'gv_cached_headerLinks';
  $cache = cache_get($cid, 'cache');

  if ($cache && !empty($cache->data) && $cache->expire > time()) {
    $out = $cache->data;
  }
  else {
    $menu = menu_build_tree('menu-header-links');
    $out = theme('gv_misc_headerLinks', array('submenu' => array('below' => $menu)));
    
    cache_set($cid, $out, 'cache', strtotime('+31 day'));
  } 
  
//  $menu = menu_build_tree('menu-header-links');
//  $out = theme('gv_misc_headerLinks', array('submenu' => array('below' => $menu)));
  return $out;
}


/**
 * Returns a themed Plain Footer menu.
 */
function gv_blocks_get_footerMenuPlain($version = 1) {
  
  $cid = 'gv_footer_menu_pl' . '_v' . $version;
  $cache = cache_get($cid, 'cache');

  if ($cache && !empty($cache->data) && $cache->expire > time()) {
    $out = $cache->data;
  }
  else {
    $menu = menu_build_tree('menu-footer-menu');
    if ($version == 2) {
      // Hide Our Team menu item on the /cloud-backup page
      unset($menu['49955 Our Team 933']);
      //dpm($menu);
    }
    
    $out = theme('gv_misc_footerLinksPlain', array('submenu' => array('below' => $menu), 'class' => 'menu', 'delimiter' => '<span> | </span>')); // . '<div class="c">В© 2012 GetVoIP.com | All Rights Reserved</div>';
    
    cache_set($cid, $out, 'cache', strtotime('+31 day'));
  } 
  
  //$menu = menu_build_tree('menu-footer-menu');
  //$out = theme('gv_misc_submenuSimple', array('submenu' => array('below' => $menu), 'class' => 'menu', 'delimiter' => '<li> | </li>')); // . '<div class="c">В© 2012 GetVoIP.com | All Rights Reserved</div>';
  
  return $out;
}


/**
 * Returns a themed Footer menu.
 */
function gv_blocks_get_footerMenu() {
  
  $cid = 'gv_footer_menu';
  $cache = cache_get($cid, 'cache');

  if ($cache && !empty($cache->data) && $cache->expire > time()) {
    $out = $cache->data;
  }
  else {
    $menu = menu_build_tree('menu-footer-menu');
    $out = theme('gv_misc_submenuSimple', array('submenu' => array('below' => $menu), 'class' => 'menu', 'delimiter' => '<li> | </li>')); // . '<div class="c">В© 2012 GetVoIP.com | All Rights Reserved</div>';
    
    cache_set($cid, $out, 'cache', strtotime('+31 day'));
  } 
  
  //$menu = menu_build_tree('menu-footer-menu');
  //$out = theme('gv_misc_submenuSimple', array('submenu' => array('below' => $menu), 'class' => 'menu', 'delimiter' => '<li> | </li>')); // . '<div class="c">В© 2012 GetVoIP.com | All Rights Reserved</div>';
  
  return $out;
}


/**
 * Dispatcher for getting themed block for MegaMenu by a block title.
 */
function gv_blocks_get_omMenuBlock_byTitle($title, $function) {

  // global $language;
  // $types = cache_get('types_' . $language->language);
  // Expire = current time + 2 hours.
  // cache_set('types_' . $language->language, $types, 'cache', time() + 7200);
  
  // Get main menu wireframe menu.
  $submenu = gv_blocks_getSubmenuByTitle('main-menu', $title);
  //return '<div class="om-btitle">' . $title . '</div>' . $function($submenu);
  return $function($submenu);
}


/**
 * Returns a themed News block content for MegaMenu.
 */
function gv_blocks_get_omMenuBlock_News($submenu) {
  $block_data = array('module' => 'gv_blocks', 'delta' => 'news_post_topics', 'subject_visible' => FALSE);
  $out = gv_blocks_getBlockThemed($block_data);
  return $out;  
  //return theme('gv_misc_submenuSimple', array('submenu' => $submenu, 'class' => 'block'));
}


/**
 * Returns a themed Library block content for MegaMenu.
 */
function gv_blocks_get_omMenuBlock_articles($submenu) {
  return theme('gv_misc_submenuSimple', array('submenu' => $submenu, 'class' => 'block'));
}


/**
 * Returns a themed VoIP Providers block content for MegaMenu.
 */
function gv_blocks_get_omMenuBlock_Providers($submenu) {
  return theme('gv_misc_submenuSimple', array('submenu' => $submenu, 'class' => 'block'));
}


/**
 * Returns a themed VoIP Blog block content for MegaMenu.
 */
function gv_blocks_get_omMenuBlock_Blog($submenu) {
  $block_data = array('module' => 'gv_blocks', 'delta' => 'blog_post_topics', 'subject_visible' => FALSE);
  $out = gv_blocks_getBlockThemed($block_data);
  return $out;  
  //return theme('gv_misc_submenuSimple', array('submenu' => $submenu, 'class' => 'block'));
}


/**
 * Returns a themed VoIP Blog block content for MegaMenu.
 */
function gv_blocks_get_omMenuBlock_AboutUs($submenu) {
  return theme('gv_misc_submenuSimple', array('submenu' => $submenu, 'class' => 'block'));
}


/**
 * Returns a themed All About VoIP block content for MegaMenu.
 */
function gv_blocks_get_omMenuBlock_voiplibrary($submenu) {
  $block_data = array('module' => 'gv_blocks', 'delta' => 'article_topics', 'subject_visible' => FALSE);
  $out = gv_blocks_getBlockThemed($block_data);
  return $out;   
  //return theme('gv_misc_submenuSimple', array('submenu' => $submenu, 'class' => 'block'));
}


/**
 * Returns a themed Editor block content for MegaMenu.
 */
function gv_blocks_get_omMenuBlock_Editor($submenu) {
  return theme('gv_misc_submenuSimple', array('submenu' => $submenu, 'class' => 'block'));
}


/**
 * Returns a themed custiom User block content (which contains several blocks and contents) for MegaMenu.
 */
function gv_blocks_get_omMenuBlock_User($submenu) {
  
  $out = NULL;
  // Build block for User login/logout.
  global $user;
  if($user->uid) {
    $out .= '<div class="title">' . t('You are logged in as ') . '<b>' . $user->name . '</b></div>';
    
    $block_data = array('module' => 'system', 'delta' => 'user-menu', 'subject_visible' => FALSE);
    $out .= gv_blocks_getBlockThemed($block_data);
  }
  else {
    $block_data = array('module' => 'user', 'delta' => 'login');
    $out .= gv_blocks_getBlockThemed($block_data);
  }
  return $out; 
}


/**
 * Returns a submenu from a menu.
 */
function gv_blocks_getSubmenuByTitle($menu_name, $submenu_title) {
  $menu = menu_build_tree($menu_name);

  if(!$menu) {
    return NULL;
  }
  foreach ($menu as $submenu) {
    if ($submenu['link']['link_title'] == $submenu_title) {
      return $submenu;
    }
  }
  return NULL;
}


/**
 * Wrap a block content in proper block's divs.
 */
function gv_blocks_wrapInBlockThemed($block_data, $block)
{
  if(!isset($block['content']) || !$block['content']) {
      return null;
  }

  if (is_array($block['content'])) {
    $block['content'] = drupal_render($block['content']);
  }
  if(isset($block_data['subjectTag']) && $block_data['subjectTag']) {
    $subjectTag = $block_data['subjectTag'];
  }
  else {
    $subjectTag = 'h2';
  }
  if(!empty($block_data['replaceUnderlinesWithDashesInID'])) {
    $block_data['module'] = str_replace('_', '-', $block_data['module']);
    $block_data['delta'] = str_replace('_', '-', $block_data['delta']);
  }
  if (!empty($block_data['shadow'])) {
    return 
      '<section id="block-' . $block_data['module'] . '-' . $block_data['delta'] . '" class="block gv block-' . $block_data['module'] . (isset($block_data['class']) ? ' ' . $block_data['class'] : '') . '">' 
        . '<div class="inside">'
            . ( ($block['subject'] && (!isset($block_data['subject_visible']) || $block_data['subject_visible']) )
                ? 
                '<div class="block-icon pngfix"></div><' . $subjectTag . ' class="block-title">' . $block['subject'] . '</' . $subjectTag . '>'
                :
                '') 
            . '<div class="content">' . $block['content'] . '</div>
          </div> <!-- /.inside -->
          <div class="shadow"></div>
      </section>';
  }
  else {
    return 
      '<section id="block-' . $block_data['module'] . '-' . $block_data['delta'] . '" class="block gv block-' . $block_data['module'] . (isset($block_data['class']) ? ' ' . $block_data['class'] : '') . '">' 
            /*
         . '<div class="contextual-links-wrapper">
              <a class="contextual-links-trigger" href="#">Configure</a>
              <ul class="contextual-links">
                <li class="block-configure first last">
                    <a href="/admin/structure/block/manage/gv_blocks/home_in_highlighted/configure?destination=home">Configure block</a>
                </li>
              </ul>
            </div>'   
            */
            
         . ( ($block['subject'] && (!isset($block_data['subject_visible']) || $block_data['subject_visible']) )
            ? 
            '<div class="block-icon pngfix"></div><' . $subjectTag . ' class="block-title">' . $block['subject'] . '</' . $subjectTag . '>'
            :
            '') 
         . '<div class="content">' . $block['content'] . '</div>
      </section>';
  }
}



function gv_blocks_contextual_links_view_alter(&$element, &$items) {
  // This hook is called for EVERY set of contextual links
  // on a page.  We first want to check the $element to make
  // sure we are adding a link to the correct list of contextual
  // links. In this case we only want to add a link to blocks
  // created by the "search" module. We just add links using the
  // same array structure as is used by theme_links.
  ////if (isset($element['#element']['#block']) && $element['#element']['#block']->delta == "site_tweets-site_tweets_block") {
  //if (isset($element['#element']['#block'])) 
    
//   {
//    $element['#links']['social-networks'] = array(
//      'title' => 'Edit social network links',
//      'href' => url('admin/config/system/site-information', array('absolute' => TRUE)),
//    );
//  }
}

/**
 * Returns themed block using standard drupal functions.
 * drupal get block programmatically
 */
function gv_blocks_render_block($module, $delta) {
//  $block = module_invoke($module, 'block_view', $delta);
//  $block['module'] = $module;
//  $block['delta'] = $delta;
//  $vars = array('elements' => array(
//      '#block' => (object) $block, 
//      '#children' => render($block['content']))
//      );
//  return theme('block', $vars);
  
  $block = block_load($module, $delta);      
  $block_array = _block_get_renderable_array(_block_render_blocks(array($block)));
  //dpm($block_array);
  $output = drupal_render($block_array);
  return $output; 
}


/**
 * Returns a content of a block wrapped in proper divs.
 */
function gv_blocks_getBlockThemed_noCache($block_data){
  
  // No caching version.
  
  $block = module_invoke($block_data['module'], 'block_view', $block_data['delta']);
  if ($block) {
    if (isset($block_data['subject'])) {
      $block['subject'] = $block_data['subject'];
    }
    elseif (@$block_data['no_subject']) {
      $block['subject'] = '';
    }
    return gv_blocks_wrapInBlockThemed($block_data, $block);
  }
  return NULL;
  
}


/**
 * Returns a content of a block wrapped in proper divs.
 */
function gv_blocks_getBlockThemed($block_data, $cache_on = FALSE, $cache_expire_str = FALSE, $suffix = NULL)
{

  
  
  // No caching version.
  
  if (!$cache_on) {
    return gv_blocks_getBlockThemed_noCache($block_data);
  }

  
  
  // Caching system version.
  
  $cid = 'gv-block-cache---' . $block_data['module'] . '-' . $block_data['delta'] . $suffix;
  $cache = cache_get($cid, 'cache');

  if ($cache && !empty($cache->data) && $cache->expire > time()) {
    $out = $cache->data;
  }
  else {

    if ($out = gv_blocks_getBlockThemed_noCache($block_data)) {
      if ($cache_expire_str) {
        cache_set($cid, $out, 'cache', strtotime($cache_expire_str));
      }
      else {
        cache_set($cid, $out, 'cache');
      }
      
    }

  } // End of else of if ($cache && !empty($cache->data) && $cache->expire > time()) {

  return $out;

  
  
  
  
  // No caching version.
  
//  $block = module_invoke($block_data['module'], 'block_view', $block_data['delta']);
//  if ($block) {
//    if (isset($block_data['subject'])) {
//      $block['subject'] = $block_data['subject'];
//    }
//    elseif (@$block_data['no_subject']) {
//      $block['subject'] = '';
//    }
//    return gv_blocks_wrapInBlockThemed($block_data, $block);
//  }
//  return NULL;
}


/**
 * Returns a content of a block Get access to the VoIP footprint... Banner.
 */
function gv_blocks_get_accessToFootprintBanner() {
  return '<div class="link">' . l(t('Learn more'), '<front>') . '</div>';
}


/**
 * Block Request a quote with a multistep form v1.
 */
function gv_blocks_get_requestQuote_block_v1() {
  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  

  //drupal_add_library('system', 'effects.bounce');
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  drupal_add_js($path_to_custom_js . 'gv_requestquote.js');
  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  //drupal_add_js($path_to_custom_js . 'bbq.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;

  $out = '
   <div id="requestQuoteFormWrapper">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        <form class="multipartForm bbq" method="post" action="/request" style="height: 272px; overflow: hidden;">

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="phones_amt_section"> 
                            <img src="/sites/all/themes/gv_orange/css/images/r-quote-woman.jpg" alt="Get Free VoIP Quotes" />
                            <div class="question">' . t('How many phones do you have?') . '</div>
                            
                            <input type="radio" name="phones_amt" value="1 - 2" /><div class="label_after">1 - 2</div>
                            <input type="radio" name="phones_amt" value="3 - 5" /><div class="label_after">3 - 5</div>
                            <input type="radio" name="phones_amt" value="6 - 10" /><div class="label_after">6 - 10</div>
                            <input type="radio" name="phones_amt" value="11 - 20" /><div class="label_after">11 - 20</div>
                            <input type="radio" name="phones_amt" value="21 - 50" /><div class="label_after">21 - 50</div>
                            <input type="radio" name="phones_amt" value="50+" /><div class="last_radio label_after">50+</div>
                            
                            <div class="step-notice">' . t('Step <span class="f">!first</span>of<span class="s">!second</span>', array('!first' => 1, '!second' => 5)) . '</div>
                    </div>
                    
                    <div class="step" id="q_for">
                        
                            <div class="question">' . t('You are looking for a quote for...') . '</div>
                            
                            <input type="radio" name="q_for" value="Home" /><div class="label_after">' . t('Home') .'</div>
                            <input type="radio" name="q_for" value="Home-based Business" /><div class="label_after">' . t('Home-based Business') . '</div>
                            <input type="radio" name="q_for" value="Business" /><div class="last_radio label_after">' . t('Business') . '</div>
                         
                            <div class="step-notice">' . t('Step <span class="f">!first</span>of<span class="s">!second</span>', array('!first' => 2, '!second' => 5)) . '</div>
                    </div>
                    

                    <div class="step" id="buying_time">
                        
                            <div class="question">' . t('What is your buying time frame?') . '</div>
                            
                            <input type="radio" name="buying_time" value="ASAP" /><div class="label_after">' . t('ASAP') . '</div>
                            <input type="radio" name="buying_time" value="Less Than 1 Month" /><div class="label_after">' . t('Less Than 1 Month') . '</div>
                            <input type="radio" name="buying_time" value="1 - 3 Months" /><div class="label_after">' . t('1 - 3 Months') . '</div>
                            <input type="radio" name="buying_time" value="3 - 6 Months" /><div class="label_after">' . t('3 - 6 Months') . '</div>
                            <input type="radio" name="buying_time" value="More Than 6 Months" /><div class="last_radio label_after">' . t('More Than 6 Months') . '</div>
                         
                            <div class="step-notice">' . t('Step <span class="f">!first</span>of<span class="s">!second</span>', array('!first' => 3, '!second' => 5)) . '</div>
                    </div>
                    

                    <div class="step" id="connection">
                        
                            <div class="question">' . t('What is your data connection?') . '</div>
                            
                            <input type="radio" name="connection" value="DSL" /><div class="label_after">' . t('DSL') . '</div>
                            <input type="radio" name="connection" value="Cable" /><div class="label_after">' . t('Cable') . '</div>
                            <input type="radio" name="connection" value="T1" /><div class="label_after">' . t('T1') . '</div>
                            <input type="radio" name="connection" value="Fiber" /><div class="label_after">' . t('Fiber') . '</div>
                            <input type="radio" name="connection" value="Other" /><div class="label_after">' . t('Other') . '</div>
                            <input type="radio" name="connection" value="Need New Connection" /><div class="last_radio label_after">' . t('Need New Connection') . '</div>
                              
                            <div class="step-notice">' . t('Step <span class="f">!first</span>of<span class="s">!second</span>', array('!first' => 4, '!second' => 5)) . '</div>
                    </div>
                    
                    
                    <div class="step" id="personal_info">
                        
                            <div class="question">' . t('Fill out the form below:') . '</div>
                            
                            <div class="label_before required">' . t('First Name') . '<span class="form-required">*</span></div>
                                <input class="after required name" name="firstname" id="firstname" />
                            <div class="label_before required">' . t('Last Name') . '<span class="form-required">*</span></div>
                                <input class="after required" name="lastname" id="lastname" />
                                
                            <div class="label_before required">' . t('Company') . '</div>
                                <input class="after" name="company" id="company" />
                                
                            <div class="label_before required">' . t('Email') . '<span class="form-required">*</span></div>
                                <input class="after email required" name="email" id="email" />
                                
                            <div class="label_before required">' . t('Phone') . '</div>
                                <input class="after required phone" name="phone_1" id="phone_1" value="" />
                                <input class="after required phone" name="phone_2" id="phone_2" value="" />
                                <input class="after required phone" name="phone_3" id="phone_3" value="" />
                                
                            <div class="label_before">' . t('Notes') . '</div>
                                <input class="after" name="notes" id="notes" />
                         
                           <div class="step-notice">' . t('Step <span class="f">!first</span>of<span class="s">!second</span>', array('!first' => 5, '!second' => 5)) . '</div>
                             
                    </div>
                    
                </div>
            
                <div id="Navigation"> 							
                        <input class="navigation_button" id="back" value="Back" type="reset" />
                        <input class="navigation_button" id="next" value="Next" type="submit" />
                </div>
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="block" />
                <input type="hidden" name="version" value="1" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}


/**
 * Block Request a quote with a multistep form v2.
 */
function gv_blocks_get_requestQuote_block_v2() {
  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  

  drupal_add_js('sites/all/libraries/jquery.plugins/jquery.hint-with-password.js');
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  drupal_add_js($path_to_custom_js . 'gv_requestquote_v2.js');
  
  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  
  
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;

  $out = '
   <div id="up">
      <h3>Compare Top VoIP Services Tailored to Your Needs</h3>
      <div class="explain p1"><div class="number">1</div><span class="text">Tell us about your VoIP needs below</span></div>
      <div class="explain p2"><div class="number">2</div><span class="text">Your request will be reviewed by our expert team of VoIP researchers</span></div>
      <div class="explain p3"><div class="number">3</div><span class="text">We will connect you with three providers that best suit your needs</span></div>
   </div>
   <div id="up-image"></div>
   <div class="bottom-clear"></div>   
   <div id="requestQuoteFormWrapper">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        <form class="multipartForm bbq" method="post" action="/request" style="height: 140px; overflow: hidden;">

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="questions_section">

                            <div class="wrapper top first">
                              <div class="question">' . t('Phones amount needed') . ':</div>
                              <select name="phones_amt" id="phones_amt" class="input required">
                                <option value="1 - 4">1 - 4</option>
                                <option value="5 - 10">5 - 10</option>
                                <option selected="selected" value="11 - 20">11 - 20</option>
                                <option value="21 - 50">21 - 50</option>
                                <option value="More than 50">More than 50</option>
                              </select>
                            </div>
           
                            <div class="wrapper top">
                              <div class="question">' . t('VoIP Service desired') . ':</div>
                              <select name="q_type" id="q_type" class="input required">
                                <option value="Both phones and service">' . t('Both phones and service') .'</option>
                                <option value="Phone system only">' . t('Phone system only') .'</option>
                                <option value="Service provider only">' . t('Service provider only') .'</option>
                              </select>
                            </div>
                            
                            <div class="wrapper top last">
                              <div class="question">' . t('Buying time frame') . ':</div>
                              <select name="buying_time" id="buying_time" class="input required">
                                <!--<option value="">- Select a value -</option>-->
                                <option value="ASAP">' . t('ASAP') .'</option>
                                <option value="1-3 Months">' . t('1-3 Months') .'</option>
                                <option value="3-6 Months">' . t('3-6 Months') .'</option>
                              </select>
                            </div>
                            
                            <div class="bottom-clear"></div>


                            <div class="wrapper first">
                              <div class="label_before required">' . t('First Name') . ':<span class="form-required">*</span></div>
                                <input class="after required firstname" name="firstname" id="firstname" />
                            </div>
                            
                            <div class="wrapper">
                              <div class="label_before required">' . t('Last Name') . ':<span class="form-required">*</span></div>
                                <input class="after required lastname" name="lastname" id="lastname" />
                            </div>
                            
                            <div class="wrapper last">
                              <div class="label_before required">' . t('Email') . ':<span class="form-required">*</span></div>
                                <input class="after email required" name="email" id="email" />
                            </div>
                         
                            <div class="wrapper phone first">
                              <div class="label_before required">' . t('Phone') . '<span class="form-required">*</span></div>
                              <div id="phone">
                                <input class="after required phone" name="phone_1" id="phone_1" value="" />
                                <input class="after required phone" name="phone_2" id="phone_2" value="" />
                                <input class="after required phone" name="phone_3" id="phone_3" value="" />
                               </div>
                            </div>
                            
                            <div class="wrapper company">
                              <div class="label_before">' . t('Company') . ':</div>
                                <input class="after" name="company" id="company" />
                            </div>

                            <div class="wrapper website last">
                              <div class="label_before">' . t('Website') . ':</div>
                                <input class="after" name="website" id="website" />
                            </div>
                            
                            <!--<div id="on_error"></div>-->

                            <!--<div class="step-notice">' . t('Step <span class="f">!first</span>of<span class="s">!second</span>', array('!first' => 1, '!second' => 2)) . '</div> -->
                                
                            <div class="protected"></div>
                    </div>

                    
                
                </div>
                
                
            
                <div id="Navigation"> 							
                        <input class="navigation_button" id="back" value="Back" type="reset" />
                        <input class="navigation_button" id="next" value="Submit & Get Quotes" type="submit" />
                </div>
                
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="block" />
                <input type="hidden" name="version" value="2" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}


/**
 * Block Request a quote with a multistep form v3.
 */
function gv_blocks_get_requestQuote_block_v3() {
  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  

  drupal_add_js('sites/all/libraries/jquery.plugins/jquery.hint-with-password.js');
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  drupal_add_js($path_to_custom_js . 'gv_requestquote_v2.js');
  
  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  
  
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;

  $out = '
  <h3>No-Risk Free VoIP Quote</h3>
  <h4>Don\'t trust your phone system with just anyone!</h4>
  <div id="requestQuoteFormWrapper">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        <form class="multipartForm bbq" method="post" action="/request" style="overflow: hidden;">

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="questions_section">

                            <div class="explain p1"><div class="number">1</div><div class="text">Tell us about your VoIP needs</div></div>
                            
                            <div class="wrapper top first">
                              <div class="question">' . t('Lines needed') . ':</div>
                              <select name="phones_amt" id="phones_amt" class="input required">
                                <option value="1 - 2">1 - 2</option>
                                <option value="3 - 5">3 - 5</option>
                                <option selected="selected" value="6 - 10">6 - 10</option>
                                <option value="11 - 20">11 - 20</option>
                                <option value="21 - 50">21 - 50</option>
                                <option value="50+">50+</option>
                              </select>
                            </div>
           
                            <div class="wrapper top">
                              <div class="question">' . t('Service Type') . ':</div>
                              <select name="q_type" id="q_type" class="input required">
                                <option selected="selected" value="Business">' . t('Business') .'</option>
                                <option value="Home">' . t('Home') .'</option>
                                <option value="Home-Based Business">' . t('Home-Based Business') .'</option>
                              </select>
                            </div>
                            
                            <div class="bottom-clear"></div>

                            <div class="explain p2"><div class="number">2</div><div class="text">Your request will be reviewed by our team of VoIP Experts</div></div>
                            <div class="explain p3"><div class="number">3</div><div class="text">РЎonnect with leading providers that best match your needs</div></div>
      
                            <div class="wrapper middle first">
                              <div class="label_before required">' . t('First Name') . ':<span class="form-required">*</span></div>
                                <input class="after required firstname" name="firstname" id="firstname" />
                            </div>
                            
                            <div class="wrapper middle">
                              <div class="label_before required">' . t('Last Name') . ':<span class="form-required">*</span></div>
                                <input class="after required lastname" name="lastname" id="lastname" />
                            </div>
                            
                            <div class="wrapper middle company">
                              <div class="label_before">' . t('Company') . ':</div>
                                <input class="after" name="company" id="company" />
                            </div>


                            <div class="wrapper middle last">
                              <div class="label_before required">' . t('Email') . ':<span class="form-required">*</span></div>
                                <input class="after email required" name="email" id="email" />
                            </div>
                         
                            <div class="wrapper middle phone">
                              <div class="label_before required">' . t('Phone') . '<span class="form-required">*</span></div>
                              <div id="phone">
                                <input class="after required phone" name="phone_1" id="phone_1" value="" />
                                <input class="after required phone" name="phone_2" id="phone_2" value="" />
                                <input class="after required phone" name="phone_3" id="phone_3" value="" />
                               </div>
                            </div>
                            
                            <!--<div id="on_error"></div>-->

                            <div class="protected"></div>
                    </div>

                    
                
                </div>
                
                
            
                <div id="Navigation"> 							
                        <input class="navigation_button" id="next" value="Submit" type="submit" />
                </div>
                
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="block" />
                <input type="hidden" name="version" value="3" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}


/**
 * Block Request a quote with a multistep form v4.
 */
function gv_blocks_get_requestQuote_block_v4() {
  
//  global $user;
//  if ($user->uid) {
//    return NULL;
//  }
  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  

  drupal_add_js('sites/all/libraries/jquery.plugins/jquery.hint-with-password.js');
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  drupal_add_js($path_to_custom_js . 'gv_requestquote_v4.js');
  
  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  
  
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;

  $out = '
  <h3>No-Risk Free VoIP Quote</h3>
  <h4>Don\'t trust your phone system with just anyone!</h4>
  <div id="requestQuoteFormWrapper">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        <form class="multipartForm bbq" method="post" action="/request" style="overflow: hidden;">

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="questions_section">

                            <div class="wrapper top first">
                              <div class="question">' . t('Lines needed') . ':</div>
                              <select name="phones_amt" id="phones_amt" class="input required">
                                <option value="1 - 4">1 - 4</option>
                                <option selected="selected" value="5 - 10">5 - 10</option>
                                <option value="11 - 20">11 - 20</option>
                                <option value="21 - 50">21 - 50</option>
                                <option value="More than 50">More than 50</option>
                              </select>
                            </div>
                            
           
                            <div class="wrapper top">
                              <div class="question">' . t('Service Type') . ':</div>
                              <select name="q_type" id="q_type" class="input required">
                                <option selected="selected" value="Business">' . t('Business') .'</option>
                                <option value="Home">' . t('Home') .'</option>
                                <option value="Home-Based Business">' . t('Home-Based Business') .'</option>
                              </select>
                            </div>
                            
                            <div class="bottom-clear"></div>

                            <div class="middle-wrapper">
                            
                              <div class="wrapper middle first">
                                  <input class="after required firstname" name="firstname" id="firstname" title="First Name *" />
                              </div>

                              <div class="wrapper middle">
                                  <input class="after required lastname" name="lastname" id="lastname" title="Last Name *" />
                              </div>

                              <div class="wrapper middle last">
                                  <input class="after email required" name="email" id="email" title="Email Address *" />
                              </div>

                              <div class="wrapper middle phone">
                                  <input class="after required phone" name="phone" id="phone" value="" title="Phone Number *" />
                              </div>

                              <div class="wrapper middle company">
                                  <input class="after" name="company" id="company" title="Company" />
                              </div>
                            
                              <div class="bottom-clear"></div>
                              
                            </div>
                            
                            <!--<div id="on_error"></div>-->

                            <div class="protected"></div>
                    </div>

                    
                
                </div>
                
                
            
                <div id="Navigation"> 							
                        <input class="navigation_button" id="next" value="Submit" type="submit" />
                </div>
                
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="block" />
                <input type="hidden" name="version" value="4" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}


/**
 * Block Request a quote with a multistep form v5.
 */
function gv_blocks_get_requestQuote_block_v5() {
  
//  global $user;
//  if ($user->uid != 1) {
//    return NULL;
//  }
  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  

  drupal_add_js('sites/all/libraries/jquery.plugins/jquery.hint-with-password.js');
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  drupal_add_js($path_to_custom_js . 'gv_requestquote_v5.js');
  
  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  
  // height: 140px; 
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;

  $out = '
   <div id="up">
      <div class="cap1">Save Big - Switch to a Business VoIP Phone System</div>
      <div class="cap2">Compare Low Rates From Leading VoIP Providers</div>
   </div>
   <div class="bottom-clear"></div>   
   <div id="requestQuoteFormWrapper">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        <form class="multipartForm bbq" method="post" action="/request" style="overflow: hidden;">

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="questions_section">
                            
                            <div class="left">
                               <img src="/sites/all/themes/gv_orange/css/images/q-phone-black.jpg" />
                            </div>
                            

                            <div class="middle-wrapper">

                                <div class="wrapper top first">
                                  <div class="question">' . /*t('How many phone lines do you need?')*/t('Lines needed') . ':</div>
                                  <select name="phones_amt" id="phones_amt" class="input required">
                                    <option value="1 - 4">1 - 4</option>
                                    <option selected="selected" value="5 - 10">5 - 10</option>
                                    <option value="11 - 20">11 - 20</option>
                                    <option value="21 - 50">21 - 50</option>
                                    <option value="More than 50">More than 50</option>
                                  </select>
                                </div>

                                <div class="wrapper top">
                                  <div class="question">' . /*t('What is your current phone needs?')*/t('Service Type') . ':</div>
                                  <select name="q_type" id="q_type" class="input required">
                                    <option selected="selected" value="Business">' . t('Business') .'</option>
                                    <option value="Home">' . t('Home') .'</option>
                                    <option value="Home-Based Business">' . t('Home-Based Business') .'</option>
                                  </select>
                                </div>


                                <div class="wrapper top last">
                                  <div class="question">' . /*t('What is your buying time frame?')*/ t('Buying time frame') . ':</div>
                                  <select name="buying_time" id="buying_time" class="input required">
                                    <!--<option value="">- Select a value -</option>-->
                                    <option value="ASAP">' . t('ASAP') .'</option>
                                    <option value="1-3 Months">' . t('1-3 Months') .'</option>
                                    <option value="3-6 Months">' . t('3-6 Months') .'</option>
                                  </select>
                                </div>
                            
                            </div>
                           


                            <div class="right">
                              <img src="/sites/all/themes/gv_orange/css/images/qrequest-book.jpg" /> 
                              <div class="str2">With quote request</div>
                            </div>
                            

                            <div class="bottom-clear"></div>
                            
                              
                            <!--<div id="on_error"></div>-->

                            <!--<div class="step-notice">' . t('Step <span class="f">!first</span>of<span class="s">!second</span>', array('!first' => 1, '!second' => 2)) . '</div> -->
                                
                            <div class="bottom-info">Personalized Quotes Tailored to your needs</div>
                            <div class="progress"><img src="/sites/all/themes/gv_orange/css/images/progress-bar-50.jpg" /></div>
                    </div>



                    


                    <div class="step" id="personal_data">
                    
                            <div class="left">
                               <img src="/sites/all/themes/gv_orange/css/images/qrequest-girl.jpg" />
                            </div>

                            <div class="middle-wrapper">
                            
                                <div class="wrapper middle first">
                                    <input class="after required firstname" name="firstname" id="firstname" title="First Name *" />
                                </div>

                                <div class="wrapper middle">
                                    <input class="after required lastname" name="lastname" id="lastname" title="Last Name *" />
                                </div>

                                <div class="wrapper middle last">
                                    <input class="after email required" name="email" id="email" title="Email Address *" />
                                </div>

                                <div class="wrapper middle phone">
                                    <input class="after required phone" name="phone" id="phone" value="" title="Phone Number *" />
                                </div>

                                <div class="wrapper middle company">
                                    <input class="after" name="company" id="company" title="Company" />
                                </div>

                                <div class="bottom-clear"></div>
                              
                            </div>
                            
                            
                            <div class="right">
                               <img src="/sites/all/themes/gv_orange/css/images/qrequest-book.jpg" />
                               <div class="str2">With quote request</div>
                            </div>
                            <!--<div class="right">
                               <img src="/sites/all/themes/gv_orange/css/images/qrequest-guide.jpg" />
                               <div class="str1">Free VoIP Guide</div>
                               <div class="str2">With quote request</div>
                            </div>-->
                            
                            <!--<div id="on_error"></div>-->

                            <div class="protected"></div>
                            <div class="progress"><img src="/sites/all/themes/gv_orange/css/images/progress-bar-75.jpg" /></div>
                    </div>





                
                </div>
                
                
            
                <div id="Navigation"> 							
                        <input class="navigation_button" id="back" value="Back" type="reset" />
                        <input class="navigation_button" id="next" value="Submit & Get Quotes" type="submit" />
                </div>
                
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="block" />
                <input type="hidden" name="version" value="5" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}


/**
 * Block Request a quote with a multistep form v6.
 */
function gv_blocks_get_requestQuote_block_v6() {
  
//  global $user;
//  if ($user->uid) {
//    return NULL;
//  }
  
  //dpm($_SERVER);
  //dpm(arg());
  // Don't show the block if on the 404 page
  if ($_GET['q'] == 'node/988') {
    return NULL;
  }
  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  

  drupal_add_js('sites/all/libraries/jquery.plugins/jquery.hint-with-password.js');
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  drupal_add_js($path_to_custom_js . 'gv_requestquote_v5.js');
  
  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  
  // height: 140px; 
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;

  $out = '
   
   <div id="requestQuoteFormWrapper">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        ' /*. '<form class="multipartForm bbq" method="post" action="/request" style="overflow: hidden;">' .*/ . '<form class="multipartForm bbq" method="post" action="/request">' . '

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="questions_section">
                    
                                <div id="up">
                                    <div class="caption">Compare Leading Providers</div>
                                    <div class="text">Low Price Assurance</div>
                                    <div class="text">Personal Service Reps</div>
                                    <div class="text">Unlimited Calling & Faxing</div>
                                    <div class="img"></div>
                                </div>
                                <div class="bottom-clear"></div>   
                           
                                <div class="wrapper top first">
                                  <div class="question ui-widget">Lines needed:</div>
                                  <select name="phones_amt" id="phones_amt" class="input required ui-state-default ui-helper-reset">
                                    <!-- <option value="1 - 4">1 - 4</option> -->
                                    <option value="1">1</option>
                                    <option value="2 - 4">2 - 4</option>
                                    <option selected="selected" value="5 - 10">5 - 10</option>
                                    <option value="11 - 20">11 - 20</option>
                                    <option value="21 - 50">21 - 50</option>
                                    <option value="More than 50">More than 50</option>
                                  </select>
                                </div>

                                <div class="wrapper top">
                                  <div class="question ui-widget">Service Type:</div>
                                  <select name="q_type" id="q_type" class="input required ui-state-default ui-helper-reset">
                                    <option selected="selected" value="Business">Business</option>
                                    <option value="Home">Home</option>
                                    <option value="Home-Based Business">Home-Based Business</option>
                                  </select>
                                </div>


                                <div class="wrapper top last">
                                  <div class="question ui-widget">Buying time frame:</div>
                                  <select name="buying_time" id="buying_time" class="input required ui-state-default ui-helper-reset">
                                    <!--<option value="">- Select a value -</option>-->
                                    <option value="ASAP">ASAP</option>
                                    <option value="1-3 Months">1-3 Months</option>
                                    <option value="3-6 Months">3-6 Months</option>
                                  </select>
                                </div>
                          

                            <div class="bottom-clear"></div>
                            
                            <!--<img class="guide" src="/sites/all/themes/gv_orange/css/images/quote-phone2.jpg" /> -->
                            <div class="phone-pic"></div>
                            <div class="guide">Free VoIP Guide With Request</div>
                            

                            <div class="bottom-clear"></div>
                            
                              
                            <!--<div id="on_error"></div>-->

                            <div class="step-notice">' . t('Step <span class="f">!first</span>of<span class="s">!second</span>', array('!first' => 1, '!second' => 2)) . '</div>
                                

                    </div>



                    


                    <div class="step" id="personal_data">
                    
                                <div id="personal-title">Your Info:</div>
                            
                                <div class="wrapper middle first">
                                    <input class="after required firstname" name="firstname" id="firstname" title="First Name *" />
                                </div>

                                <div class="wrapper middle">
                                    <input class="after required lastname" name="lastname" id="lastname" title="Last Name *" />
                                </div>

                                <div class="wrapper middle last">
                                    <input class="after email required" name="email" id="email" title="Email Address *" />
                                </div>

                                <div class="wrapper middle phone">
                                    <input class="after required phone" name="phone" id="phone" value="" title="Phone Number *" />
                                </div>

                                <div class="wrapper middle company">
                                    <input class="after" name="company" id="company" title="Company" />
                                </div>
      
' 
      
    . 
          
          '<div class="gv-captcha">
    <img id="siimage" style="border: 1px solid #000; margin-right: 15px" src="/securimage_show?sid=' . md5(uniqid()) . '" alt="CAPTCHA Image" align="left" />
    <object id="play-btn" type="application/x-shockwave-flash" data="/sites/all/libraries/jquery.plugins/securimage/securimage_play.swf?bgcol=#ffffff&amp;icon_file=/sites/all/libraries/jquery.plugins/securimage/images/audio_icon.png&amp;audio_file=/sites/all/libraries/jquery.plugins/securimage/securimage_play.php" height="32" width="32">
    <param name="movie" value="/sites/all/libraries/jquery.plugins/securimage/securimage_play.swf?bgcol=#ffffff&amp;icon_file=/sites/all/libraries/jquery.plugins/securimage/images/audio_icon.png&amp;audio_file=/sites/all/libraries/jquery.plugins/securimage/securimage_play.php" />
    </object>

    <a id="reload-btn" tabindex="-1" style="border-style: none;" href="#" title="Refresh Image" onclick="document.getElementById(' . "'siimage'" . ').src = ' . "'/securimage_show?sid='" . ' + Math.random(); this.blur(); return false">
      ' . 
          //'<img src="/sites/all/libraries/jquery.plugins/securimage/images/refresh.png" alt="Reload Image" height="32" width="32" onclick="this.blur()" align="bottom" border="0" />' 
          '<div class="reload" alt="Reload Image" style="height: 15px; width: 15px;" onclick="this.blur()"></div>' 
      . '
    </a>
    <div id="code">Enter Code*:</div>' . /* @$_SESSION["ctform"]["captcha_error"] .*/ '
    <input type="text" class="required ct_captcha" id="ct_captcha" name="ct_captcha" size="12" maxlength="16" />
  </div>'
    
    . 
          ' 
      

                            <div class="bottom-clear"></div>
                            
                            <!-- <img class="guide" src="/sites/all/themes/gv_orange/css/images/quote-phone2.jpg" /> -->
                            <div class="phone-pic"></div>
                            <div class="guide">Free VoIP Guide With Request</div>
           
                            
                            <!--<div id="on_error"></div>-->

                            <div class="protected"></div>

                    </div>





                
                </div>
                
                
            
                <div id="Navigation"> 							
                        <input class="navigation_button ui-state-disabled" id="back" value="Back" type="reset" />
                        <input class="navigation_button" id="next" value="Get Quotes" type="submit" />
                </div>
                
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="block" />
                <input type="hidden" name="version" value="6" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}


/**
 * Block Request a quote with a multistep form v7 - 1 step.
 */
function gv_blocks_get_requestQuote_block_v7() {
  
  global $user;
  // don't show for registered users/
  if ($user->uid)  
    {
    return NULL;
  }
  
  // Don't show the block if on the 404 page
  if ($_GET['q'] == 'node/988') {
    return NULL;
  }
  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  

  drupal_add_js('sites/all/libraries/jquery.plugins/jquery.hint-with-password.js');
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  drupal_add_js($path_to_custom_js . 'gv_requestquote_v7.js');
  
  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  
  // height: 140px; 
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;

  
  
  
  $data = unserialize(variable_get('gv_request_quote_v7', NULL));
  
  
  $out = '
   
   <div id="requestQuoteFormWrapper">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        ' /*. '<form class="multipartForm bbq" method="post" action="/request" style="overflow: hidden;">' .*/ . '<form class="multipartForm bbq" method="post" action="/request">' . '

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="questions_section">
                    
                                <div id="up">
                                    <div class="text">' . $data['headline']['value'] . '</div>
                                    <div class="phone-pic"></div>
                                </div>
                                <div class="bottom-clear"></div>   
                           
                                <div class="wrapper top first">
                                  <div class="question ui-widget">Service Type:</div>
                                  <select name="q_type" id="q_type" class="input required ui-state-default ui-helper-reset">
                                    <option selected="selected" value="Business">Business</option>
                                    <option value="Home-Based Business">Home-Based Business</option>
                                  </select>
                                </div>

                                <div class="wrapper top last">
                                  <div class="question ui-widget">Lines Needed:</div>
                                  <select name="phones_amt" id="phones_amt" class="input required ui-state-default ui-helper-reset">
                                    <!-- <option value="1 - 4">1 - 4</option> -->
                                    <option value="2 - 4">2 - 4</option>
                                    <option selected="selected" value="5 - 10">5 - 10</option>
                                    <option value="11 - 20">11 - 20</option>
                                    <option value="21 - 50">21 - 50</option>
                                    <option value="More than 50">More than 50</option>
                                  </select>
                                </div>

                            <div class="bottom-clear"></div>
                            
                            <!--<img class="guide" src="/sites/all/themes/gv_orange/css/images/quote-phone2.jpg" /> -->


                            <div class="bottom-clear"></div>
                            
                                <div class="wrapper middle first left">
                                    <input class="after required firstname" name="firstname" id="firstname" title="First Name" />
                                </div>

                                <div class="wrapper middle right">
                                    <input class="after required lastname" name="lastname" id="lastname" title="Last Name" />
                                </div>

                                <div class="wrapper middle left">
                                    <input class="after email required" name="email" id="email" title="Email Address" />
                                </div>

                                <div class="wrapper middle phone right">
                                    <input class="after required phone" name="phone" id="phone" value="" title="Phone Number" />
                                </div>
                                
                           <div class="bottom-clear"></div>    
                           <div class="guide ps"><div class="text"><span>Free guide with submission</span> Business VoIP Start-up Guide</div><div class="pdf-icon"></div></div>
                           <div class="verisign"></div>
                    </div>

                
                </div>
                
                
            
                <div id="Navigation"> 							
                        <input class="navigation_button" id="next" value="Quote Me" type="submit" />
                </div>
                
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="block" />
                <input type="hidden" name="version" value="7" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}


/**
 * Block Request a quote with a multistep form v8 - 1 step, New design based on v7
 */
function gv_blocks_get_requestQuote_block_v8() {
  
//  global $user;
//  if (!$user->uid) 
//    {
//    return NULL;
//  }
  
  
  if (
       $_GET['q'] == 'node/988' // Don't show the block if on the 404 page
       || 
       $_GET['q'] == 'node/2488' // Don't show on /cloud-backup
      ) {
    return NULL;
  }
  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  

  drupal_add_js('sites/all/libraries/jquery.plugins/jquery.hint-with-password.js');
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  drupal_add_js($path_to_custom_js . 'gv_requestquote_v8.js');
  
  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  
  $path_to_custom_js = drupal_get_path('module', 'selectmenu') . '/js/jquery.ui.selectmenu/';
  drupal_add_js($path_to_custom_js . 'jquery.ui.selectmenu.js');
  drupal_add_css($path_to_custom_js . 'jquery.ui.selectmenu.css');
  
  
  // height: 140px; 
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;

  
  
  
  $data = unserialize(variable_get('gv_request_quote_v8', NULL));
  
  
  $out = '
   
   <div id="requestQuoteFormWrapper">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        ' /*. '<form class="multipartForm bbq" method="post" action="/request" style="overflow: hidden;">' .*/ . '<form class="multipartForm bbq" method="post" action="/request">' . '

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="questions_section">
                    
                                <div id="up">
                                    <div class="text">' . $data['headline']['value'] . '</div>
                                </div>
                                <div class="bottom-clear"></div>   
                           
                                <div class="wrapper top first">
                                  <div class="question ui-widget">Service Type:</div>
                                  <select name="q_type" id="q_type" class="input required ui-state-default ui-helper-reset">
                                    <option selected="selected" value="Business">Business</option>
                                    <option value="Home-Based Business">Home-Based Business</option>
                                  </select>
                                </div>

                                <div class="wrapper top last">
                                  <div class="question ui-widget">Lines Needed:</div>
                                  <select name="phones_amt" id="phones_amt" class="input required ui-state-default ui-helper-reset">
                                    <!-- <option value="1 - 4">1 - 4</option> -->
                                    <option value="2 - 4">2 - 4</option>
                                    <option selected="selected" value="5 - 10">5 - 10</option>
                                    <option value="11 - 20">11 - 20</option>
                                    <option value="21 - 50">21 - 50</option>
                                    <option value="More than 50">More than 50</option>
                                  </select>
                                </div>

                            <div class="bottom-clear"></div>
                            
                            <!--<img class="guide" src="/sites/all/themes/gv_orange/css/images/quote-phone2.jpg" /> -->


                            <div class="bottom-clear"></div>
                            
                                <div class="wrapper middle first left">
                                    <input class="after required firstname" name="firstname" id="firstname" title="First Name" />
                                </div>

                                <div class="wrapper middle right">
                                    <input class="after required lastname" name="lastname" id="lastname" title="Last Name" />
                                </div>

                                <div class="wrapper middle left">
                                    <input class="after email required" name="email" id="email" title="Email Address" />
                                </div>

                                <div class="wrapper middle phone right">
                                    <input class="after required phone" name="phone" id="phone" value="" title="Phone Number" />
                                </div>
                                
                           <div class="bottom-clear"></div>    
                           <div class="guide ps"><div class="text"><span>Free guide with submission</span> Business VoIP Start-up Guide</div><div class="pdf-icon"></div></div>
                    </div>

                
                </div>
                
                
            
                <div id="Navigation"> 							
                        <input class="navigation_button" id="next" value="Quote Me" type="submit" />
                </div>
                
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="block" />
                <input type="hidden" name="version" value="8" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}


/**
 * Block Request a quote with a multistep form v8 for popup on provider page - 1 step, New design based on v7
 */
function gv_blocks_get_requestQuote_block_v8_popup_provider() {
  
//  global $user;
//  if (!$user->uid) 
//    {
//    return NULL;
//  }
  
 
  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  

  drupal_add_js('sites/all/libraries/jquery.plugins/jquery.hint-with-password.js');
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  drupal_add_js($path_to_custom_js . 'gv_requestquote_v8_popup_provider.js');
  
  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  
//  $path_to_custom_js = drupal_get_path('module', 'selectmenu') . '/js/jquery.ui.selectmenu/';
//  drupal_add_js($path_to_custom_js . 'jquery.ui.selectmenu.js');
//  drupal_add_css($path_to_custom_js . 'jquery.ui.selectmenu.css');
  
  
  // height: 140px; 
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;

  
  
  
  $out = '
   
   <div id="requestQuoteFormWrapper">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        <div class="caption">Your Information</div>
        ' /*. '<form class="multipartForm bbq" method="post" action="/request" style="overflow: hidden;">' .*/ . '<form class="multipartForm bbq" method="post" action="/request">' . '

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="questions_section">
                    
                               <!--
                                <div class="wrapper top first">
                                  <div class="question ui-widget">Service Type:</div>
                                  <select name="q_type" id="q_type" class="input required ui-state-default ui-helper-reset">
                                    <option selected="selected" value="Business">Business</option>
                                    <option value="Home-Based Business">Home-Based Business</option>
                                  </select>
                                </div>
                                -->
                                
                                <div class="wrapper top first"> 
                                 <div class="question">Current Needs:</div>
                                 <select name="q_for" id="q_for" class="input required">
                                   <option value="Need a phone system for a new office">System For New Office</option>
                                   <option value="Replace current phone system">Replace Current System</option>
                                   <option value="Expand on our current phone system">Expand Current System</option>
                                 </select>
                                </div>

                                <div class="wrapper top last">
                                  <div class="question ui-widget">Lines Needed:</div>
                                  <select name="phones_amt" id="phones_amt" class="input required ui-state-default ui-helper-reset">
                                    <!-- <option value="1 - 4">1 - 4</option> -->
                                    <option value="2 - 4">2 - 4</option>
                                    <option selected="selected" value="5 - 10">5 - 10</option>
                                    <option value="11 - 20">11 - 20</option>
                                    <option value="21 - 50">21 - 50</option>
                                    <option value="More than 50">More than 50</option>
                                  </select>
                                </div>

                            <div class="bottom-clear"></div>
                            

                            <div class="wrapper top first"> 
                             <div class="question">Type of Quote:</div>
                              <select name="q_type" id="q_type" class="input required">
                                <option value="Both phones and service">Both Phones & Services</option>
                                <option value="Phone system only">Phone System Only</option>
                                <option value="Service provider only">Service Provider Only</option>
                              </select>
                            </div>
                            
                           <div class="wrapper top last"> 
                             <div class="question">Buying Timeframe:</div>
                              <select name="buying_time" id="buying_time" class="input required">
                                <option value="ASAP">ASAP</option>
                                <option value="1-3 Months">1-3 Months</option>
                                <option value="3-6 Months">3-6 Months</option>
                              </select>
                            </div>
                            
                            <!--<img class="guide" src="/sites/all/themes/gv_orange/css/images/quote-phone2.jpg" /> -->


                            <div class="bottom-clear"></div>
                            
                                <div class="wrapper middle first left">
                                    <input class="after required firstname" name="firstname" id="firstname" title="FIRST NAME" />
                                </div>

                                <div class="wrapper middle right">
                                    <input class="after required lastname" name="lastname" id="lastname" title="LAST NAME" />
                                </div>

                                <div class="wrapper middle left">
                                    <input class="after email required" name="email" id="email" title="EMAIL ADDRESS" />
                                </div>

                                <div class="wrapper middle phone right">
                                    <input class="after required phone" name="phone" id="phone" value="" title="PHONE NUMBER" />
                                </div>
                                
                           <div class="bottom-clear"></div>    
                           <div class="guide ps"><div class="text"><span>Free guide with submission</span> Business VoIP Start-up Guide</div><div class="pdf-icon"></div></div>
                    </div>

                
                </div>
                
                
            
                <div id="Navigation"> 							
                        <input class="navigation_button" id="next" value="Quote Me" type="submit" />
                </div>
                
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="block" />
                <input type="hidden" name="version" value="8-popup-provider" />
                <input type="hidden" name="goal" value="quote" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                <input type="hidden" name="provider_name" value="" />
                <input type="hidden" name="provider_id" value="" />
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}


/**
 * Block Request a quote with a multistep form v8 for popup on provider page - 1 step, New design based on v7
 */
function gv_blocks_get_requestDemo_block_v1_popup_provider() {
  
//  global $user;
//  if (!$user->uid) 
//    {
//    return NULL;
//  }
  
 
  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  

  drupal_add_js('sites/all/libraries/jquery.plugins/jquery.hint-with-password.js');
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  drupal_add_js($path_to_custom_js . 'gv_requestdemo_v1.js');
  
  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  
//  $path_to_custom_js = drupal_get_path('module', 'selectmenu') . '/js/jquery.ui.selectmenu/';
//  drupal_add_js($path_to_custom_js . 'jquery.ui.selectmenu.js');
//  drupal_add_css($path_to_custom_js . 'jquery.ui.selectmenu.css');
  
  
  // height: 140px; 
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;

  
  
  
  $out = '
   
   <div id="requestQuoteFormWrapper">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        <div class="caption">Your Information</div>
        ' /*. '<form class="multipartForm bbq" method="post" action="/request" style="overflow: hidden;">' .*/ . '<form class="multipartForm bbq" method="post" action="/request">' . '

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="questions_section">
                    
                                <div class="wrapper top first">
                                  <!-- <div class="question ui-widget">Industry:</div> -->
                                  <select name="industry" id="industry" class="input required ui-state-default ui-helper-reset">
                                    <option value="" class="none demo">- Industry -</option>
                                    ' . gv_blocks_getIndustryOptions_text() . 

                                  '</select>
                                </div>

                                <div class="wrapper top last">
                                  <!-- <div class="question ui-widget">Number of Employees:</div> -->
                                  <select name="employees_amt" id="employees_amt" class="input required ui-state-default ui-helper-reset">
                                    <option value="" class="none">- Number of Employees -</option>
                                    <option value="2 - 4">2 - 4</option>
                                    <option value="5 - 10">5 - 10</option>
                                    <option value="11 - 20">11 - 20</option>
                                    <option value="21 - 50">21 - 50</option>
                                    <option value="51 - 99">51 - 99</option>
                                    <option value="100 - 499">100 - 499</option>
                                    <option value="500+">500+</option>
                                  </select>
                                </div>

                            <div class="bottom-clear"></div>
                            
                            <!--<img class="guide" src="/sites/all/themes/gv_orange/css/images/quote-phone2.jpg" /> -->


                            <div class="bottom-clear"></div>
                            
                                <div class="wrapper middle first left">
                                    <input class="after required name" name="name" id="name" title="YOUR NAME" />
                                </div>

                                <div class="wrapper middle right">
                                    <input class="after required company" name="company" id="company" title="COMPANY NAME" />
                                </div>

                                <div class="wrapper middle left">
                                    <input class="after email required" name="email" id="email" title="YOUR EMAIL" />
                                </div>

                                <div class="wrapper middle phone right">
                                    <input class="after required phone" name="phone" id="phone" value="" title="PHONE NUMBER" />
                                </div>
                                
                           <div class="bottom-clear"></div>    
                           <div class="notice">Your Name and Email WILL NOT be displayed</div>
                    </div>

                
                </div>
                
                
            
                <div id="Navigation"> 							
                        <input class="navigation_button" id="next" value="Quote Me" type="submit" />
                </div>
                
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="block" />
                <input type="hidden" name="version" value="1-demo-popup-provider" />
                <input type="hidden" name="goal" value="demo" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}


function gv_blocks_getIndustryOptions_text() {
  $out = '              <option value="Accounting">Accounting</option>
              <option value="Airlines/Aviation">Airlines/Aviation</option>
              <option value="Alternative Dispute Resolution">Alternative Dispute Resolution</option>
              <option value="Alternative Medicine">Alternative Medicine</option>
              <option value="Animation">Animation</option>
              <option value="Apparel &amp; Fashion">Apparel &amp; Fashion</option>
              <option value="Architecture &amp; Planning">Architecture &amp; Planning</option>
              <option value="Arts and Crafts">Arts and Crafts</option>
              <option value="Automotive">Automotive</option>
              <option value="Aviation &amp; Aerospace">Aviation &amp; Aerospace</option>
              <option value="Banking">Banking</option>
              <option value="Biotechnology">Biotechnology</option>
              <option value="Broadcast Media">Broadcast Media</option>
              <option value="Building Materials">Building Materials</option>
              <option value="Business Supplies and Equipment">Business Supplies and Equipment</option>
              <option value="Capital Markets">Capital Markets</option>
              <option value="Chemicals">Chemicals</option>
              <option value="Civic &amp; Social Organization">Civic &amp; Social Organization</option>
              <option value="Civil Engineering">Civil Engineering</option>
              <option value="Commercial Real Estate">Commercial Real Estate</option>
              <option value="Computer &amp; Network Security">Computer &amp; Network Security</option>
              <option value="Computer Games">Computer Games</option>
              <option value="Computer Hardware">Computer Hardware</option>
              <option value="Computer Networking">Computer Networking</option>
              <option value="Computer Software">Computer Software</option>
              <option value="Construction">Construction</option>
              <option value="Consumer Electronics">Consumer Electronics</option>
              <option value="Consumer Goods">Consumer Goods</option>
              <option value="Consumer Services">Consumer Services</option>
              <option value="Cosmetics">Cosmetics</option>
              <option value="Dairy">Dairy</option>
              <option value="Defense &amp; Space">Defense &amp; Space</option>
              <option value="Design">Design</option>
              <option value="Education Management">Education Management</option>
              <option value="E-Learning">E-Learning</option>
              <option value="Electrical/Electronic Manufacturing">Electrical/Electronic Manufacturing</option>
              <option value="Entertainment">Entertainment</option>
              <option value="Environmental Services">Environmental Services</option>
              <option value="Events Services">Events Services</option>
              <option value="Executive Office">Executive Office</option>
              <option value="Facilities Services">Facilities Services</option>
              <option value="Farming">Farming</option>
              <option value="Financial Services">Financial Services</option>
              <option value="Fine Art">Fine Art</option>
              <option value="Fishery">Fishery</option>
              <option value="Food &amp; Beverages">Food &amp; Beverages</option>
              <option value="Food Production">Food Production</option>
              <option value="Fund-Raising">Fund-Raising</option>
              <option value="Furniture">Furniture</option>
              <option value="Gambling &amp; Casinos">Gambling &amp; Casinos</option>
              <option value="Glass, Ceramics &amp; Concrete">Glass, Ceramics &amp; Concrete</option>
              <option value="Government Administration">Government Administration</option>
              <option value="Government Relations">Government Relations</option>
              <option value="Graphic Design">Graphic Design</option>
              <option value="Health, Wellness and Fitness">Health, Wellness and Fitness</option>
              <option value="Higher Education">Higher Education</option>
              <option value="Hospital &amp; Health Care">Hospital &amp; Health Care</option>
              <option value="Hospitality">Hospitality</option>
              <option value="Human Resources">Human Resources</option>
              <option value="Import and Export">Import and Export</option>
              <option value="Individual &amp; Family Services">Individual &amp; Family Services</option>
              <option value="Industrial Automation">Industrial Automation</option>
              <option value="Information Services">Information Services</option>
              <option value="Information Technology and Services">Information Technology and Services</option>
              <option value="Insurance">Insurance</option>
              <option value="International Affairs">International Affairs</option>
              <option value="International Trade and Development">International Trade and Development</option>
              <option value="Internet">Internet</option>
              <option value="Investment Banking">Investment Banking</option>
              <option value="Investment Management">Investment Management</option>
              <option value="Judiciary">Judiciary</option>
              <option value="Law Enforcement">Law Enforcement</option>
              <option value="Law Practice">Law Practice</option>
              <option value="Legal Services">Legal Services</option>
              <option value="Legislative Office">Legislative Office</option>
              <option value="Leisure, Travel &amp; Tourism">Leisure, Travel &amp; Tourism</option>
              <option value="Libraries">Libraries</option>
              <option value="Logistics and Supply Chain">Logistics and Supply Chain</option>
              <option value="Luxury Goods &amp; Jewelry">Luxury Goods &amp; Jewelry</option>
              <option value="Machinery">Machinery</option>
              <option value="Management Consulting">Management Consulting</option>
              <option value="Maritime">Maritime</option>
              <option value="Market Research">Market Research</option>
              <option value="Marketing and Advertising">Marketing and Advertising</option>
              <option value="Mechanical or Industrial Engineering">Mechanical or Industrial Engineering</option>
              <option value="Media Production">Media Production</option>
              <option value="Medical Devices">Medical Devices</option>
              <option value="Medical Practice">Medical Practice</option>
              <option value="Mental Health Care">Mental Health Care</option>
              <option value="Military">Military</option>
              <option value="Mining &amp; Metals">Mining &amp; Metals</option>
              <option value="Motion Pictures and Film">Motion Pictures and Film</option>
              <option value="Museums and Institutions">Museums and Institutions</option>
              <option value="Music">Music</option>
              <option value="Nanotechnology">Nanotechnology</option>
              <option value="Newspapers">Newspapers</option>
              <option value="Non-Profit Organization Management">Non-Profit Organization Management</option>
              <option value="Oil &amp; Energy">Oil &amp; Energy</option>
              <option value="Online Media">Online Media</option>
              <option value="Outsourcing/Offshoring">Outsourcing/Offshoring</option>
              <option value="Package/Freight Delivery">Package/Freight Delivery</option>
              <option value="Packaging and Containers">Packaging and Containers</option>
              <option value="Paper &amp; Forest Products">Paper &amp; Forest Products</option>
              <option value="Performing Arts">Performing Arts</option>
              <option value="Pharmaceuticals">Pharmaceuticals</option>
              <option value="Philanthropy">Philanthropy</option>
              <option value="Photography">Photography</option>
              <option value="Plastics">Plastics</option>
              <option value="Political Organization">Political Organization</option>
              <option value="Primary/Secondary Education">Primary/Secondary Education</option>
              <option value="Printing">Printing</option>
              <option value="Professional Training &amp; Coaching">Professional Training &amp; Coaching</option>
              <option value="Program Development">Program Development</option>
              <option value="Public Policy">Public Policy</option>
              <option value="Public Relations and Communications">Public Relations and Communications</option>
              <option value="Public Safety">Public Safety</option>
              <option value="Publishing">Publishing</option>
              <option value="Railroad Manufacture">Railroad Manufacture</option>
              <option value="Ranching">Ranching</option>
              <option value="Real Estate">Real Estate</option>
              <option value="Recreational Facilities and Services">Recreational Facilities and Services</option>
              <option value="Religious Institutions">Religious Institutions</option>
              <option value="Renewables &amp; Environment">Renewables &amp; Environment</option>
              <option value="Research">Research</option>
              <option value="Restaurants">Restaurants</option>
              <option value="Retail">Retail</option>
              <option value="Security and Investigations">Security and Investigations</option>
              <option value="Semiconductors">Semiconductors</option>
              <option value="Shipbuilding">Shipbuilding</option>
              <option value="Sporting Goods">Sporting Goods</option>
              <option value="Sports">Sports</option>
              <option value="Staffing and Recruiting">Staffing and Recruiting</option>
              <option value="Supermarkets">Supermarkets</option>
              <option value="Telecommunications">Telecommunications</option>
              <option value="Textiles">Textiles</option>
              <option value="Think Tanks">Think Tanks</option>
              <option value="Tobacco">Tobacco</option>
              <option value="Translation and Localization">Translation and Localization</option>
              <option value="Transportation/Trucking/Railroad">Transportation/Trucking/Railroad</option>
              <option value="Utilities">Utilities</option>
              <option value="Venture Capital &amp; Private Equity">Venture Capital &amp; Private Equity</option>
              <option value="Veterinary">Veterinary</option>
              <option value="Warehousing">Warehousing</option>
              <option value="Wholesale">Wholesale</option>
              <option value="Wine and Spirits">Wine and Spirits</option>
              <option value="Wireless">Wireless</option>
              <option value="Writing and Editing">Writing and Editing</option>
';
  return $out;
}


/**
 * Block Request a quote with a multistep form FOR PAGE v1 - /request-voip-phone-system-quote.
 */
function gv_blocks_get_requestQuoteForPage() {

  drupal_add_library('system', 'ui.widget');

  //drupal_add_library('system', 'effects.bounce');
  
  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  //drupal_add_js($path_to_custom_js . 'bbq.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  
  
  drupal_add_js('sites/all/libraries/jquery.plugins/ui/jquery.ui.selectmenu.js');
  drupal_add_css('sites/all/libraries/jquery.plugins/ui/themes/base/jquery.ui.selectmenu.css');
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  drupal_add_js($path_to_custom_js . 'gv_requestquote_page.js');
  
  
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;
  
  $out = '
   <div id="requestQuoteFormWrapper">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        <form class="multipartForm bbq" method="post" action="/request" style="height: 300px; overflow: hidden;">

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="phones_amt_section">
                        
                            <div class="question">' . t('How many phones do you need?') . '<span class="form-required">*</span></div>
                              <select name="phones_amt" id="phones_amt" class="input required">
                                <!--<option value="">- Select a value -</option>-->
                                <option value="1 - 4">1 - 4</option>
                                <option value="5 - 10">5 - 10</option>
                                <option selected="selected" value="11 - 20">11 - 20</option>
                                <option value="21 - 50">21 - 50</option>
                                <option value="More than 50">More than 50</option>
                              </select>
                            
                            
                            <div class="question">' . t('What is your current phone needs?') . '<span class="form-required">*</span></div>
                              <select name="q_for" id="q_for" class="input required">
                                <!--<option value="">- Select a value -</option>-->
                                <option value="Replace current phone system">' . t('Replace current phone system') .'</option>
                                <option value="Need a phone system for a new office">' . t('Need a phone system for a new office') .'</option>
                                <option value="Expand on our current phone system">' . t('Expand on our current phone system') .'</option>
                              </select>

                            <div class="question">' . t('What type of quote do you need?') . '<span class="form-required">*</span></div>
                              <select name="q_type" id="q_type" class="input required">
                                <!--<option value="">- Select a value -</option>-->
                                <option value="Both phones and service">' . t('Both phones and service') .'</option>
                                <option value="Phone system only">' . t('Phone system only') .'</option>
                                <option value="Service provider only">' . t('Service provider only') .'</option>
                              </select>
                            
                            <div class="question">' . t('What is your buying time frame?') . '<span class="form-required">*</span></div>
                              <select name="buying_time" id="buying_time" class="input required">
                                <!--<option value="">- Select a value -</option>-->
                                <option value="ASAP">' . t('ASAP') .'</option>
                                <option value="1-3 Months">' . t('1-3 Months') .'</option>
                                <option value="3-6 Months">' . t('3-6 Months') .'</option>
                              </select>
                            
                            <!--<div id="on_error"></div>-->
                            
                            <!--<div class="step-notice">' . t('Step <span class="f">!first</span>of<span class="s">!second</span>', array('!first' => 1, '!second' => 2)) . '</div> -->
                    </div>
                    
                    <div class="step" id="personal_info">
                        
                            <div class="question">' . t('Fill out the form below:') . '</div>
                            
                            <div class="wrapper">
                              <div class="label_before required">' . t('First Name') . '<span class="form-required">*</span></div>
                                <input class="after required name" name="firstname" id="firstname" />
                            </div>
                            
                            <div class="wrapper">
                              <div class="label_before required">' . t('Last Name') . '<span class="form-required">*</span></div>
                                <input class="after required" name="lastname" id="lastname" />
                            </div>
                            
                            <div class="wrapper">
                              <div class="label_before required">' . t('Company') . '</div>
                                <input class="after" name="company" id="company" />
                            </div>

                            <div class="wrapper">
                              <div class="label_before required">' . t('Email') . '<span class="form-required">*</span></div>
                                <input class="after email required" name="email" id="email" />
                            </div>
                            
                            <div class="wrapper">
                              <div class="label_before">' . t('Website') . '</div>
                                <input class="after" name="website" id="website" />
                            </div>
                            
                            <div class="wrapper">
                              <div class="label_before required">' . t('Phone') . '<span class="form-required">*</span></div>
                              <div id="phone">
                                <input class="after required phone" name="phone_1" id="phone_1" value="" />
                                <input class="after required phone" name="phone_2" id="phone_2" value="" />
                                <input class="after required phone" name="phone_3" id="phone_3" value="" />
                               </div>
                            </div>
                         
                           <!--<div class="step-notice">' . t('Step <span class="f">!first</span>of<span class="s">!second</span>', array('!first' => 2, '!second' => 2)) . '</div>-->
                           <div class="protected"></div>
                    </div>
                    
                </div>
            
                <div id="Navigation"> 							
                        <input class="navigation_button" id="back" value="Back" type="reset" />
                        <input class="navigation_button" id="next" value="No Risk Quote" type="submit" />
                </div>
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="page" />
                <input type="hidden" name="version" value="1" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}


/**
 * Block Request a quote with a multistep form FOR PAGE v2 - /voip-provider-quotes.
 */
function gv_blocks_get_requestQuoteForPage_v2() {

  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  //drupal_add_js($path_to_custom_js . 'bbq.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  drupal_add_js('sites/all/libraries/jquery.plugins/jquery.hint-with-password.js');
  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  drupal_add_js($path_to_custom_js . 'gv_requestquote_page_v2.js');
  
  
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;
  
  $out = '
   <div id="requestQuoteFormWrapper">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        <form class="multipartForm bbq" method="post" action="/request">

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="questions_section">

                            <div class="question">' . t('How many phones do you need?') . '<span class="form-required">*</span></div>
                            <div class="subset first">
                              <input type="radio" name="phones_amt" value="1 - 4" /><div class="label_after">1 - 4</div>
                              <input type="radio" name="phones_amt" value="11 - 20" /><div class="last_radio label_after">11 - 20</div>
                            </div>
                            <div class="subset second">
                              <input checked type="radio" name="phones_amt" value="5 - 10" /><div class="label_after">5 - 10</div>
                              <input type="radio" name="phones_amt" value="more than 20" /><div class="last_radio label_after">more than 20</div>
                            </div>
                            
                            <div class="bottom-clear"></div>


                            <div class="question">' . t('What type of quote do you need?') . '<span class="form-required">*</span></div>
                            <div class="subset first">
                              <input type="radio" name="q_type" value="Phone system only" /><div class="label_after">' . t('Phone system only') . '</div>
                              <input checked type="radio" name="q_type" value="Both phones and service" /><div class="label_after">' . t('Both phones and service') . '</div>
                            </div>
                            <div class="subset second">
                              <input type="radio" name="q_type" value="Service provider only" /><div class="last_radio label_after">' . t('Service provider only') . '</div>
                            </div>

                            <div class="question">' . t('What is your buying time frame?') . '<span class="form-required">*</span></div>
                            <div class="subset first">
                              <input checked type="radio" name="buying_time" value="ASAP" /><div class="label_after">' . t('ASAP') . '</div>
                              <input type="radio" name="buying_time" value="3 - 6 Months" /><div class="last_radio label_after">' . t('3 - 6 Months') . '</div>
                            </div>  
                            <div class="subset second">
                              <input type="radio" name="buying_time" value="1 - 3 Months" /><div class="label_after">' . t('1 - 3 Months') . '</div>
                            </div>
                            
                            <div class="bottom-clear"></div>
                            
                            <div class="subset-name"> 
                              <div class="wrapper subset first">
                                <div class="label_before required">' . t('Name') . '<span class="form-required">*</span></div>
                                  <input class="after required name" name="firstname" id="firstname" title="First" />
                              </div>

                              <div class="wrapper subset second">
                                  <input class="after required" name="lastname" id="lastname" title="Last" />
                              </div>
                            </div>
                            
                            <div class="bottom-clear"></div>
                            
                            <div class="wrapper">
                              <div class="label_before required">' . t('Email') . '<span class="form-required">*</span></div>
                                <input class="after email required" name="email" id="email" title="Enter a valid email" />
                            </div>
                         
                            <div class="wrapper">
                              <div class="label_before required">' . t('Phone') . '<span class="form-required">*</span></div>
                              <div id="phone">
                                <input class="after required phone" name="phone_1" id="phone_1" value="" />
                                <input class="after required phone" name="phone_2" id="phone_2" value="" />
                                <input class="after required phone" name="phone_3" id="phone_3" value="" />
                               </div>
                            </div>
                            
                            <div class="wrapper">
                              <div class="label_before">' . t('Company') . '</div>
                                <input class="after" name="company" id="company" title="Optional" />
                            </div>

   
                     

                            <!--<div id="on_error"></div>-->

                            <!--<div class="step-notice">' . t('Step <span class="f">!first</span>of<span class="s">!second</span>', array('!first' => 1, '!second' => 2)) . '</div> -->
                    </div>

                    <div class="protected"></div>
                
                </div>
                
                
            
                <div id="Navigation"> 							
                        <input class="navigation_button" id="back" value="Back" type="reset" />
                        <input class="navigation_button" id="next" value="Submit & Get Quotes" type="submit" />
                </div>
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="page" />
                <input type="hidden" name="version" value="2" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}



/**
 * Block Request a quote with a multistep form FOR PAGE v3 - /voip-provider-quotes.
 */
function gv_blocks_get_requestQuoteForPage_v3() {

  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  //drupal_add_js($path_to_custom_js . 'bbq.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  drupal_add_js('sites/all/libraries/jquery.plugins/jquery.hint-with-password.js');

  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  drupal_add_js($path_to_custom_js . 'gv_requestquote_page_v2.js');
  
  drupal_add_js($path_to_custom_js . 'gv_brandsCarousel.js');
  drupal_add_js('sites/all/libraries/jquery.plugins/jcarousel/jquery.jcarousel.min.js');
  drupal_add_css('sites/all/libraries/jquery.plugins/jcarousel/skins/tango/skin.css');
  
  
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;
  
  $out = '
   <div id="requestQuoteFormWrapper">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        <form class="multipartForm bbq" method="post" action="/request">

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="questions_section">

                            <div class="question">' . t('Amount of phones needed') . ':</div>
                              <select name="phones_amt" id="phones_amt" class="input required">
                                <option value="1 - 4">1 - 4</option>
                                <option selected="selected" value="5 - 10">5 - 10</option>
                                <option value="11 - 20">11 - 20</option>
                                <option value="21 - 50">21 - 50</option>
                                <option value="More than 50">More than 50</option>
                              </select>
           
                            <div class="question">' . t('VoIP Service desired') . ':</div>
                              <select name="q_type" id="q_type" class="input required">
                                <option value="Both phones and service">' . t('Both phones and service') .'</option>
                                <option value="Phone system only">' . t('Phone system only') .'</option>
                                <option value="Service provider only">' . t('Service provider only') .'</option>
                              </select>
                            
                            <div class="question">' . t('Buying time frame') . ':</div>
                              <select name="buying_time" id="buying_time" class="input required">
                                <!--<option value="">- Select a value -</option>-->
                                <option value="ASAP">' . t('ASAP') .'</option>
                                <option value="1-3 Months">' . t('1-3 Months') .'</option>
                                <option value="3-6 Months">' . t('3-6 Months') .'</option>
                              </select>
                              
                            
                            <div class="bottom-clear"></div>


                            <div class="wrapper">
                              <div class="label_before required">' . t('First Name') . ':<span class="form-required">*</span></div>
                                <input class="after required firstname" name="firstname" id="firstname" />
                            </div>
                            
                            <div class="wrapper">
                              <div class="label_before required">' . t('Last Name') . ':<span class="form-required">*</span></div>
                                <input class="after required lastname" name="lastname" id="lastname" />
                            </div>
                            
                            <div class="wrapper">
                              <div class="label_before required">' . t('Email') . ':<span class="form-required">*</span></div>
                                <input class="after email required" name="email" id="email" />
                            </div>
                         
                            <div class="wrapper phone">
                              <div class="label_before required">' . t('Phone') . '<span class="form-required">*</span></div>
                              <div id="phone">
                                <input class="after required phone" name="phone_1" id="phone_1" value="" />
                                <input class="after required phone" name="phone_2" id="phone_2" value="" />
                                <input class="after required phone" name="phone_3" id="phone_3" value="" />
                              </div>
                            </div>
                            
                            <!--
                            <div class="wrapper phone">
                              <div class="label_before required">' . t('Phone') . ':<span class="form-required">*</span></div>
                                <input class="after required phone" name="phone" id="phone" value="" />
                            </div>
                            -->
                            
                            <div class="wrapper company">
                              <div class="label_before">' . t('Company') . ':</div>
                                <input class="after" name="company" id="company" />
                            </div>

                            <div class="wrapper website">
                              <div class="label_before">' . t('Website') . ':</div>
                                <input class="after" name="website" id="website" />
                            </div>
                            
                            <!--<div id="on_error"></div>-->

                            <!--<div class="step-notice">' . t('Step <span class="f">!first</span>of<span class="s">!second</span>', array('!first' => 1, '!second' => 2)) . '</div> -->
                                
                            <div class="protected"></div>
                    </div>

                    
                
                </div>
                
                
            
                <div id="Navigation"> 							
                        <!--<input class="navigation_button" id="back" value="Back" type="reset" />-->
                        <input class="navigation_button" id="next" value="Submit & Get Quotes" type="submit" />
                </div>
                
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="page" />
                <input type="hidden" name="version" value="3" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}


/**
 * Block Request a quote with a multistep form FOR PAGE v32 - /voip-provider-quotes.
 * A bit changed v3.
 */
function gv_blocks_get_requestQuoteForPage_v32() {

  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  
  
  
  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  //drupal_add_js($path_to_custom_js . 'bbq.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  
  
  //drupal_add_js('sites/all/libraries/jquery.plugins/jquery.hint-with-password.js');
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  
  
  drupal_add_js($path_to_custom_js . 'gv_quote_page_field_hints.js');
  
  
  drupal_add_js($path_to_custom_js . 'gv_requestquote_page_v3.js');
  
  
  
  drupal_add_js($path_to_custom_js . 'gv_brandsCarousel.js');
  drupal_add_js('sites/all/libraries/jquery.plugins/jcarousel/jquery.jcarousel.min.js');
  drupal_add_css('sites/all/libraries/jquery.plugins/jcarousel/skins/tango/skin.css');
  
  
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;
  
  $out = '
   <div id="requestQuoteFormWrapper">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        <form class="multipartForm bbq" method="post" action="/request">

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="questions_section">

                            <div class="question">' . t('Amount of phones needed') . ':</div>
                              <select name="phones_amt" id="phones_amt" class="input required">
                                <!-- <option value="1 - 4">1 - 4</option> -->
                                <option value="1">1</option>
                                <option value="2 - 4">2 - 4</option>
                                <option selected="selected" value="5 - 10">5 - 10</option>
                                <option value="11 - 20">11 - 20</option>
                                <option value="21 - 50">21 - 50</option>
                                <option value="More than 50">More than 50</option>
                              </select>
           
                            <div class="question">VoIP Service desired:</div>
                              <select name="q_type" id="q_type" class="input required">
                                <option value="Both phones and service">' . t('Both phones and service') .'</option>
                                <option value="Phone system only">' . t('Phone system only') .'</option>
                                <option value="Service provider only">' . t('Service provider only') .'</option>
                              </select>
                            
                            <div class="question">' . t('Buying time frame') . ':</div>
                              <select name="buying_time" id="buying_time" class="input required">
                                <!--<option value="">- Select a value -</option>-->
                                <option value="ASAP">' . t('ASAP') .'</option>
                                <option value="1-3 Months">' . t('1-3 Months') .'</option>
                                <option value="3-6 Months">' . t('3-6 Months') .'</option>
                              </select>
                              
                            
                            <div class="bottom-clear"></div>
                            
                            <div class="guide">Free VoIP Guide With Request</div>

                            <div class="wrapper input-border">
                              <input class="after required firstname" name="firstname" id="firstname" title="First Name *" />
                            </div>
                            
                            <div class="wrapper input-border">
                              <input class="after required lastname" name="lastname" id="lastname" title="Last Name *" />
                            </div>
                            
                            <div class="wrapper input-border">
                              <input class="after email required" name="email" id="email" title="Email Address *" />
                            </div>
                            
                            <!--
                            <div class="wrapper phone">
                              <div class="label_before required">' . t('Phone') . '<span class="form-required">*</span></div>
                              <div class="input-border"><div id="phone">
                                <input class="after required phone" name="phone_1" id="phone_1" value="" />
                                <input class="after required phone" name="phone_2" id="phone_2" value="" />
                                <input class="after required phone" name="phone_3" id="phone_3" value="" />
                               </div></div>
                            </div>
                            -->
                            
                            <div class="wrapper phone input-border">
                                <input class="after required phone" name="phone" id="phone" value="" title="Phone Number *" />
                            </div>
                            
                            
                            <div class="wrapper company input-border">
                                <input class="after required" name="company" id="company" title="Company *" />
                            </div>

                            <div class="wrapper website input-border">
                                <input class="after" name="website" id="website" title="Website" />
                            </div>
                            
                            <!--<div id="on_error"></div>-->

                            <!--<div class="step-notice">' . t('Step <span class="f">!first</span>of<span class="s">!second</span>', array('!first' => 1, '!second' => 2)) . '</div> -->
                            
                            <div class="ps"><span>4,000+ Form Submissions -</span> Helping businesses save an average of $180 per month on their phone bill</div>
                            
                            <div class="verisign"></div><div class="protected"></div>
                    </div>

                    
                
                </div>
                
                
            
                <div id="Navigation"> 							
                        <input class="navigation_button" id="next" value="Submit & Get Quotes" type="submit" />
                </div>
                
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="page" />
                <input type="hidden" name="version" value="3" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}


/**
 * Block Request a quote with a multistep form FOR PAGE v33 - /voip-provider-quotes.
 * A bit changed v32.
 */
function gv_blocks_get_requestQuoteForPage_v33() {

  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  
  
  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  //drupal_add_js($path_to_custom_js . 'bbq.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  //drupal_add_js('sites/all/libraries/jquery.plugins/jquery.hint-with-password.js');
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  
  drupal_add_js($path_to_custom_js . 'gv_quote_page_field_hints.js');
  
  drupal_add_js($path_to_custom_js . 'gv_requestquote_page_v3.js');
  
  drupal_add_js($path_to_custom_js . 'gv_brandsCarousel.js');
  
  drupal_add_js('sites/all/libraries/jquery.plugins/jcarousel/jquery.jcarousel.min.js');
  drupal_add_css('sites/all/libraries/jquery.plugins/jcarousel/skins/tango/skin.css');
  
  
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;
  
  $out = '
   <div id="requestQuoteFormWrapper">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        <form class="multipartForm bbq" method="post" action="/request">

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="questions_section">

                            <div class="question">Amount of lines needed:</div>
                              <select name="phones_amt" id="phones_amt" class="input required">
                                <option value="1 - 4">1 - 4 Lines</option>
                                <option selected="selected" value="5 - 10">5 - 10 Lines</option>
                                <option value="11 - 20">11 - 20 Lines</option>
                                <option value="21 - 50">21 - 50 Lines</option>
                                <option value="More than 50">More than 50 Lines</option>
                              </select>
           
                            <div class="question">VoIP Service desired:</div>
                            <!-- <div class="question">Services to Compare:</div> -->
                              <select name="q_type" id="q_type" class="input required">
                                <option value="Both phones and service">Both Phones & Services</option>
                                <option value="Phone system only">Phone System Only</option>
                                <option value="Service provider only">Service Provider Only</option>
                              </select>
                            
                            <!--
                            <div class="question">Current Phone Needs:</div>
                              <select name="q_for" id="q_for" class="input required">
                                <option value="Need a phone system for a new office">System For New Office</option>
                                <option value="Replace current phone system">Replace Current System</option>
                                <option value="Expand on our current phone system">Expand Current System</option>
                              </select>
                            -->  
                            
                            <div class="question">Buying time frame:</div>
                              <select name="buying_time" id="buying_time" class="input required">
                                <option value="ASAP">ASAP</option>
                                <option value="1-3 Months">1-3 Months</option>
                                <option value="3-6 Months">3-6 Months</option>
                              </select>
                            
                            
                            <div class="bottom-clear"></div>

                            <div class="text-h-group">
                              <div class="wrapper input-border">
                                <input class="after required firstname" name="firstname" id="firstname" title="First Name *" />
                              </div>

                              <div class="wrapper input-border second">
                                <input class="after required lastname" name="lastname" id="lastname" title="Last Name *" />
                              </div>
                            </div>
                            
                            <div class="text-h-group">
                              <div class="wrapper input-border">
                                <input class="after email required" name="email" id="email" title="Email Address *" />
                              </div>

                              <div class="wrapper phone input-border  second">
                                  <input class="after required phone" name="phone" id="phone" value="" title="Phone Number *" />
                              </div>
                            </div>
                            
                            <div class="text-h-group">
                              <div class="wrapper company input-border">
                                  <input class="after required" name="company" id="company" title="Company *" />
                              </div>

                              <div class="wrapper website input-border  second">
                                  <input class="after" name="website" id="website" title="Website" />
                              </div>
                            </div>
                            
                            <!--<div id="on_error"></div>-->

                            <!--<div class="step-notice">' . t('Step <span class="f">!first</span>of<span class="s">!second</span>', array('!first' => 1, '!second' => 2)) . '</div> -->
                            
                            
                            
                    </div>

                    
                
                </div>
                
                
                <div class="guide ps"><div class="text"><span>Free guide with submission</span> Business VoIP Start-up Guide</div><img src="/sites/all/themes/gv_orange/css/images/pdf-icon2.png" alt="Free guide with submission Business VoIP Start-up Guide" /></div>
                
                <div id="Navigation"> 							
                        <input class="navigation_button" id="next" value="Submit & Get Quotes" type="submit" />
                </div>
                
                <!-- <div class="ps"><span>5000+ Submissions -</span> Delivered Businesses an Average Savings of $180 per month</div> -->
                
                
                
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="page" />
                <input type="hidden" name="version" value="3" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}


/**
 * Block Request a quote FOR PAGE v4 - /business-systems.
 * 
 */
function gv_blocks_get_requestQuoteForPage_v4() {

  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  
  
  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  //drupal_add_js($path_to_custom_js . 'bbq.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  //drupal_add_js('sites/all/libraries/jquery.plugins/jquery.hint-with-password.js');
  
  
  
//  drupal_add_js('sites/all/libraries/jquery.plugins/ui/jquery.ui.selectmenu.js');
//  drupal_add_css('sites/all/libraries/jquery.plugins/ui/themes/base/jquery.ui.selectmenu.css');
  
  $path_to_custom_js = drupal_get_path('module', 'selectmenu') . '/js/jquery.ui.selectmenu/';
  drupal_add_js($path_to_custom_js . 'jquery.ui.selectmenu.js');
  drupal_add_css($path_to_custom_js . 'jquery.ui.selectmenu.css');
  
  
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  
  drupal_add_js($path_to_custom_js . 'gv_quote_page_field_hints.js');
  
  drupal_add_js($path_to_custom_js . 'gv_requestquote_page_v4.js');
  
  // No slider with provider on V4.

//  drupal_add_js($path_to_custom_js . 'gv_brandsCarousel.js');
//  
//  drupal_add_js('sites/all/libraries/jquery.plugins/jcarousel/jquery.jcarousel.min.js');
//  drupal_add_css('sites/all/libraries/jquery.plugins/jcarousel/skins/tango/skin.css');
  
  
  
  
//  // Exit intent Ad popup block.
//  global $user; 
//  
//  if ($user->uid) {
//    // Colorbox for popup window.
//    //1, 3, 4, 
//    drupal_add_js('sites/all/libraries/jquery.plugins/colorbox/colorbox/jquery.colorbox.js');
//    drupal_add_css('sites/all/libraries/jquery.plugins/colorbox/example1/colorbox.css', array('preprocess' => FALSE)); // array('group' => CSS_THEME, 'preprocess' => FALSE)
//
//    // Exit intent Ad block main js.
//    $path_to_custom_js = drupal_get_path('module', 'gv_misc') . '/js/';
//    drupal_add_js($path_to_custom_js . 'gv_exitIntent_lpV4.js');
//  }
//  
  
  
  
  
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;
  
  
  
//  $exitIntent_block = '
//  <div style="display: none;">
//   <div id="exitIntent"> 
//    <div id="line-1">Do You Want To Save BIG On</div>
//    <div id="line-2">Reliable Business Phone Service?</div>
//    
//    <div id="line-3">Get voice, fax, text and conferencing</div>
//    <div id="line-4">in one phone system for $19/mo.</div>
//    
//    <a href="/business" id="yes" target="_top">YES</a>
//    <div id="no">NO - I like overpaying for my old phone service.</div>
//   </div>
//  </div>
//';
  
  $out = //$exitIntent_block . 
          '
   <h2>Ready To Save?<br/>Get Competing Quotes Now!</h2>
   <div id="requestQuoteFormWrapper">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        <form class="multipartForm bbq" method="post" action="/request">

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="questions_section">

                          <div class="select">
                            <div class="question">Amount of lines needed:</div>
                              <select name="phones_amt" id="phones_amt" class="input required">
                                <option value="1 - 4">1 - 4 Lines</option>
                                <option selected="selected" value="5 - 10">5 - 10 Lines</option>
                                <option value="11 - 20">11 - 20 Lines</option>
                                <option value="21 - 50">21 - 50 Lines</option>
                                <option value="More than 50">More than 50 Lines</option>
                              </select>
                           </div>
           
                           <div class="select last">
                            <div class="question">Show me:</div>
                              <select name="q_type" id="q_type" class="input required">
                                <option value="Both phones and service">Both Phones & Services</option>
                                <option value="Phone system only">Phone System Only</option>
                                <option value="Service provider only">Service Provider Only</option>
                              </select>
                            </div>
                            
                            
                            <div class="bottom-clear"></div>

                            <div class="text-h-group">
                              <div class="wrapper input-border">
                                <input class="after required firstname" name="firstname" id="firstname" title="First Name" />
                              </div>

                              <div class="wrapper input-border second">
                                <input class="after required lastname" name="lastname" id="lastname" title="Last Name" />
                              </div>
                            </div>
                            
                            <div class="text-h-group">
                              <div class="wrapper input-border">
                                <input class="after email required" name="email" id="email" title="Email Address" />
                              </div>

                              <div class="wrapper phone input-border  second">
                                  <input class="after required phone" name="phone" id="phone" value="" title="Phone Number" />
                              </div>
                            </div>' 
                            

//                            . '<div class="text-h-group">
//                              <div class="wrapper input-border">
//                                <input class="after company" name="company" id="company" value="" title="Company Name" />
//                              </div>
//
//                              <div class="wrapper input-border  second">
//                                  <input class="after q-title" name="q-title" id="q-title" value="" title="Title" />
//                              </div>
//                            </div>'
                            
                            .'
                            
                            
                    </div>

                    
                
                </div>
                
                
                <div id="Navigation"> 							
                        <input class="navigation_button" id="next" value="Get My Free Quote" type="submit" />
                </div>
                
                
                <div class="guide ps"><div id="pdf-icon"></div><div class="text">Receive a <strong>FREE 6-page</strong> Business VoIP Start Up Guide with submission!</div></div>
                
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="page" />
                <input type="hidden" name="version" value="4" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}


/**
 * Block Request a quote FOR PAGE v5 - /lp-iscope.
 * 
 */
function gv_blocks_get_requestQuoteForPage_v5() {

  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  
  
  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  //drupal_add_js($path_to_custom_js . 'bbq.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  //drupal_add_js('sites/all/libraries/jquery.plugins/jquery.hint-with-password.js');
  
  
  
//  drupal_add_js('sites/all/libraries/jquery.plugins/ui/jquery.ui.selectmenu.js');
//  drupal_add_css('sites/all/libraries/jquery.plugins/ui/themes/base/jquery.ui.selectmenu.css');
  
  $path_to_custom_js = drupal_get_path('module', 'selectmenu') . '/js/jquery.ui.selectmenu/';
  drupal_add_js($path_to_custom_js . 'jquery.ui.selectmenu.js');
  drupal_add_css($path_to_custom_js . 'jquery.ui.selectmenu.css');
  
  
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  
  drupal_add_js($path_to_custom_js . 'gv_quote_page_field_hints.js');
  
  drupal_add_js($path_to_custom_js . 'gv_requestquote_page_v4.js');
  
  // No slider with provider on V4.

//  drupal_add_js($path_to_custom_js . 'gv_brandsCarousel.js');
//  
//  drupal_add_js('sites/all/libraries/jquery.plugins/jcarousel/jquery.jcarousel.min.js');
//  drupal_add_css('sites/all/libraries/jquery.plugins/jcarousel/skins/tango/skin.css');
  
  
  
  
//  // Exit intent Ad popup block.
//  global $user; 
//  
//  if ($user->uid) {
//    // Colorbox for popup window.
//    //1, 3, 4, 
//    drupal_add_js('sites/all/libraries/jquery.plugins/colorbox/colorbox/jquery.colorbox.js');
//    drupal_add_css('sites/all/libraries/jquery.plugins/colorbox/example1/colorbox.css', array('preprocess' => FALSE)); // array('group' => CSS_THEME, 'preprocess' => FALSE)
//
//    // Exit intent Ad block main js.
//    $path_to_custom_js = drupal_get_path('module', 'gv_misc') . '/js/';
//    drupal_add_js($path_to_custom_js . 'gv_exitIntent_lpV4.js');
//  }
//  
  
  
  
  
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;
  
  
  
//  $exitIntent_block = '
//  <div style="display: none;">
//   <div id="exitIntent"> 
//    <div id="line-1">Do You Want To Save BIG On</div>
//    <div id="line-2">Reliable Business Phone Service?</div>
//    
//    <div id="line-3">Get voice, fax, text and conferencing</div>
//    <div id="line-4">in one phone system for $19/mo.</div>
//    
//    <a href="/business" id="yes" target="_top">YES</a>
//    <div id="no">NO - I like overpaying for my old phone service.</div>
//   </div>
//  </div>
//';
  
  $out = //$exitIntent_block . 
          '
   <h2>Ready To Save?<br/>Get Competing Quotes Now!</h2>
   <div id="requestQuoteFormWrapper">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        <form class="multipartForm bbq" method="post" action="/request">

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="questions_section">

                          <div class="select">
                            <div class="question">Amount of lines needed:</div>
                              <select name="phones_amt" id="phones_amt" class="input required">
                                <option value="1 - 4">1 - 4 Lines</option>
                                <option selected="selected" value="5 - 10">5 - 10 Lines</option>
                                <option value="11 - 20">11 - 20 Lines</option>
                                <option value="21 - 50">21 - 50 Lines</option>
                                <option value="More than 50">More than 50 Lines</option>
                              </select>
                           </div>
           
                           <div class="select last">
                            <div class="question">Show me:</div>
                              <select name="q_type" id="q_type" class="input required">
                                <option value="Both phones and service">Both Phones & Services</option>
                                <option value="Phone system only">Phone System Only</option>
                                <option value="Service provider only">Service Provider Only</option>
                              </select>
                            </div>
                            
                            
                            <div class="bottom-clear"></div>' 
                            

                            . '<div class="text-h-group">
                              <div class="wrapper input-border">
                                <input class="after company" name="company" id="company" value="" title="Company Name" />
                              </div>

                              <div class="wrapper input-border  second">
                                  <input class="after q-title" name="q-title" id="q-title" value="" title="Title" />
                              </div>
                            </div>'
                            
                            .'
                            

                            <div class="text-h-group">
                              <div class="wrapper input-border">
                                <input class="after required firstname" name="firstname" id="firstname" title="First Name" />
                              </div>

                              <div class="wrapper input-border second">
                                <input class="after required lastname" name="lastname" id="lastname" title="Last Name" />
                              </div>
                            </div>
                            
                            <div class="text-h-group">
                              <div class="wrapper input-border">
                                <input class="after email required" name="email" id="email" title="Email Address" />
                              </div>

                              <div class="wrapper phone input-border  second">
                                  <input class="after required phone" name="phone" id="phone" value="" title="Phone Number" />
                              </div>
                            </div>
                            
                            
                    </div>

                    
                
                </div>
                
                
                <div id="Navigation"> 							
                        <input class="navigation_button" id="next" value="Submit & Get Quotes" type="submit" />
                </div>
                
                
                <div class="guide ps"><div id="pdf-icon"></div><div class="text">Receive a <strong>FREE 6-page</strong> Business VoIP Start Up Guide with submission!</div></div>
                
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="page" />
                <input type="hidden" name="version" value="5-IScope" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}


/**
 * Block Request a quote FOR PAGE v6 -/business-systems-uk - duplicate of v4 ( /business-systems ), but only for UK.
 * 
 */
function gv_blocks_get_requestQuoteForPage_v6() {

  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  
  
  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  //drupal_add_js($path_to_custom_js . 'bbq.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  //drupal_add_js('sites/all/libraries/jquery.plugins/jquery.hint-with-password.js');
  
  
  
//  drupal_add_js('sites/all/libraries/jquery.plugins/ui/jquery.ui.selectmenu.js');
//  drupal_add_css('sites/all/libraries/jquery.plugins/ui/themes/base/jquery.ui.selectmenu.css');
  
  $path_to_custom_js = drupal_get_path('module', 'selectmenu') . '/js/jquery.ui.selectmenu/';
  drupal_add_js($path_to_custom_js . 'jquery.ui.selectmenu.js');
  drupal_add_css($path_to_custom_js . 'jquery.ui.selectmenu.css');
  
  
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  
  drupal_add_js($path_to_custom_js . 'gv_quote_page_field_hints.js');
  
  drupal_add_js($path_to_custom_js . 'gv_requestquote_page_v4.js');
  
  // No slider with provider on V4.

//  drupal_add_js($path_to_custom_js . 'gv_brandsCarousel.js');
//  
//  drupal_add_js('sites/all/libraries/jquery.plugins/jcarousel/jquery.jcarousel.min.js');
//  drupal_add_css('sites/all/libraries/jquery.plugins/jcarousel/skins/tango/skin.css');
  
  
  
  
//  // Exit intent Ad popup block.
//  global $user; 
//  
//  if ($user->uid) {
//    // Colorbox for popup window.
//    //1, 3, 4, 
//    drupal_add_js('sites/all/libraries/jquery.plugins/colorbox/colorbox/jquery.colorbox.js');
//    drupal_add_css('sites/all/libraries/jquery.plugins/colorbox/example1/colorbox.css', array('preprocess' => FALSE)); // array('group' => CSS_THEME, 'preprocess' => FALSE)
//
//    // Exit intent Ad block main js.
//    $path_to_custom_js = drupal_get_path('module', 'gv_misc') . '/js/';
//    drupal_add_js($path_to_custom_js . 'gv_exitIntent_lpV4.js');
//  }
//  
  
  
  
  
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;
  
  
  
//  $exitIntent_block = '
//  <div style="display: none;">
//   <div id="exitIntent"> 
//    <div id="line-1">Do You Want To Save BIG On</div>
//    <div id="line-2">Reliable Business Phone Service?</div>
//    
//    <div id="line-3">Get voice, fax, text and conferencing</div>
//    <div id="line-4">in one phone system for $19/mo.</div>
//    
//    <a href="/business" id="yes" target="_top">YES</a>
//    <div id="no">NO - I like overpaying for my old phone service.</div>
//   </div>
//  </div>
//';
  
  $out = //$exitIntent_block . 
          '
   <h2>Ready To Save?<br/>Get Competing Quotes Now!</h2>
   <div id="requestQuoteFormWrapper">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        <form class="multipartForm bbq" method="post" action="/request">

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="questions_section">

                          <div class="select">
                            <div class="question">Amount of lines needed:</div>
                              <select name="phones_amt" id="phones_amt" class="input required">
                              
                                <option value="1">1 Line</option>
                                <option value="2 - 4">2 - 4 Lines</option>
                                
                                <option selected="selected" value="5 - 10">5 - 10 Lines</option>
                                <option value="11 - 20">11 - 20 Lines</option>
                                <option value="21 - 50">21 - 50 Lines</option>
                                <option value="51 - 99">51 - 99 Lines</option>
                                <option value="More 100+ Lines">More 100+ Lines</option>


                              </select>
                           </div>
           
                           <div class="select last">
                            <div class="question">Show me:</div>
                              <select name="q_type" id="q_type" class="input required">
                                <option value="Both phones and service">Both Phones & Services</option>
                                <option value="Phone system only">Phone System Only</option>
                                <option value="Service provider only">Service Provider Only</option>
                              </select>
                            </div>
                            
                            
                            <div class="bottom-clear"></div>

                            <div class="text-h-group">
                              <div class="wrapper input-border">
                                <input class="after required firstname" name="firstname" id="firstname" title="First Name" />
                              </div>

                              <div class="wrapper input-border second">
                                <input class="after required lastname" name="lastname" id="lastname" title="Last Name" />
                              </div>
                            </div>
                            
                            <div class="text-h-group">
                              <div class="wrapper input-border">
                                <input class="after email required" name="email" id="email" title="Email Address" />
                              </div>

                              <div class="wrapper phone input-border  second">
                                  <input class="after required phone" name="phone" id="phone" value="" title="Phone Number" />
                              </div>
                            </div>' 
                            

//                            . '<div class="text-h-group">
//                              <div class="wrapper input-border">
//                                <input class="after company" name="company" id="company" value="" title="Company Name" />
//                              </div>
//
//                              <div class="wrapper input-border  second">
//                                  <input class="after q-title" name="q-title" id="q-title" value="" title="Title" />
//                              </div>
//                            </div>'
                            
                            .'
                            
                            
                    </div>

                    
                
                </div>
                
                
                <div id="Navigation"> 							
                        <input class="navigation_button" id="next" value="Get My Free Quote" type="submit" />
                </div>
                
                
                <div class="guide ps"><div id="pdf-icon"></div><div class="text">Receive a <strong>FREE 6-page</strong> Business VoIP Start Up Guide with submission!</div></div>
                
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="page" />
                <input type="hidden" name="version" value="6-UK-LP" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}


/**
 * Block Request a quote FOR PAGE v7 - /service-quotes ///lp-7.
 * 
 */
function gv_blocks_get_requestQuoteForPage_v7() {

  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  
  
  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  //drupal_add_js($path_to_custom_js . 'bbq.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  //drupal_add_js('sites/all/libraries/jquery.plugins/jquery.hint-with-password.js');
  
  
  
//  drupal_add_js('sites/all/libraries/jquery.plugins/ui/jquery.ui.selectmenu.js');
//  drupal_add_css('sites/all/libraries/jquery.plugins/ui/themes/base/jquery.ui.selectmenu.css');
  
  $path_to_custom_js = drupal_get_path('module', 'selectmenu') . '/js/jquery.ui.selectmenu/';
  drupal_add_js($path_to_custom_js . 'jquery.ui.selectmenu.js');
  drupal_add_css($path_to_custom_js . 'jquery.ui.selectmenu.css');
  
  
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  
  drupal_add_js($path_to_custom_js . 'gv_quote_page_field_hints.js');
  
  
  drupal_add_js($path_to_custom_js . 'gv_requestquote_page_v7.js');
  
  
  // No slider with provider on V4.

//  drupal_add_js($path_to_custom_js . 'gv_brandsCarousel.js');
//  
//  drupal_add_js('sites/all/libraries/jquery.plugins/jcarousel/jquery.jcarousel.min.js');
//  drupal_add_css('sites/all/libraries/jquery.plugins/jcarousel/skins/tango/skin.css');
  
  
  
  
//  // Exit intent Ad popup block.
//  global $user; 
//  
//  if ($user->uid) {
//    // Colorbox for popup window.
//    //1, 3, 4, 
//    drupal_add_js('sites/all/libraries/jquery.plugins/colorbox/colorbox/jquery.colorbox.js');
//    drupal_add_css('sites/all/libraries/jquery.plugins/colorbox/example1/colorbox.css', array('preprocess' => FALSE)); // array('group' => CSS_THEME, 'preprocess' => FALSE)
//
//    // Exit intent Ad block main js.
//    $path_to_custom_js = drupal_get_path('module', 'gv_misc') . '/js/';
//    drupal_add_js($path_to_custom_js . 'gv_exitIntent_lpV4.js');
//  }
//  
  
  
  
  
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;
  
  
  
//  $exitIntent_block = '
//  <div style="display: none;">
//   <div id="exitIntent"> 
//    <div id="line-1">Do You Want To Save BIG On</div>
//    <div id="line-2">Reliable Business Phone Service?</div>
//    
//    <div id="line-3">Get voice, fax, text and conferencing</div>
//    <div id="line-4">in one phone system for $19/mo.</div>
//    
//    <a href="/business" id="yes" target="_top">YES</a>
//    <div id="no">NO - I like overpaying for my old phone service.</div>
//   </div>
//  </div>
//';
  
  $out = //$exitIntent_block . 
          //'<h3>See How Much You Could Save<span>It only takes a few minutes.</span></h3>'
          //'<h3>See How Much You Could Save</h3>'
          //
          '<h3>How Much Will You Save?</h3>'
          //'<h3>How Much Will I Save?<span>- No contracts or set-up fees -</span></h3>'
   .'<div id="requestQuoteFormWrapper">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        <form class="multipartForm bbq" method="post" action="/request">

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="questions_section">

                          <div class="select">
                            <div class="question">Amount of lines needed:</div>
                              <select name="phones_amt" id="phones_amt" class="input required">
                                <option value="1 - 4">1 - 4 Lines</option>
                                <option selected="selected" value="5 - 10">5 - 10 Lines</option>
                                <option value="11 - 20">11 - 20 Lines</option>
                                <option value="21 - 50">21 - 50 Lines</option>
                                <option value="More than 50">More than 50 Lines</option>
                              </select>
                           </div>
           
                           <div class="select last">
                            <div class="question">Show me:</div>
                              <select name="q_type" id="q_type" class="input required">
                                <option value="Both phones and service">Both Phones & Services</option>
                                <option value="Phone system only">Phone System Only</option>
                                <option value="Service provider only">Service Provider Only</option>
                              </select>
                            </div>
                            
                            
                            <div class="bottom-clear"></div>

                            <div class="text-h-group">
                              <div class="wrapper input-border">
                                <input class="after required firstname" name="firstname" id="firstname" title="First Name" />
                              </div>

                              <div class="wrapper input-border second">
                                <input class="after required lastname" name="lastname" id="lastname" title="Last Name" />
                              </div>
                            </div>
                            
                            <div class="text-h-group">
                              <div class="wrapper input-border">
                                <input class="after email required" name="email" id="email" title="Email Address" />
                              </div>

                              <div class="wrapper phone input-border  second">
                                  <input class="after required phone" name="phone" id="phone" value="" title="Phone Number" />
                              </div>
                            </div>' 
                            

//                            . '<div class="text-h-group">
//                              <div class="wrapper input-border">
//                                <input class="after company" name="company" id="company" value="" title="Company Name" />
//                              </div>
//
//                              <div class="wrapper input-border  second">
//                                  <input class="after q-title" name="q-title" id="q-title" value="" title="Title" />
//                              </div>
//                            </div>'
                            
                            .'
                            
                            
                    </div>

                    
                
                </div>
                
                
                <div id="Navigation"> 							
                        <input class="navigation_button" id="next" value="Compare Your Savings Now!" type="submit" />
                </div>
                
                
                <div class="guide ps"><div id="pdf-icon"></div><div class="text">Receive a <strong>FREE 6-page</strong> Business VoIP Start Up Guide with submission!</div></div>
                
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="page" />
                <input type="hidden" name="version" value="7" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}


/**
 * Block Request a quote FOR PAGE v7_uk at /service-quotes-uk, same as v7 - /service-quotes but only for UK
 * 
 */
function gv_blocks_get_requestQuoteForPage_v7_uk() {

  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  
  
  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  //drupal_add_js($path_to_custom_js . 'bbq.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  //drupal_add_js('sites/all/libraries/jquery.plugins/jquery.hint-with-password.js');
  
  
  
//  drupal_add_js('sites/all/libraries/jquery.plugins/ui/jquery.ui.selectmenu.js');
//  drupal_add_css('sites/all/libraries/jquery.plugins/ui/themes/base/jquery.ui.selectmenu.css');
  
  $path_to_custom_js = drupal_get_path('module', 'selectmenu') . '/js/jquery.ui.selectmenu/';
  drupal_add_js($path_to_custom_js . 'jquery.ui.selectmenu.js');
  drupal_add_css($path_to_custom_js . 'jquery.ui.selectmenu.css');
  
  
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  
  drupal_add_js($path_to_custom_js . 'gv_quote_page_field_hints.js');
  
  
  drupal_add_js($path_to_custom_js . 'gv_requestquote_page_v7.js');
  
  
  // No slider with provider on V4.

//  drupal_add_js($path_to_custom_js . 'gv_brandsCarousel.js');
//  
//  drupal_add_js('sites/all/libraries/jquery.plugins/jcarousel/jquery.jcarousel.min.js');
//  drupal_add_css('sites/all/libraries/jquery.plugins/jcarousel/skins/tango/skin.css');
  
  
  
  
//  // Exit intent Ad popup block.
//  global $user; 
//  
//  if ($user->uid) {
//    // Colorbox for popup window.
//    //1, 3, 4, 
//    drupal_add_js('sites/all/libraries/jquery.plugins/colorbox/colorbox/jquery.colorbox.js');
//    drupal_add_css('sites/all/libraries/jquery.plugins/colorbox/example1/colorbox.css', array('preprocess' => FALSE)); // array('group' => CSS_THEME, 'preprocess' => FALSE)
//
//    // Exit intent Ad block main js.
//    $path_to_custom_js = drupal_get_path('module', 'gv_misc') . '/js/';
//    drupal_add_js($path_to_custom_js . 'gv_exitIntent_lpV4.js');
//  }
//  
  
  
  
  
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;
  
  
  
//  $exitIntent_block = '
//  <div style="display: none;">
//   <div id="exitIntent"> 
//    <div id="line-1">Do You Want To Save BIG On</div>
//    <div id="line-2">Reliable Business Phone Service?</div>
//    
//    <div id="line-3">Get voice, fax, text and conferencing</div>
//    <div id="line-4">in one phone system for $19/mo.</div>
//    
//    <a href="/business" id="yes" target="_top">YES</a>
//    <div id="no">NO - I like overpaying for my old phone service.</div>
//   </div>
//  </div>
//';
  
  $out = //$exitIntent_block . 
          //'<h3>See How Much You Could Save<span>It only takes a few minutes.</span></h3>'
          //'<h3>See How Much You Could Save</h3>'
         '<h3>How Much Will You Save?</h3>'
          //'<h3>How Much Will I Save?<span>- No contracts or set-up fees -</span></h3>'
   . '<div id="requestQuoteFormWrapper">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        <form class="multipartForm bbq" method="post" action="/request">

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="questions_section">

                          <div class="select">
                            <div class="question">Amount of lines needed:</div>
                              <select name="phones_amt" id="phones_amt" class="input required">
                                <option value="1 - 4">1 - 4 Lines</option>
                                <option selected="selected" value="5 - 10">5 - 10 Lines</option>
                                <option value="11 - 20">11 - 20 Lines</option>
                                <option value="21 - 50">21 - 50 Lines</option>
                                <option value="More than 50">More than 50 Lines</option>
                              </select>
                           </div>
           
                           <div class="select last">
                            <div class="question">Show me:</div>
                              <select name="q_type" id="q_type" class="input required">
                                <option value="Both phones and service">Both Phones & Services</option>
                                <option value="Phone system only">Phone System Only</option>
                                <option value="Service provider only">Service Provider Only</option>
                              </select>
                            </div>
                            
                            
                            <div class="bottom-clear"></div>

                            <div class="text-h-group">
                              <div class="wrapper input-border">
                                <input class="after required firstname" name="firstname" id="firstname" title="First Name" />
                              </div>

                              <div class="wrapper input-border second">
                                <input class="after required lastname" name="lastname" id="lastname" title="Last Name" />
                              </div>
                            </div>
                            
                            <div class="text-h-group">
                              <div class="wrapper input-border">
                                <input class="after email required" name="email" id="email" title="Email Address" />
                              </div>

                              <div class="wrapper phone input-border  second">
                                  <input class="after required phone" name="phone" id="phone" value="" title="Phone Number" />
                              </div>
                            </div>' 
                            

//                            . '<div class="text-h-group">
//                              <div class="wrapper input-border">
//                                <input class="after company" name="company" id="company" value="" title="Company Name" />
//                              </div>
//
//                              <div class="wrapper input-border  second">
//                                  <input class="after q-title" name="q-title" id="q-title" value="" title="Title" />
//                              </div>
//                            </div>'
                            
                            .'
                            
                            
                    </div>

                    
                
                </div>
                
                
                <div id="Navigation"> 							
                        <input class="navigation_button" id="next" value="GET MY QUICK QUOTE" type="submit" />
                </div>
                
                
                <div class="guide ps"><div id="pdf-icon"></div><div class="text">Receive a <strong>FREE 6-page</strong> Business VoIP Start Up Guide with submission!</div></div>
                
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="page" />
                <input type="hidden" name="version" value="7_uk" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}



/**
 * Block Request a quote FOR PAGE v7_uk_ppc at /ppc/service-quotes, same as v7_uk - but for ppc.
 * 
 */
function gv_blocks_get_requestQuoteForPage_v7_uk_ppc() {

  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  
  
  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  //drupal_add_js($path_to_custom_js . 'bbq.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  //drupal_add_js('sites/all/libraries/jquery.plugins/jquery.hint-with-password.js');
  
  
  
//  drupal_add_js('sites/all/libraries/jquery.plugins/ui/jquery.ui.selectmenu.js');
//  drupal_add_css('sites/all/libraries/jquery.plugins/ui/themes/base/jquery.ui.selectmenu.css');
  
  $path_to_custom_js = drupal_get_path('module', 'selectmenu') . '/js/jquery.ui.selectmenu/';
  drupal_add_js($path_to_custom_js . 'jquery.ui.selectmenu.js');
  drupal_add_css($path_to_custom_js . 'jquery.ui.selectmenu.css');
  
  
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  
  drupal_add_js($path_to_custom_js . 'gv_quote_page_field_hints.js');
  
  
  drupal_add_js($path_to_custom_js . 'gv_requestquote_page_v7.js');
  
  
  // No slider with provider on V4.

//  drupal_add_js($path_to_custom_js . 'gv_brandsCarousel.js');
//  
//  drupal_add_js('sites/all/libraries/jquery.plugins/jcarousel/jquery.jcarousel.min.js');
//  drupal_add_css('sites/all/libraries/jquery.plugins/jcarousel/skins/tango/skin.css');
  
  
  
  
//  // Exit intent Ad popup block.
//  global $user; 
//  
//  if ($user->uid) {
//    // Colorbox for popup window.
//    //1, 3, 4, 
//    drupal_add_js('sites/all/libraries/jquery.plugins/colorbox/colorbox/jquery.colorbox.js');
//    drupal_add_css('sites/all/libraries/jquery.plugins/colorbox/example1/colorbox.css', array('preprocess' => FALSE)); // array('group' => CSS_THEME, 'preprocess' => FALSE)
//
//    // Exit intent Ad block main js.
//    $path_to_custom_js = drupal_get_path('module', 'gv_misc') . '/js/';
//    drupal_add_js($path_to_custom_js . 'gv_exitIntent_lpV4.js');
//  }
//  
  
  
  
  
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;
  
  
  
//  $exitIntent_block = '
//  <div style="display: none;">
//   <div id="exitIntent"> 
//    <div id="line-1">Do You Want To Save BIG On</div>
//    <div id="line-2">Reliable Business Phone Service?</div>
//    
//    <div id="line-3">Get voice, fax, text and conferencing</div>
//    <div id="line-4">in one phone system for $19/mo.</div>
//    
//    <a href="/business" id="yes" target="_top">YES</a>
//    <div id="no">NO - I like overpaying for my old phone service.</div>
//   </div>
//  </div>
//';
  
  $out = //$exitIntent_block . 
          //'<h3>See How Much You Could Save<span>It only takes a few minutes.</span></h3>'
          //'<h3>See How Much You Could Save</h3>'
         '<h3>How Much Will You Save?</h3>'
          //'<h3>How Much Will I Save?<span>- No contracts or set-up fees -</span></h3>'
   . '<div id="requestQuoteFormWrapper">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        <form class="multipartForm bbq" method="post" action="/request">

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="questions_section">

                          <div class="select">
                            <div class="question">Amount of lines needed:</div>
                              <select name="phones_amt" id="phones_amt" class="input required">
                                <option value="1 - 4">1 - 4 Lines</option>
                                <option selected="selected" value="5 - 10">5 - 10 Lines</option>
                                <option value="11 - 20">11 - 20 Lines</option>
                                <option value="21 - 50">21 - 50 Lines</option>
                                <option value="More than 50">More than 50 Lines</option>
                              </select>
                           </div>
           
                           <div class="select last">
                            <div class="question">Show me:</div>
                              <select name="q_type" id="q_type" class="input required">
                                <option value="Both phones and service">Both Phones & Services</option>
                                <option value="Phone system only">Phone System Only</option>
                                <option value="Service provider only">Service Provider Only</option>
                              </select>
                            </div>
                            
                            
                            <div class="bottom-clear"></div>

                            <div class="text-h-group">
                              <div class="wrapper input-border">
                                <input class="after required firstname" name="firstname" id="firstname" title="First Name" />
                              </div>

                              <div class="wrapper input-border second">
                                <input class="after required lastname" name="lastname" id="lastname" title="Last Name" />
                              </div>
                            </div>
                            
                            <div class="text-h-group">
                              <div class="wrapper input-border">
                                <input class="after email required" name="email" id="email" title="Email Address" />
                              </div>

                              <div class="wrapper phone input-border  second">
                                  <input class="after required phone" name="phone" id="phone" value="" title="Phone Number" />
                              </div>
                            </div>' 
                            

//                            . '<div class="text-h-group">
//                              <div class="wrapper input-border">
//                                <input class="after company" name="company" id="company" value="" title="Company Name" />
//                              </div>
//
//                              <div class="wrapper input-border  second">
//                                  <input class="after q-title" name="q-title" id="q-title" value="" title="Title" />
//                              </div>
//                            </div>'
                            
                            .'
                            
                            
                    </div>

                    
                
                </div>
                
                
                <div id="Navigation"> 							
                        <input class="navigation_button" id="next" value="GET MY QUICK QUOTE" type="submit" />
                </div>
                
                
                <div class="guide ps"><div id="pdf-icon"></div><div class="text">Receive a <strong>FREE 6-page</strong> Business VoIP Start Up Guide with submission!</div></div>
                
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="page" />
                <input type="hidden" name="version" value="7_uk_ppc" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}

/**
 * Block Request a quote FOR PAGE v7_ca at /service-quotes-ca, same as v7 - /service-quotes but only for CA
 * 
 */
function gv_blocks_get_requestQuoteForPage_v7_ca() {

  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  
  
  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  //drupal_add_js($path_to_custom_js . 'bbq.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  //drupal_add_js('sites/all/libraries/jquery.plugins/jquery.hint-with-password.js');
  
  
  
//  drupal_add_js('sites/all/libraries/jquery.plugins/ui/jquery.ui.selectmenu.js');
//  drupal_add_css('sites/all/libraries/jquery.plugins/ui/themes/base/jquery.ui.selectmenu.css');
  
  $path_to_custom_js = drupal_get_path('module', 'selectmenu') . '/js/jquery.ui.selectmenu/';
  drupal_add_js($path_to_custom_js . 'jquery.ui.selectmenu.js');
  drupal_add_css($path_to_custom_js . 'jquery.ui.selectmenu.css');
  
  
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  
  drupal_add_js($path_to_custom_js . 'gv_quote_page_field_hints.js');
  
  
  drupal_add_js($path_to_custom_js . 'gv_requestquote_page_v7.js');
  
  
  // No slider with provider on V4.

//  drupal_add_js($path_to_custom_js . 'gv_brandsCarousel.js');
//  
//  drupal_add_js('sites/all/libraries/jquery.plugins/jcarousel/jquery.jcarousel.min.js');
//  drupal_add_css('sites/all/libraries/jquery.plugins/jcarousel/skins/tango/skin.css');
  
  
  
  
//  // Exit intent Ad popup block.
//  global $user; 
//  
//  if ($user->uid) {
//    // Colorbox for popup window.
//    //1, 3, 4, 
//    drupal_add_js('sites/all/libraries/jquery.plugins/colorbox/colorbox/jquery.colorbox.js');
//    drupal_add_css('sites/all/libraries/jquery.plugins/colorbox/example1/colorbox.css', array('preprocess' => FALSE)); // array('group' => CSS_THEME, 'preprocess' => FALSE)
//
//    // Exit intent Ad block main js.
//    $path_to_custom_js = drupal_get_path('module', 'gv_misc') . '/js/';
//    drupal_add_js($path_to_custom_js . 'gv_exitIntent_lpV4.js');
//  }
//  
  
  
  
  
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;
  
  
  
//  $exitIntent_block = '
//  <div style="display: none;">
//   <div id="exitIntent"> 
//    <div id="line-1">Do You Want To Save BIG On</div>
//    <div id="line-2">Reliable Business Phone Service?</div>
//    
//    <div id="line-3">Get voice, fax, text and conferencing</div>
//    <div id="line-4">in one phone system for $19/mo.</div>
//    
//    <a href="/business" id="yes" target="_top">YES</a>
//    <div id="no">NO - I like overpaying for my old phone service.</div>
//   </div>
//  </div>
//';
  
  $out = //$exitIntent_block . 
          //'<h3>See How Much You Could Save<span>It only takes a few minutes.</span></h3>'
          //'<h3>See How Much You Could Save</h3>'
          '<h3>How Much Will You Save?</h3>'
          //'<h3>How Much Will I Save?<span>- No contracts or set-up fees -</span></h3>'
   . '<div id="requestQuoteFormWrapper">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        <form class="multipartForm bbq" method="post" action="/request">

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="questions_section">

                          <div class="select">
                            <div class="question">Amount of lines needed:</div>
                              <select name="phones_amt" id="phones_amt" class="input required">
                                <option value="1 - 4">1 - 4 Lines</option>
                                <option selected="selected" value="5 - 10">5 - 10 Lines</option>
                                <option value="11 - 20">11 - 20 Lines</option>
                                <option value="21 - 50">21 - 50 Lines</option>
                                <option value="More than 50">More than 50 Lines</option>
                              </select>
                           </div>
           
                           <div class="select last">
                            <div class="question">Show me:</div>
                              <select name="q_type" id="q_type" class="input required">
                                <option value="Both phones and service">Both Phones & Services</option>
                                <option value="Phone system only">Phone System Only</option>
                                <option value="Service provider only">Service Provider Only</option>
                              </select>
                            </div>
                            
                            
                            <div class="bottom-clear"></div>

                            <div class="text-h-group">
                              <div class="wrapper input-border">
                                <input class="after required firstname" name="firstname" id="firstname" title="First Name" />
                              </div>

                              <div class="wrapper input-border second">
                                <input class="after required lastname" name="lastname" id="lastname" title="Last Name" />
                              </div>
                            </div>
                            
                            <div class="text-h-group">
                              <div class="wrapper input-border">
                                <input class="after email required" name="email" id="email" title="Email Address" />
                              </div>

                              <div class="wrapper phone input-border  second">
                                  <input class="after required phone" name="phone" id="phone" value="" title="Phone Number" />
                              </div>
                            </div>' 
                            

//                            . '<div class="text-h-group">
//                              <div class="wrapper input-border">
//                                <input class="after company" name="company" id="company" value="" title="Company Name" />
//                              </div>
//
//                              <div class="wrapper input-border  second">
//                                  <input class="after q-title" name="q-title" id="q-title" value="" title="Title" />
//                              </div>
//                            </div>'
                            
                            .'
                            
                            
                    </div>

                    
                
                </div>
                
                
                <div id="Navigation"> 							
                        <input class="navigation_button" id="next" value="GET MY QUICK QUOTE" type="submit" />
                </div>
                
                
                <div class="guide ps"><div id="pdf-icon"></div><div class="text">Receive a <strong>FREE 6-page</strong> Business VoIP Start Up Guide with submission!</div></div>
                
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="page" />
                <input type="hidden" name="version" value="7_ca" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}


/**
 * Block Request a quote with a multistep form FOR lpv8,  Based on PAGE v1 - /request-voip-phone-system-quote.
 */
function gv_blocks_get_requestQuoteForPage_v8() {

  drupal_add_library('system', 'ui.widget');

  //drupal_add_library('system', 'effects.bounce');
  
  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  //drupal_add_js($path_to_custom_js . 'bbq.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  
  
  //drupal_add_js('sites/all/libraries/jquery.plugins/ui/jquery.ui.selectmenu.js');
  //drupal_add_css('sites/all/libraries/jquery.plugins/ui/themes/base/jquery.ui.selectmenu.css');
  
  $path_to_custom_js = drupal_get_path('module', 'selectmenu') . '/js/jquery.ui.selectmenu/';
  drupal_add_js($path_to_custom_js . 'jquery.ui.selectmenu.js');
  drupal_add_css($path_to_custom_js . 'jquery.ui.selectmenu.css');
  
  
  
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  drupal_add_js($path_to_custom_js . 'gv_quote_page_field_hints.js');
  
  drupal_add_js($path_to_custom_js . 'gv_requestquote_page_v8.js');
  
  
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;
  
  $out = '
   <div id="requestQuoteFormWrapper" class="hidden">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        <form class="multipartForm bbq" method="post" action="/request" style="height: 300px; overflow: hidden;">

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="phones_amt_section">
                        


                       <div class="text-h-group">

                         <div class="field-group left">

                            <div class="question">How many phones do you need?</div>
                              <select name="phones_amt" id="phones_amt" class="input required">
                                <!--<option value="">- Select a value -</option>-->
                                <option value="1 - 4">1 - 4</option>
                                <option value="5 - 10">5 - 10</option>
                                <option selected="selected" value="11 - 20">11 - 20</option>
                                <option value="21 - 50">21 - 50</option>
                                <option value="More than 50">More than 50</option>
                              </select>
                            
                           </div>
                           
                           <div class="field-group right">
                            
                             <div class="question">What are your current phone needs?</div>
                              <select name="q_for" id="q_for" class="input required">
                                <!--<option value="">- Select a value -</option>-->
                                <option value="Replace current phone system">Replace current phone system</option>
                                <option value="Need a phone system for a new office">Need a phone system for a new office</option>
                                <option value="Expand on our current phone system">Expand on our current phone system</option>
                              </select>
                              
                            </div>
                              
                         </div>
                         


                        <div class="text-h-group">
                         
                          <div class="field-group left">
                          
                             <div class="question">What type of quote do you need?</div>
                              <select name="q_type" id="q_type" class="input required">
                                <!--<option value="">- Select a value -</option>-->
                                <option value="Both phones and service">Both phones and service</option>
                                <option value="Phone system only">Phone system only</option>
                                <option value="Service provider only">Service provider only</option>
                              </select>
                              
                           </div>
                           

                           <div class="field-group right">

                             <div class="question">What is your buying time frame?</div>
                              <select name="buying_time" id="buying_time" class="input required">
                                <!--<option value="">- Select a value -</option>-->
                                <option value="ASAP">ASAP</option>
                                <option value="1-3 Months">1-3 Months</option>
                                <option value="3-6 Months">3-6 Months</option>
                              </select>
                              
                            </div>
                              
                          </div>
                            
                          
                          <!--<div class="step-notice">' . t('Step <span class="f">!first</span>of<span class="s">!second</span>', array('!first' => 1, '!second' => 2)) . '</div> -->
                            
                    </div>
                    
                    <div class="step" id="personal_info">
                        
                            
                            <div class="text-h-group">
                              <div class="wrapper input-border">
                                <input class="after required firstname" name="firstname" id="firstname" title="First Name" />
                              </div>

                              <div class="wrapper input-border second">
                                <input class="after required lastname" name="lastname" id="lastname" title="Last Name" />
                              </div>
                            </div>
                            
                            <div class="text-h-group">
                              <div class="wrapper input-border">
                                <input class="after email required" name="email" id="email" title="Email Address" />
                              </div>

                              <div class="wrapper phone input-border  second">
                                  <input class="after required phone" name="phone" id="phone" value="" title="Phone Number" />
                              </div>
                            </div>
                            

                         
                           <!--<div class="step-notice">' . t('Step <span class="f">!first</span>of<span class="s">!second</span>', array('!first' => 2, '!second' => 2)) . '</div>-->
                           <div class="protected"></div>
                    </div>
                    
                </div>
            
                <div id="Navigation"> 							
                        <input class="navigation_button" id="back" value="Back" type="reset" />
                        <input class="navigation_button" id="next" value="Let\'s Get Started" type="submit" />
                        <div class="guide ps"><div id="pdf-icon"></div><div class="text">Receive a <strong>FREE 6-page</strong> Business VoIP Start Up Guide with submission!</div></div>
                   
                </div>
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="page" />
                <input type="hidden" name="version" value="8" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}



/**
 * Block Request a quote with a multistep form FOR lpv8-uk,  Based on PAGE v1 - /request-voip-phone-system-quote.
 */
function gv_blocks_get_requestQuoteForPage_v8_uk() {

  drupal_add_library('system', 'ui.widget');

  //drupal_add_library('system', 'effects.bounce');
  
  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  //drupal_add_js($path_to_custom_js . 'bbq.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  
  
  //drupal_add_js('sites/all/libraries/jquery.plugins/ui/jquery.ui.selectmenu.js');
  //drupal_add_css('sites/all/libraries/jquery.plugins/ui/themes/base/jquery.ui.selectmenu.css');
  
  $path_to_custom_js = drupal_get_path('module', 'selectmenu') . '/js/jquery.ui.selectmenu/';
  drupal_add_js($path_to_custom_js . 'jquery.ui.selectmenu.js');
  drupal_add_css($path_to_custom_js . 'jquery.ui.selectmenu.css');
  
  
  
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  drupal_add_js($path_to_custom_js . 'gv_quote_page_field_hints.js');
  
  drupal_add_js($path_to_custom_js . 'gv_requestquote_page_v8.js');
  
  
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;
  
  $out = '
   <div id="requestQuoteFormWrapper" class="hidden">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        <form class="multipartForm bbq" method="post" action="/request" style="height: 300px; overflow: hidden;">

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="phones_amt_section">
                        


                       <div class="text-h-group">

                         <div class="field-group left">

                            <div class="question">How many phones do you need?</div>
                              <select name="phones_amt" id="phones_amt" class="input required">
                                <!--<option value="">- Select a value -</option>-->
                                <option value="1 - 4">1 - 4</option>
                                <option value="5 - 10">5 - 10</option>
                                <option selected="selected" value="11 - 20">11 - 20</option>
                                <option value="21 - 50">21 - 50</option>
                                <option value="More than 50">More than 50</option>
                              </select>
                            
                           </div>
                           
                           <div class="field-group right">
                            
                             <div class="question">What are your current phone needs?</div>
                              <select name="q_for" id="q_for" class="input required">
                                <!--<option value="">- Select a value -</option>-->
                                <option value="Replace current phone system">Replace current phone system</option>
                                <option value="Need a phone system for a new office">Need a phone system for a new office</option>
                                <option value="Expand on our current phone system">Expand on our current phone system</option>
                              </select>
                              
                            </div>
                              
                         </div>
                         


                        <div class="text-h-group">
                         
                          <div class="field-group left">
                          
                             <div class="question">What type of quote do you need?</div>
                              <select name="q_type" id="q_type" class="input required">
                                <!--<option value="">- Select a value -</option>-->
                                <option value="Both phones and service">Both phones and service</option>
                                <option value="Phone system only">Phone system only</option>
                                <option value="Service provider only">Service provider only</option>
                              </select>
                              
                           </div>
                           

                           <div class="field-group right">

                             <div class="question">What is your buying time frame?</div>
                              <select name="buying_time" id="buying_time" class="input required">
                                <!--<option value="">- Select a value -</option>-->
                                <option value="ASAP">ASAP</option>
                                <option value="1-3 Months">1-3 Months</option>
                                <option value="3-6 Months">3-6 Months</option>
                              </select>
                              
                            </div>
                              
                          </div>
                            
                          
                          <!--<div class="step-notice">' . t('Step <span class="f">!first</span>of<span class="s">!second</span>', array('!first' => 1, '!second' => 2)) . '</div> -->
                            
                    </div>
                    
                    <div class="step" id="personal_info">
                        
                            
                            <div class="text-h-group">
                              <div class="wrapper input-border">
                                <input class="after required firstname" name="firstname" id="firstname" title="First Name" />
                              </div>

                              <div class="wrapper input-border second">
                                <input class="after required lastname" name="lastname" id="lastname" title="Last Name" />
                              </div>
                            </div>
                            
                            <div class="text-h-group">
                              <div class="wrapper input-border">
                                <input class="after email required" name="email" id="email" title="Email Address" />
                              </div>

                              <div class="wrapper phone input-border  second">
                                  <input class="after required phone" name="phone" id="phone" value="" title="Phone Number" />
                              </div>
                            </div>
                            
                            <div class="text-h-group">
                              <div class="wrapper input-border">
                                <input class="after company" name="company" id="company" title="Company Name" />
                              </div>
                            </div>
                         
                           <!--<div class="step-notice">' . t('Step <span class="f">!first</span>of<span class="s">!second</span>', array('!first' => 2, '!second' => 2)) . '</div>-->
                           <div class="protected"></div>
                    </div>
                    
                </div>
            
                <div id="Navigation"> 							
                        <input class="navigation_button" id="back" value="Back" type="reset" />
                        <input class="navigation_button" id="next" value="Let\'s Get Started" type="submit" />
                        <div class="guide ps"><div id="pdf-icon"></div><div class="text">Receive a <strong>FREE 6-page</strong> Business VoIP Start Up Guide with submission!</div></div>
                   
                </div>
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="page" />
                <input type="hidden" name="version" value="8_uk" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}


/**
 * Block Request a quote with a multistep form FOR lpv8-ca.
 */
function gv_blocks_get_requestQuoteForPage_v8_ca() {

  drupal_add_library('system', 'ui.widget');

  //drupal_add_library('system', 'effects.bounce');
  
  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  //drupal_add_js($path_to_custom_js . 'bbq.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  
  
  //drupal_add_js('sites/all/libraries/jquery.plugins/ui/jquery.ui.selectmenu.js');
  //drupal_add_css('sites/all/libraries/jquery.plugins/ui/themes/base/jquery.ui.selectmenu.css');
  
  $path_to_custom_js = drupal_get_path('module', 'selectmenu') . '/js/jquery.ui.selectmenu/';
  drupal_add_js($path_to_custom_js . 'jquery.ui.selectmenu.js');
  drupal_add_css($path_to_custom_js . 'jquery.ui.selectmenu.css');
  
  
  
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  drupal_add_js($path_to_custom_js . 'gv_quote_page_field_hints.js');
  
  drupal_add_js($path_to_custom_js . 'gv_requestquote_page_v8.js');
  
  
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;
  
  $out = '
   <div id="requestQuoteFormWrapper" class="hidden">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        <form class="multipartForm bbq" method="post" action="/request" style="height: 300px; overflow: hidden;">

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="phones_amt_section">
                        


                       <div class="text-h-group">

                         <div class="field-group left">

                            <div class="question">How many phones do you need?</div>
                              <select name="phones_amt" id="phones_amt" class="input required">
                                <!--<option value="">- Select a value -</option>-->
                                <option value="1 - 4">1 - 4</option>
                                <option value="5 - 10">5 - 10</option>
                                <option selected="selected" value="11 - 20">11 - 20</option>
                                <option value="21 - 50">21 - 50</option>
                                <option value="More than 50">More than 50</option>
                              </select>
                            
                           </div>
                           
                           <div class="field-group right">
                            
                             <div class="question">What are your current phone needs?</div>
                              <select name="q_for" id="q_for" class="input required">
                                <!--<option value="">- Select a value -</option>-->
                                <option value="Replace current phone system">Replace current phone system</option>
                                <option value="Need a phone system for a new office">Need a phone system for a new office</option>
                                <option value="Expand on our current phone system">Expand on our current phone system</option>
                              </select>
                              
                            </div>
                              
                         </div>
                         


                        <div class="text-h-group">
                         
                          <div class="field-group left">
                          
                             <div class="question">What type of quote do you need?</div>
                              <select name="q_type" id="q_type" class="input required">
                                <!--<option value="">- Select a value -</option>-->
                                <option value="Both phones and service">Both phones and service</option>
                                <option value="Phone system only">Phone system only</option>
                                <option value="Service provider only">Service provider only</option>
                              </select>
                              
                           </div>
                           

                           <div class="field-group right">

                             <div class="question">What is your buying time frame?</div>
                              <select name="buying_time" id="buying_time" class="input required">
                                <!--<option value="">- Select a value -</option>-->
                                <option value="ASAP">ASAP</option>
                                <option value="1-3 Months">1-3 Months</option>
                                <option value="3-6 Months">3-6 Months</option>
                              </select>
                              
                            </div>
                              
                          </div>
                            
                          
                          <!--<div class="step-notice">' . t('Step <span class="f">!first</span>of<span class="s">!second</span>', array('!first' => 1, '!second' => 2)) . '</div> -->
                            
                    </div>
                    
                    <div class="step" id="personal_info">
                        
                            
                            <div class="text-h-group">
                              <div class="wrapper input-border">
                                <input class="after required firstname" name="firstname" id="firstname" title="First Name" />
                              </div>

                              <div class="wrapper input-border second">
                                <input class="after required lastname" name="lastname" id="lastname" title="Last Name" />
                              </div>
                            </div>
                            
                            <div class="text-h-group">
                              <div class="wrapper input-border">
                                <input class="after email required" name="email" id="email" title="Email Address" />
                              </div>

                              <div class="wrapper phone input-border  second">
                                  <input class="after required phone" name="phone" id="phone" value="" title="Phone Number" />
                              </div>
                            </div>
                            
                            <div class="text-h-group">
                              <div class="wrapper input-border">
                                <input class="after company" name="company" id="company" title="Company Name" />
                              </div>
                            </div>
                         
                           <!--<div class="step-notice">' . t('Step <span class="f">!first</span>of<span class="s">!second</span>', array('!first' => 2, '!second' => 2)) . '</div>-->
                           <div class="protected"></div>
                    </div>
                    
                </div>
            
                <div id="Navigation"> 							
                        <input class="navigation_button" id="back" value="Back" type="reset" />
                        <input class="navigation_button" id="next" value="Let\'s Get Started" type="submit" />
                        <div class="guide ps"><div id="pdf-icon"></div><div class="text">Receive a <strong>FREE 6-page</strong> Business VoIP Start Up Guide with submission!</div></div>
                   
                </div>
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="page" />
                <input type="hidden" name="version" value="8_ca" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}



/**
 * Block Request a quote with a multistep form FOR lpv9,  Based on lp8, but 1 step
 */
function gv_blocks_get_requestQuoteForPage_v9() {

  drupal_add_library('system', 'ui.widget');

  //drupal_add_library('system', 'effects.bounce');
  
  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  //drupal_add_js($path_to_custom_js . 'bbq.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  
  
  //drupal_add_js('sites/all/libraries/jquery.plugins/ui/jquery.ui.selectmenu.js');
  //drupal_add_css('sites/all/libraries/jquery.plugins/ui/themes/base/jquery.ui.selectmenu.css');
  
  $path_to_custom_js = drupal_get_path('module', 'selectmenu') . '/js/jquery.ui.selectmenu/';
  drupal_add_js($path_to_custom_js . 'jquery.ui.selectmenu.js');
  drupal_add_css($path_to_custom_js . 'jquery.ui.selectmenu.css');
  
  
  
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  drupal_add_js($path_to_custom_js . 'gv_quote_page_field_hints.js');
  
  drupal_add_js($path_to_custom_js . 'gv_requestquote_page_v9.js');
  
  
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;
  // class="hidden"
  $out = //$exitIntent_block . 
          '
   <div id="requestQuoteFormWrapper">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        <form class="multipartForm bbq" method="post" action="/request">

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="questions_section">

                          <div class="select">

                           <div class="question">How many phones do you need?</div>
                              <select name="phones_amt" id="phones_amt" class="input required">
                                <!--<option value="">- Select a value -</option>-->
                                <option value="1 - 4">1 - 4</option>
                                <option selected="selected" value="5 - 10">5 - 10</option>
                                <option value="11 - 20">11 - 20</option>
                                <option value="21 - 50">21 - 50</option>
                                <option value="More than 50">More than 50</option>
                              </select>
                           </div>
                           
                           
                           <div class="select last">
                            <div class="question">Show me quotes for:</div>
                              <select name="q_type" id="q_type" class="input required">
                                <option value="Both phones and service">Both Phones & Services</option>
                                <option value="Phone system only">Phone System Only</option>
                                <option value="Service provider only">Service Provider Only</option>
                              </select>
                            </div>
                            
                            
                            <div class="bottom-clear"></div>

                            <div class="text-h-group">
                              <div class="wrapper input-border">
                                <input class="after required firstname" name="firstname" id="firstname" title="First Name" />
                              </div>

                              <div class="wrapper input-border second">
                                <input class="after required lastname" name="lastname" id="lastname" title="Last Name" />
                              </div>
                            </div>
                            
                            <div class="text-h-group">
                              <div class="wrapper input-border">
                                <input class="after email required" name="email" id="email" title="Email Address" />
                              </div>

                              <div class="wrapper phone input-border  second">
                                  <input class="after required phone" name="phone" id="phone" value="" title="Phone Number" />
                              </div>
                            </div>' 
                            

//                            . '<div class="text-h-group">
//                              <div class="wrapper input-border">
//                                <input class="after company" name="company" id="company" value="" title="Company Name" />
//                              </div>
//
//                              <div class="wrapper input-border  second">
//                                  <input class="after q-title" name="q-title" id="q-title" value="" title="Title" />
//                              </div>
//                            </div>'
                            
                            .'
                            
                            
                    </div>

                    
                
                </div>
                
                
                <div id="Navigation"> 							
                        <input class="navigation_button" id="next" value="Get My Free Quote" type="submit" />
                </div>
                
                
                <div class="guide ps"><div id="pdf-icon"></div><div class="text">Receive a <strong>FREE 6-page</strong> Business VoIP Start Up Guide with submission!</div></div>
                
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="page" />
                <input type="hidden" name="version" value="9" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}


/**
 * Block Request a quote with a multistep form FOR lpv9-ca,  Based on lp8, but 1 step
 */
function gv_blocks_get_requestQuoteForPage_v9_ca() {

  drupal_add_library('system', 'ui.widget');

  //drupal_add_library('system', 'effects.bounce');
  
  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  //drupal_add_js($path_to_custom_js . 'bbq.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  
  
  //drupal_add_js('sites/all/libraries/jquery.plugins/ui/jquery.ui.selectmenu.js');
  //drupal_add_css('sites/all/libraries/jquery.plugins/ui/themes/base/jquery.ui.selectmenu.css');
  
  $path_to_custom_js = drupal_get_path('module', 'selectmenu') . '/js/jquery.ui.selectmenu/';
  drupal_add_js($path_to_custom_js . 'jquery.ui.selectmenu.js');
  drupal_add_css($path_to_custom_js . 'jquery.ui.selectmenu.css');
  
  
  
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  drupal_add_js($path_to_custom_js . 'gv_quote_page_field_hints.js');
  
  drupal_add_js($path_to_custom_js . 'gv_requestquote_page_v9.js');
  
  
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;
  // class="hidden"
  $out = //$exitIntent_block . 
          '
   <div id="requestQuoteFormWrapper">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        <form class="multipartForm bbq" method="post" action="/request">

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="questions_section">

                          <div class="select">

                           <div class="question">How many phones do you need?</div>
                              <select name="phones_amt" id="phones_amt" class="input required">
                                <!--<option value="">- Select a value -</option>-->
                                <option value="1 - 4">1 - 4</option>
                                <option selected="selected" value="5 - 10">5 - 10</option>
                                <option value="11 - 20">11 - 20</option>
                                <option value="21 - 50">21 - 50</option>
                                <option value="More than 50">More than 50</option>
                              </select>
                           </div>
                           
                           
                           <div class="select last">
                            <div class="question">Show me quotes for:</div>
                              <select name="q_type" id="q_type" class="input required">
                                <option value="Both phones and service">Both Phones & Services</option>
                                <option value="Phone system only">Phone System Only</option>
                                <option value="Service provider only">Service Provider Only</option>
                              </select>
                            </div>
                            
                            
                            <div class="bottom-clear"></div>

                            <div class="text-h-group">
                              <div class="wrapper input-border">
                                <input class="after required firstname" name="firstname" id="firstname" title="First Name" />
                              </div>

                              <div class="wrapper input-border second">
                                <input class="after required lastname" name="lastname" id="lastname" title="Last Name" />
                              </div>
                            </div>
                            
                            <div class="text-h-group">
                              <div class="wrapper input-border">
                                <input class="after email required" name="email" id="email" title="Email Address" />
                              </div>

                              <div class="wrapper phone input-border  second">
                                  <input class="after required phone" name="phone" id="phone" value="" title="Phone Number" />
                              </div>
                            </div>' 
                            

//                            . '<div class="text-h-group">
//                              <div class="wrapper input-border">
//                                <input class="after company" name="company" id="company" value="" title="Company Name" />
//                              </div>
//
//                              <div class="wrapper input-border  second">
//                                  <input class="after q-title" name="q-title" id="q-title" value="" title="Title" />
//                              </div>
//                            </div>'
                            
                            .'
                            
                            
                    </div>

                    
                
                </div>
                
                
                <div id="Navigation"> 							
                        <input class="navigation_button" id="next" value="Get My Free Quote" type="submit" />
                </div>
                
                
                <div class="guide ps"><div id="pdf-icon"></div><div class="text">Receive a <strong>FREE 6-page</strong> Business VoIP Start Up Guide with submission!</div></div>
                
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="page" />
                <input type="hidden" name="version" value="9_ca" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}



/**
 * Block Request a quote with a multistep form FOR lpv9-uk,  Based on lp8, but 1 step
 */
function gv_blocks_get_requestQuoteForPage_v9_uk() {

  drupal_add_library('system', 'ui.widget');

  //drupal_add_library('system', 'effects.bounce');
  
  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  //drupal_add_js($path_to_custom_js . 'bbq.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  
  
  //drupal_add_js('sites/all/libraries/jquery.plugins/ui/jquery.ui.selectmenu.js');
  //drupal_add_css('sites/all/libraries/jquery.plugins/ui/themes/base/jquery.ui.selectmenu.css');
  
  $path_to_custom_js = drupal_get_path('module', 'selectmenu') . '/js/jquery.ui.selectmenu/';
  drupal_add_js($path_to_custom_js . 'jquery.ui.selectmenu.js');
  drupal_add_css($path_to_custom_js . 'jquery.ui.selectmenu.css');
  
  
  
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  drupal_add_js($path_to_custom_js . 'gv_quote_page_field_hints.js');
  
  drupal_add_js($path_to_custom_js . 'gv_requestquote_page_v9.js');
  
  
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;
  // class="hidden"
  $out = //$exitIntent_block . 
          '
   <div id="requestQuoteFormWrapper">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        <form class="multipartForm bbq" method="post" action="/request">

                
                <div id="fieldWrapper">
                    
                    <div class="step" id="questions_section">

                          <div class="select">

                           <div class="question">How many phones do you need?</div>
                              <select name="phones_amt" id="phones_amt" class="input required">
                                <!--<option value="">- Select a value -</option>-->
                                <option value="1 - 4">1 - 4</option>
                                <option selected="selected" value="5 - 10">5 - 10</option>
                                <option value="11 - 20">11 - 20</option>
                                <option value="21 - 50">21 - 50</option>
                                <option value="More than 50">More than 50</option>
                              </select>
                           </div>
                           
                           
                           <div class="select last">
                            <div class="question">Show me quotes for:</div>
                              <select name="q_type" id="q_type" class="input required">
                                <option value="Both phones and service">Both Phones & Services</option>
                                <option value="Phone system only">Phone System Only</option>
                                <option value="Service provider only">Service Provider Only</option>
                              </select>
                            </div>
                            
                            
                            <div class="bottom-clear"></div>

                            <div class="text-h-group">
                              <div class="wrapper input-border">
                                <input class="after required firstname" name="firstname" id="firstname" title="First Name" />
                              </div>

                              <div class="wrapper input-border second">
                                <input class="after required lastname" name="lastname" id="lastname" title="Last Name" />
                              </div>
                            </div>
                            
                            <div class="text-h-group">
                              <div class="wrapper input-border">
                                <input class="after email required" name="email" id="email" title="Email Address" />
                              </div>

                              <div class="wrapper phone input-border  second">
                                  <input class="after required phone" name="phone" id="phone" value="" title="Phone Number" />
                              </div>
                            </div>' 
                            

//                            . '<div class="text-h-group">
//                              <div class="wrapper input-border">
//                                <input class="after company" name="company" id="company" value="" title="Company Name" />
//                              </div>
//
//                              <div class="wrapper input-border  second">
//                                  <input class="after q-title" name="q-title" id="q-title" value="" title="Title" />
//                              </div>
//                            </div>'
                            
                            .'
                            
                            
                    </div>

                    
                
                </div>
                
                
                <div id="Navigation"> 							
                        <input class="navigation_button" id="next" value="Get My Free Quote" type="submit" />
                </div>
                
                
                <div class="guide ps"><div id="pdf-icon"></div><div class="text">Receive a <strong>FREE 6-page</strong> Business VoIP Start Up Guide with submission!</div></div>
                
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="page" />
                <input type="hidden" name="version" value="9_uk" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
  ';
  
  return $out;
}





/**
 * Block Request a quote FOR PAGE v10 - /lpv10
 * 
 */
function gv_blocks_get_requestQuoteForPage_v10() {

  global $user;
  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  
  
  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  //drupal_add_js($path_to_custom_js . 'bbq.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  
  $path_to_custom_js = drupal_get_path('module', 'selectmenu') . '/js/jquery.ui.selectmenu/';
  drupal_add_js($path_to_custom_js . 'jquery.ui.selectmenu.js');
  drupal_add_css($path_to_custom_js . 'jquery.ui.selectmenu.css');
  
  
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  
  drupal_add_js($path_to_custom_js . 'gv_quote_page_field_hints.js');
  
  
  drupal_add_js($path_to_custom_js . 'gv_requestquote_page_v10.js');
  
  
  
  //drupal_add_js('sites/all/libraries/jquery.plugins/jquery.inputmask/dist/inputmask/jquery.inputmask.min.js');
  //drupal_add_js('sites/all/libraries/jquery.plugins/jquery.inputmask/dist/inputmask/jquery.inputmask.phone.extensions.js');
  //drupal_add_js('sites/all/libraries/jquery.plugins/jquery.inputmask/_real/jquery.inputmask.min.js');
  drupal_add_js('sites/all/libraries/jquery.plugins/jquery.inputmask/_v1/jquery.inputmask.js');
  
  
  
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;
  
  
  $out = 
   '<div class="form-main">
      <div class="title-first">
        <h1>Simplify your Business VoIP buying process by letting us do the work for you.</h1>
        <h2>Answer a few questions and we\'ll find the best business phone solution for your specific needs.</h2>
      </div>
      <div class="title-loading">
        <h1>Searching our database of providers...</h1>
        <div class="loading-gif"></div>
      </div>
      <div class="title-second" style="display: none;">
        <h1>We have found <span class="result"><span class="number">3</span></span> VoIP companies matching your requirements!</h1>
        <h2>Where do we send the details for your <span class="number2">4</span> matches?</h2>
      </div>

          
      <div id="requestQuoteFormWrapper" class="hidden form">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        <form class="multipartForm bbq" method="post" action="/request" style="background: none; border: none;">

                    
                    <div class="step one radio-filled" id="phones_amt_section">
                        

                                  <div class="wrap">
                                  
                                              <div class="fieldset choices service-type first">

                                                          <p class="question">How can we help you?</p>

                                                          <div class="wrap">

                                                                          <div class="choice phone-only first">
                                                                            <div class="icon-replace"></div>
                                                                            <label for="replace">Replace current system</label>
                                                                            <input type="radio" class="radio" name="q_for" id="replace" value="Replace current phone system">
                                                                          </div>

                                                                          <div class="choice both checked">
                                                                            <div class="icon-new"></div>
                                                                            <label for="new"><span>Find</span> new system &amp; service</label>
                                                                            <input type="radio" class="radio" name="q_for" id="new" value="Need a phone system for a new office" checked="checked">
                                                                          </div>

                                                                          <div class="choice service-only">
                                                                            <div class="icon-expand"></div>
                                                                            <label for="expand-only">Expand current system</label>
                                                                            <input type="radio" class="radio" name="q_for" id="expand-only" value="Expand on our current phone system">
                                                                          </div>

                                                          </div>
                                                          
                                                          <div class="clearfix-dk"></div>

                                              </div>
                                    
                                    
                                              

                                              <div class="fieldset button-field next">
                                                <div class="wrap">
                                                  <div class="button next">
                                                    <p>Let\'s Get Started <span class="icon-angle-double-right"></span></p>
                                                  </div>
                                                </div>
                                              </div>
          
                                  </div>                      



                               
                    </div>
                    
                    <div class="step two" id="quesions">
                        
                            <div class="wrap">
                                              <div class="fieldset choices people first">
                                                <p class="question">
                                                  How many people will be using your phone system?
                                                  <span class="error-warn">Please Select</span>
                                                </p>
                                                <div class="wrap">
                                                  <div class="choice first"><label for="1-4">1<span> </span>-<span> </span>4</label><input type="radio" class="radio" name="phones_amt" value="1 - 4" id="1-4"></div>
                                                  <div class="choice second"><label for="5-10">5<span> </span>-<span> </span>10</label><input type="radio" class="radio" name="phones_amt" value="5 - 10" id="5-10"></div>
                                                  <div class="choice third"><label for="11-20">11<span> </span>-<span> </span>20</label><input type="radio" class="radio" name="phones_amt" value="11 - 20" id="11-20"></div>
                                                  <div class="choice fourth"><label for="21-49">21<span> </span>-<span> </span>49</label><input type="radio" class="radio" name="phones_amt" value="21 - 49" id="21-49"></div>
                                                  <div class="choice fifth"><label for="50">50 +</label><input type="radio" class="radio" name="phones_amt" value="More than 50" id="50"></div>
                                                  <div class="clearfix-dk"></div>
                                                </div>
                                              </div>
                                              <div class="fieldset checkboxes">
                                                <p class="question">
                                                  What features are important to you?
                                                  <span class="error-warn">Please Select</span>
                                                </p>
                                                <div class="wrap top5">
                                                  <div class="wrap column left">
                                                    <div class="choice-checkbox first"><div class="checkbox-new"></div><label for="mobile">Mobile Capabilities</label><input type="checkbox" class="checkbox" name="features[]" value="Mobile Capabilities" id="mobile"></div>
                                                    <div class="choice-checkbox second"><div class="checkbox-new"></div><label for="fax">Online Fax</label><input type="checkbox" class="checkbox" name="features[]" value="Online Fax" id="fax"></div>
                                                    <div class="choice-checkbox third"><div class="checkbox-new"></div><label for="monitoring">Call Management<span>/Monitoring</span></label><input type="checkbox" class="checkbox" name="features[]" value="Call Management" id="monitoring"></div>
                                                  </div>
                                                  <div class="wrap column right">
                                                    <div class="choice-checkbox first"><div class="checkbox-new"></div><label for="voicemail">Voicemail-to-email</label><input type="checkbox" class="checkbox" name="features[]" value="Voicemail-to-email" id="voicemail"></div>
                                                    <div class="choice-checkbox second"><div class="checkbox-new"></div><label for="auto">Auto Attendant</label><input type="checkbox" class="checkbox" name="features[]" value="Auto Attendant" id="auto"></div>
                                                    <div class="choice-checkbox third"><div class="checkbox-new"></div><label for="none">No Preference</label><input type="checkbox" class="checkbox" name="features[]" value="No Preference" id="none"></div>
                                                  </div>
                                                  <div class="clearfix-dk"></div>
                                                </div>
                                              </div>
                                              <div class="fieldset button-field top10">
                                                <div class="wrap">
                                                  <div class="button fixed left back to-step-1">
                                                    <p>Back</p>
                                                  </div>
                                                  <div class="button right next to-step-3">
                                                    <p>Find Me Solutions <span class="icon-angle-double-right"></span></p>
                                                  </div>
                                                  <div class="clearfix-dk"></div>
                                                </div>
                                              </div>
                            </div>
                    </div>
                    

                    

                    
                    <div class="step three" id="personal_info">
                    
                            <div class="wrap">
                                              <div class="fieldset input half first firstname error">
                                                <p class="question">First Name</p>
                                                <div class="wrap"><input type="text" class="field required firstname" name="firstname" id="firstname"></div>
                                              </div>
                                              <div class="fieldset input half first lastname error">
                                                <p class="question">Last Name</p>
                                                <div class="wrap"><input type="text" class="field required lastname" name="lastname" id="lastname"></div>
                                              </div>
                                              <div class="clearfix-dk"></div>
                                              <div class="fieldset input half email error">
                                                <p class="question">Email Address</p>
                                                <div class="wrap"><input type="text" class="field email required" name="email" id="email"></div>
                                              </div>
                                              <div class="fieldset input half phone error">
                                                <p class="question">Phone Number</p>
                                                <div class="wrap"><input type="text" class="field phone required" name="phone" id="phone"></div>
                                              </div>
                                              <div class="clearfix-dk"></div>
                                              <div class="fieldset button-field">
                                                <div class="wrap">
                                                  <div class="button right next to-step-3">
                                                    <p>Show Me Results <span class="icon-angle-double-right"></span></p>
                                                  </div>
                                                  <input type="submit" value="Show Me Results" class="button" style="display: none;">

                                                </div>
                                              </div>
                                              <p class="inform-text">You will also receive a FREE 6-Page business VoIP guide to help analyze and compare your results.</p>
                                              ' . ($user->uid == 1 ? '<div class="button back">Back</div>' : '') . '
                            </div>


                    </div>
                    
                <!--
                <div id="Navigation" class="fieldset button-field next"> 	
                  <div class="wrap">
                    <div class="button">
                        <input class="navigation_button" id="back" value="Back" type="reset" />
                        <input class="navigation_button" id="next" value="Let\'s Get Started" type="submit" />
                    </div>
                  </div>
                </div>
                -->
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="page" />
                <input type="hidden" name="version" value="10" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
</div>
  ';
  
  return $out;
}



/**
 * Block Request a quote FOR PAGE v10_uk - /lpv10-uk
 * 
 */
function gv_blocks_get_requestQuoteForPage_v10_uk() {

  global $user;
  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  
  
  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  //drupal_add_js($path_to_custom_js . 'bbq.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  
  $path_to_custom_js = drupal_get_path('module', 'selectmenu') . '/js/jquery.ui.selectmenu/';
  drupal_add_js($path_to_custom_js . 'jquery.ui.selectmenu.js');
  drupal_add_css($path_to_custom_js . 'jquery.ui.selectmenu.css');
  
  
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  
  drupal_add_js($path_to_custom_js . 'gv_quote_page_field_hints.js');
  
  
  drupal_add_js($path_to_custom_js . 'gv_requestquote_page_v10.js');
  
  
  
  //drupal_add_js('sites/all/libraries/jquery.plugins/jquery.inputmask/dist/inputmask/jquery.inputmask.min.js');
  //drupal_add_js('sites/all/libraries/jquery.plugins/jquery.inputmask/dist/inputmask/jquery.inputmask.phone.extensions.js');
  //drupal_add_js('sites/all/libraries/jquery.plugins/jquery.inputmask/_real/jquery.inputmask.min.js');
  drupal_add_js('sites/all/libraries/jquery.plugins/jquery.inputmask/_v1/jquery.inputmask.js');
  
  // Turn off input phone mask for UK
  drupal_add_js(array('gv_turn_on_phone_input_mask' => FALSE), 'setting');  
  
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;
  
  
  $out = 
   '<div class="form-main">
      <div class="title-first">
        <h1>Simplify your Business VoIP buying process by letting us do the work for you.</h1>
        <h2>Answer a few questions and we\'ll find the best business phone solution for your specific needs.</h2>
      </div>
      <div class="title-loading">
        <h1>Searching our database of providers...</h1>
        <div class="loading-gif"></div>
      </div>
      <div class="title-second" style="display: none;">
        <h1>We have found <span class="result"><span class="number">3</span></span> VoIP companies matching your requirements!</h1>
        <h2>Where do we send the details for your <span class="number2">4</span> matches?</h2>
      </div>

          
      <div id="requestQuoteFormWrapper" class="hidden form">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        <form class="multipartForm bbq" method="post" action="/request" style="background: none; border: none;">

                    
                    <div class="step one radio-filled" id="phones_amt_section">
                        

                                  <div class="wrap">
                                  
                                              <div class="fieldset choices service-type first">

                                                          <p class="question">How can we help you?</p>

                                                          <div class="wrap">

                                                                          <div class="choice phone-only first">
                                                                            <div class="icon-replace"></div>
                                                                            <label for="replace">Replace current system</label>
                                                                            <input type="radio" class="radio" name="q_for" id="replace" value="Replace current phone system">
                                                                          </div>

                                                                          <div class="choice both checked">
                                                                            <div class="icon-new"></div>
                                                                            <label for="new"><span>Find</span> new system &amp; service</label>
                                                                            <input type="radio" class="radio" name="q_for" id="new" value="Need a phone system for a new office" checked="checked">
                                                                          </div>

                                                                          <div class="choice service-only">
                                                                            <div class="icon-expand"></div>
                                                                            <label for="expand-only">Expand current system</label>
                                                                            <input type="radio" class="radio" name="q_for" id="expand-only" value="Expand on our current phone system">
                                                                          </div>

                                                          </div>
                                                          
                                                          <div class="clearfix-dk"></div>

                                              </div>
                                    
                                    
                                              

                                              <div class="fieldset button-field next">
                                                <div class="wrap">
                                                  <div class="button next">
                                                    <p>Let\'s Get Started <span class="icon-angle-double-right"></span></p>
                                                  </div>
                                                </div>
                                              </div>
          
                                  </div>                      



                               
                    </div>
                    
                    <div class="step two" id="quesions">
                        
                            <div class="wrap">
                                              <div class="fieldset choices people first">
                                                <p class="question">
                                                  How many people will be using your phone system?
                                                  <span class="error-warn">Please Select</span>
                                                </p>
                                                <div class="wrap">
                                                  <div class="choice first"><label for="1-4">1<span> </span>-<span> </span>4</label><input type="radio" class="radio" name="phones_amt" value="1 - 4" id="1-4"></div>
                                                  <div class="choice second"><label for="5-10">5<span> </span>-<span> </span>10</label><input type="radio" class="radio" name="phones_amt" value="5 - 10" id="5-10"></div>
                                                  <div class="choice third"><label for="11-20">11<span> </span>-<span> </span>20</label><input type="radio" class="radio" name="phones_amt" value="11 - 20" id="11-20"></div>
                                                  <div class="choice fourth"><label for="21-49">21<span> </span>-<span> </span>49</label><input type="radio" class="radio" name="phones_amt" value="21 - 49" id="21-49"></div>
                                                  <div class="choice fifth"><label for="50">50 +</label><input type="radio" class="radio" name="phones_amt" value="More than 50" id="50"></div>
                                                  <div class="clearfix-dk"></div>
                                                </div>
                                              </div>
                                              <div class="fieldset checkboxes">
                                                <p class="question">
                                                  What features are important to you?
                                                  <span class="error-warn">Please Select</span>
                                                </p>
                                                <div class="wrap top5">
                                                  <div class="wrap column left">
                                                    <div class="choice-checkbox first"><div class="checkbox-new"></div><label for="mobile">Mobile Capabilities</label><input type="checkbox" class="checkbox" name="features[]" value="Mobile Capabilities" id="mobile"></div>
                                                    <div class="choice-checkbox second"><div class="checkbox-new"></div><label for="fax">Online Fax</label><input type="checkbox" class="checkbox" name="features[]" value="Online Fax" id="fax"></div>
                                                    <div class="choice-checkbox third"><div class="checkbox-new"></div><label for="monitoring">Call Management<span>/Monitoring</span></label><input type="checkbox" class="checkbox" name="features[]" value="Call Management" id="monitoring"></div>
                                                  </div>
                                                  <div class="wrap column right">
                                                    <div class="choice-checkbox first"><div class="checkbox-new"></div><label for="voicemail">Voicemail-to-email</label><input type="checkbox" class="checkbox" name="features[]" value="Voicemail-to-email" id="voicemail"></div>
                                                    <div class="choice-checkbox second"><div class="checkbox-new"></div><label for="auto">Auto Attendant</label><input type="checkbox" class="checkbox" name="features[]" value="Auto Attendant" id="auto"></div>
                                                    <div class="choice-checkbox third"><div class="checkbox-new"></div><label for="none">No Preference</label><input type="checkbox" class="checkbox" name="features[]" value="No Preference" id="none"></div>
                                                  </div>
                                                  <div class="clearfix-dk"></div>
                                                </div>
                                              </div>
                                              <div class="fieldset button-field top10">
                                                <div class="wrap">
                                                  <div class="button fixed left back to-step-1">
                                                    <p>Back</p>
                                                  </div>
                                                  <div class="button right next to-step-3">
                                                    <p>Find Me Solutions <span class="icon-angle-double-right"></span></p>
                                                  </div>
                                                  <div class="clearfix-dk"></div>
                                                </div>
                                              </div>
                            </div>
                    </div>
                    

                    

                    
                    <div class="step three" id="personal_info">
                    
                            <div class="wrap">
                                              <div class="fieldset input half first firstname error">
                                                <p class="question">First Name</p>
                                                <div class="wrap"><input type="text" class="field required firstname" name="firstname" id="firstname"></div>
                                              </div>
                                              <div class="fieldset input half first lastname error">
                                                <p class="question">Last Name</p>
                                                <div class="wrap"><input type="text" class="field required lastname" name="lastname" id="lastname"></div>
                                              </div>
                                              <div class="clearfix-dk"></div>
                                              <div class="fieldset input half email error">
                                                <p class="question">Email Address</p>
                                                <div class="wrap"><input type="text" class="field email required" name="email" id="email"></div>
                                              </div>
                                              <div class="fieldset input half phone error">
                                                <p class="question">Phone Number</p>
                                                <div class="wrap"><input type="text" class="field phone required" name="phone" id="phone"></div>
                                              </div>
                                              <div class="clearfix-dk"></div>
                                              <div class="fieldset button-field">
                                                <div class="wrap">
                                                  <div class="button right next to-step-3">
                                                    <p>Show Me Results <span class="icon-angle-double-right"></span></p>
                                                  </div>
                                                  <input type="submit" value="Show Me Results" class="button" style="display: none;">

                                                </div>
                                              </div>
                                              <p class="inform-text">You will also receive a FREE 6-Page business VoIP guide to help analyze and compare your results.</p>
                                              ' . ($user->uid == 1 ? '<div class="button back">Back</div>' : '') . '
                            </div>


                    </div>
                    
                <!--
                <div id="Navigation" class="fieldset button-field next"> 	
                  <div class="wrap">
                    <div class="button">
                        <input class="navigation_button" id="back" value="Back" type="reset" />
                        <input class="navigation_button" id="next" value="Let\'s Get Started" type="submit" />
                    </div>
                  </div>
                </div>
                -->
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="page" />
                <input type="hidden" name="version" value="10_uk" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
</div>
  ';
  
  return $out;
}



/**
 * Block Request a quote FOR block popup-provider v10
 * 
 */
function gv_blocks_get_requestQuote_block_v10_popup_provider() {

  global $user;
  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  
  
  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  //drupal_add_js($path_to_custom_js . 'bbq.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  
  $path_to_custom_js = drupal_get_path('module', 'selectmenu') . '/js/jquery.ui.selectmenu/';
  drupal_add_js($path_to_custom_js . 'jquery.ui.selectmenu.js');
  drupal_add_css($path_to_custom_js . 'jquery.ui.selectmenu.css');
  
  
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  
  drupal_add_js($path_to_custom_js . 'gv_quote_page_field_hints.js');
  
  
  //drupal_add_js($path_to_custom_js . 'gv_requestquote_page_v10.js');
  
  drupal_add_js($path_to_custom_js . 'gv_requestquote_v10_popup_provider.js');
  
  drupal_add_css(path_to_theme() . '/css/sass/lpv10_popup_on_list.scss', array('group' => CSS_DEFAULT/*, 'every_page' => TRUE)*/));
  
  //drupal_add_js('sites/all/libraries/jquery.plugins/jquery.inputmask/dist/inputmask/jquery.inputmask.min.js');
  //drupal_add_js('sites/all/libraries/jquery.plugins/jquery.inputmask/dist/inputmask/jquery.inputmask.phone.extensions.js');
  //drupal_add_js('sites/all/libraries/jquery.plugins/jquery.inputmask/_real/jquery.inputmask.min.js');
  drupal_add_js('sites/all/libraries/jquery.plugins/jquery.inputmask/_v1/jquery.inputmask.js');
  
  
  
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;
  
  
  $out = 
   '<div class="form-main">
      <div class="title-first">
        <h1>Get Your Hassle Free, Custom Quote From <span>Nextiva</span> below.</h1>
        <h2>Just Tell Us The Basics:</h2>
      </div>
      <div class="title-second" style="display: none;">
        <h1>Where do we send the details for your <span>custom <span>Nextiva</span> quote?</span> </h1>
      </div>

          
      <div id="requestQuoteFormWrapper" class="form">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        <form class="multipartForm bbq" method="post" action="/request" style="background: none; border: none;">

                    
                    <div class="step one radio-filled" id="phones_amt_section">
                        

                                  <div class="wrap">
                                  
                                              <div class="fieldset choices service-type first">

                                                          <p class="question">How can we help you?</p>

                                                          <div class="wrap">

                                                                          <div class="choice phone-only first">
                                                                            <div class="icon-replace"></div>
                                                                            <label for="replace">Replace current system</label>
                                                                            <input type="radio" class="radio" name="q_for" id="replace" value="Replace current phone system">
                                                                          </div>

                                                                          <div class="choice both checked">
                                                                            <div class="icon-new"></div>
                                                                            <label for="new"><span>Find</span> new system &amp; service</label>
                                                                            <input type="radio" class="radio" name="q_for" id="new" value="Need a phone system for a new office" checked="checked">
                                                                          </div>

                                                                          <div class="choice service-only">
                                                                            <div class="icon-expand"></div>
                                                                            <label for="expand-only">Expand current system</label>
                                                                            <input type="radio" class="radio" name="q_for" id="expand-only" value="Expand on our current phone system">
                                                                          </div>

                                                          </div>
                                                          
                                                          <div class="clearfix-dk"></div>

                                              </div>
                                    
                                    
                                              

                                              <div class="fieldset button-field next">
                                                <div class="wrap">
                                                  <div class="button next">
                                                    <p>Let\'s Get Started <span class="icon-angle-double-right"></span></p>
                                                  </div>
                                                </div>
                                              </div>
          
                                  </div>                      



                               
                    </div>
                    
                    <div class="step two" id="quesions">
                        
                            <div class="wrap">
                                              <div class="fieldset choices people first">
                                                <p class="question">
                                                  How many people will be using your phone system?
                                                  <span class="error-warn">Please Select</span>
                                                </p>
                                                <div class="wrap">
                                                  <div class="choice first"><label for="1-4">1<span> </span>-<span> </span>4</label><input type="radio" class="radio" name="phones_amt" value="1 - 4" id="1-4"></div>
                                                  <div class="choice second"><label for="5-10">5<span> </span>-<span> </span>10</label><input type="radio" class="radio" name="phones_amt" value="5 - 10" id="5-10"></div>
                                                  <div class="choice third"><label for="11-20">11<span> </span>-<span> </span>20</label><input type="radio" class="radio" name="phones_amt" value="11 - 20" id="11-20"></div>
                                                  <div class="choice fourth"><label for="21-49">21<span> </span>-<span> </span>49</label><input type="radio" class="radio" name="phones_amt" value="21 - 49" id="21-49"></div>
                                                  <div class="choice fifth"><label for="50">50 +</label><input type="radio" class="radio" name="phones_amt" value="More than 50" id="50"></div>
                                                  <div class="clearfix-dk"></div>
                                                </div>
                                              </div>
                                              <div class="fieldset checkboxes">
                                                <p class="question">
                                                  What features are important to you?
                                                  <span class="error-warn">Please Select</span>
                                                </p>
                                                <div class="wrap top5">
                                                  <div class="wrap column left">
                                                    <div class="choice-checkbox first"><div class="checkbox-new"></div><label for="mobile">Mobile Capabilities</label><input type="checkbox" class="checkbox" name="features[]" value="Mobile Capabilities" id="mobile"></div>
                                                    <div class="choice-checkbox second"><div class="checkbox-new"></div><label for="fax">Online Fax</label><input type="checkbox" class="checkbox" name="features[]" value="Online Fax" id="fax"></div>
                                                    <div class="choice-checkbox third"><div class="checkbox-new"></div><label for="monitoring">Call Management<span>/Monitoring</span></label><input type="checkbox" class="checkbox" name="features[]" value="Call Management" id="monitoring"></div>
                                                  </div>
                                                  <div class="wrap column right">
                                                    <div class="choice-checkbox first"><div class="checkbox-new"></div><label for="voicemail">Voicemail-to-email</label><input type="checkbox" class="checkbox" name="features[]" value="Voicemail-to-email" id="voicemail"></div>
                                                    <div class="choice-checkbox second"><div class="checkbox-new"></div><label for="auto">Auto Attendant</label><input type="checkbox" class="checkbox" name="features[]" value="Auto Attendant" id="auto"></div>
                                                    <div class="choice-checkbox third"><div class="checkbox-new"></div><label for="none">No Preference</label><input type="checkbox" class="checkbox" name="features[]" value="No Preference" id="none"></div>
                                                  </div>
                                                  <div class="clearfix-dk"></div>
                                                </div>
                                              </div>
                                              <div class="fieldset button-field top10">
                                                <div class="wrap">
                                                  <div class="button fixed left back to-step-1">
                                                    <p>Back</p>
                                                  </div>
                                                  <div class="button right next to-step-3">
                                                    <p>Find Me Solutions <span class="icon-angle-double-right"></span></p>
                                                  </div>
                                                  <div class="clearfix-dk"></div>
                                                </div>
                                              </div>
                            </div>
                    </div>
                    

                    

                    
                    <div class="step three" id="personal_info">
                    
                            <div class="wrap">
                                              <div class="fieldset input half first firstname error">
                                                <p class="question">First Name</p>
                                                <div class="wrap"><input type="text" class="field required firstname" name="firstname" id="firstname"></div>
                                              </div>
                                              <div class="fieldset input half first lastname error">
                                                <p class="question">Last Name</p>
                                                <div class="wrap"><input type="text" class="field required lastname" name="lastname" id="lastname"></div>
                                              </div>
                                              <div class="clearfix-dk"></div>
                                              <div class="fieldset input half email error">
                                                <p class="question">Email Address</p>
                                                <div class="wrap"><input type="text" class="field email required" name="email" id="email"></div>
                                              </div>
                                              <div class="fieldset input half phone error">
                                                <p class="question">Phone Number</p>
                                                <div class="wrap"><input type="text" class="field phone required" name="phone" id="phone"></div>
                                              </div>
                                              <div class="clearfix-dk"></div>
                                              <div class="fieldset button-field">
                                                <div class="wrap">
                                                  <div class="button right next to-step-3">
                                                    <p>Show Me Results <span class="icon-angle-double-right"></span></p>
                                                  </div>
                                                  <input type="submit" value="Show Me Results" class="button" style="display: none;">

                                                </div>
                                              </div>
                                              <p class="inform-text">You will also receive a FREE 6-Page business VoIP guide to help analyze and compare your results.</p>
                                              ' . ($user->uid == 1 ? '<div class="button back">Back</div>' : '') . '
                            </div>


                    </div>
                    
                <!--
                <div id="Navigation" class="fieldset button-field next"> 	
                  <div class="wrap">
                    <div class="button">
                        <input class="navigation_button" id="back" value="Back" type="reset" />
                        <input class="navigation_button" id="next" value="Let\'s Get Started" type="submit" />
                    </div>
                  </div>
                </div>
                -->
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="page" />
                <input type="hidden" name="version" value="10-popup-provider" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                <input type="hidden" name="provider_name" value="" />
                <input type="hidden" name="provider_id" value="" />
                
        </form>

        <p id="data"></p>
</div>
<div class="block_footer"></div>
</div>
  ';
  
  return $out;
}


/**
 * Ppc bu page /ppc/business-voip exit intent block.
 */
function gv_blocks_get_exitIntent_v2() {

  //drupal_add_library('system', 'ui.widget');

  //drupal_add_library('system', 'effects.bounce');
  
//  $path_to_custom_js = 'sites/all/modules/_JS/multipart_form/';
//  drupal_add_js($path_to_custom_js . 'jquery.form.js');
//  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
//  //drupal_add_js($path_to_custom_js . 'bbq.js');
//  drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  
  
  $path_to_custom_js = 'sites/all/libraries/jquery.plugins/formwizard-307/js/';
  drupal_add_js($path_to_custom_js . 'jquery.form.js');
  drupal_add_js($path_to_custom_js . 'jquery.validate.js');
  //drupal_add_js($path_to_custom_js . 'bbq.js');
  //drupal_add_js($path_to_custom_js . 'jquery.form.wizard-min.js');
  drupal_add_js($path_to_custom_js . 'jquery.form.wizard.js');
  
  // Docs
  // http://thecodemine.org/#_demoForm=norway
  // http://stackoverflow.com/questions/14067693/submit-form-at-each-step-using-jquery-form-wizard
  // http://forum.jquery.com/topic/form-wizard-not-working-after-duplicating-steps
  
  
  
  
  
  
  
  
  
  drupal_add_library('system', 'ui.core');
  drupal_add_library('system', 'ui.widget');
  drupal_add_library('system', 'ui.position');  
  
  //drupal_add_js('sites/all/libraries/jquery.plugins/ui/jquery.ui.selectmenu.js');
  //drupal_add_css('sites/all/libraries/jquery.plugins/ui/themes/base/jquery.ui.selectmenu.css');
  
  $path_to_custom_js = drupal_get_path('module', 'selectmenu') . '/js/jquery.ui.selectmenu/';
  drupal_add_js($path_to_custom_js . 'jquery.ui.selectmenu.js');
  drupal_add_css($path_to_custom_js . 'jquery.ui.selectmenu.css');
  
  
  
  
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  drupal_add_js($path_to_custom_js . 'gv_quote_page_field_hints.js');
  
  
  
  $current_js_array = drupal_add_js();
  if (!isset($current_js_array['sites/all/libraries/jquery.plugins/colorbox/colorbox/jquery.colorbox-min.js']) && !isset($current_js_array['sites/all/libraries/jquery.plugins/colorbox/colorbox/jquery.colorbox.js']) ) {
      //dpm($current_js_array);
      // Colorbox for popup window for exit intent.
      //possible versions for the design: 1, 3, 4, 
    
     drupal_add_js('sites/all/libraries/jquery.plugins/colorbox/colorbox/jquery.colorbox.js');

  }
  //drupal_add_css('sites/all/libraries/jquery.plugins/colorbox/example1/colorbox.css', array('preprocess' => FALSE)); // array('group' => CSS_THEME, 'preprocess' => FALSE)
  drupal_add_css('sites/all/libraries/jquery.plugins/colorbox/example2/colorbox.css', array('preprocess' => FALSE)); // array('group' => CSS_THEME, 'preprocess' => FALSE)
  
  
  // multistep form and exit intent specific using functionality.
  drupal_add_js($path_to_custom_js . 'gv_exitIntent_forPpcBuPage.js');
  
//  $current_js_array = drupal_add_js();
//  dpm($current_js_array);
  
  //exitIntent-ppc-bu
  $css_object = drupal_add_css();
  if (!isset($css_object['sites/all/themes/gv_blue/css/exit-intent-v2.css'])) {
    //drupal_add_css(path_to_theme() . '/css/exitIntent-ppc-bu.css', array('group' => CSS_DEFAULT, 'every_page' => FALSE));
    drupal_add_css(path_to_theme() . '/css/exit-intent-v2.css', array('group' => CSS_DEFAULT, 'every_page' => FALSE)); 
  }
  
  

  
  $token = md5(time()); //drupal_get_token('test');
  $_SESSION['requestQuoteToken'] = $token;
  
  $out = '
   <div style="display: none;">
    <div id="exitIntent"> 
      <div id="requestQuoteFormWrapper-ppc" class="hidden">
        <div class="sending results" style="display: none;"></div>
        <div class="success results" style="display: none;"></div>
        <div class="fail results" style="display: none;">The Request has failed! <br>Something went wrong. <br>Please, contact the site administrator.</div>
        
        <form class="multipartForm" method="post" action="/request" style="height: 300px; overflow: hidden;">

                
                <div id="fieldWrapper">
                
                    <div class="step" id="first_step">
                        
                           <div class="line-1">Want To See Exactly How Much</div>
                           <div class="line-2">BUSINESS VOIP</div>
                           <div class="line-3">Will <span>Save</span> You?</div>
                           <div class="line"></div>
                           <div class="line-4">We provide bottom line quotes from award-winning providers.</div>
                           
                           <div class="control">
                              <div class="next_custom">Next</div>
                              <div class="no">No</div>
                           </div>
                    </div>



                    
                    <div class="step" id="second_step">
                       
                      <div class="line-1">We provide bottom line quotes from award-winning providers.</div>
                      <div class="line"></div>
                      <div class="line-2">To Get Started On Your</div>
                      <div class="line-3">SAVINGS QUOTE</div>
                      <div class="line-4">Tell us:</div>
                        

                      <div class="control">
                      
                            <div class="text-h-group">


                                <div class="field-group left">

                                  <div class="wrapper input-border">
                                    <input class="after company" name="company" id="company" title="Company Name" />
                                  </div>

                                </div>

                                <div class="field-group right">

                                   <!--<div class="question">How many phones do you need?</div>-->
                                     <select name="phones_amt" id="phones_amt" class="input">
                                       <option value="">- Number of Lines -</option>
                                       <option value="1 - 4">1 - 4</option>
                                       <option value="5 - 10">5 - 10</option>
                                       <option value="11 - 20">11 - 20</option>
                                       <option value="21 - 50">21 - 50</option>
                                       <option value="More than 50">More than 50</option>
                                     </select>

                                 </div>
                           
                              
                              </div>
                              
                              <div class="back_custom">Back</div>
                              <div class="next_custom">Next</div>
                              <div class="err" style="display: none;">Please select a Number of lines.</div>
                         
                         </div>
                         
                         
                    </div>
                    


                    <div class="step" id="third_step">
                        
                           <div class="line-1">After we match you with qualified providers,</div>
                           <div class="line-2">Where should we send your</div>
                           <div class="line-3">FREE QUOTE?</div>
                           <div class="line"></div>
                           <div class="line-4">Your quotes will be delivered within minutes.</div>
                           
                          <div class="control">
                          
                                  <div class="text-h-group">
                                    <div class="wrapper input-border">
                                      <input class="after required firstname" name="firstname" id="firstname" title="First Name" />
                                    </div>

                                    <div class="wrapper input-border second">
                                      <input class="after required lastname" name="lastname" id="lastname" title="Last Name" />
                                    </div>
                                  </div>

                                  <div class="text-h-group">
                                    <div class="wrapper input-border">
                                      <input class="after email required" name="email" id="email" title="Email Address" />
                                    </div>

                                    <div class="wrapper phone input-border  second">
                                        <input class="after required phone" name="phone" id="phone" value="" title="Phone Number" />
                                    </div>
                                  </div>
                                  
                                  
                                  <div class="back_custom">Back</div>
                                  
                          </div>
                         
                          

                    </div>
                    


                    
                </div>
            
                <div id="Navigation"> 							
                        <!-- <input class="navigation_button" id="back" value="Back" type="reset" /> -->
                        <input class="navigation_button" id="next" value="Next" type="submit" />
                        
                </div>
                
                <input type="hidden" name="token" value="' . $token . '" />
                <input type="hidden" name="source" value="block" />
                <input type="hidden" name="version" value="exit-intent-ppc-bu-1" />
                <input type="hidden" name="referrer" value="" />
                <input type="hidden" name="url" value="" />
                
        </form>

        <p id="data"></p>
      </div>
    </div>
 </div>
<div class="block_footer"></div>
  ';
  
  return $out;
}



/**
 * Block with providers banner ads.
 */
function gv_blocks_voipAds($type = 'bu') {
  
  $out = NULL;
  
  if ($type == 'bu') {
    
      $cid = 'gv_voipAds_bu';
      $cache = cache_get($cid, 'cache');

      if ($cache && !empty($cache->data) && $cache->expire > time()) {
        $out = $cache->data;
      }
      else {
    
            $query = db_select('field_data_field_banner_toggle', 'bt')
                  ->fields('bt', array('field_banner_toggle_value'));
            $query->leftJoin('field_data_field_banner_pic', 'bp', 'bp.entity_id = bt.entity_id');
            $query->fields('bp', array('field_banner_pic_alt', 'field_banner_pic_title'));

            $query->leftJoin('file_managed', 'f', 'f.fid = bp.field_banner_pic_fid');
            $query->fields('f', array('uri'));

          //  $query->leftJoin('field_data_field_p_data', 'pd', 'pd.entity_id = bt.entity_id');
          //  $query->fields('pd', array('field_p_data_value'));
            $query->leftJoin('field_data_field_p_data_quick', 'pd', 'pd.entity_id = bt.entity_id');
            $query->fields('pd', array('field_p_data_quick_value'));


            $query->leftJoin('field_data_field_p_erating', 'er', 'er.entity_id = bt.entity_id');
            $query->fields('er', array('field_p_erating_value'));

            $query->condition('bt.field_banner_toggle_value', 1);
            $query->condition('er.field_p_erating_value', 0, '>');
            $query->isNotNull('bp.field_banner_pic_fid');


            $query->orderBy('er.field_p_erating_value', 'ASC');

            //$query->range(0, 10);

            $results = $query->execute()->fetchAll();
            //dpm($results);

            $out = NULL;
            foreach ($results as $result) {
              //$p_data = unserialize($result->field_p_data_value);
              $p_data = unserialize($result->field_p_data_quick_value);
              //$out .= '<div class="bnr"><a href="' . $p_data['info']['i_web'] . '" target="_blank">' . theme('image_style', array( 'path' =>  $result->uri, 'style_name' => 'banner_ads', 'alt' => $result->field_banner_pic_alt, 'title' => $result->field_banner_pic_title)) . '</a></div>';



              //$out .= '<div class="bnr"><a href="' . $p_data['info']['i_web'] . '" target="_blank"><img src="/' . gv_misc_getPathFromStreamUri($result->uri) . '" alt="' . $result->field_banner_pic_alt . '" title="' . $result->field_banner_pic_title . '" /></a></div>';
              ////$out .= '<div class="bnr"><a href="' . $p_data['i_web'] . '" target="_blank"><img src="/' . gv_misc_getPathFromStreamUri($result->uri) . '" alt="' . $result->field_banner_pic_alt . '" title="' . $result->field_banner_pic_title . '" /></a></div>';


          //    $goto_link = 'goto';
          //    $goto_link_query = array('t' => 'provider', 'n' => urlencode($p_data['name'])/*, 'url' => urlencode($node->p_data['info']['i_web'])*/);

              $out .= '<div class="bnr"><a href="/goto?t=provider&n=' . urlencode($p_data['name']) . '" rel="nofollow" target="_blank"><img src="/' . gv_misc_getPathFromStreamUri($result->uri) . '" alt="' . $result->field_banner_pic_alt . '" title="' . $result->field_banner_pic_title . '" /></a></div>';
            }

      
       cache_set($cid, $out, 'cache', strtotime('+7 day'));
      } 

  }
  
  return $out;
}


/**
 * Themed user block for the header.
 */
function gv_blocks_userBlock() {
  
  global $user;
  
  if (!$user->uid) {
    
    gv_misc_initLogin();
    // V1, no need to launch drupal_add_library('system', 'drupal.ajax');
    //$out = ctools_modal_text_button(t('Login'), 'ajax_register/login/nojs', t('Login'), 'ctools-modal-ctools-ajax-register-style');
    // V2, need to launch drupal_add_library('system', 'drupal.ajax') in zp_user_initLogin(), but possible to set more params in l()...
    $out = l(t('Login'), 'ajax_register/login/nojs', array('html' => TRUE, 'attributes' => array('rel' => 'nofollow', 'class' => array('gv-login', 'ctools-use-modal', 'ctools-modal-ctools-ajax-register-style'), 'title' => t('Login'))));
  }
  else {
    $out = '<span class="user-profile">Hello, ' . theme('username', array('account' => $user, 'link_path' => 'user/' . $user->uid))  . '</span><span class="user-logout">' . l('Logout', 'user/logout', array('query' => array('destination' => ltrim(str_replace('#comment-form', '', $_SERVER['REQUEST_URI']), '/')))) . '</span>';
  }
  
  return $out;
}



function gv_blocks_get_confMainSearch() {
  $gv_blocks_get_confMainSearch_form = drupal_get_form('gv_blocks_get_confMainSearch_form');
  return render($gv_blocks_get_confMainSearch_form);
}


/**
 * Implements hook_form().
 *
 * @return $form
 *   Return nothing.
 */
function gv_blocks_get_confMainSearch_form($form, &$form_state) {
  
  // Date range formatting
  // http://forums.phpfreaks.com/topic/267102-multi-date-range-format/
  // http://stackoverflow.com/questions/3654101/format-a-date-string-in-php
  
  //global $user;
  
  
  //$path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  
  
  //$current_js_array = drupal_add_js();
  //if (!isset($current_js_array['sites/all/libraries/jquery.plugins/colorbox/colorbox/jquery.colorbox-min.js']) && !isset($current_js_array['sites/all/libraries/jquery.plugins/colorbox/colorbox/jquery.colorbox.js']) ) 
    {
      //dpm($current_js_array);
      // Colorbox for popup window for exit intent.
      //possible versions for the design: 1, 3, 4, 
      drupal_add_js('sites/all/libraries/jquery.plugins/colorbox/colorbox/jquery.colorbox.js');
  }
  //drupal_add_css('sites/all/libraries/jquery.plugins/colorbox/example1/colorbox.css', array('preprocess' => FALSE)); // array('group' => CSS_THEME, 'preprocess' => FALSE)
  drupal_add_css('sites/all/libraries/jquery.plugins/colorbox/example2/colorbox.css', array('preprocess' => FALSE)); // array('group' => CSS_THEME, 'preprocess' => FALSE)
  
   // Add some Google fonts.
  // <link href='http://fonts.googleapis.com/css?family=Lato:300,400' rel='stylesheet' type='text/css'>
  gv_misc_addMetatag('stylesheet', NULL, 'http://fonts.googleapis.com/css?family=Lato:300,400,700', 'NA', 'text/css');
  
  // test
  //drupal_add_css(path_to_theme() . '/css/exit-intent-v2.css', array('group' => CSS_DEFAULT, 'every_page' => FALSE)); 
  
  // https://github.com/jquery-textfill/jquery-textfill
  //drupal_add_js('sites/all/libraries/jquery.plugins/jquery-textfill/source/jquery.textfill.min.js');
  ////drupal_add_js('sites/all/libraries/jquery.plugins/jquery-textfill/source/jquery.textfill.js');
  // https://github.com/DanielHoffmann/jquery-bigtext
  drupal_add_js('sites/all/libraries/jquery.plugins/jquery-bigtext/jquery-bigtext.js');
  
  // Allow to calculate a height of a hidden object
  // http://dreamerslab.com/blog/en/get-hidden-elements-width-and-height-with-jquery/
  drupal_add_js('sites/all/libraries/jquery.plugins/jquery.actual/jquery.actual.js');
  
  $popup_1 = '
   <div style="display: none;">
    <div id="cb-popup_1"> 
      <div id="results_1">
       results #1  
      </div>
    </div>
   </div>
  ';
  
  $form['search_section'] = array(
    //'#markup' => '<div class="title">Sign up to receive weekly updates</div>',
    '#markup' => '
      <div class="hints">
        <div id="h-search"><strong>Find Conference</strong><span></span></div><div id="h-industry"><span></span><strong>By Industry</strong></div><div id="h-city-state"><span></span><strong>By City and/or State</strong></div><div id="h-name"><span></span><strong>By Name</strong></div>
      </div>
      <div id="search-wrapper">
      <input id="conf" title="Industry" />'
      //. '<div id="label">Start typing "web" for a start</div>'.
      . '<div id="buttons"><div id="switches"><div class="divider"></div><div class="switch active" id="c-industry"> - By industry</div>
      <div class="switch" id="c-city-state"> - By City and/or State</div><div class="switch" id="c-title"> - By title</div></div><div id="submit">Submit</div></div>
      </div>
<input type="hidden" id="conf-id" />
<p id="conf-description"></p>'
      .$popup_1,
      
  );
  
  
  /*
  $form['email'] = array(
    '#type' => 'textfield',
    //'#title' => 'Sign up to receive weekly updates',
    //'#default_value' => $user->uid ? $user->mail : NULL,
    //'#description' => '',
    //'#element_validate' => array('gv_misc_validate_email'),
    '#required' => TRUE,
    //'#access' => $user->uid ? FALSE : TRUE,
    '#attributes' => array('title' => 'EMAIL'),
  );
  */
  
//  $form['actions'] = array('#type' => 'actions');
//  $form['actions']['submit'] = array(
//    '#type' => 'submit',
//    '#value' => 'Submit',
//    '#disabled' => TRUE,
//  ); 
  
  
  // Add stars widgets to a Rating block
  //$gv_misc_path = drupal_get_path('module', 'gv_misc');
  $gv_blocks_path = drupal_get_path('module', 'gv_blocks');

  
  $form['#attached'] = array(
      'library' => array(
        array('system', 'ui.autocomplete'),
      ),
      'js' => array(
        // Add hints inside some fields
        //$gv_misc_path . '/js/gv_newsletterSubscribe_fieldHints.js',
        //
        //https://github.com/kottenator/jquery-circle-progress
        //'/sites/all/libraries/jquery.plugins/jquery-circle-progress/dist/circle-progress.js',
        //
        //https://github.com/jquery-textfill/jquery-textfill
        //'/sites/all/libraries/jquery.plugins/jquery-textfill/source/jquery.textfill.min.js',
        //
        // Autocomplete custom functionality
        $gv_blocks_path . '/js/gv_conf_main_page.js',
      ),
      'css' => array(
          //drupal_add_css(path_to_theme() . '/css/iframes-n-quotes.css', array('group' => CSS_DEFAULT, 'every_page' => TRUE));
          path_to_theme() . '/css/conferences.css',
      ),
    );
  
  
  drupal_add_library('system', 'ui.core');
  //drupal_add_library('system', 'ui.widget');
  //drupal_add_library('system', 'ui.position'); 
  drupal_add_library('system', 'effects.bounce');
  
  
  
  
  return $form;
}


/**
 * Implements hook_form_validate().
 *
 * @return $form
 *   Return nothing.
 */
function gv_blocks_get_confMainSearch_form_validate(&$form, &$form_state) {

  //drupal_set_message('In Validate!', 'warning');
  //dpm($form_state['values']);
  //dpm($form);
    
  // Clear hints, if any.
  $fields_to_clear_hints = array(); //array('email' => array('hint' => @$form['email']['#attributes']['title']));
  foreach ($fields_to_clear_hints as $fname => $fdata) {
   
    if ($form_state['values'][$fname] == $fdata['hint']) {
      
      // This clear the field.
      $form[$fname]['#value'] = NULL;
      
      // Just in case.
      // BUT! It causes fatal eror with #parent index absence
      //form_set_value($form[$fdata['set']][$fname], array('#value' => NULL), $form_state);
      
      // Just in case on more.
      $form_state['values'][$fname] = NULL;
   
      
    }
   
    
  }
  
}


/**
 * Implements hook_form_submit().
 *
 * @return $form
 *   Return nothing.
 */
function gv_blocks_get_confMainSearch_form_submit(&$form, &$form_state) {
  /*
  $verification_code = md5(time());
  db_insert('gv_emails_subscribed')
    ->fields(array(
      'email'=> $form_state['values']['email'],
      'timestamp'=> time(),
      'code' => $verification_code,
    ))
    ->execute();
    */
  //gv_misc_sendMessage('email_verification', array('verification_code' => $verification_code . '=' . urlencode($form_state['values']['email']), 'email' => $form_state['values']['email']));
  
  global $user;
  if ($user->uid == 1) {
    drupal_set_message('Submitted conf page.');
  }
  drupal_goto(ltrim(@$_SERVER['REDIRECT_URL'], '/'), array('query' => array('nocache' => 1)));
}


/**
 * Get top providers logos for LP.
 */
function gv_blocks_get_topProvidersForLP($type = 'Top 5') {
  
  
  
//  $view = views_get_view('providers');
//  // Run view's query.
//  $view->execute('block_top_bu_small');
//  dpm($view);
//  dpm($view->result);
  
  $out = '';
  if ($type == 'Top 5') {
    
    $cache_name = 'gv_top5LPRatingStars';
    
    $cache_content = cache_get($cache_name);
    if ($cache_content && !empty($cache_content->data) && $cache_content->expire > time()) {
      return $cache_content->data;
    }
    
    
    //$allProvidersData = gv_misc_getProvidersDataQuick();
    //dpm($allProvidersData);
    
    $query = db_select('field_data_field_p_erating', 'r');
    //$query->fields('r', array('entity_id', 'field_p_erating_value'))
    $query->fields('r', array('entity_id'))
          ->condition('r.entity_id', 63, '!=') // Exlude Nextiva
          ->condition('r.entity_id', 12, '!=') // Exlude Ringcentral
          ->condition('r.bundle', 'provider');
    $query->orderBy('r.field_p_erating_value', 'ASC');
    $query->range(0, 4);
    //$top5 = $query->execute()->fetchAllAssoc('entity_id'); 
    $top5 = $query->execute()->fetchCol(); 
    //dpm($top5);
    //dpm(array('data' => (object) array('nid' => 12)));
    
    // Add VoipStudio
    $top5[] = 2054;
    $new_providers_order = array(
        36, // Vonage
        88, // 8x8
        191, // Jive
        2062, // Corvisa
        2054, // VoipStudio
        );
    
    // Rearrange providers with a new order.
    $new_top5 = array();
    foreach ($new_providers_order as $new_index => $nid) {
      if ( ($old_index = array_search($nid, $top5)) !== FALSE ) {
         $new_top5[$new_index] = $nid;
         unset($top5[$old_index]);
      }
    }
    //dpm($new_top5);
    //dpm($top5);
    if (!empty($top5)) {
      foreach ($top5 as $nid) {
        $new_top5[] = $nid;
      }
    }
    
    
    $query = db_select('votingapi_cache', 'r');
    //$query->fields('r', array('entity_id', 'field_p_erating_value'))
    $query->fields('r', array('value', 'entity_id'))
          ->condition('r.value_type', 'percent')
          ->condition('r.tag', 'overall')
          ->condition('r.function', 'average')
          ->condition('r.entity_id', $new_top5, 'IN');
    $top5_votes = $query->execute()->fetchAllAssoc('entity_id');
    
    //dpm($new_top5);
    //dpm($top5_votes);
    //global $user;
    $out = '<table><tbody><tr>';
    //foreach ($top5 as $nid) {
    foreach ($new_top5 as $nid) {
      $stars = theme('gv_misc_fivestar_static', array('rating' => $top5_votes[$nid]->value, 'stars' => 5, 'tag' => 'overall', 'widget' => array('name' => 'stars', 'css' => 'stars.css')));
      $rating_count = number_format( (0.05 * $top5_votes[$nid]->value), 1 ); 
      $logo = gv_misc_getProviderQuickData('logo_chart', array('data' => (object) array('nid' => $nid)));
      $out .= '<td>' . $logo . '</td>';
    }
    
    $out .= '</tr><tr>';
    foreach ($new_top5 as $nid) {
      $stars = theme('gv_misc_fivestar_static', array('rating' => $top5_votes[$nid]->value, 'stars' => 5, 'tag' => 'overall', 'widget' => array('name' => 'stars', 'css' => 'stars.css')));
      $rating_count = number_format( (0.05 * $top5_votes[$nid]->value), 1 ); 
      $out .= '<td><div class="rate">' . $stars . '<div class="count">(' . $rating_count . ')</div></div></td>';
    }
  
    //dpm($logo);
    $out .= '</tr></tbody></table>';
    
    cache_set($cache_name, $out, 'cache', time() + 14400);
  }
  
  return $out;
}






/**
 * chartFromView_altered_rotatedFirst4providers.
 */
function gv_blocks_chartFromView_altered_rotatedFirst4providers($view_n_display) {
  
  $chart_themed = NULL;

  $view = views_get_view($view_n_display['view']);
  
  
  // Run view's query.
  $view->execute($view_n_display['display']);

  //dpm($view);
  //dpm($view->result);
  
  $fixed_positions = array();
  
  
  
  $random_array = array_slice($view->result, 0, 5);
  
  
  foreach ($random_array as $key => $result) {
    if ($result->nid == 12) {
      //RingCentral page nid is 12
      // Key should be always 1 (2nd position)
      $fixed_positions['RingCentral_key'] = $key;
    }
    elseif ($result->nid == 36) {
      //Vonage page nid is 36
      // Key should be always 0 OR 2 (1st or 3nd position)
      $fixed_positions['Vonage_key'] = $key;
    }
    elseif ($result->nid == 63) {
      // Nextiva page nid is 63
      // Nextiva never rotates into Position 1 or 3 (key 0 or 2) and stays in rotation only in P4 & 5 (key 3 or 4)
      $fixed_positions['Nextiva_key'] = $key;
    }
    elseif ($result->nid == 88) {
      // 8x8 page nid is 88
      $fixed_positions['8x8_key'] = $key;
    }
  }
  
  //dpm($random_array);
  $random_index = array(0, 1, 2, 3, 4);
  //shuffle($random_index);
  
  do {
    shuffle($random_index);
  }while (
            // RingCentral_key should be always 1 (2nd position)
            (isset($fixed_positions['RingCentral_key']) && $random_index[1] != $fixed_positions['RingCentral_key'])
            ||
            // Vonage_key should be always 0 OR 2 (1st or 3nd position)
            (
              isset($fixed_positions['Vonage_key']) 
              && 
              !($random_index[0] == $fixed_positions['Vonage_key'] || $random_index[2] == $fixed_positions['Vonage_key'])
            )
            ||
            // Nextiva never rotates into Position 1 or 3 (key 0 or 2) and stays in rotation only in P4 & 5 (key 3 or 4)
            (
              isset($fixed_positions['Nextiva_key']) 
              && 
              !($random_index[3] == $fixed_positions['Nextiva_key'] || $random_index[4] == $fixed_positions['Nextiva_key'])
            )
          );
  
  //dpm($random_index);
  
  foreach ($random_index as $key => $value) {
    $view->result[$key] = $random_array[$value];
  }
  //dpm($view->result);
    

  $chart_themed = $view->preview($view_n_display['display']);
  
  return $chart_themed;
}


/**
 * chartFromView_altered_rotatedProviders.
 */
function gv_blocks_chartFromView_altered_rotatedProviders($view_n_display) {
  
 $chart_themed = NULL;
 $info = '';
 global $user;
 
 // For now only sip page have settings for turning on/off rotation
 if ($view_n_display['display'] == 'bl_p_sip_rotated') {
    
                $gv_settings = variable_get('gv_settings', NULL);


                if (empty($gv_settings['Alter_Charts']['AB_Testing_on_SIP'])) {
                  $gv_settings['Alter_Charts']['AB_Testing_on_SIP'] = array(
                    'descr' => 'Turn On the SIP page chart ab-testing rotation',
                    'Turn_On_for_logged_In' => array('field_type' => 'checkbox', 'value' => 0, 'descr' => 'Turn on Rotation for logged In users'),
                    'Turn_On_for_logged_Out' => array('field_type' => 'checkbox', 'value' => 0),
                    'Remain_Top_Rating_For_First_Position' => array('field_type' => 'checkbox', 'value' => 0),
                  );
                  variable_set('gv_settings', $gv_settings);
                }


                global $user;
                if ( ($user->uid && !$gv_settings['Alter_Charts']['AB_Testing_on_SIP']['Turn_On_for_logged_In']['value']) || (!$user->uid && !$gv_settings['Alter_Charts']['AB_Testing_on_SIP']['Turn_On_for_logged_Out']['value'])) {
                  // Show turned Off, simple chart without rotation

                  dpm('Cached: ' . $user->uid);
                  //global $language;
                  $cache_name = 'gv_SIPOriginal_notAlteredChart_' . $view_n_display['display'];

                  $info = '<div class="info cached" style="display: none;"></div>';
                  $cache_content = cache_get($cache_name);
                  if ($cache_content && !empty($cache_content->data) && $cache_content->expire > time()) {
                    return '<div class="info cached" style="display: none;"></div>'. $cache_content->data;
                  }

                  // Or build the original char, save and  return it.
                  $chart_themed = NULL;

                  $view = views_get_view($view_n_display['view']);
                  // Run view's query.
                  $view->execute($view_n_display['display']);

                  $chart_themed = $view->preview($view_n_display['display']);

                  cache_set($cache_name, $chart_themed, 'cache', time() + 14400);

                  return '<div class="info cached rebuilt" style="display: none;"></div>' . $chart_themed;
                }

                dpm('Not cached: ' . $user->uid);

                
  } // End of if ($view_n_display['display'] == 'bl_p_sip_rotated') {
                
  
  
  // Init views

  // Else show rotating chart with ab-testing turned ON.
  $view = views_get_view($view_n_display['view']);
  // Run view's query.
  $view->execute($view_n_display['display']);
  //dpm($view);
  //dpm($view->result);
  $fixed_positions = array();


  
  // Now here's different rotation logics for different cases (displays)

  if ($view_n_display['display'] == 'bl_p_sip_rotated') {                

                // ---------------------------
                // iPage should be first 3 of 4 consecutive page loadings.
                // Bluehost should be first 1 of 4 consecutive page loadings.
                $random_array = array_slice($view->result, 0, 3);

                //dpm($random_array);

                foreach ($random_array as $key => $result) {
                  if ($result->nid == 63) {
                    //Nextiva page nid is 63
                    // Key should be always 1 (2nd position)
                    $fixed_positions['Nextiva_key'] = $key;
                  }
                  elseif ($result->nid == 88) {
                    // 8x8 page nid is 88
                    // Key should be always 0 OR 2 (1st or 3nd position)
                    $fixed_positions['8x8_key'] = $key;
                  }
                  elseif ($result->nid == 1731) {
                    // Flowroute page nid is 731
                    // Key should be always 0 OR 2 (1st or 3nd position)
                    $fixed_positions['Flowroute_key'] = $key;
                  }
                }


                $positions_sets = array(
                    array(0, 1, 2),
                    array(1, 0, 2),
                    array(0, 2, 1),
                    array(1, 2, 0),
                    array(2, 1, 0),
                    array(2, 0, 1),
                );

                $current_positions_set = variable_get('current_positions_set', 0);
                if ($current_positions_set + 1 > 5) {
                  $current_positions_set = 0;
                }
                else {
                  $current_positions_set += 1;
                }
                variable_set('current_positions_set', $current_positions_set);

                //dpm($positions_sets[$current_positions_set]);

                $view->result[0] = $random_array[$positions_sets[$current_positions_set][0]];
                $view->result[1] = $random_array[$positions_sets[$current_positions_set][1]];
                $view->result[2] = $random_array[$positions_sets[$current_positions_set][2]];

                if (!$user->uid) {
                  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
                  drupal_add_js($path_to_custom_js . 'gv_rotate_cached_page_table.js');
                }

                /*


                if (!$current_top_positions_counter = variable_get('gv_current_top_positions_counter')) {
                  $current_top_positions_counter = array(
                      'Nextiva_top' => 0,
                      '8x8_top' => 0,
                  );
                }

                if ($current_top_positions_counter['Nextiva_top'] + 1 == 2) { // 50/50 for i/b
                //if ($current_top_positions_counter['Nextiva_top'] + 1 > 3) { // 75/25 for i/b
                  // 25%
                  $current_top_positions_counter = array(
                      'Nextiva_top' => 0,
                      '8x8_top' => 1,
                  );
                }
                else {
                  // 75%
                  $current_top_positions_counter = array(
                      'Nextiva_top' => $current_top_positions_counter['Nextiva_top'] + 1,
                      '8x8_top' => 0,
                  );
                }

                dpm($current_top_positions_counter);

                variable_set('gv_current_top_positions_counter', $current_top_positions_counter);

                */
                //return 'xxx';



                /*
                //if ($user->uid) 
                  {

                  if ($current_top_positions_counter['Nextiva_top']) {
                    $view->result[0] = $random_array[$fixed_positions['Nextiva_key']];
                    $view->result[1] = $random_array[$fixed_positions['8x8_key']];
                  }
                  else {

                    //Change urls to alternative.
                    //dpm($random_array[$fixed_positions['Nextiva_key']]);
                    //dpm($random_array[$fixed_positions['Nextiva_key']]->views_php_4);

                    //dpm(str_replace('/click/ipage/sh', '/click/ipage/sh?alt=2', $random_array[$fixed_positions['Nextiva_key']]->views_php_4));
                    $Nextiva_p_data = unserialize($random_array[$fixed_positions['Nextiva_key']]->_field_data['nid']['entity']->field_p_data['und'][0]['value']);
                    //dpm($Nextiva_p_data);
                    // Change url in cnaged position to alternative one
                    if (!empty($Nextiva_p_data['s']['sh']['s-url2'])) {
                      $random_array[$fixed_positions['Nextiva_key']]->views_php_4 = str_replace('/click/ipage/sh', '/click/ipage/sh?alt=2', $random_array[$fixed_positions['Nextiva_key']]->views_php_4);
                      $random_array[$fixed_positions['Nextiva_key']]->views_php_11 = str_replace('/click/ipage/sh', '/click/ipage/sh?alt=2', $random_array[$fixed_positions['Nextiva_key']]->views_php_11);
                    }
                    // Change position list number to 2
                    $random_array[$fixed_positions['Nextiva_key']]->field_field_p_listposition_sh[0]['rendered']['#markup'] = 2;
                    $random_array[$fixed_positions['Nextiva_key']]->field_field_p_listposition_sh[0]['raw']['value'] = 2;

                    //$Nextiva_p_data_quick = unserialize($random_array[$fixed_positions['Nextiva_key']]->_field_data['nid']['entity']->field_p_data_quick['und'][0]['value']);
                    //dpm($Nextiva_p_data_quick);

                    //dpm($random_array[$fixed_positions['8x8_key']]);
                    //dpm($random_array[$fixed_positions['8x8_key']]->views_php_4);
                    $_8x8_p_data = unserialize($random_array[$fixed_positions['8x8_key']]->_field_data['nid']['entity']->field_p_data['und'][0]['value']);
                    //dpm($_8x8_p_data);
                    // Change url in cnaged position to alternative one
                    if (!empty($_8x8_p_data['s']['sh']['s-url2'])) {
                      $random_array[$fixed_positions['8x8_key']]->views_php_4 = str_replace('/click/bluehost/sh', '/click/bluehost/sh?alt=2', $random_array[$fixed_positions['8x8_key']]->views_php_4);
                      $random_array[$fixed_positions['8x8_key']]->views_php_11 = str_replace('/click/bluehost/sh', '/click/bluehost/sh?alt=2', $random_array[$fixed_positions['8x8_key']]->views_php_11);
                    }
                    // Change position list number to 1
                    $random_array[$fixed_positions['8x8_key']]->field_field_p_listposition_sh[0]['rendered']['#markup'] = 1;
                    $random_array[$fixed_positions['8x8_key']]->field_field_p_listposition_sh[0]['raw']['value'] = 1;

                    //$_8x8_p_data_quick = unserialize($random_array[$fixed_positions['8x8_key']]->_field_data['nid']['entity']->field_p_data_quick['und'][0]['value']);
                    //dpm($_8x8_p_data_quick);

                    //dpm($random_array);


                    // Swap ratings to remain the better rating to the new top provider.
                    if ($gv_settings['Alter_Charts']['AB_Testing_on_Home']['Remain_Top_Rating_For_First_Position']['value']) {
                      $old_bluehost_rating = $random_array[$fixed_positions['8x8_key']]->views_php_10;
                      $random_array[$fixed_positions['8x8_key']]->views_php_10 = $random_array[$fixed_positions['Nextiva_key']]->views_php_10;
                      $random_array[$fixed_positions['Nextiva_key']]->views_php_10 = $old_bluehost_rating;
                    }

                    // And finally swap corrected rows.
                    $view->result[1] = $random_array[$fixed_positions['Nextiva_key']];
                    $view->result[0] = $random_array[$fixed_positions['8x8_key']];
                  }

                  // Try to cope with cached pages table (just starting thoughts).
                    $current_top_positions_counter['current_uid'] = $user->uid;
              //    drupal_add_js(array('gv_blocks' => array(
              //      'gv_current_top_positions_counter' => $current_top_positions_counter,
              //    )), 'setting');

                  // Update (reRequest) the cached page only for logged out users.
                  // For admins cached copy is not created so no need to repeat recreate the page (and extra increment the counter), that would cause losing of steps.
                  if (!$user->uid) {
                    $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
                    drupal_add_js($path_to_custom_js . 'gv_rotate_cached_page_table.js');
                  }


                }
                */


                //-----------------------------------------


                // ----------------------------------------
                // Like on GV initial case...
                // iPage should be always second
                // Bluehost should be always in 1 or 3 position.
                /*
                $random_array = array_slice($view->result, 0, 4);


                foreach ($random_array as $key => $result) {
                  if ($result->nid == 86) {
                    // iPage page nid is 12
                    // Key should be always 1 (2nd position)
                    $fixed_positions['iPage_key'] = $key;
                  }
                  elseif ($result->nid == 69) {
                    // Bluehost page nid is 36
                    // Key should be always 0 OR 2 (1st or 3nd position)
                    $fixed_positions['Bluehost_key'] = $key;
                  }
                }

                //dpm($random_array);
                $random_index = array(0, 1, 2, 3);
                //shuffle($random_index);

                do {
                  shuffle($random_index);
                }while (
                          // iPage_key should be always 1 (2nd position)
                          (isset($fixed_positions['iPage_key']) && $random_index[1] != $fixed_positions['iPage_key'])
                          ||
                          // Bluehost_key should be always 0 OR 2 (1st or 3nd position)
                          (
                            isset($fixed_positions['Bluehost_key']) 
                            && 
                            !($random_index[0] == $fixed_positions['Bluehost_key'] || $random_index[2] == $fixed_positions['Bluehost_key'])
                          )
                        );

                //dpm($random_index);

                foreach ($random_index as $key => $value) {
                  $view->result[$key] = $random_array[$value];
                }
                //dpm($view->result);
                */ 
                //----------------------------------------------------------------------

                
                ////$chart_themed = $view->preview($view_n_display['display']);
                //dpm($view->result);

                /*
                //watchdog('HR Home Rotation iteration', print_r($current_top_positions_counter, TRUE) . ', $_server -------> '. print_r($_SERVER, TRUE), NULL, WATCHDOG_WARNING);
                  ////watchdog('i-' . $current_top_positions_counter['iPage_top'] . ',b-' . $current_top_positions_counter['Bluehost_top'] . ',u-' . $current_top_positions_counter['current_uid'], print_r($current_top_positions_counter, TRUE) . ', $_server -------> '. print_r($_SERVER, TRUE), NULL, WATCHDOG_WARNING);

                  // $current_top_positions_counter = array(
              //        'iPage_top' => $current_top_positions_counter['iPage_top'] + 1,
              //        'Bluehost_top' => 0,
              //    );
                */
                //$info = '<div class="info" style="display: none;">iPage_top = ' . $current_top_positions_counter['iPage_top'] . ', Bluehost_top = ' . $current_top_positions_counter['Bluehost_top'] . '</div>';
  
  } // End of if ($view_n_display['display'] == 'bl_p_sip_rotated') {
  
  elseif ($view_n_display['display'] == 'block_top_bu_ppc') {
  
  
                $random_array = array_slice($view->result, 0, 5);


                foreach ($random_array as $key => $result) {
                  if ($result->nid == 12) {
                    //RingCentral page nid is 12
                    // Key should be always 1 (2nd position)
                    $fixed_positions['RingCentral_key'] = $key;
                  }
                  elseif ($result->nid == 36) {
                    //Vonage page nid is 36
                    // Key should be always 0 OR 2 (1st or 3nd position)
                    $fixed_positions['Vonage_key'] = $key;
                  }
                  elseif ($result->nid == 63) {
                    // Nextiva page nid is 63
                    // Nextiva never rotates into Position 1 or 3 (key 0 or 2) and stays in rotation only in P4 & 5 (key 3 or 4)
                    $fixed_positions['Nextiva_key'] = $key;
                  }
                  elseif ($result->nid == 88) {
                    // 8x8 page nid is 88
                    $fixed_positions['8x8_key'] = $key;
                  }
                }

                //dpm($random_array);
                $random_index = array(0, 1, 2, 3, 4);
                //shuffle($random_index);

                do {
                  shuffle($random_index);
                }while (
                          /*
                          // RingCentral_key should be always 1 (2nd position)
                          (isset($fixed_positions['RingCentral_key']) && $random_index[1] != $fixed_positions['RingCentral_key'])
                          ||
                          */
                          // RingCentral_key should be always 1,2,3 (2,3,4 positions)
                          (
                            isset($fixed_positions['RingCentral_key']) 
                            &&
                            !($random_index[1] == $fixed_positions['RingCentral_key'] || $random_index[2] == $fixed_positions['RingCentral_key'] || $random_index[3] == $fixed_positions['RingCentral_key'])
                          )
                          ||
                          // Vonage_key should be always 0 OR 2 (1st or 3nd position)
                          (
                            isset($fixed_positions['Vonage_key']) 
                            && 
                            !($random_index[0] == $fixed_positions['Vonage_key'] || $random_index[2] == $fixed_positions['Vonage_key'])
                          )
                          ||
                          // Nextiva never rotates into Position 1 or 3 (key 0 or 2) and stays in rotation only in P4 & 5 (key 3 or 4)
                          (
                            isset($fixed_positions['Nextiva_key']) 
                            && 
                            !($random_index[3] == $fixed_positions['Nextiva_key'] || $random_index[4] == $fixed_positions['Nextiva_key'])
                          )
                        );

                //dpm($random_index);

                foreach ($random_index as $key => $value) {
                  $view->result[$key] = $random_array[$value];
                }
                
                //dpm($view->result);
                // Set fixed rating score for each position
                // And correspondingly recreate fields with ratings
                $fixed_ratings = array(4.9, 4.8, 4.6, 4.5, 4.4, 4.2, 3.9, 3.9, 3.7);
                
                //if ($user->uid == 1) 
                {
                  foreach ($view->result as $position => $field) {
                      // Copy of the code at views for reviews in ppc providers: $value = gv_misc_getProviderQuickData('rating', array('data' => $data, 'target' => 'iframe')); // 'target' => 'iframe' is for _blank target for a link
                    
                    
                      $rating_count = $fixed_ratings[$position];
                      $stars = theme('gv_misc_fivestar_static', array('rating' => $rating_count*20, 'stars' => 5, 'tag' => 'overall', 'widget' => array('name' => 'stars', 'css' => 'stars.css')));
        
                      $view->result[$position]->views_php_10 = '
                        <div class="fivestars_n_count">
                            <div class="count">' . $rating_count . '<span> / 5</span></div>' .
                            $stars . 
                        '</div>
                        <div class="details"><a target="_blank"  rel="nofollow" href="' . url('node/' . $field->nid) . '"><div>Read Reviews</div></a></div>
                        ';
                    
                  }
                }
                
                //if (!$user->uid) 
                {
                  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
                  drupal_add_js($path_to_custom_js . 'gv_rotate_ppc_cached_page_table.js');
                }
                //dpm($view->result);


                ////$chart_themed = $view->preview($view_n_display['display']);
  }
  
  $chart_themed = $view->preview($view_n_display['display']);
  
  return $info . $chart_themed;
}


/*
 * Show popup Get quote for every provider in list by click on the Get Quote link.
 */
function gv_blocks_getQuotePopup_onLists() {
  
  
  // Colorbox for popup window.
  //1, 3, 4, 
  
  
  //$current_js_array = drupal_add_js();
  if (!isset($current_js_array['sites/all/libraries/jquery.plugins/colorbox/colorbox/jquery.colorbox-min.js']) && !isset($current_js_array['sites/all/libraries/jquery.plugins/colorbox/colorbox/jquery.colorbox.js']) ) 
    {
      //dpm($current_js_array);
      // Colorbox for popup window for exit intent.
      //possible versions for the design: 1, 3, 4, 
      drupal_add_js('sites/all/libraries/jquery.plugins/colorbox/colorbox/jquery.colorbox.js');
  }
  

  // Exit intent Ad block main js.
  $path_to_custom_js = drupal_get_path('module', 'gv_blocks') . '/js/';
  
  global $user;
  if ($user->uid == 1) {
    
    //return '';
    
    drupal_add_js($path_to_custom_js . 'gv_getQuotePopup_onLists_2.js');
    
    drupal_add_css('sites/all/libraries/jquery.plugins/colorbox/example3/colorbox.css', array('preprocess' => FALSE)); // array('group' => CSS_THEME, 'preprocess' => FALSE)
    
    $out = 
    '<div style="display: none;">
      <div id="block-gv-blocks-request-quote-v10" class="popup-request quote on-list">' 
        . gv_blocks_get_requestQuote_block_v10_popup_provider() .
     '</div>
    </div>';
  }
  else {
    drupal_add_js($path_to_custom_js . 'gv_getQuotePopup_onLists.js');
    
    drupal_add_css('sites/all/libraries/jquery.plugins/colorbox/example1/colorbox.css', array('preprocess' => FALSE)); // array('group' => CSS_THEME, 'preprocess' => FALSE)
  
    
    //$logo_block = '<div class="logo">' . theme('image_style', array( 'path' =>  $content['field_p_logo'][0]['#item']['uri'], 'style_name' => 'logo_provider_page', 'alt' => $provider_name . ' Reviews', 'title' => $provider_name . ' Reviews', 'attributes' => array('rel' => 'v:photo'))) . '</div>';
    $logo_block = '<div class="logo">'. 'LOGO' . '</div>';
    $provider_name = 'Name';


    $out = 
    '<div style="display: none;">
      <div id="block-gv-blocks-request-quote-v8" class="popup-request quote on-list">' 
        . $logo_block. '<div class="header"><div class="title">Request <span>'. $provider_name. '</span> Quote</div><div class="descr">In order to prepare a quote, we need some information about you</div></div>
        <div class="bottom-clear"></div>'
        . gv_blocks_get_requestQuote_block_v8_popup_provider() .

      '</div>
    </div>';
  }
  
  
  
  return $out;
}